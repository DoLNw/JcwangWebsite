!(function(){var Ky=(Ut,ae,O)=>new Promise((te,de)=>{var y=Y=>{try{P(O.next(Y))}catch(V){de(V)}},le=Y=>{try{P(O.throw(Y))}catch(V){de(V)}},P=Y=>Y.done?te(Y.value):Promise.resolve(Y.value).then(y,le);P((O=O.apply(Ut,ae)).next())});(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7801],{64183:function(Ut,ae,O){"use strict";var te=O(67294),de=O(64776),y=function(){return y=Object.assign||function(P){for(var Y,V=1,ue=arguments.length;V<ue;V++){Y=arguments[V];for(var H in Y)Object.prototype.hasOwnProperty.call(Y,H)&&(P[H]=Y[H])}return P},y.apply(this,arguments)},le=function(P){return te.createElement(de.P,y({},P,{chartType:"Area"}))};ae.Z=le},35099:function(Ut,ae,O){"use strict";var te=O(67294),de=O(64776),y=function(){return y=Object.assign||function(P){for(var Y,V=1,ue=arguments.length;V<ue;V++){Y=arguments[V];for(var H in Y)Object.prototype.hasOwnProperty.call(Y,H)&&(P[H]=Y[H])}return P},y.apply(this,arguments)},le=function(P){return te.createElement(de.P,y({},P,{chartType:"Gauge"}))};ae.Z=le},65337:function(Ut,ae,O){"use strict";var te=O(67294),de=O(64776),y=function(){return y=Object.assign||function(P){for(var Y,V=1,ue=arguments.length;V<ue;V++){Y=arguments[V];for(var H in Y)Object.prototype.hasOwnProperty.call(Y,H)&&(P[H]=Y[H])}return P},y.apply(this,arguments)},le=function(P){return te.createElement(de.P,y({},P,{chartType:"Liquid"}))};ae.Z=le},92688:function(Ut,ae,O){"use strict";var te=O(67294),de=O(64776),y=function(){return y=Object.assign||function(P){for(var Y,V=1,ue=arguments.length;V<ue;V++){Y=arguments[V];for(var H in Y)Object.prototype.hasOwnProperty.call(Y,H)&&(P[H]=Y[H])}return P},y.apply(this,arguments)},le=function(P){return te.createElement(de.P,y({},P,{chartType:"WordCloud"}))};ae.Z=le},88372:function(Ut,ae,O){"use strict";O.d(ae,{f:function(){return ge}});var te=O(4942),de=O(28459),y=O(93967),le=O.n(y),P=O(67294),Y=O(76509),V=O(1413),ue=O(98082),H=function(ye){return(0,te.Z)({},ye.componentCls,{width:"100%","&-wide":{maxWidth:1152,margin:"0 auto"}})};function Ae(ct){return(0,ue.Xj)("ProLayoutGridContent",function(ye){var St=(0,V.Z)((0,V.Z)({},ye),{},{componentCls:".".concat(ct)});return[H(St)]})}var Ce=O(85893),ge=function(ye){var St=(0,P.useContext)(Y.X),mt=ye.children,Ze=ye.contentWidth,ht=ye.className,it=ye.style,dr=(0,P.useContext)(de.ZP.ConfigContext),yr=dr.getPrefixCls,cr=ye.prefixCls||yr("pro"),ft=Ze||St.contentWidth,Pe="".concat(cr,"-grid-content"),Rt=Ae(Pe),Ve=Rt.wrapSSR,Vt=Rt.hashId,mr=ft==="Fixed"&&St.layout==="top";return Ve((0,Ce.jsx)("div",{className:le()(Pe,Vt,ht,(0,te.Z)({},"".concat(Pe,"-wide"),mr)),style:it,children:(0,Ce.jsx)("div",{className:"".concat(cr,"-grid-content-children ").concat(Vt).trim(),children:mt})}))}},83832:function(Ut,ae,O){"use strict";O.d(ae,{S:function(){return V}});var te=O(1413),de=O(91),y=O(75081),le=O(67294),P=O(85893),Y=["isLoading","pastDelay","timedOut","error","retry"],V=function(H){var Ae=H.isLoading,Ce=H.pastDelay,ge=H.timedOut,ct=H.error,ye=H.retry,St=(0,de.Z)(H,Y);return(0,P.jsx)("div",{style:{paddingBlockStart:100,textAlign:"center"},children:(0,P.jsx)(y.Z,(0,te.Z)({size:"large"},St))})}},76509:function(Ut,ae,O){"use strict";O.d(ae,{X:function(){return de}});var te=O(67294),de=(0,te.createContext)({})},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Ut){try{let H=function(){P||(P=!0,y())},Ae=function(){try{le.documentElement.doScroll("left")}catch(Ce){return void setTimeout(Ae,50)}H()};var V=H,ue=Ae,O=(O=document.getElementsByTagName("script"))[O.length-1],ae=O.getAttribute("data-injectcss"),O=O.getAttribute("data-disable-injectsvg");if(!O){var te,de,y,le,P,Y=function(ge,ct){ct.parentNode.insertBefore(ge,ct)};if(ae&&!Ut.__iconfont__svg__cssinject__){Ut.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(Ce){console&&console.log(Ce)}}te=function(){var ge,ct=document.createElement("div");ct.innerHTML=Ut._iconfont_svg_string_3580659,(ct=ct.getElementsByTagName("svg")[0])&&(ct.setAttribute("aria-hidden","true"),ct.style.position="absolute",ct.style.width=0,ct.style.height=0,ct.style.overflow="hidden",ct=ct,(ge=document.body).firstChild?Y(ct,ge.firstChild):ge.appendChild(ct))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(te,0):(de=function(){document.removeEventListener("DOMContentLoaded",de,!1),te()},document.addEventListener("DOMContentLoaded",de,!1)):document.attachEvent&&(y=te,le=Ut.document,P=!1,Ae(),le.onreadystatechange=function(){le.readyState=="complete"&&(le.onreadystatechange=null,H())})}}catch(H){}}(window)},10578:function(Ut){"use strict";var ae=Object.prototype.hasOwnProperty,O="~";function te(){}Object.create&&(te.prototype=Object.create(null),new te().__proto__||(O=!1));function de(Y,V,ue){this.fn=Y,this.context=V,this.once=ue||!1}function y(Y,V,ue,H,Ae){if(typeof ue!="function")throw new TypeError("The listener must be a function");var Ce=new de(ue,H||Y,Ae),ge=O?O+V:V;return Y._events[ge]?Y._events[ge].fn?Y._events[ge]=[Y._events[ge],Ce]:Y._events[ge].push(Ce):(Y._events[ge]=Ce,Y._eventsCount++),Y}function le(Y,V){--Y._eventsCount===0?Y._events=new te:delete Y._events[V]}function P(){this._events=new te,this._eventsCount=0}P.prototype.eventNames=function(){var V=[],ue,H;if(this._eventsCount===0)return V;for(H in ue=this._events)ae.call(ue,H)&&V.push(O?H.slice(1):H);return Object.getOwnPropertySymbols?V.concat(Object.getOwnPropertySymbols(ue)):V},P.prototype.listeners=function(V){var ue=O?O+V:V,H=this._events[ue];if(!H)return[];if(H.fn)return[H.fn];for(var Ae=0,Ce=H.length,ge=new Array(Ce);Ae<Ce;Ae++)ge[Ae]=H[Ae].fn;return ge},P.prototype.listenerCount=function(V){var ue=O?O+V:V,H=this._events[ue];return H?H.fn?1:H.length:0},P.prototype.emit=function(V,ue,H,Ae,Ce,ge){var ct=O?O+V:V;if(!this._events[ct])return!1;var ye=this._events[ct],St=arguments.length,mt,Ze;if(ye.fn){switch(ye.once&&this.removeListener(V,ye.fn,void 0,!0),St){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,ue),!0;case 3:return ye.fn.call(ye.context,ue,H),!0;case 4:return ye.fn.call(ye.context,ue,H,Ae),!0;case 5:return ye.fn.call(ye.context,ue,H,Ae,Ce),!0;case 6:return ye.fn.call(ye.context,ue,H,Ae,Ce,ge),!0}for(Ze=1,mt=new Array(St-1);Ze<St;Ze++)mt[Ze-1]=arguments[Ze];ye.fn.apply(ye.context,mt)}else{var ht=ye.length,it;for(Ze=0;Ze<ht;Ze++)switch(ye[Ze].once&&this.removeListener(V,ye[Ze].fn,void 0,!0),St){case 1:ye[Ze].fn.call(ye[Ze].context);break;case 2:ye[Ze].fn.call(ye[Ze].context,ue);break;case 3:ye[Ze].fn.call(ye[Ze].context,ue,H);break;case 4:ye[Ze].fn.call(ye[Ze].context,ue,H,Ae);break;default:if(!mt)for(it=1,mt=new Array(St-1);it<St;it++)mt[it-1]=arguments[it];ye[Ze].fn.apply(ye[Ze].context,mt)}}return!0},P.prototype.on=function(V,ue,H){return y(this,V,ue,H,!1)},P.prototype.once=function(V,ue,H){return y(this,V,ue,H,!0)},P.prototype.removeListener=function(V,ue,H,Ae){var Ce=O?O+V:V;if(!this._events[Ce])return this;if(!ue)return le(this,Ce),this;var ge=this._events[Ce];if(ge.fn)ge.fn===ue&&(!Ae||ge.once)&&(!H||ge.context===H)&&le(this,Ce);else{for(var ct=0,ye=[],St=ge.length;ct<St;ct++)(ge[ct].fn!==ue||Ae&&!ge[ct].once||H&&ge[ct].context!==H)&&ye.push(ge[ct]);ye.length?this._events[Ce]=ye.length===1?ye[0]:ye:le(this,Ce)}return this},P.prototype.removeAllListeners=function(V){var ue;return V?(ue=O?O+V:V,this._events[ue]&&le(this,ue)):(this._events=new te,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=O,P.EventEmitter=P,Ut.exports=P},36829:function(Ut){"use strict";var ae=Object.prototype.hasOwnProperty,O="~";function te(){}Object.create&&(te.prototype=Object.create(null),new te().__proto__||(O=!1));function de(Y,V,ue){this.fn=Y,this.context=V,this.once=ue||!1}function y(Y,V,ue,H,Ae){if(typeof ue!="function")throw new TypeError("The listener must be a function");var Ce=new de(ue,H||Y,Ae),ge=O?O+V:V;return Y._events[ge]?Y._events[ge].fn?Y._events[ge]=[Y._events[ge],Ce]:Y._events[ge].push(Ce):(Y._events[ge]=Ce,Y._eventsCount++),Y}function le(Y,V){--Y._eventsCount===0?Y._events=new te:delete Y._events[V]}function P(){this._events=new te,this._eventsCount=0}P.prototype.eventNames=function(){var V=[],ue,H;if(this._eventsCount===0)return V;for(H in ue=this._events)ae.call(ue,H)&&V.push(O?H.slice(1):H);return Object.getOwnPropertySymbols?V.concat(Object.getOwnPropertySymbols(ue)):V},P.prototype.listeners=function(V){var ue=O?O+V:V,H=this._events[ue];if(!H)return[];if(H.fn)return[H.fn];for(var Ae=0,Ce=H.length,ge=new Array(Ce);Ae<Ce;Ae++)ge[Ae]=H[Ae].fn;return ge},P.prototype.listenerCount=function(V){var ue=O?O+V:V,H=this._events[ue];return H?H.fn?1:H.length:0},P.prototype.emit=function(V,ue,H,Ae,Ce,ge){var ct=O?O+V:V;if(!this._events[ct])return!1;var ye=this._events[ct],St=arguments.length,mt,Ze;if(ye.fn){switch(ye.once&&this.removeListener(V,ye.fn,void 0,!0),St){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,ue),!0;case 3:return ye.fn.call(ye.context,ue,H),!0;case 4:return ye.fn.call(ye.context,ue,H,Ae),!0;case 5:return ye.fn.call(ye.context,ue,H,Ae,Ce),!0;case 6:return ye.fn.call(ye.context,ue,H,Ae,Ce,ge),!0}for(Ze=1,mt=new Array(St-1);Ze<St;Ze++)mt[Ze-1]=arguments[Ze];ye.fn.apply(ye.context,mt)}else{var ht=ye.length,it;for(Ze=0;Ze<ht;Ze++)switch(ye[Ze].once&&this.removeListener(V,ye[Ze].fn,void 0,!0),St){case 1:ye[Ze].fn.call(ye[Ze].context);break;case 2:ye[Ze].fn.call(ye[Ze].context,ue);break;case 3:ye[Ze].fn.call(ye[Ze].context,ue,H);break;case 4:ye[Ze].fn.call(ye[Ze].context,ue,H,Ae);break;default:if(!mt)for(it=1,mt=new Array(St-1);it<St;it++)mt[it-1]=arguments[it];ye[Ze].fn.apply(ye[Ze].context,mt)}}return!0},P.prototype.on=function(V,ue,H){return y(this,V,ue,H,!1)},P.prototype.once=function(V,ue,H){return y(this,V,ue,H,!0)},P.prototype.removeListener=function(V,ue,H,Ae){var Ce=O?O+V:V;if(!this._events[Ce])return this;if(!ue)return le(this,Ce),this;var ge=this._events[Ce];if(ge.fn)ge.fn===ue&&(!Ae||ge.once)&&(!H||ge.context===H)&&le(this,Ce);else{for(var ct=0,ye=[],St=ge.length;ct<St;ct++)(ge[ct].fn!==ue||Ae&&!ge[ct].once||H&&ge[ct].context!==H)&&ye.push(ge[ct]);ye.length?this._events[Ce]=ye.length===1?ye[0]:ye:le(this,Ce)}return this},P.prototype.removeAllListeners=function(V){var ue;return V?(ue=O?O+V:V,this._events[ue]&&le(this,ue)):(this._events=new te,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=O,P.EventEmitter=P,Ut.exports=P},15085:function(Ut){"use strict";var ae=Object.prototype.hasOwnProperty,O="~";function te(){}Object.create&&(te.prototype=Object.create(null),new te().__proto__||(O=!1));function de(Y,V,ue){this.fn=Y,this.context=V,this.once=ue||!1}function y(Y,V,ue,H,Ae){if(typeof ue!="function")throw new TypeError("The listener must be a function");var Ce=new de(ue,H||Y,Ae),ge=O?O+V:V;return Y._events[ge]?Y._events[ge].fn?Y._events[ge]=[Y._events[ge],Ce]:Y._events[ge].push(Ce):(Y._events[ge]=Ce,Y._eventsCount++),Y}function le(Y,V){--Y._eventsCount===0?Y._events=new te:delete Y._events[V]}function P(){this._events=new te,this._eventsCount=0}P.prototype.eventNames=function(){var V=[],ue,H;if(this._eventsCount===0)return V;for(H in ue=this._events)ae.call(ue,H)&&V.push(O?H.slice(1):H);return Object.getOwnPropertySymbols?V.concat(Object.getOwnPropertySymbols(ue)):V},P.prototype.listeners=function(V){var ue=O?O+V:V,H=this._events[ue];if(!H)return[];if(H.fn)return[H.fn];for(var Ae=0,Ce=H.length,ge=new Array(Ce);Ae<Ce;Ae++)ge[Ae]=H[Ae].fn;return ge},P.prototype.listenerCount=function(V){var ue=O?O+V:V,H=this._events[ue];return H?H.fn?1:H.length:0},P.prototype.emit=function(V,ue,H,Ae,Ce,ge){var ct=O?O+V:V;if(!this._events[ct])return!1;var ye=this._events[ct],St=arguments.length,mt,Ze;if(ye.fn){switch(ye.once&&this.removeListener(V,ye.fn,void 0,!0),St){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,ue),!0;case 3:return ye.fn.call(ye.context,ue,H),!0;case 4:return ye.fn.call(ye.context,ue,H,Ae),!0;case 5:return ye.fn.call(ye.context,ue,H,Ae,Ce),!0;case 6:return ye.fn.call(ye.context,ue,H,Ae,Ce,ge),!0}for(Ze=1,mt=new Array(St-1);Ze<St;Ze++)mt[Ze-1]=arguments[Ze];ye.fn.apply(ye.context,mt)}else{var ht=ye.length,it;for(Ze=0;Ze<ht;Ze++)switch(ye[Ze].once&&this.removeListener(V,ye[Ze].fn,void 0,!0),St){case 1:ye[Ze].fn.call(ye[Ze].context);break;case 2:ye[Ze].fn.call(ye[Ze].context,ue);break;case 3:ye[Ze].fn.call(ye[Ze].context,ue,H);break;case 4:ye[Ze].fn.call(ye[Ze].context,ue,H,Ae);break;default:if(!mt)for(it=1,mt=new Array(St-1);it<St;it++)mt[it-1]=arguments[it];ye[Ze].fn.apply(ye[Ze].context,mt)}}return!0},P.prototype.on=function(V,ue,H){return y(this,V,ue,H,!1)},P.prototype.once=function(V,ue,H){return y(this,V,ue,H,!0)},P.prototype.removeListener=function(V,ue,H,Ae){var Ce=O?O+V:V;if(!this._events[Ce])return this;if(!ue)return le(this,Ce),this;var ge=this._events[Ce];if(ge.fn)ge.fn===ue&&(!Ae||ge.once)&&(!H||ge.context===H)&&le(this,Ce);else{for(var ct=0,ye=[],St=ge.length;ct<St;ct++)(ge[ct].fn!==ue||Ae&&!ge[ct].once||H&&ge[ct].context!==H)&&ye.push(ge[ct]);ye.length?this._events[Ce]=ye.length===1?ye[0]:ye:le(this,Ce)}return this},P.prototype.removeAllListeners=function(V){var ue;return V?(ue=O?O+V:V,this._events[ue]&&le(this,ue)):(this._events=new te,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=O,P.EventEmitter=P,Ut.exports=P},83557:function(Ut,ae,O){var te=O(34155);var de;(function(y){(function(le){var P=typeof O.g=="object"?O.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Y=V(y);typeof P.Reflect=="undefined"?P.Reflect=y:Y=V(P.Reflect,Y),le(Y);function V(ue,H){return function(Ae,Ce){typeof ue[Ae]!="function"&&Object.defineProperty(ue,Ae,{configurable:!0,writable:!0,value:Ce}),H&&H(Ae,Ce)}}})(function(le){var P=Object.prototype.hasOwnProperty,Y=typeof Symbol=="function",V=Y&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ue=Y&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",H=typeof Object.create=="function",Ae={__proto__:[]}instanceof Array,Ce=!H&&!Ae,ge={create:H?function(){return To(Object.create(null))}:Ae?function(){return To({__proto__:null})}:function(){return To({})},has:Ce?function(Gt,br){return P.call(Gt,br)}:function(Gt,br){return br in Gt},get:Ce?function(Gt,br){return P.call(Gt,br)?Gt[br]:void 0}:function(Gt,br){return Gt[br]}},ct=Object.getPrototypeOf(Function),ye=typeof te=="object"&&te["env"]&&te["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",St=!ye&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:da(),mt=!ye&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:so(),Ze=!ye&&typeof WeakMap=="function"?WeakMap:po(),ht=new Ze;function it(Gt,br,Gr,rn){if(kt(Gr)){if(!jn(Gt))throw new TypeError;if(!hn(br))throw new TypeError;return ie(Gt,br)}else{if(!jn(Gt))throw new TypeError;if(!Ir(br))throw new TypeError;if(!Ir(rn)&&!kt(rn)&&!Vr(rn))throw new TypeError;return Vr(rn)&&(rn=void 0),Gr=Lr(Gr),j(Gt,br,Gr,rn)}}le("decorate",it);function dr(Gt,br){function Gr(rn,yn){if(!Ir(rn))throw new TypeError;if(!kt(yn)&&!qi(yn))throw new TypeError;Qe(Gt,br,rn,yn)}return Gr}le("metadata",dr);function yr(Gt,br,Gr,rn){if(!Ir(Gr))throw new TypeError;return kt(rn)||(rn=Lr(rn)),Qe(Gt,br,Gr,rn)}le("defineMetadata",yr);function cr(Gt,br,Gr){if(!Ir(br))throw new TypeError;return kt(Gr)||(Gr=Lr(Gr)),ke(Gt,br,Gr)}le("hasMetadata",cr);function ft(Gt,br,Gr){if(!Ir(br))throw new TypeError;return kt(Gr)||(Gr=Lr(Gr)),Te(Gt,br,Gr)}le("hasOwnMetadata",ft);function Pe(Gt,br,Gr){if(!Ir(br))throw new TypeError;return kt(Gr)||(Gr=Lr(Gr)),st(Gt,br,Gr)}le("getMetadata",Pe);function Rt(Gt,br,Gr){if(!Ir(br))throw new TypeError;return kt(Gr)||(Gr=Lr(Gr)),ze(Gt,br,Gr)}le("getOwnMetadata",Rt);function Ve(Gt,br){if(!Ir(Gt))throw new TypeError;return kt(br)||(br=Lr(br)),at(Gt,br)}le("getMetadataKeys",Ve);function Vt(Gt,br){if(!Ir(Gt))throw new TypeError;return kt(br)||(br=Lr(br)),Mt(Gt,br)}le("getOwnMetadataKeys",Vt);function mr(Gt,br,Gr){if(!Ir(br))throw new TypeError;kt(Gr)||(Gr=Lr(Gr));var rn=re(br,Gr,!1);if(kt(rn)||!rn.delete(Gt))return!1;if(rn.size>0)return!0;var yn=ht.get(br);return yn.delete(Gr),yn.size>0||ht.delete(br),!0}le("deleteMetadata",mr);function ie(Gt,br){for(var Gr=Gt.length-1;Gr>=0;--Gr){var rn=Gt[Gr],yn=rn(br);if(!kt(yn)&&!Vr(yn)){if(!hn(yn))throw new TypeError;br=yn}}return br}function j(Gt,br,Gr,rn){for(var yn=Gt.length-1;yn>=0;--yn){var Ci=Gt[yn],he=Ci(br,Gr,rn);if(!kt(he)&&!Vr(he)){if(!Ir(he))throw new TypeError;rn=he}}return rn}function re(Gt,br,Gr){var rn=ht.get(Gt);if(kt(rn)){if(!Gr)return;rn=new St,ht.set(Gt,rn)}var yn=rn.get(br);if(kt(yn)){if(!Gr)return;yn=new St,rn.set(br,yn)}return yn}function ke(Gt,br,Gr){var rn=Te(Gt,br,Gr);if(rn)return!0;var yn=aa(br);return Vr(yn)?!1:ke(Gt,yn,Gr)}function Te(Gt,br,Gr){var rn=re(br,Gr,!1);return kt(rn)?!1:nn(rn.has(Gt))}function st(Gt,br,Gr){var rn=Te(Gt,br,Gr);if(rn)return ze(Gt,br,Gr);var yn=aa(br);if(!Vr(yn))return st(Gt,yn,Gr)}function ze(Gt,br,Gr){var rn=re(br,Gr,!1);if(!kt(rn))return rn.get(Gt)}function Qe(Gt,br,Gr,rn){var yn=re(Gr,rn,!0);yn.set(Gt,br)}function at(Gt,br){var Gr=Mt(Gt,br),rn=aa(Gt);if(rn===null)return Gr;var yn=at(rn,br);if(yn.length<=0)return Gr;if(Gr.length<=0)return yn;for(var Ci=new mt,he=[],L=0,z=Gr;L<z.length;L++){var fe=z[L],Re=Ci.has(fe);Re||(Ci.add(fe),he.push(fe))}for(var Ue=0,$t=yn;Ue<$t.length;Ue++){var fe=$t[Ue],Re=Ci.has(fe);Re||(Ci.add(fe),he.push(fe))}return he}function Mt(Gt,br){var Gr=[],rn=re(Gt,br,!1);if(kt(rn))return Gr;for(var yn=rn.keys(),Ci=ia(yn),he=0;;){var L=Se(Ci);if(!L)return Gr.length=he,Gr;var z=ta(L);try{Gr[he]=z}catch(fe){try{Ni(Ci)}finally{throw fe}}he++}}function vr(Gt){if(Gt===null)return 1;switch(typeof Gt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Gt===null?1:6;default:return 6}}function kt(Gt){return Gt===void 0}function Vr(Gt){return Gt===null}function Kr(Gt){return typeof Gt=="symbol"}function Ir(Gt){return typeof Gt=="object"?Gt!==null:typeof Gt=="function"}function In(Gt,br){switch(vr(Gt)){case 0:return Gt;case 1:return Gt;case 2:return Gt;case 3:return Gt;case 4:return Gt;case 5:return Gt}var Gr=br===3?"string":br===5?"number":"default",rn=Ei(Gt,V);if(rn!==void 0){var yn=rn.call(Gt,Gr);if(Ir(yn))throw new TypeError;return yn}return gn(Gt,Gr==="default"?"number":Gr)}function gn(Gt,br){if(br==="string"){var Gr=Gt.toString;if(jr(Gr)){var rn=Gr.call(Gt);if(!Ir(rn))return rn}var yn=Gt.valueOf;if(jr(yn)){var rn=yn.call(Gt);if(!Ir(rn))return rn}}else{var yn=Gt.valueOf;if(jr(yn)){var rn=yn.call(Gt);if(!Ir(rn))return rn}var Ci=Gt.toString;if(jr(Ci)){var rn=Ci.call(Gt);if(!Ir(rn))return rn}}throw new TypeError}function nn(Gt){return!!Gt}function hi(Gt){return""+Gt}function Lr(Gt){var br=In(Gt,3);return Kr(br)?br:hi(br)}function jn(Gt){return Array.isArray?Array.isArray(Gt):Gt instanceof Object?Gt instanceof Array:Object.prototype.toString.call(Gt)==="[object Array]"}function jr(Gt){return typeof Gt=="function"}function hn(Gt){return typeof Gt=="function"}function qi(Gt){switch(vr(Gt)){case 3:return!0;case 4:return!0;default:return!1}}function Ei(Gt,br){var Gr=Gt[br];if(Gr!=null){if(!jr(Gr))throw new TypeError;return Gr}}function ia(Gt){var br=Ei(Gt,ue);if(!jr(br))throw new TypeError;var Gr=br.call(Gt);if(!Ir(Gr))throw new TypeError;return Gr}function ta(Gt){return Gt.value}function Se(Gt){var br=Gt.next();return br.done?!1:br}function Ni(Gt){var br=Gt.return;br&&br.call(Gt)}function aa(Gt){var br=Object.getPrototypeOf(Gt);if(typeof Gt!="function"||Gt===ct||br!==ct)return br;var Gr=Gt.prototype,rn=Gr&&Object.getPrototypeOf(Gr);if(rn==null||rn===Object.prototype)return br;var yn=rn.constructor;return typeof yn!="function"||yn===Gt?br:yn}function da(){var Gt={},br=[],Gr=function(){function he(L,z,fe){this._index=0,this._keys=L,this._values=z,this._selector=fe}return he.prototype["@@iterator"]=function(){return this},he.prototype[ue]=function(){return this},he.prototype.next=function(){var L=this._index;if(L>=0&&L<this._keys.length){var z=this._selector(this._keys[L],this._values[L]);return L+1>=this._keys.length?(this._index=-1,this._keys=br,this._values=br):this._index++,{value:z,done:!1}}return{value:void 0,done:!0}},he.prototype.throw=function(L){throw this._index>=0&&(this._index=-1,this._keys=br,this._values=br),L},he.prototype.return=function(L){return this._index>=0&&(this._index=-1,this._keys=br,this._values=br),{value:L,done:!0}},he}();return function(){function he(){this._keys=[],this._values=[],this._cacheKey=Gt,this._cacheIndex=-2}return Object.defineProperty(he.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),he.prototype.has=function(L){return this._find(L,!1)>=0},he.prototype.get=function(L){var z=this._find(L,!1);return z>=0?this._values[z]:void 0},he.prototype.set=function(L,z){var fe=this._find(L,!0);return this._values[fe]=z,this},he.prototype.delete=function(L){var z=this._find(L,!1);if(z>=0){for(var fe=this._keys.length,Re=z+1;Re<fe;Re++)this._keys[Re-1]=this._keys[Re],this._values[Re-1]=this._values[Re];return this._keys.length--,this._values.length--,L===this._cacheKey&&(this._cacheKey=Gt,this._cacheIndex=-2),!0}return!1},he.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Gt,this._cacheIndex=-2},he.prototype.keys=function(){return new Gr(this._keys,this._values,rn)},he.prototype.values=function(){return new Gr(this._keys,this._values,yn)},he.prototype.entries=function(){return new Gr(this._keys,this._values,Ci)},he.prototype["@@iterator"]=function(){return this.entries()},he.prototype[ue]=function(){return this.entries()},he.prototype._find=function(L,z){return this._cacheKey!==L&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=L)),this._cacheIndex<0&&z&&(this._cacheIndex=this._keys.length,this._keys.push(L),this._values.push(void 0)),this._cacheIndex},he}();function rn(he,L){return he}function yn(he,L){return L}function Ci(he,L){return[he,L]}}function so(){return function(){function Gt(){this._map=new St}return Object.defineProperty(Gt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Gt.prototype.has=function(br){return this._map.has(br)},Gt.prototype.add=function(br){return this._map.set(br,br),this},Gt.prototype.delete=function(br){return this._map.delete(br)},Gt.prototype.clear=function(){this._map.clear()},Gt.prototype.keys=function(){return this._map.keys()},Gt.prototype.values=function(){return this._map.values()},Gt.prototype.entries=function(){return this._map.entries()},Gt.prototype["@@iterator"]=function(){return this.keys()},Gt.prototype[ue]=function(){return this.keys()},Gt}()}function po(){var Gt=16,br=ge.create(),Gr=rn();return function(){function z(){this._key=rn()}return z.prototype.has=function(fe){var Re=yn(fe,!1);return Re!==void 0?ge.has(Re,this._key):!1},z.prototype.get=function(fe){var Re=yn(fe,!1);return Re!==void 0?ge.get(Re,this._key):void 0},z.prototype.set=function(fe,Re){var Ue=yn(fe,!0);return Ue[this._key]=Re,this},z.prototype.delete=function(fe){var Re=yn(fe,!1);return Re!==void 0?delete Re[this._key]:!1},z.prototype.clear=function(){this._key=rn()},z}();function rn(){var z;do z="@@WeakMap@@"+L();while(ge.has(br,z));return br[z]=!0,z}function yn(z,fe){if(!P.call(z,Gr)){if(!fe)return;Object.defineProperty(z,Gr,{value:ge.create()})}return z[Gr]}function Ci(z,fe){for(var Re=0;Re<fe;++Re)z[Re]=Math.random()*255|0;return z}function he(z){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(z)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(z)):Ci(new Uint8Array(z),z):Ci(new Array(z),z)}function L(){var z=he(Gt);z[6]=z[6]&79|64,z[8]=z[8]&191|128;for(var fe="",Re=0;Re<Gt;++Re){var Ue=z[Re];(Re===4||Re===6||Re===8)&&(fe+="-"),Ue<16&&(fe+="0"),fe+=Ue.toString(16).toLowerCase()}return fe}}function To(Gt){return Gt.__=void 0,delete Gt.__,Gt}})})(de||(de={}))},14394:function(Ut,ae,O){"use strict";O.d(ae,{zP:function(){return hF},JE:function(){return cB},ns:function(){return fF}});var te=O(67294),de=(0,te.createContext)({});function y(){return(0,te.useContext)(de)}var le={},P={},Y=function(r){return P[r]},V=function(r,t){P[r]=t},ue=function(r){return le[r]},H=function(r,t){le[r]=t},Ae={},Ce={},ge=34,ct=10,ye=13;function St(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function mt(e,r){var t=St(e);return function(n,i){return r(t(n),i,e)}}function Ze(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function ht(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function it(e){return e<0?"-"+ht(-e,6):e>9999?"+"+ht(e,6):ht(e,4)}function dr(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":it(e.getUTCFullYear(),4)+"-"+ht(e.getUTCMonth()+1,2)+"-"+ht(e.getUTCDate(),2)+(i?"T"+ht(r,2)+":"+ht(t,2)+":"+ht(n,2)+"."+ht(i,3)+"Z":n?"T"+ht(r,2)+":"+ht(t,2)+":"+ht(n,2)+"Z":t||r?"T"+ht(r,2)+":"+ht(t,2)+"Z":"")}function yr(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(x,A){var C,I,D=i(x,function(Z,J){if(C)return C(Z,J-1);I=Z,C=A?mt(Z,A):St(Z)});return D.columns=I||[],D}function i(x,A){var C=[],I=x.length,D=0,Z=0,J,ce=I<=0,xe=!1;x.charCodeAt(I-1)===ct&&--I,x.charCodeAt(I-1)===ye&&--I;function Xe(){if(ce)return Ce;if(xe)return xe=!1,Ae;var pt,et=D,Pt;if(x.charCodeAt(et)===ge){for(;D++<I&&x.charCodeAt(D)!==ge||x.charCodeAt(++D)===ge;);return(pt=D)>=I?ce=!0:(Pt=x.charCodeAt(D++))===ct?xe=!0:Pt===ye&&(xe=!0,x.charCodeAt(D)===ct&&++D),x.slice(et+1,pt-1).replace(/""/g,'"')}for(;D<I;){if((Pt=x.charCodeAt(pt=D++))===ct)xe=!0;else if(Pt===ye)xe=!0,x.charCodeAt(D)===ct&&++D;else if(Pt!==t)continue;return x.slice(et,pt)}return ce=!0,x.slice(et,I)}for(;(J=Xe())!==Ce;){for(var bt=[];J!==Ae&&J!==Ce;)bt.push(J),J=Xe();A&&(bt=A(bt,Z++))==null||C.push(bt)}return C}function a(x,A){return x.map(function(C){return A.map(function(I){return _(C[I])}).join(e)})}function s(x,A){return A==null&&(A=Ze(x)),[A.map(_).join(e)].concat(a(x,A)).join(`
`)}function l(x,A){return A==null&&(A=Ze(x)),a(x,A).join(`
`)}function f(x){return x.map(d).join(`
`)}function d(x){return x.map(_).join(e)}function _(x){return x==null?"":x instanceof Date?dr(x):r.test(x+="")?'"'+x.replace(/"/g,'""')+'"':x}return{parse:n,parseRows:i,format:s,formatBody:l,formatRows:f,formatRow:d,formatValue:_}}var cr=yr(","),ft=cr.parse,Pe=cr.parseRows,Rt=cr.format,Ve=cr.formatBody,Vt=cr.formatRows,mr=cr.formatRow,ie=cr.formatValue,j=O(1413),re=63710088e-1,ke={centimeters:re*100,centimetres:re*100,degrees:re/111325,feet:re*3.28084,inches:re*39.37,kilometers:re/1e3,kilometres:re/1e3,meters:re,metres:re,miles:re/1609.344,millimeters:re*1e3,millimetres:re*1e3,nauticalmiles:re/1852,radians:1,yards:re*1.0936},Te={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/re,yards:1.0936133},st={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ze(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function Qe(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return at(r).geometry;case"LineString":return Vr(r).geometry;case"Polygon":return vr(r).geometry;case"MultiPoint":return gn(r).geometry;case"MultiLineString":return In(r).geometry;case"MultiPolygon":return nn(r).geometry;default:throw new Error(e+" is invalid")}}function at(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ni(e[0])||!Ni(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return ze(n,r,t)}function Mt(e,r,t){return t===void 0&&(t={}),Ir(e.map(function(n){return at(n,r)}),t)}function vr(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return ze(l,r,t)}function kt(e,r,t){return t===void 0&&(t={}),Ir(e.map(function(n){return vr(n,r)}),t)}function Vr(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return ze(n,r,t)}function Kr(e,r,t){return t===void 0&&(t={}),Ir(e.map(function(n){return Vr(n,r)}),t)}function Ir(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function In(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return ze(n,r,t)}function gn(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return ze(n,r,t)}function nn(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return ze(n,r,t)}function hi(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return ze(n,r,t)}function Lr(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function jn(e,r){r===void 0&&(r="kilometers");var t=ke[r];if(!t)throw new Error(r+" units is invalid");return e*t}function jr(e,r){r===void 0&&(r="kilometers");var t=ke[r];if(!t)throw new Error(r+" units is invalid");return e/t}function hn(e,r){return Ei(jr(e,r))}function qi(e){var r=e%360;return r<0&&(r+=360),r}function Ei(e){var r=e%(2*Math.PI);return r*180/Math.PI}function ia(e){var r=e%360;return r*Math.PI/180}function ta(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return jn(jr(e,r),t)}function Se(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=st[r];if(!n)throw new Error("invalid original units");var i=st[t];if(!i)throw new Error("invalid final units");return e/n*i}function Ni(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function aa(e){return!!e&&e.constructor===Object}function da(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!Ni(r))throw new Error("bbox must only contain numbers")})}function so(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function po(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function To(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Gt(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Gt(e[0]);throw new Error("coordinates must only contain numbers")}function br(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function Gr(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function rn(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+a.geometry.type)}}function yn(e){return e.type==="Feature"?e.geometry:e}function Ci(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function he(e,r,t){if(e!==null)for(var n,i,a,s,l,f,d,_=0,x=0,A,C=e.type,I=C==="FeatureCollection",D=C==="Feature",Z=I?e.features.length:1,J=0;J<Z;J++){d=I?e.features[J].geometry:D?e.geometry:e,A=d?d.type==="GeometryCollection":!1,l=A?d.geometries.length:1;for(var ce=0;ce<l;ce++){var xe=0,Xe=0;if(s=A?d.geometries[ce]:d,s!==null){f=s.coordinates;var bt=s.type;switch(_=t&&(bt==="Polygon"||bt==="MultiPolygon")?1:0,bt){case null:break;case"Point":if(r(f,x,J,xe,Xe)===!1)return!1;x++,xe++;break;case"LineString":case"MultiPoint":for(n=0;n<f.length;n++){if(r(f[n],x,J,xe,Xe)===!1)return!1;x++,bt==="MultiPoint"&&xe++}bt==="LineString"&&xe++;break;case"Polygon":case"MultiLineString":for(n=0;n<f.length;n++){for(i=0;i<f[n].length-_;i++){if(r(f[n][i],x,J,xe,Xe)===!1)return!1;x++}bt==="MultiLineString"&&xe++,bt==="Polygon"&&Xe++}bt==="Polygon"&&xe++;break;case"MultiPolygon":for(n=0;n<f.length;n++){for(Xe=0,i=0;i<f[n].length;i++){for(a=0;a<f[n][i].length-_;a++){if(r(f[n][i][a],x,J,xe,Xe)===!1)return!1;x++}Xe++}xe++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(he(s.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function L(e,r,t,n){var i=t;return he(e,function(a,s,l,f,d){s===0&&t===void 0?i=a:i=r(i,a,s,l,f,d)},n),i}function z(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function fe(e,r,t){var n=t;return z(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function Re(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function Ue(e,r,t){var n=t;return Re(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function $t(e){var r=[];return he(e,function(t){r.push(t)}),r}function Lt(e,r){var t,n,i,a,s,l,f,d,_,x,A=0,C=e.type==="FeatureCollection",I=e.type==="Feature",D=C?e.features.length:1;for(t=0;t<D;t++){for(l=C?e.features[t].geometry:I?e.geometry:e,d=C?e.features[t].properties:I?e.properties:{},_=C?e.features[t].bbox:I?e.bbox:void 0,x=C?e.features[t].id:I?e.id:void 0,f=l?l.type==="GeometryCollection":!1,s=f?l.geometries.length:1,i=0;i<s;i++){if(a=f?l.geometries[i]:l,a===null){if(r(null,A,d,_,x)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,A,d,_,x)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],A,d,_,x)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Bt(e,r,t){var n=t;return Lt(e,function(i,a,s,l,f){a===0&&t===void 0?n=i:n=r(n,i,a,s,l,f)}),n}function xt(e,r){Lt(e,function(t,n,i,a,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(ze(t,i,{bbox:a,id:s}),n,0)===!1?!1:void 0}var f;switch(l){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var d=0;d<t.coordinates.length;d++){var _=t.coordinates[d],x={type:f,coordinates:_};if(r(ze(x,i),n,d)===!1)return!1}})}function U(e,r,t){var n=t;return xt(e,function(i,a,s){a===0&&s===0&&t===void 0?n=i:n=r(n,i,a,s)}),n}function N(e,r){xt(e,function(t,n,i){var a=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,f=0,d=0,_=0;if(he(t,function(x,A,C,I,D){if(l===void 0||n>f||I>d||D>_){l=x,f=n,d=I,_=D,a=0;return}var Z=lineString([l,x],t.properties);if(r(Z,n,i,D,a)===!1)return!1;a++,l=x})===!1)return!1}}})}function q(e,r,t){var n=t,i=!1;return N(e,function(a,s,l,f,d){i===!1&&t===void 0?n=a:n=r(n,a,s,l,f,d),i=!0}),n}function se(e,r){if(!e)throw new Error("geojson is required");xt(e,function(t,n,i){if(t.geometry!==null){var a=t.geometry.type,s=t.geometry.coordinates;switch(a){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(r(lineString(s[l],t.properties),n,i,l)===!1)return!1;break}}})}function Me(e,r,t){var n=t;return se(e,function(i,a,s,l){a===0&&t===void 0?n=i:n=r(n,i,a,s,l)}),n}function We(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.segmentIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=f.length+a-1),lineString([f[a],f[a+1]],s,r);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a-1),lineString([f[i][a],f[i][a+1]],s,r);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a-1),lineString([f[n][a],f[n][a+1]],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a-1),lineString([f[n][i][a],f[n][i][a+1]],s,r)}throw new Error("geojson is invalid")}function ut(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.coordIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":return point(f,s,r);case"MultiPoint":return n<0&&(n=f.length+n),point(f[n],s,r);case"LineString":return a<0&&(a=f.length+a),point(f[a],s,r);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a),point(f[i][a],s,r);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a),point(f[n][a],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a),point(f[n][i][a],s,r)}throw new Error("geojson is invalid")}var W=O(43144),ne=O(15671),je=O(60136),lt=O(82963),Ie=O(61120),Kt=O(89611);function Er(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(r){return typeof e=="function"}}var sn=O(78814);function un(e,r,t){if((0,sn.Z)())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,r);var i=new(e.bind.apply(e,n));return t&&(0,Kt.Z)(i,t.prototype),i}function nr(e){var r=typeof Map=="function"?new Map:void 0;return nr=function(n){if(n===null||!Er(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return un(n,arguments,(0,Ie.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,Kt.Z)(i,n)},nr(e)}var Qr={REGISTERED_PROTOCOLS:{}};function Hr(e){var r=$r();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function $r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oi=function(r){return Qr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]},pn=function(e){(0,je.Z)(t,e);var r=Hr(t);function t(n,i,a,s){var l;return(0,ne.Z)(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=s,l}return(0,W.Z)(t)}(nr(Error));function mi(e,r){var t=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(e.type==="json")try{a=JSON.parse(t.response)}catch(l){return r(l)}r(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var s=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new pn(t.status,t.statusText,n.toString(),s))}},t.cancel=t.abort,t.send(e.body),t}function Gi(e){return new Promise(function(r,t){mi(e,function(n,i,a,s,l){n?t({err:n,data:null,xhr:l}):r({err:null,data:i,cacheControl:a,expires:s,xhr:l})})})}function di(e,r){return mi(e,r)}var zi=function(r,t){var n=oi(r.url)||di;return n((0,j.Z)((0,j.Z)({},r),{},{type:"json"}),t)},Ri=function(r,t){var n=oi(r.url)||di;return n((0,j.Z)((0,j.Z)({},r),{},{type:"arrayBuffer"}),t)},ss=function(r,t){return di(_objectSpread(_objectSpread({},r),{},{method:"POST"}),t)},oa=function(r,t){return di((0,j.Z)((0,j.Z)({},r),{},{method:"GET"}),t)};function La(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var Mi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function yi(e,r){var t=new window.Image,n=window.URL||window.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Mi})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):Mi}function Ii(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Ba=function(r,t,n){var i=function(s,l){if(s)t(s);else if(l){var f=typeof createImageBitmap=="function",d=n?n(l):l;f?Ii(d,t):yi(d,t)}};return r.type==="json"?zi(r,i):Ri(r,i)},vu=function(r,t){var n=typeof createImageBitmap=="function";n?Ii(r,t):yi(r,t)},_a=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Ia={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hl(e,r,t){var n=e.classList;for(var i in Ia)Ia.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}var Ho=O(16372);function Pa(e){return typeof e=="string"?!!d3.color(e):!1}function bi(e){var r=Ho.ZP(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function Fa(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function ca(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Wo(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=null,i=t.createLinearGradient(0,0,256,1),a=e.positions[0],s=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var f=(e.positions[l]-a)/(s-a);i.addColorStop(f,e.colors[l])}return t.fillStyle=i,t.fillRect(0,0,256,1),n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1}}function ma(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var i=n.createLinearGradient(0,0,256,1),a=r[1]-r[0],s=0;s<e.colors.length;++s){var l=Math.max((e.positions[s]-r[0])/a,0);i.addColorStop(l,e.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1);var f=n.getImageData(0,0,256,1).data,d=gs(n,f);return t=null,n=null,d}function us(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var s=bi(e.colors[a]);n.data[i*4+0]=s[0]*255,n.data[i*4+1]=s[1]*255,n.data[i*4+2]=s[2]*255,n.data[i*4+3]=s[3]*255}),r=null,t=null,n}function Qo(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");t.globalAlpha=1,r.width=256,r.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[i],t.moveTo(i*n,0),t.lineTo((i+1)*n,0),t.stroke();var a=t.getImageData(0,0,256,1).data,s=gs(t,a);return r=null,t=null,s}function Bu(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var i=r[1]-r[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-r[0])/i*255,0),n.lineTo((e.positions[a+1]-r[0])/i*255,0),n.stroke();var s=n.getImageData(0,0,256,1).data,l=gs(n,s);return t=null,n=null,l}function gs(e,r){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=r[n+0],t.data[n+1]=r[n+1],t.data[n+2]=r[n+2],t.data[n+3]=r[n+3];return t}function xc(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var Ra={BACK:1029,FRONT:1028};function sa(e){switch(e){case"GAODE1.x":return Ra.BACK;case"GAODE2.x":return Ra.BACK;case"MAPBOX":return Ra.FRONT;case"SIMPLE":return Ra.FRONT;case"GLOBEL":return Ra.BACK;case"DEBAULT":return Ra.FRONT;default:return Ra.FRONT}}var er=O(74902),Rn=O(97685),Ee=O(74691),Ne=O.n(Ee),Tt=O(50361),fr=O.n(Tt),tn=O(23279),Bn=O.n(tn),Xi=O(27361),yo=O.n(Xi),wo=O(51584),vo=O.n(wo),Bs=O(18446),Rs=O.n(Bs),ep=O(14293),Sf=O.n(ep),Jo=O(81763),Tl=O.n(Jo),wl=O(68630),Fu=O.n(wl),Nu=O(47037),el=O.n(Nu),qc=O(36719),Fs=O.n(qc),ro=O(82492),Cl=O.n(ro),tl=O(30236),Af=O.n(tl),tp=O(97019),Tf=O.n(tp),dh=O(23493),vh=O.n(dh),mh=O(44908),rp=O.n(mh),np=O(11700),Gp=O.n(np),Kc=O(23560),Uu=O.n(Kc),ip=O(13218),es=O.n(ip),Wl=O(52353),Rl=O.n(Wl),Ks=O(68929),Ml=O.n(Ks),pi={isNil:Sf(),merge:Cl(),throttle:vh(),isString:el(),debounce:Bn(),pull:Tf(),isTypedArray:Fs(),isPlainObject:Fu(),isNumber:Tl(),isBoolean:vo(),isEqual:Rs(),cloneDeep:fr(),uniq:rp(),clamp:Ne(),upperFirst:Gp(),get:yo(),mergeWith:Af(),isFunction:Uu(),isObject:es(),isUndefined:Rl(),camelCase:Ml()},rl=pi.pull;function Ns(e){var r=e;return typeof e=="string"&&(r=window.document.getElementById(e)),r}function zu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function nl(e){return zu(e).split(/\s+/)}function ap(e){var r,t=(r=document)===null||r===void 0||(r=r.documentElement)===null||r===void 0?void 0:r.style;if(!t)return e[0];for(var n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function ra(e,r,t){var n=window.document.createElement(e);return r&&(n.className=r||""),t&&t.appendChild(n),n}function ki(e){var r=e.parentNode;r&&r.removeChild(e)}function au(e,r){if(e.classList!==void 0)for(var t=nl(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!wf(e,r)){var a=Cf(e);$a(e,(a?a+" ":"")+r)}}function mu(e,r){if(e.classList!==void 0){var t=nl(r);t.forEach(function(n){e.classList.remove(n)})}else $a(e,zu((" "+Cf(e)+" ").replace(" "+r+" "," ")))}function wf(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=Cf(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function $a(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function gh(e,r,t){t===void 0?wf(e,r)?mu(e,r):au(e,r):t?au(e,r):mu(e,r)}function Cf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Us(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var il=ap(["transform","WebkitTransform"]);function gu(e,r){e.style[il]=r}function Gl(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function yh(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function Ec(){var e,r=window.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),s=(0,Rn.Z)(a,1),l=s[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var va=Ec()<1?1:window.devicePixelRatio;function Sc(e,r){e.setAttribute("style","".concat(e.style.cssText).concat(r))}function al(e){return e.split(";").map(function(r){return r.trim()}).filter(function(r){return r})}function Il(e,r){var t,n=al((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),i=al(r),a=rl.apply(void 0,[n].concat((0,er.Z)(i)));e.setAttribute("style",a.join(";"))}function _h(e){return Object.entries(e).map(function(r){var t=(0,Rn.Z)(r,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(";")}function Qc(e,r){return{left:e.left-r.left,top:e.top-r.top,right:r.left+r.width-e.left-e.width,bottom:r.top+r.height-e.top-e.height}}function ba(e,r){e.checked=r,r?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Pl(e){e.innerHTML=""}function op(e){e.setAttribute("draggable","false")}function ol(e,r){if(typeof r=="string"){var t=document.createElement("div");for(t.innerHTML=r;t.firstChild;)e.append(t.firstChild)}else Array.isArray(r)?e.append.apply(e,(0,er.Z)(r)):e.append(r)}function Jc(e,r){for(var t=Array.isArray(r)?r:[r],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(t.find(function(s){var l;return(l=n)===null||l===void 0?void 0:l.matches(s)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var ef;function Rf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function sl(){return typeof importScripts=="function"}var Xl=sl()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},Zu=(ef=navigator)===null||ef===void 0?void 0:ef.userAgent,tf=!!Zu.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Ac=Zu.indexOf("Android")>-1||Zu.indexOf("Adr")>-1;function $l(){for(var e=Zu,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,i=r;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){t=!1;break}}return t}function bh(e,r){e.forEach(function(t){r[t]&&(r[t]=r[t].bind(r))})}var Tc=null;function zs(e){var r=[1/0,1/0,-1/0,-1/0];return he(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}zs.default=zs;var xh=zs;function rf(e){return typeof e=="number"}var wc=2*Math.PI*6378137/2;function Ol(e,r){var t=(0,Rn.Z)(r,4),n=t[0],i=t[1],a=t[2],s=t[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=s}function Vu(e){var r=[1/0,1/0,-1/0,-1/0];return e.forEach(function(t){var n=t.coordinates;Yl(r,n)}),r}function Yl(e,r){return Array.isArray(r[0])?r.forEach(function(t){Yl(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function Mf(e,r){return ul(e,r)}function ul(e,r){return Array.isArray(e[0])?e.map(function(t){return ul(t,r)}):r(e)}function Eh(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=sp(e,r);var n=e[0],i=e[1],a=n*wc/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=s*wc/180,t.enable&&(a=Number(a.toFixed(t.decimal)),s=Number(s.toFixed(t.decimal))),e.length===3?[a,s,e[2]]:[a,s]}function Sh(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/wc*180,a=n/wc*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),a=Number(a.toFixed(r))),e.length===3?[i,a,e[2]]:[i,a]}function Ah(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function If(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function sp(e,r){if(r===!1)return e;var t=Ah(e[0]),n=If(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Ya(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,s=t*i;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,f=.5,d=-.5/Math.PI;return i=.5,a=n*(l*a+f),s=n*(d*s+i),[Math.floor(a),Math.floor(s)]}function up(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,a=256<<20,s=_slicedToArray(e,2),l=s[0],f=s[1];l=(l/a-t)/r,f=(f/a-i)/n,f=(Math.atan(Math.pow(Math.E,f))-Math.PI/4)*2,i=Math.PI/180;var d=f/i,_=l/i;return[_,d]}function Pf(e,r){var t=85.0511287798,n=Math.PI/180,i=6378137;return r=Math.max(Math.min(t,r),-t),e*=n,r*=n,r=Math.log(Math.tan(Math.PI/4+r/2)),[e*i,r*i]}function lp(e,r){var t=Math.PI/180,n=6378137,i=e/n/t,a=2*(Math.atan(Math.exp(r/n))-Math.PI/4)/t;return[i,a]}function ql(e,r,t){var n=ia(r[1]-e[1]),i=ia(r[0]-e[0]),a=ia(e[1]),s=ia(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return jn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function cp(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),a=Math.sin(i*r),s=n*e[0]*r,l=n*Math.log((1+a)/(1-a))/2;return[s,l]}function ju(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function Sa(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function Kl(e){return[[e[0],e[1]],[e[2],e[3]]]}function Hu(e){var r=ll(e,[0,0]);return[e[0]/r,e[1]/r]}function ll(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Zi(e,r){return e[0]*r[0]+e[1]*r[1]}function Aa(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ou(e,r){return Math.acos(Zi(e,r)/(Aa(e)*Aa(r)))*180/Math.PI}function nf(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function af(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var s=e[a],l=e[a+1],f=ll(s,l);n+=f;var d=[s[0]-l[0],s[1]-l[1]],_=nf(t,d);if(a>0){var x=i[a-1].rotation;x-_>360-x+_&&(_=_+360)}i.push({start:s,end:l,dis:f,rotation:_,duration:0})}return i.map(function(A){A.duration=r*(A.dis/n)}),i}}function Qs(e){if(rf(e[0]))return e;if(rf(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(rf(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(s){t+=s[0],n+=s[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function fp(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,s=0,l=0,f=0;f<e.length;f+=2){var d=e[f],_=e[f+1];d&&_&&(r=Math.max(d,r),t=Math.max(_,t),n=Math.min(d,n),i=Math.min(_,i),a+=d,s+=_,l++)}return{center:[a/l,s/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function Of(e){return xh(Ir([Vr(e)]))}function kf(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(a);return n}function Ql(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}function Co(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})}var qa=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function of(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*(a-1))/(a-1)),n?ys(e,r,l,n,i):ys(e,r,l,.314,i)}function Cc(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function uo(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Mn(e,r,t){var n=[r[0]-e[0],r[1]-e[1]],i=uo(n,[0,0]),a=Math.atan2(n[1],n[0]),s=i/2/Math.cos(t),l=a+t,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function ys(e,r,t,n,i){if(i===MapType["GAODE2.x"]){var a=amap2Project(e[0],e[1]),s=amap2Project(r[0],r[1]),l=Mn(a,s,n),f=[a[0],l[0],s[0]],d=[a[1],l[1],s[1]];return[].concat(_toConsumableArray(amap2UnProject(Cc(f,t),Cc(d,t))),[0])}else{var _=Mn(e,r,n),x=[e[0],_[0],r[0]],A=[e[1],_[1],r[1]];return[Cc(x,t),Cc(A,t),0]}}function Df(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*29)/29),Lf(e,r,l,i)}function Rc(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=calDistance(t,[0,0]),i=Math.atan2(t[1],t[0]),a=.314,s=n/2/Math.cos(a),l=i+a,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function ls(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function xa(e,r){var t=[e[0]-r[0],e[1]-r[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(r[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function Lf(e,r,t,n){var i=[degreesToRadians(e[0]),degreesToRadians(e[1])],a=[degreesToRadians(r[0]),degreesToRadians(r[1])];if(n==="GAODE2.x"){var s=Rc(i,a),l=[i[0],s[0],a[0]],f=[i[1],s[1],a[1]];return[ls(l,t),ls(f,t),0]}else{var d=xa(i,a);if(Math.abs(d-Math.PI)<.001)return[(1-t)*i[0]+t*a[0],(1-t)*i[1]+t*a[1]];var _=Math.sin((1-t)*d)/Math.sin(d),x=Math.sin(t*d)/Math.sin(d),A=[Math.sin(i[0]),Math.sin(i[1])],C=[Math.cos(i[0]),Math.cos(i[1])],I=[Math.sin(a[0]),Math.sin(a[1])],D=[Math.cos(a[0]),Math.cos(a[1])],Z=_*C[1]*C[0]+x*D[1]*D[0],J=_*C[1]*A[0]+x*D[1]*I[0],ce=_*A[1]+x*I[1];return[radiansToDegrees(Math.atan2(J,Z)),radiansToDegrees(Math.atan2(ce,Math.sqrt(Z*Z+J*J)))]}}function cn(e,r){for(var t=0,n=[],i=0;i<e.length-1;i++){var a=e[i],s=e[i+1],l=sf(a,s),f=t;t+=l,n.push({p1:a,p2:s,totalDistance:t,distance:l,lastTotalDistance:f})}for(var d=t*r,_,x,A=0,C=n;A<C.length;A++){var I=C[A],D=I.totalDistance;if(D>d){var Z=I.p1,J=I.p2,ce=(d-I.lastTotalDistance)/I.distance,xe=cl(J,Z,ce);_=xe[0],x=xe[1];break}}return{lng:_,lat:x,height:0}}function cl(e,r,t){return[e[0]*t+r[0]*(1-t),e[1]*t+r[1]*(1-t)]}function sf(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function uf(e,r){var t=r.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(i){var a=i.id;return a===t})),n.map(function(i){var a=Zs(i,r);return _objectSpread(_objectSpread({},i),a)})}function yu(e,r){return new Promise(function(t){e.inited?t(uf(e,r)):e.once("update",function(){t(uf(e,r))})})}function Zs(e,r){var t=r.offset,n=r.shape,i=r.thetaOffset,a=r.mapVersion,s=r.segmentNumber,l=s===void 0?30:s,f=r.autoFit,d=f===void 0?!0:f,_=e.coordinates;if(n==="line")return pathLineAtOffset(_,t);var x=_[0],A=_[1],C=typeof i=="string"?e[i]||0:i,I;switch(n){case"arc":I=arcLineAtOffset;break;case"greatcircle":I=greatCircleLineAtOffset;break;default:I=arcLineAtOffset}var D=I(x,A,t,C,a,l,d),Z=_slicedToArray(D,3),J=Z[0],ce=Z[1],xe=Z[2];return{lng:J,lat:ce,height:xe}}var Bf=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,ne.Z)(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,W.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function Ff(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function _s(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function _u(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function hp(e){if(e.length===0)throw new Error("mean requires at least one data point");return _u(e)/e.length}function Mc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var Ic={min:_s,max:Ff,mean:hp,sum:_u,mode:Mc};function Nf(e,r){return e.map(function(t){return t[r]})}function Js(e,r){return Ic[e](r)}var Nt=O(15861),Le=O(97326),F=O(4942),eu=O(64687),ve=O.n(eu);function kl(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[t,n],l=[t,a],f=[i,a],d=[i,n];return vr([[s,d,f,l,s]],r.properties,{bbox:e,id:r.id})}var Wu=O(72895),su=O.n(Wu),Ro=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),bs=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),Zn=0,Pn=1,cs=2;function fs(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function bu(e){e.forEach(function(r){r.properties.state=Zn}),e.forEach(function(r){r.isCurrent&&!tu(r)&&xu(r)}),e.forEach(function(r){r.isVisible=!!(r.properties.state&cs)})}function Ua(e){e.forEach(function(t){t.properties.state=Zn}),e.forEach(function(t){t.isCurrent&&tu(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=!!(t.properties.state&cs),t.children.length&&(t.isVisible||t.properties.state&Pn)?t.children.forEach(function(n){n.properties.state=Pn}):t.isCurrent&&xu(t)})}function tu(e){for(;e;){if(e.isLoaded)return e.properties.state|=cs,!0;e=e.parent}return!1}function xu(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=cs:xu(r)})}var Eu,pa=256,_o=[-1/0,-1/0,1/0,1/0],Th=.2,Dl=5,Uf=(Eu={},(0,F.Z)(Eu,Ro.Realtime,fs),(0,F.Z)(Eu,Ro.Overlap,bu),(0,F.Z)(Eu,Ro.Replace,Ua),Eu),fl=function(){};function xs(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function Jl(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var Su=function(r,t,n){var i=Jl(r,t,n),a=(0,Rn.Z)(i,2),s=a[0],l=a[1],f=Jl(r+1,t+1,n),d=(0,Rn.Z)(f,2),_=d[0],x=d[1];return[s,x,_,l]};function zf(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?1/0:n,a=e.minZoom,s=a===void 0?0:a,l=e.zoomOffset,f=l===void 0?0:l,d=e.extent,_=d===void 0?_o:d,x=Math.ceil(r)+f;if(Number.isFinite(s)&&x<s)return[];Number.isFinite(i)&&x>i&&(x=i);for(var A=(0,Rn.Z)(t,4),C=A[0],I=A[1],D=A[2],Z=A[3],J=[Math.max(C,_[0]),Math.max(I,_[1]),Math.min(D,_[2]),Math.min(Z,_[3])],ce=[],xe=xs(J[0],J[1],x),Xe=(0,Rn.Z)(xe,2),bt=Xe[0],pt=Xe[1],et=xs(J[2],J[3],x),Pt=(0,Rn.Z)(et,2),jt=Pt[0],Ar=Pt[1],gr=bt;gr<=jt;gr++)for(var Xr=Ar;Xr<=pt;Xr++)ce.push({x:gr,y:Xr,z:x});var mn=(jt+bt)/2,qn=(pt+Ar)/2,ea=function(Ko,Vo){return Math.abs(Ko-mn)+Math.abs(Vo-qn)};return ce.sort(function(Ma,Ko){return ea(Ma.x,Ma.y)-ea(Ko.x,Ko.y)}),ce}var Pc=function(r,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),s=a-1,l=a,f=r,d=t;return i&&(f<0?f=f+l:f>s&&(f=f%l)),{warpX:f,warpY:d}};function lf(e){var r=Zf();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Zf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ec=function(e){(0,je.Z)(t,e);var r=lf(t);function t(n){var i;(0,ne.Z)(this,t),i=r.call(this),(0,F.Z)((0,Le.Z)(i),"tileSize",256),(0,F.Z)((0,Le.Z)(i),"isVisible",!1),(0,F.Z)((0,Le.Z)(i),"isCurrent",!1),(0,F.Z)((0,Le.Z)(i),"isVisibleChange",!1),(0,F.Z)((0,Le.Z)(i),"loadedLayers",0),(0,F.Z)((0,Le.Z)(i),"isLayerLoaded",!1),(0,F.Z)((0,Le.Z)(i),"isLoad",!1),(0,F.Z)((0,Le.Z)(i),"isChildLoad",!1),(0,F.Z)((0,Le.Z)(i),"parent",null),(0,F.Z)((0,Le.Z)(i),"children",[]),(0,F.Z)((0,Le.Z)(i),"data",null),(0,F.Z)((0,Le.Z)(i),"properties",{}),(0,F.Z)((0,Le.Z)(i),"loadDataId",0);var a=n.x,s=n.y,l=n.z,f=n.tileSize,d=n.warp,_=d===void 0?!0:d;return i.x=a,i.y=s,i.z=l,i.warp=_||!0,i.tileSize=f,i}return(0,W.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===bs.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===bs.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===bs.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===bs.Cancelled}},{key:"isDone",get:function(){return[bs.Loaded,bs.Cancelled,bs.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Su(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=(0,Rn.Z)(this.bounds,4),a=i[0],s=i[1],l=i[2],f=i[3],d=[(l-a)/2,(f-s)/2],_=kl(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:d,meta:`
      `.concat(this.key,`
      `)}});return _}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){var l,f,d,_,x,A,C,I,D,Z,J,ce,xe,Xe,bt,pt,et;return ve().wrap(function(jt){for(;;)switch(jt.prev=jt.next){case 0:return l=s.getData,f=s.onLoad,d=s.onError,this.loadDataId++,_=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=bs.Loading,x=null,jt.prev=7,C=this.x,I=this.y,D=this.z,Z=this.bounds,J=this.tileSize,ce=this.warp,xe=Pc(C,I,D,ce),Xe=xe.warpX,bt=xe.warpY,pt=this.abortController.signal,et={x:Xe,y:bt,z:D,bounds:Z,tileSize:J,signal:pt,warp:ce},jt.next=14,l(et,this);case 14:x=jt.sent,jt.next=20;break;case 17:jt.prev=17,jt.t0=jt.catch(7),A=jt.t0;case 20:if(_===this.loadDataId){jt.next=22;break}return jt.abrupt("return");case 22:if(!(this.isCancelled&&!x)){jt.next=24;break}return jt.abrupt("return");case 24:if(!(A||!x)){jt.next=28;break}return this.loadStatus=bs.Failure,d(A,this),jt.abrupt("return");case 28:this.loadStatus=bs.Loaded,this.data=x,f(this);case 31:case"end":return jt.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=bs.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(Wu.EventEmitter),tc=function(r,t){var n=Kl(r),i=ju(n,t),a=360*3-180,s=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-s),Math.min(i[1][0],a),Math.min(i[1][1],s)];return l},wh=function(r,t){var n=Kl(r),i=Kl(t),a=Sa(n,i);return a};function hs(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Au(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Au(e,r){if(e){if(typeof e=="string")return cf(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return cf(e,r)}}function cf(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ll(e){var r=uu();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ch=pi.throttle,Gu=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Vf=function(e){(0,je.Z)(t,e);var r=Ll(t);function t(n){var i;return(0,ne.Z)(this,t),i=r.call(this),(0,F.Z)((0,Le.Z)(i),"currentTiles",[]),(0,F.Z)((0,Le.Z)(i),"cacheTiles",new Map),(0,F.Z)((0,Le.Z)(i),"throttleUpdate",Ch(function(a,s){i.update(a,s)},16)),(0,F.Z)((0,Le.Z)(i),"onTileLoad",function(a){i.emit(Gu.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Le.Z)(i),"onTileError",function(a,s){i.emit(Gu.TileError,{error:a,tile:s}),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Le.Z)(i),"onTileUnload",function(a){i.emit(Gu.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:_o,getTileData:fl,warp:!0,updateStrategy:Ro.Replace},i.updateOptions(n),i}return(0,W.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,s){return a.z-s.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),s=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=(0,j.Z)((0,j.Z)((0,j.Z)({},this.options),i),{},{minZoom:a,maxZoom:s})}},{key:"update",value:function(i,a){var s=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&wh(this.lastViewStates.latLonBoundsBuffer,a))){var f=tc(a,Th);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:f},this.currentZoom=l;var d=!1,_=this.getTileIndices(l,f).filter(function(x){return s.options.warp||x.x>=0&&x.x<Math.pow(2,l)});this.emit(Gu.TilesLoadStart),this.currentTiles=_.map(function(x){var A=x.x,C=x.y,I=x.z,D=s.getTile(A,C,I);if(D){var Z,J,ce=((Z=D)===null||Z===void 0?void 0:Z.isFailure)||((J=D)===null||J===void 0?void 0:J.isCancelled);return ce&&D.loadData({getData:s.options.getTileData,onLoad:s.onTileLoad,onError:s.onTileError}),D}return D=s.createTile(A,C,I),d=!0,D}),d&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=hs(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var s=(0,Rn.Z)(a.value,2),l=s[0],f=s[1];if(!this.currentTiles.includes(f)){this.cacheTiles.delete(l),this.onTileUnload(f);return}this.onTileUnload(f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(d){i.e(d)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,s){var l=this.cacheTiles.get("".concat(a,",").concat(s,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,s){var l=this.getTileByLngLat(i,a,s);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var s=this,l=this.getTileIndices(a,i);l.forEach(function(f){s.reloadTileById(f.z,f.x,f.y)})}},{key:"pruneRequests",value:function(){var i=[],a=hs(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(d){a.e(d)}finally{a.f()}for(;i.length>0;){var f=i.shift();f.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,s){var l=this.options.zoomOffset,f=Math.ceil(s)+l,d=xs(i,a,f),_=this.tiles.filter(function(x){return x.key==="".concat(d[0],"_").concat(d[1],"_").concat(f)});return _[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,s){var l=this.tiles.filter(function(f){return f.key==="".concat(a,"_").concat(s,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=hs(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.isLoading?s.abortLoad():this.onTileUnload(s)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,s=hs(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var f=l.value;a.set(f.key,f.isVisible),f.isCurrent=!1,f.isVisible=!1}}catch(I){s.e(I)}finally{s.f()}var d=hs(this.currentTiles),_;try{for(d.s();!(_=d.n()).done;){var x=_.value;x.isCurrent=!0,x.isVisible=!0}}catch(I){d.e(I)}finally{d.f()}var A=Array.from(this.cacheTiles.values());typeof i=="function"?i(A):Uf[i](A);var C=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==a.get(I.key)?(I.isVisibleChange=!0,C=!0):I.isVisibleChange=!1}),C&&this.emit(Gu.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var s=this.options,l=s.tileSize,f=s.extent,d=s.zoomOffset,_=Math.floor(this.options.maxZoom),x=Math.ceil(this.options.minZoom),A=zf({maxZoom:_,minZoom:x,zoomOffset:d,tileSize:l,zoom:i,latLonBounds:a,extent:f});return A}},{key:"getTileId",value:function(i,a,s){var l="".concat(i,",").concat(a,",").concat(s);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(Gu.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=this.cacheTiles.get(l);return f}},{key:"createTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=new ec({x:i,y:a,z:s,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),f}},{key:"resizeCacheTiles",value:function(){var i=Dl*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var s=hs(this.cacheTiles),l;try{for(s.s();!(l=s.n()).done;){var f=(0,Rn.Z)(l.value,2),d=f[0],_=f[1];if(!_.isVisible&&!this.currentTiles.includes(_)&&(this.cacheTiles.delete(d),this.onTileUnload(_)),this.cacheTiles.size<=i)break}}catch(x){s.e(x)}finally{s.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=hs(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.parent=null,s.children.length=0}}catch(x){i.e(x)}finally{i.f()}var l=hs(this.cacheTiles.values()),f;try{for(l.s();!(f=l.n()).done;){var d=f.value,_=this.getNearestAncestor(d.x,d.y,d.z);d.parent=_,_!=null&&_.children&&_.children.push(d)}}catch(x){l.e(x)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,s){for(;s>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),s=s-1;var l=this.getTile(i,a,s);if(l)return l}return null}}]),t}(su());function Rh(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function h(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),i=t[2].charCodeAt(0),a;for(a=n;a<=i;++a)r.push(e.replace(t[0],String.fromCharCode(a)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var s=parseInt(t[2],10),l=parseInt(t[1],10);l<=s;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}function v(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z,a=h(e),s=Math.abs(t+n)%a.length,l=oi(a[s])?"".concat(a[s],"/{z}/{x}/{y}"):a[s];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Su(t,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function p(e,r){var t=r.x,n=r.y,i=r.z,a=r.layer,s=r.version,l=s===void 0?"1.0.0":s,f=r.style,d=f===void 0?"default":f,_=r.format,x=r.service,A=x===void 0?"WMTS":x,C=r.tileMatrixset,I=h(e),D=Math.abs(t+n)%I.length,Z="".concat(I[D],"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(d,"&TILEMATRIXSET=").concat(C,"&FORMAT=").concat(_,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return Z}function g(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var S={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},w=S.self||S.window||{},R=S.window||S.self||{},k=S.self||S.window||{},$=S.document||{},oe=typeof importScripts=="function",be=typeof window!="undefined"&&typeof window.orientation!="undefined",we=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),Oe=we,qe=new Map;function $e(e){g(e.source&&!e.url||!e.source&&e.url);var r=qe.get(e.source||e.url);return r||(e.url&&(r=vt(e.url),qe.set(e.url,r)),e.source&&(r=He(e.source),qe.set(e.source,r))),g(r),r}function vt(e){if(!e.startsWith("http"))return e;var r=dt(e);return He(r)}function He(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function dt(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function wt(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(zt(e))n.add(e);else if(zt(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)wt(e[i],r,n)}}return t===void 0?Array.from(n):[]}function zt(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var ar=function(){},Qt=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;g(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=ar,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=ar,this.onError=ar,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.onMessage},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||wt(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=$e({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),hr=Qt,Tr=function(){return Tr=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Tr.apply(this,arguments)},Yr=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},Ur=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},_n=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=Tr(Tr({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(i,a,s){return i.done(s)}),n===void 0&&(n=function(i,a){return i.error(a)}),Yr(this,void 0,void 0,function(){var i,a=this;return Ur(this,function(s){switch(s.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,s.sent()]}})})},e.prototype.startQueuedJob=function(){return Yr(this,void 0,void 0,function(){var r,t,n;return Ur(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new Oe(t.name,r),r.onMessage=function(a){return t.onMessage(n,a.type,a.payload)},r.onError=function(a){return t.onError(n,a)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new hr({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return be?this.maxMobileConcurrency:this.maxConcurrency},e}(),Hn=_n,Vn=function(){return Vn=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Vn.apply(this,arguments)},Wn=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Wi={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Tn=function(){function e(r){this.workerPools=new Map,this.props=Vn({},Wi),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return hr.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=Wn(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=Vn(Vn({},this.props),r);try{for(var i=Wn(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,a=this.workerPools.get(t);return a||(a=new Hn({name:t,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),ui=null,gi=new Map,si=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(r){self.onmessage=function(t){if(vi(t)){var n=t.data,i=n.type,a=n.payload;r(i,a)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=gi.get(r);t||(t=function(n){if(vi(n)){var i=n.data,a=i.type,s=i.payload;r(a,s)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=gi.get(r);gi.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=wt(t);self.postMessage(n,i)}},e}(),ni=null;function vi(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function ii(e){return JSON.parse(Jn(e))}function Jn(e){var r=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(r.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}r.add(n)}return n})}function Mo(e){return""+e.name}function no(e,r){r===void 0&&(r={});var t=r[e.id]||{},n=e.name+".worker.js",i=t.workerUrl;return r._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),assert(i),i}var Io=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},bo=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};function Ka(e,r){return WorkerFarm.isSupported()?e.worker&&(r==null?void 0:r.worker):!1}function io(e,r,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),Io(this,void 0,void 0,function(){var i,a,s,l,f,d,_,x;return bo(this,function(A){switch(A.label){case 0:return i=getWorkerName(e),a=getWorkerURL(e,t),s=WorkerFarm.getWorkerFarm(t),l=s.getWorkerPool({name:i,url:a}),f=t.jobName||e.name,[4,l.startJob(f,Es.bind(null,n))];case 1:return d=A.sent(),_=removeNontransferableOptions(t),d.postMessage("process",{input:r,options:_}),[4,d.result];case 2:return x=A.sent(),[2,x.result]}})})}function Es(e,r,t,n){return Io(this,void 0,void 0,function(){var i,a,s,l,f,d,_;return bo(this,function(x){switch(x.label){case 0:switch(i=t,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return r.done(n),[3,9];case 2:return r.error(new Error(n.error)),[3,9];case 3:a=n.id,s=n.input,l=n.options,x.label=4;case 4:return x.trys.push([4,6,,7]),e.process?[4,e.process(s,l)]:(r.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return f=x.sent(),r.postMessage("done",{id:a,result:f}),[3,7];case 6:return d=x.sent(),_=d instanceof Error?d.message:"unknown error",r.postMessage("error",{id:a,error:_}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),x.label=9;case 9:return[2]}})})}var Ss=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),hl=null,As=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},lu=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},Vs=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=e[a]&&function(s){return new Promise(function(l,f){s=e[a](s),i(l,f,s.done,s.value)})}}function i(a,s,l,f){Promise.resolve(f).then(function(d){a({value:d,done:l})},s)}},Oc=0,Xu,Tu;function rc(e,r){var t=this;if(typeof self!="undefined"){var n={process:pl};WorkerBody.onmessage=function(i,a){return As(t,void 0,void 0,function(){var s,l,f,d,_,x,A,C,I,D,Z;return lu(this,function(J){switch(J.label){case 0:switch(J.trys.push([0,19,,20]),s=i,s){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=J.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");Xu=new AsyncQueue,Tu=a.options||{},f=r(Xu,Tu,n),J.label=4;case 4:J.trys.push([4,9,10,15]),d=Vs(f),J.label=5;case 5:return[4,d.next()];case 6:if(_=J.sent(),!!_.done)return[3,8];x=_.value,WorkerBody.postMessage("output-batch",{result:x}),J.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=J.sent(),D={error:A},[3,15];case 10:return J.trys.push([10,,13,14]),_&&!_.done&&(Z=d.return)?[4,Z.call(d)]:[3,12];case 11:J.sent(),J.label=12;case 12:return[3,14];case 13:if(D)throw D.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return Xu.push(a.input),[3,18];case 17:return Xu.close(),[3,18];case 18:return[3,20];case 19:return C=J.sent(),I=C instanceof Error?C.message:"",WorkerBody.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function pl(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=Oc++,a=function(l,f){if(f.id===i)switch(l){case"done":WorkerBody.removeEventListener(a),t(f.result);break;case"error":WorkerBody.removeEventListener(a),n(f.error);break;default:}};WorkerBody.addEventListener(a);var s={id:i,input:e,options:r};WorkerBody.postMessage("process",s)})}var cu=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},dl=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},Po={};function lo(e,r,t){return r===void 0&&(r=null),t===void 0&&(t={}),cu(this,void 0,void 0,function(){return dl(this,function(n){switch(n.label){case 0:return r&&(e=Ms(e,r,t)),Po[e]=Po[e]||fu(e),[4,Po[e]];case 1:return[2,n.sent()]}})})}function Ms(e,r,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+r+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+r+"/src/libs/"+e}function fu(e){return cu(this,void 0,void 0,function(){var r,t,n;return dl(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return r=i.sent(),[4,r.arrayBuffer()];case 2:return[2,i.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=i.sent(),[4,t.text()];case 5:return n=i.sent(),[2,wu(n,e)]}})})}function wu(e,r){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=r;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Vi="0.0.3",ts={id:"null",name:"null",module:"web-worker-helper",options:{}};function co(e){var r=e.color;return!r||!r.length?[1,1,1,1]:r}function hu(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function kc(e){var r=e.filter;return r?[1]:[0]}function $u(e,r){return[r]}var Mh=O(9187),Oo=O.n(Mh),Br=O(31437),js=Br.Ue(),Ih=Br.Ue(),ko=Br.Ue(),ru=Br.Ue(),Do=Br.Ue();function pp(e,r,t,n,i){Br.IH(e,t,n),Br.Fv(e,e),r=Br.al(-e[1],e[0]);var a=Br.al(-t[1],t[0]);return[i/Br.AK(r,a),r]}function nc(e,r){return Br.t8(e,-r[1],r[0])}function vl(e,r,t){return Br.lu(e,r,t),Br.Fv(e,e),e}function Xp(e,r){return e[0]===r[0]&&e[1]===r[1]}function ng(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var Zv=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ne.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Br.al(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,W.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],D=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,J=this.segment_gaode2(i,s,x,C,D,A,I,Z);s+=J}if(this.dash)for(var ce=0;ce<i.positions.length/6;ce++)i.positions[ce*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],D=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,J=this.simpleSegment(i,s,x,C,D,A,I,Z);s+=J}if(this.dash)for(var ce=0;ce<i.positions.length/6;ce++)i.positions[ce*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.segment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.simpleSegment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,f,d){var _=0,x=t.indices,A=t.positions,C=t.normals,I=this.cap==="square",D=this.join==="bevel",Z=Ya([f[0],f[1]]),J=Ya([l[0],l[1]]);vl(ko,a,i);var ce=0;if(this.dash&&(ce=this.lineSegmentDistance(Z,J),this.totalDistance+=ce),this.normal||(this.normal=Br.Ue(),nc(this.normal,ko)),!this.started)if(this.started=!0,I){var xe=Br.Ue(),Xe=Br.Ue();Br.IH(xe,this.normal,ko),Br.IH(Xe,this.normal,ko),C.push(Xe[0],Xe[1],0),C.push(xe[0],xe[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-ce,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-ce,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,i,this.normal,this.thickness,this.totalDistance-ce);if(x.push(n+0,n+1,n+2),s){Xp(a,s)&&Br.IH(s,a,Br.Fv(s,Br.$X(s,a,i))),vl(ru,s,a);var et=pp(Do,Br.Ue(),ko,ru,this.thickness),Pt=(0,Rn.Z)(et,2),jt=Pt[0],Ar=Pt[1],gr=Br.AK(Do,this.normal)<0?-1:1,Xr=D;if(!Xr&&this.join==="miter"){var mn=jt;mn>this.miterLimit&&(Xr=!0)}Xr?(C.push(this.normal[0],this.normal[1],0),C.push(Ar[0],Ar[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*gr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*gr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,(0,er.Z)(this.lastFlip!==-gr?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),nc(js,ru),Br.JG(this.normal,js),C.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*gr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,C,a,Ar,jt,this.totalDistance),x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),gr=-1,Br.JG(this.normal,Ar),_+=2),this.lastFlip=gr}else{if(nc(this.normal,ko),I){var bt=Br.Ue(),pt=Br.Ue();Br.lu(pt,ko,this.normal),Br.IH(bt,ko,this.normal),C.push(pt[0],pt[1],0),C.push(bt[0],bt[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=Ya([a[0],a[1]]),A=Ya([i[0],i[1]]);vl(ko,x,A);var C=0;if(this.dash&&(C=this.lineSegmentDistance(x,A),this.totalDistance+=C),this.normal||(this.normal=Br.Ue(),nc(this.normal,ko)),this.started||(this.started=!0,this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-C)),f.push(n+0,n+1,n+2),!s)nc(this.normal,ko),this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Ya([s[0],s[1]]);Xp(x,I)&&Br.IH(I,x,Br.Fv(I,Br.$X(I,x,A))),vl(ru,I,x);var D=pp(Do,Br.Ue(),ko,ru,this.thickness),Z=(0,Rn.Z)(D,2),J=Z[0],ce=Z[1],xe=Br.AK(Do,this.normal)<0?-1:1;this.extrusions(d,_,a,ce,J,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),xe=-1,Br.JG(this.normal,ce),l+=2,this.lastFlip=xe}return l}},{key:"segment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=this.cap==="square",A=this.join==="bevel",C=Ya([a[0],a[1]]),I=Ya([i[0],i[1]]);vl(ko,C,I);var D=0;if(this.dash&&(D=this.lineSegmentDistance(C,I),this.totalDistance+=D),this.normal||(this.normal=Br.Ue(),nc(this.normal,ko)),!this.started)if(this.started=!0,x){var Z=Br.Ue(),J=Br.Ue();Br.IH(Z,this.normal,ko),Br.IH(J,this.normal,ko),_.push(J[0],J[1],0),_.push(Z[0],Z[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-D,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-D,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-D);if(f.push(n+0,n+1,n+2),s){var Xe=Ya([s[0],s[1]]);Xp(C,Xe)&&Br.IH(Xe,C,Br.Fv(Xe,Br.$X(Xe,C,I))),vl(ru,Xe,C);var bt=pp(Do,Br.Ue(),ko,ru,this.thickness),pt=(0,Rn.Z)(bt,2),et=pt[0],Pt=pt[1],jt=Br.AK(Do,this.normal)<0?-1:1,Ar=A;if(!Ar&&this.join==="miter"){var gr=et;gr>this.miterLimit&&(Ar=!0)}Ar?(_.push(this.normal[0],this.normal[1],0),_.push(Pt[0],Pt[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*jt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*jt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,er.Z)(this.lastFlip!==-jt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),nc(js,ru),Br.JG(this.normal,js),_.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*jt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,_,a,Pt,et,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),jt=-1,Br.JG(this.normal,Pt),l+=2),this.lastFlip=jt}else{if(nc(this.normal,ko),x){var ce=Br.Ue(),xe=Br.Ue();Br.lu(xe,ko,this.normal),Br.IH(ce,ko,this.normal),_.push(xe[0],xe[1],0),_.push(ce[0],ce[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function jf(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new Zv({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function dp(e){var r=Qs(e.coordinates);return{vertices:[].concat((0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Ph(e){var r=e.coordinates,t=Oo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes,s=Oo()(n,a,i);return{indices:s,vertices:n,size:i}}var Ld=function(){var e=(0,Nt.Z)(ve().mark(function r(t){var n,i,a,s,l,f,d,_,x;return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.iconMap,l={a_Color:co,a_Position:hu,filter:kc,a_vertexId:$u,a_PickingColor:function(D){var Z=D.id;return a?ca(Z):[0,0,0]},a_DistanceAndIndex:function(D,Z,J,ce,xe,Xe){return Xe===void 0?[J[3],10]:[J[3],Xe]},a_Total_Distance:function(D,Z,J){return[J[5]]},a_Size:function(D){var Z=D.size,J=Z===void 0?1:Z;return Array.isArray(J)?[J[0],J[1]]:[J,0]},a_Normal:function(D,Z,J,ce,xe){return xe},a_Miter:function(D,Z,J){return[J[4]]},a_iconMapUV:function(D){var Z=D.texture,J=s[Z]||{x:0,y:0},ce=J.x,xe=J.y;return[ce,xe]}},f={sizePerElement:0,elements:[]},d=0,_=[],x=3,i.forEach(function(I,D){var Z=jf(I),J=Z.indices,ce=Z.vertices,xe=Z.normals,Xe=Z.size,bt=Z.indexes;J.forEach(function(jt){_.push(jt+d)}),x=Xe;var pt=ce.length/Xe;f.sizePerElement=x,f.elements.push({featureIdx:D,vertices:ce,normals:xe,offset:d}),d+=pt;for(var et=function(Ar){var gr=(xe==null?void 0:xe.slice(Ar*3,Ar*3+3))||[],Xr=ce.slice(Ar*Xe,Ar*Xe+Xe),mn=0;bt&&bt[Ar]!==void 0&&(mn=bt[Ar]),n.forEach(function(qn){if(qn&&l[qn.name]){var ea;(ea=qn.buffer.data).push.apply(ea,(0,er.Z)(l[qn.name](I,D,Xr,Ar,gr,mn)))}})},Pt=0;Pt<pt;Pt++)et(Pt)}),C.abrupt("return",{descriptors:n,featureLayout:f,indices:_});case 8:case"end":return C.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Dc=function(){var e=(0,Nt.Z)(ve().mark(function r(t){var n,i,a,s,l,f,d,_,x;return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.shape2d,l={a_Color:co,a_Position:hu,filter:kc,a_vertexId:$u,a_PickingColor:function(D){var Z=D.id;return a?ca(Z):[0,0,0]},a_Shape:function(D){var Z=D.shape,J=Z===void 0?2:Z,ce=s.indexOf(J);return[ce]},a_Extrude:function(D,Z,J,ce){var xe=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Xe=ce%4*3;return[xe[Xe],xe[Xe+1],xe[Xe+2]]},a_Size:function(D){var Z=D.size,J=Z===void 0?5:Z;return Array.isArray(J)?[J[0]]:[J]}},f={sizePerElement:0,elements:[]},d=0,_=[],x=3,i.forEach(function(I,D){var Z=dp(I),J=Z.indices,ce=Z.vertices,xe=Z.normals,Xe=Z.size,bt=Z.indexes;J.forEach(function(jt){_.push(jt+d)}),x=Xe;var pt=ce.length/Xe;f.sizePerElement=x,f.elements.push({featureIdx:D,vertices:ce,normals:xe,offset:d}),d+=pt;for(var et=function(Ar){var gr=(xe==null?void 0:xe.slice(Ar*3,Ar*3+3))||[],Xr=ce.slice(Ar*Xe,Ar*Xe+Xe),mn=0;bt&&bt[Ar]!==void 0&&(mn=bt[Ar]),n.forEach(function(qn){if(qn&&l[qn.name]){var ea;(ea=qn.buffer.data).push.apply(ea,(0,er.Z)(l[qn.name](I,D,Xr,Ar,gr,mn)))}})},Pt=0;Pt<pt;Pt++)et(Pt)}),C.abrupt("return",{descriptors:n,featureLayout:f,indices:_});case 8:case"end":return C.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Oh=function(){var e=(0,Nt.Z)(ve().mark(function r(t){var n,i,a,s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s={a_Color:co,a_Position:hu,filter:kc,a_vertexId:$u,a_PickingColor:function(I){var D=I.id;return a?ca(D):[0,0,0]}},l={sizePerElement:0,elements:[]},f=0,d=[],_=3,i.forEach(function(C,I){var D=Ph(C),Z=D.indices,J=D.vertices,ce=D.normals,xe=D.size,Xe=D.indexes;Z.forEach(function(Pt){d.push(Pt+f)}),_=xe;var bt=J.length/xe;l.sizePerElement=_,l.elements.push({featureIdx:I,vertices:J,normals:ce,offset:f}),f+=bt;for(var pt=function(jt){var Ar=(ce==null?void 0:ce.slice(jt*3,jt*3+3))||[],gr=J.slice(jt*xe,jt*xe+xe),Xr=0;Xe&&Xe[jt]!==void 0&&(Xr=Xe[jt]),n.forEach(function(mn){if(mn&&s[mn.name]){var qn;(qn=mn.buffer.data).push.apply(qn,(0,er.Z)(s[mn.name](C,I,gr,jt,Ar,Xr)))}})},et=0;et<bt;et++)pt(et)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:d});case 8:case"end":return A.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Vv={pointFill:Dc,line:Ld,polygonFill:Oh},Bd=(0,j.Z)({},Vv);function ig(e){return $p.apply(this,arguments)}function $p(){return $p=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.workerType,n=r.data,!Bd[t]){a.next=3;break}return a.abrupt("return",Bd[t](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),$p.apply(this,arguments)}var Fd=new Map;function Nd(e,r){Fd.set(e,r)}function Yp(e){var r=Fd.get(e);return r}var Bl="l7-worker",vp=3,Lc=!0;function qp(e){registerWorkerSource(Bl,e)}function ao(){var e=getWorkerSource(Bl);if(!e)throw new Error("get worker failed by workerName: ".concat(Bl,"."));return e}function Hf(e,r){return Wf.apply(this,arguments)}function Wf(){return Wf=_asyncToGenerator(_regeneratorRuntime.mark(function e(r,t){var n,i,a,s,l;return _regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=ao(),i=WorkerFarm.getWorkerFarm({maxConcurrency:vp,reuseWorkers:Lc}),a=i.getWorkerPool({name:Bl,source:n}),d.next=5,a.startJob(Bl,function(_,x,A){return _.done(A)});case 5:return s=d.sent,s.postMessage("process",{input:{workerType:r,data:t}}),d.next=9,s.result;case 9:return l=d.sent,d.abrupt("return",l.result);case 11:case"end":return d.stop()}},e)})),Wf.apply(this,arguments)}function ml(e,r){return e==null?r:e}var ff=O(38163),Bc=O.n(ff);function Gf(e,r){return e.map(function(t){return t[r]*1})}function Xf(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Fc(e){return Array.isArray(e)?e.length===0?!1:!!Xf(e[0]):!1}function Nc(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function ic(e){var r=Object.isFrozen(e)?pi.cloneDeep(e):e;return Bc()(r,!0),r}function Kp(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,s=r.coordinates,l=r.geometry,f=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(J){return J[l]&&J[l].type&&J[l].coordinates&&J[l].coordinates.length>0}).forEach(function(J,ce){var xe=ic(J[l]);xt(xe,function(Xe){var bt=To(Xe),pt=(0,j.Z)((0,j.Z)({},J),{},{_id:ce,coordinates:bt});f.push(pt)})}),{dataArray:f};for(var d=0;d<e.length;d++){var _=e[d],x=[];if(s){var A="Polygon";Array.isArray(s[0])||(A="Point"),Array.isArray(s[0])&&!Array.isArray(s[0][0])&&(A="LineString");var C=ic({type:A,coordinates:_[s]});x=C.coordinates}else if(t&&n&&i&&a){var I=[parseFloat(_[t]),parseFloat(_[n])],D=[parseFloat(_[i]),parseFloat(_[a])];x=[I,D]}else t&&n&&(x=[parseFloat(_[t]),parseFloat(_[n])]);var Z=(0,j.Z)((0,j.Z)({},_),{},{_id:d,coordinates:x});f.push(Z)}return{dataArray:f}}function ac(e,r){var t=ft(e);return Kp(t,r)}var Hs=O(71002);function mp(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function Qp(e,r){return r===void 0?null:(0,Hs.Z)(e.properties[r])*1==="number"?e.properties[r]*1:e.properties&&e.properties[r]?mp(e.properties[r]+"")%1000019:null}function Jp(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=ic(e),e.features.length===0?{dataArray:[],featureKeys:n}:(xt(e,function(i,a){var s=Qp(i,r==null?void 0:r.featureId);s===null&&(s=a);var l=s,f=To(i),d=(0,j.Z)((0,j.Z)({},i.properties),{},{coordinates:f,_id:l});t.push(d)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function kh(e,r,t,n){for(var i=n,a=t-r>>1,s=t-r,l,f=e[r],d=e[r+1],_=e[t],x=e[t+1],A=r+3;A<t;A+=3){var C=gl(e[A],e[A+1],f,d,_,x);if(C>i)l=A,i=C;else if(C===i){var I=Math.abs(A-a);I<s&&(l=A,s=I)}}i>n&&(l-r>3&&kh(e,r,l,n),e[l+2]=i,t-l>3&&kh(e,l,t,n))}function gl(e,r,t,n,i,a){var s=i-t,l=a-n;if(s!==0||l!==0){var f=((e-t)*s+(r-n)*l)/(s*s+l*l);f>1?(t=i,n=a):f>0&&(t+=s*f,n+=l*f)}return s=e-t,l=r-n,s*s+l*l}function Yu(e,r,t,n){var i={id:typeof e=="undefined"?null:e,type:r,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return Ud(i),i}function Ud(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")gp(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)gp(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)gp(e,r[n][i])}function gp(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function zd(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Dh(t,e.features[n],r,n);else e.type==="Feature"?Dh(t,e,r):Dh(t,{geometry:e},r);return t}function Dh(e,r,t,n){if(r.geometry){var i=r.geometry.coordinates,a=r.geometry.type,s=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],f=r.id;if(t.promoteId?f=r.properties[t.promoteId]:t.generateId&&(f=n||0),a==="Point")Uc(i,l);else if(a==="MultiPoint")for(var d=0;d<i.length;d++)Uc(i[d],l);else if(a==="LineString")ed(i,l,s,!1);else if(a==="MultiLineString")if(t.lineMetrics){for(d=0;d<i.length;d++)l=[],ed(i[d],l,s,!1),e.push(Yu(f,"LineString",l,r.properties));return}else qu(i,l,s,!1);else if(a==="Polygon")qu(i,l,s,!0);else if(a==="MultiPolygon")for(d=0;d<i.length;d++){var _=[];qu(i[d],_,s,!0),l.push(_)}else if(a==="GeometryCollection"){for(d=0;d<r.geometry.geometries.length;d++)Dh(e,{id:f,geometry:r.geometry.geometries[d],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Yu(f,a,l,r.properties))}}function Uc(e,r){r.push(yp(e[0])),r.push(zc(e[1])),r.push(0)}function ed(e,r,t,n){for(var i,a,s=0,l=0;l<e.length;l++){var f=yp(e[l][0]),d=zc(e[l][1]);r.push(f),r.push(d),r.push(0),l>0&&(n?s+=(i*d-f*a)/2:s+=Math.sqrt(Math.pow(f-i,2)+Math.pow(d-a,2))),i=f,a=d}var _=r.length-3;r[2]=1,kh(r,0,_,t),r[_+2]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function qu(e,r,t,n){for(var i=0;i<e.length;i++){var a=[];ed(e[i],a,t,n),r.push(a)}}function yp(e){return e/360+.5}function zc(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function Ws(e,r,t,n,i,a,s,l){if(t/=r,n/=r,a>=t&&s<n)return e;if(s<t||a>=n)return null;for(var f=[],d=0;d<e.length;d++){var _=e[d],x=_.geometry,A=_.type,C=i===0?_.minX:_.minY,I=i===0?_.maxX:_.maxY;if(C>=t&&I<n){f.push(_);continue}else if(I<t||C>=n)continue;var D=[];if(A==="Point"||A==="MultiPoint")Zd(x,D,t,n,i);else if(A==="LineString")oc(x,D,t,n,i,!1,l.lineMetrics);else if(A==="MultiLineString")$f(x,D,t,n,i,!1);else if(A==="Polygon")$f(x,D,t,n,i,!0);else if(A==="MultiPolygon")for(var Z=0;Z<x.length;Z++){var J=[];$f(x[Z],J,t,n,i,!0),J.length&&D.push(J)}if(D.length){if(l.lineMetrics&&A==="LineString"){for(Z=0;Z<D.length;Z++)f.push(Yu(_.id,A,D[Z],_.tags));continue}(A==="LineString"||A==="MultiLineString")&&(D.length===1?(A="LineString",D=D[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=D.length===3?"Point":"MultiPoint"),f.push(Yu(_.id,A,D,_.tags))}}return f.length?f:null}function Zd(e,r,t,n,i){for(var a=0;a<e.length;a+=3){var s=e[a+i];s>=t&&s<=n&&(r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]))}}function oc(e,r,t,n,i,a,s){for(var l=Lh(e),f=i===0?Ts:Lo,d=e.start,_,x,A=0;A<e.length-3;A+=3){var C=e[A],I=e[A+1],D=e[A+2],Z=e[A+3],J=e[A+4],ce=i===0?C:I,xe=i===0?Z:J,Xe=!1;s&&(_=Math.sqrt(Math.pow(C-Z,2)+Math.pow(I-J,2))),ce<t?xe>t&&(x=f(l,C,I,Z,J,t),s&&(l.start=d+_*x)):ce>n?xe<n&&(x=f(l,C,I,Z,J,n),s&&(l.start=d+_*x)):ps(l,C,I,D),xe<t&&ce>=t&&(x=f(l,C,I,Z,J,t),Xe=!0),xe>n&&ce<=n&&(x=f(l,C,I,Z,J,n),Xe=!0),!a&&Xe&&(s&&(l.end=d+_*x),r.push(l),l=Lh(e)),s&&(d+=_)}var bt=e.length-3;C=e[bt],I=e[bt+1],D=e[bt+2],ce=i===0?C:I,ce>=t&&ce<=n&&ps(l,C,I,D),bt=l.length-3,a&&bt>=3&&(l[bt]!==l[0]||l[bt+1]!==l[1])&&ps(l,l[0],l[1],l[2]),l.length&&r.push(l)}function Lh(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function $f(e,r,t,n,i,a){for(var s=0;s<e.length;s++)oc(e[s],r,t,n,i,a,!1)}function ps(e,r,t,n){e.push(r),e.push(t),e.push(n)}function Ts(e,r,t,n,i,a){var s=(a-r)/(n-r);return e.push(a),e.push(t+(i-t)*s),e.push(1),s}function Lo(e,r,t,n,i,a){var s=(a-t)/(i-t);return e.push(r+(n-r)*s),e.push(a),e.push(1),s}function pu(e,r){var t=r.buffer/r.extent,n=e,i=Ws(e,1,-1-t,t,0,-1,2,r),a=Ws(e,1,1-t,2+t,0,-1,2,r);return(i||a)&&(n=Ws(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=td(i,1).concat(n)),a&&(n=n.concat(td(a,-1)))),n}function td(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i.type,s;if(a==="Point"||a==="MultiPoint"||a==="LineString")s=hf(i.geometry,r);else if(a==="MultiLineString"||a==="Polygon"){s=[];for(var l=0;l<i.geometry.length;l++)s.push(hf(i.geometry[l],r))}else if(a==="MultiPolygon")for(s=[],l=0;l<i.geometry.length;l++){for(var f=[],d=0;d<i.geometry[l].length;d++)f.push(hf(i.geometry[l][d],r));s.push(f)}t.push(Yu(i.id,a,s,i.tags))}return t}function hf(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function rd(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,a,s,l;for(a=0;a<e.features.length;a++){var f=e.features[a],d=f.geometry,_=f.type;if(f.geometry=[],_===1)for(s=0;s<d.length;s+=2)f.geometry.push(Vd(d[s],d[s+1],r,t,n,i));else for(s=0;s<d.length;s++){var x=[];for(l=0;l<d[s].length;l+=2)x.push(Vd(d[s][l],d[s][l+1],r,t,n,i));f.geometry.push(x)}}return e.transformed=!0,e}function Vd(e,r,t,n,i,a){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-a))]}function jv(e,r,t,n,i){for(var a=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){s.numFeatures++,jd(s,e[l],a,i);var f=e[l].minX,d=e[l].minY,_=e[l].maxX,x=e[l].maxY;f<s.minX&&(s.minX=f),d<s.minY&&(s.minY=d),_>s.maxX&&(s.maxX=_),x>s.maxY&&(s.maxY=x)}return s}function jd(e,r,t,n){var i=r.geometry,a=r.type,s=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)s.push(i[l]),s.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")nd(s,i,e,t,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)nd(s,i[l],e,t,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var f=0;f<i.length;f++){var d=i[f];for(l=0;l<d.length;l++)nd(s,d[l],e,t,!0,l===0)}if(s.length){var _=r.tags||null;if(a==="LineString"&&n.lineMetrics){_={};for(var x in r.tags)_[x]=r.tags[x];_.mapbox_clip_start=i.start/i.size,_.mapbox_clip_end=i.end/i.size}var A={geometry:s,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:_};r.id!==null&&(A.id=r.id),e.features.push(A)}}function nd(e,r,t,n,i,a){var s=n*n;if(n>0&&r.size<(i?s:n)){t.numPoints+=r.length/3;return}for(var l=[],f=0;f<r.length;f+=3)(n===0||r[f+2]>s)&&(t.numSimplified++,l.push(r[f]),l.push(r[f+1])),t.numPoints++;i&&Hd(l,a),e.push(l)}function Hd(e,r){for(var t=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)t+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=l}}function Is(e,r){return new _p(e,r)}function _p(e,r){r=this.options=id(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=zd(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=pu(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}_p.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_p.prototype.splitTile=function(e,r,t,n,i,a,s){for(var l=[e,r,t,n],f=this.options,d=f.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var _=1<<r,x=bp(r,t,n),A=this.tiles[x];if(!A&&(d>1&&console.time("creation"),A=this.tiles[x]=jv(e,r,t,n,f),this.tileCoords.push({z:r,x:t,y:n}),d)){d>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var C="z"+r;this.stats[C]=(this.stats[C]||0)+1,this.total++}if(A.source=e,i){if(r===f.maxZoom||r===i)continue;var I=1<<i-r;if(t!==Math.floor(a/I)||n!==Math.floor(s/I))continue}else if(r===f.indexMaxZoom||A.numPoints<=f.indexMaxPoints)continue;if(A.source=null,e.length!==0){d>1&&console.time("clipping");var D=.5*f.buffer/f.extent,Z=.5-D,J=.5+D,ce=1+D,xe,Xe,bt,pt,et,Pt;xe=Xe=bt=pt=null,et=Ws(e,_,t-D,t+J,0,A.minX,A.maxX,f),Pt=Ws(e,_,t+Z,t+ce,0,A.minX,A.maxX,f),e=null,et&&(xe=Ws(et,_,n-D,n+J,1,A.minY,A.maxY,f),Xe=Ws(et,_,n+Z,n+ce,1,A.minY,A.maxY,f),et=null),Pt&&(bt=Ws(Pt,_,n-D,n+J,1,A.minY,A.maxY,f),pt=Ws(Pt,_,n+Z,n+ce,1,A.minY,A.maxY,f),Pt=null),d>1&&console.timeEnd("clipping"),l.push(xe||[],r+1,t*2,n*2),l.push(Xe||[],r+1,t*2,n*2+1),l.push(bt||[],r+1,t*2+1,n*2),l.push(pt||[],r+1,t*2+1,n*2+1)}}},_p.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var s=1<<e;r=(r%s+s)%s;var l=bp(e,r,t);if(this.tiles[l])return rd(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var f=e,d=r,_=t,x;!x&&f>0;)f--,d=Math.floor(d/2),_=Math.floor(_/2),x=this.tiles[bp(f,d,_)];return!x||!x.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",f,d,_),a>1&&console.time("drilling down"),this.splitTile(x.source,f,d,_,e,r,t),a>1&&console.timeEnd("drilling down"),this.tiles[l]?rd(this.tiles[l],i):null)};function bp(e,r,t){return((1<<e)*t+r)*32+e}function id(e,r){for(var t in r)e[t]=r[t];return e}var Yf=function(){function e(r,t,n,i){(0,ne.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=r}return(0,W.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),ad={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Hv(e){for(var r=0,t=0,n=e.length,i=n-1,a,s;t<n;i=t++)a=e[t],s=e[i],r+=(s.x-a.x)*(a.y+s.y);return r}function Wv(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var s=Hv(e[a]);s!==0&&(i===void 0&&(i=s<0),i===s<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var Wd=["Unknown","Point","LineString","Polygon"];function Gd(e,r,t,n,i){var a=i.geometry,s=i.type,l=i.tags,f=i.id,d=e*Math.pow(2,n),_=e*r,x=e*t,A=Wd[s],C,I;function D(ce){for(var xe=0;xe<ce.length;xe++){var Xe=ce[xe];if(Xe[3])break;var bt=180-(Xe[1]+x)*360/d,pt=(Xe[0]+_)*360/d-180,et=360/Math.PI*Math.atan(Math.exp(bt*Math.PI/180))-90;ce[xe]=[pt,et,0,1]}}switch(s){case 1:var Z=[];for(C=0;C<a.length;C++)Z[C]=a[C][0];a=Z,D(a);break;case 2:for(C=0;C<a.length;C++)D(a[C]);break;case 3:for(a=Wv(a),C=0;C<a.length;C++)for(I=0;I<a[C].length;I++)D(a[C][I]);break}a.length===1?a=a[0]:A="Multi"+A;var J={type:"Feature",geometry:{type:A,coordinates:a},properties:l,id:f,tileOrigin:[0,0],coord:""};return J}var X=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n,i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f){var d=n.getTile(t.z,t.x,t.y),_=d?d.features.map(function(C){return Gd(a,i.x,i.y,i.z,C)}):[],x={layers:{defaultLayer:{features:_}}},A=new Yf(x,t.x,t.y,t.z);f(A)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function De(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?r:(0,j.Z)((0,j.Z)({},r),e.geojsonvtOptions)}function rt(e,r){var t=De(r),n=t.extent||4096,i=Is(e,t),a=function(f,d){return X(d,i,f,n)},s=(0,j.Z)((0,j.Z)((0,j.Z)({},ad),r),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:s,isTile:!0}}function Jt(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=r.requestParameters,a=i===void 0?{}:i,s=new Promise(function(f){e instanceof HTMLImageElement||Rf(e)?f([e]):_r(e,a,function(d){f(d)})}),l={originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function _r(e,r,t){var n=[];if(typeof e=="string")Ba((0,j.Z)((0,j.Z)({},r),{},{url:e}),function(s,l){l&&(n.push(l),t(n))});else{var i=e.length,a=0;e.forEach(function(s){Ba((0,j.Z)((0,j.Z)({},r),{},{url:s}),function(l,f){a++,f&&n.push(f),a===i&&t(n)})})}return Jt}var rr=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n,i,a){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s={x:n.x,y:n.y,z:n.z},l=v(t,s),d.abrupt("return",new Promise(function(_){a?a(s,function(x,A){if(x||!A){var C={layers:{defaultLayer:{features:[]}}},I=new Yf(C,n.x,n.y,n.z);_(I)}else{var D={layers:{defaultLayer:{features:A.features}}},Z=new Yf(D,n.x,n.y,n.z);_(Z)}}):oa((0,j.Z)((0,j.Z)({},i),{},{url:l}),function(x,A){if(x||!A){var C={layers:{defaultLayer:{features:[]}}},I=new Yf(C,n.x,n.y,n.z);_(I)}else{var D=JSON.parse(A),Z={layers:{defaultLayer:{features:D}}},J=new Yf(Z,n.x,n.y,n.z);_(J)}})}));case 3:case"end":return d.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function Xt(e,r){var t=function(a,s){return rr(e,s,r==null?void 0:r.requestParameters,r.getCustomData)},n=(0,j.Z)((0,j.Z)({},r),{},{getTileData:t});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Nr=O(38929),Or=O(3614),en=O.n(Or),zr=function(){function e(r,t,n,i){(0,ne.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=new Nr.VectorTile(new(en())(r))}return(0,W.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var s=n.feature(a),l=s.toGeoJSON(this.x,this.y,this.z);i.push((0,j.Z)((0,j.Z)({},l),{},{properties:(0,j.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),qr={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},an=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n,i,a,s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l=v(t,n),d.abrupt("return",new Promise(function(_){if(s)s({x:i.x,y:i.y,z:i.z},function(A,C){if(A||!C)_(void 0);else{var I=new zr(C,i.x,i.y,i.z);_(I)}});else{var x=Ri((0,j.Z)((0,j.Z)({},a),{},{url:l}),function(A,C){if(A||!C)_(void 0);else{var I=new zr(C,i.x,i.y,i.z);_(I)}});i.xhrCancel=function(){return x.cancel()}}}));case 2:case"end":return d.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function Dr(e,r){var t=Array.isArray(e)?e[0]:e,n=function(s,l){return an(t,s,l,r==null?void 0:r.requestParameters,r==null?void 0:r.getCustomData)},i=(0,j.Z)((0,j.Z)((0,j.Z)({},qr),r),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}function Jr(e,r,t){switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"%":return r%t;case"^":return Math.pow(r,t);case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"sin":return Math.sin(r);case"cos":return Math.cos(r);case"atan":return t===-1?Math.atan(r):Math.atan2(r,t);case"min":return Math.min(r,t);case"max":return Math.max(r,t);case"log10":return Math.log(r);case"log2":return Math.log2(r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Ft(e,r){for(var t=r[0],n=t.width,i=t.height,a=r.map(function(C){return C.rasterData}),s=n*i,l=[],f=JSON.stringify(e),d=0;d<s;d++){var _=JSON.parse(f),x=lr(_,a,d);if(typeof x=="number")l.push(x);else{var A=dn(_);l.push(A)}}return l}function lr(e,r,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return r[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=r[n[1]][t]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:lr(n,r,t)}})}function Zr(e){var r=(0,Rn.Z)(e,3),t=r[0],n=r[1],i=n===void 0?-1:n,a=r[2],s=a===void 0?-1:a;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,i,s]}function dn(e){var r=Zr(e),t=r[0],n=r[1],i=r[2];return Array.isArray(n)&&(n=dn(e[1])),Array.isArray(i)&&(i=dn(e[2])),Jr(t,n,i)}var Rr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:bn}};function bn(e,r){for(var t=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],s=(r==null?void 0:r.countCut)||[2,98],l=(0,Rn.Z)(s,2),f=l[0],d=l[1],_=(r==null?void 0:r.RMinMax)||Pr(t,f,d),x=(r==null?void 0:r.GMinMax)||Pr(n,f,d),A=(r==null?void 0:r.BMinMax)||Pr(i,f,d),C=0;C<t.length;C++)a.push(Math.max(0,t[C]-_[0])),a.push(Math.max(0,n[C]-x[0])),a.push(Math.max(0,i[C]-A[0]));return{rasterData:a,rMinMax:_,gMinMax:x,bMinMax:A}}function Pr(e,r,t){var n=e.slice().sort(function(l,f){return l-f}),i=n.length,a=n[Math.ceil(i*r/100)],s=n[Math.ceil(i*t/100)];return[a,s]}function vn(e,r,t){return Cr.apply(this,arguments)}function Cr(){return Cr=(0,Nt.Z)(ve().mark(function e(r,t,n){var i,a,s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.length!==0){x.next=2;break}return x.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return x.next=4,Promise.all(r.map(function(A){var C=A.data,I=A.bands,D=I===void 0?[0]:I;return t(C,D)}));case 4:i=x.sent,a=[],i.forEach(function(A){Array.isArray(A)?a.push.apply(a,(0,er.Z)(A)):a.push(A)}),s=a[0],l=s.width,f=s.height,x.t0=(0,Hs.Z)(n),x.next=x.t0==="function"?11:x.t0==="object"?13:15;break;case 11:return d=n(a),x.abrupt("break",16);case 13:return Array.isArray(n)?d={rasterData:Ft(n,a)}:d=fn(n,a),x.abrupt("break",16);case 15:d={rasterData:a[0].rasterData};case 16:return x.abrupt("return",(0,j.Z)((0,j.Z)({},d),{},{width:l,height:f}));case 17:case"end":return x.stop()}},e)})),Cr.apply(this,arguments)}function fn(e,r){var t=Rr[e.type];if(t.type==="function")return t.method(r,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?$n(t.expression,r):{rasterData:Ft(t.expression,r)}}function $n(e,r){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=Ft(e.r||["band",0],r),n=Ft(e.g||["band",0],r),i=Ft(e.b||["band",0],r);return[t,n,i]}function li(e,r,t,n){return ln.apply(this,arguments)}function ln(){return ln=(0,Nt.Z)(ve().mark(function e(r,t,n,i){var a;return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,vn(r,t,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),ln.apply(this,arguments)}function Fr(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,s=r.max,l=r.format,f=r.operation,d,_,x;if(l===void 0||Nc(e))d=Array.from(e),_=n,x=i;else{var A=Array.isArray(e)?e:[e];d=vn(A,l,f)}var C={_id:1,dataArray:[{_id:1,data:d,width:_,height:x,min:a,max:s,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return C}var Sr=O(8520),Fn=O(36829),Pi=O.n(Fn),Zt=O(86700),Ai=O(84879),Ct={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},ri=O(49296),na=O.n(ri);function mo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=rs(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function rs(e,r){if(e){if(typeof e=="string")return Di(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Di(e,r)}}function Di(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Qa=30;function Oa(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,s=e.mapping,l=s===void 0?{}:s,f=e.xOffset,d=f===void 0?0:f,_=e.yOffset,x=_===void 0?0:_,A=0,C=d;Array.from(r).forEach(function(D,Z){if(!l[D]){var J=t(D,Z);C+Qa>a&&(C=0,A++),l[D]={x:C,y:x+A*Qa,width:Qa,height:Qa,advance:J},C+=Qa}});var I=n+i*2;return{mapping:l,xOffset:C,yOffset:x+A*I,canvasHeight:Ja(x+(A+1)*I)}}function Bo(e,r,t){var n=0,i=0,a=0,s=[],l={},f=mo(e),d;try{for(f.s();!(d=f.n()).done;){var _=d.value;if(!l[_.id]){var x=_.size;n+x+r>t&&(xo(l,s,i),n=0,i=a+i+r,a=0,s=[]),s.push({icon:_,xOffset:n}),n=n+x+r,a=Math.max(a,x)}}}catch(C){f.e(C)}finally{f.f()}s.length>0&&xo(l,s,i);var A=Ja(a+i+r);return{mapping:l,canvasHeight:A}}function xo(e,r,t){var n=mo(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.icon,l=a.xOffset;e[s.id]=(0,j.Z)((0,j.Z)({},s),{},{x:l,y:t,image:s.image,width:s.width,height:s.height})}}catch(f){n.e(f)}finally{n.f()}}function Ja(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Fo,ds;function Eo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Si(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Si(e,r){if(e){if(typeof e=="string")return ns(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ns(e,r)}}function ns(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function fa(e){var r=ei();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function ei(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Li=nt(),Ki="sans-serif",So="normal",yl=24,Ke=3,or=.25,Yt=8,xn=1024,Ti=1,ga=1,me=3,Fe=null;function nt(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function qt(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function Wt(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var gt=(Fo=(0,Zt.b2)(),Fo(ds=function(e){(0,je.Z)(t,e);var r=fa(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"fontAtlas",void 0),(0,F.Z)((0,Le.Z)(n),"iconFontMap",void 0),(0,F.Z)((0,Le.Z)(n),"iconFontGlyphs",{}),(0,F.Z)((0,Le.Z)(n),"fontOptions",void 0),(0,F.Z)((0,Le.Z)(n),"key",void 0),(0,F.Z)((0,Le.Z)(n),"cache",new Bf(me)),n}return(0,W.Z)(t,[{key:"scale",get:function(){return ga}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ki,fontWeight:So,characterSet:Li,fontSize:yl,buffer:Ke,sdf:!0,cutoff:or,radius:Yt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(s){a.iconFontGlyphs[s.name]=s.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=(0,j.Z)((0,j.Z)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),s=this.cache.get(this.key);if(!(s&&a.length===0)){var l=this.generateFontAtlas(this.key,a,s);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var s=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){s.emit("fontloaded",{fontFamily:i})})}catch(f){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(f)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,s){var l=this.fontOptions,f=l.fontFamily,d=l.fontWeight,_=l.fontSize,x=l.buffer,A=l.sdf,C=l.radius,I=l.cutoff,D=l.iconfont,Z=s&&s.data;Z||(Z=window.document.createElement("canvas"),Z.width=xn);var J=Z.getContext("2d",{willReadFrequently:!0});qt(J,f,_,d);var ce=Oa((0,j.Z)({getFontWidth:function(qs){return J.measureText(qs).width},fontHeight:_*ga,buffer:x,characterSet:a,maxCanvasWidth:xn},s&&{mapping:s.mapping,xOffset:s.xOffset,yOffset:s.yOffset})),xe=ce.mapping,Xe=ce.canvasHeight,bt=ce.xOffset,pt=ce.yOffset,et=J.getImageData(0,0,Z.width,Z.height);if(Z.height=Xe,J.putImageData(et,0,0),qt(J,f,_,d),A){var Pt=new(na())(_,x,C,I,f,d),jt=J.getImageData(0,0,Pt.size,Pt.size),Ar=Eo(a),gr;try{for(Ar.s();!(gr=Ar.n()).done;){var Xr=gr.value;if(D){var mn=String.fromCharCode(parseInt(Xr.replace("&#x","").replace(";",""),16)),qn=Pt.draw(mn);Wt(qn,jt)}else Wt(Pt.draw(Xr),jt);J.putImageData(jt,xe[Xr].x,xe[Xr].y)}}catch(Vo){Ar.e(Vo)}finally{Ar.f()}}else{var ea=Eo(a),Ma;try{for(ea.s();!(Ma=ea.n()).done;){var Ko=Ma.value;J.fillText(Ko,xe[Ko].x,xe[Ko].y+_*Ti)}}catch(Vo){ea.e(Vo)}finally{ea.f()}}return{xOffset:bt,yOffset:pt,mapping:xe,data:Z,width:Z.width,height:Z.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,s=i.fontWeight;return"".concat(a,"_").concat(s)}},{key:"getNewChars",value:function(i,a){var s=this.cache.get(i);if(!s)return a;var l=[],f=s.mapping,d=new Set(Object.keys(f)),_=new Set(a);return _.forEach(function(x){d.has(x)||l.push(x)}),l}}]),t}(Fn.EventEmitter))||ds),At,It;function Je(e){var r=_t();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function _t(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Be=3,Et=1024,tr=64,pr=(At=(0,Zt.b2)(),At(It=function(e){(0,je.Z)(t,e);var r=Je(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"canvasHeight",128),(0,F.Z)((0,Le.Z)(n),"texture",void 0),(0,F.Z)((0,Le.Z)(n),"canvas",void 0),(0,F.Z)((0,Le.Z)(n),"iconData",void 0),(0,F.Z)((0,Le.Z)(n),"iconMap",void 0),(0,F.Z)((0,Le.Z)(n),"ctx",void 0),(0,F.Z)((0,Le.Z)(n),"loadingImageCount",0),n}return(0,W.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s,l){var f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return f=new Image,this.loadingImageCount++,this.hasImage(s)?console.warn("Image Id already exists"):this.iconData.push({id:s,size:tr}),this.updateIconMap(),x.next=6,this.loadImage(l);case 6:f=x.sent,d=this.iconData.find(function(A){return A.id===s}),d&&(d.image=f,d.width=f.width,d.height=f.height),this.update();case 10:case"end":return x.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,s){var l=this,f=s.getSceneConfig().canvas,d=f.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:tr}),this.updateIconMap(),this.loadImageMini(a,f).then(function(_){d=_;var x=l.iconData.find(function(A){return A.id===i});x&&(x.image=d,x.width=d.width,x.height=d.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,s){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=Et,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var s=i.iconMap[a],l=s.x,f=s.y,d=s.image,_=s.width,x=_===void 0?64:_,A=s.height,C=A===void 0?64:A,I=Math.max(x,C),D=I/tr,Z=C/D,J=x/D;d&&i.ctx.drawImage(d,l+(tr-J)/2,f+(tr-Z)/2,J,Z)})}},{key:"updateIconMap",value:function(){var i=Bo(this.iconData,Be,Et),a=i.mapping,s=i.canvasHeight;this.iconMap=a,this.canvasHeight=s}},{key:"loadImageMini",value:function(i,a){return new Promise(function(s,l){var f=a.createImage();f.crossOrigin="anonymous",f.onload=function(){s(f)},f.onerror=function(){l(new Error("Could not load image at "+i))},f.src=i})}}]),t}(Fn.EventEmitter))||It),sr=O(85975),wr,kr,Nn=(wr=(0,Zt.b2)(),wr(kr=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"viewport",void 0),(0,F.Z)(this,"overridedViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredProjectionMatrix",void 0),(0,F.Z)(this,"viewMatrixInverse",void 0),(0,F.Z)(this,"cameraPosition",void 0)}return(0,W.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=sr.create(),sr.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,Rn.Z)(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=sr.fromTranslation(sr.create(),[t,n,0]);this.jitteredProjectionMatrix=sr.multiply(sr.create(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=sr.multiply(sr.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||kr),En=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),On,Kn;function ci(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ha(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function ha(e,r){if(e){if(typeof e=="string")return Ao(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ao(e,r)}}function Ao(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var _l={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},od=(On=(0,Zt.b2)(),On(Kn=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"controlCorners",void 0),(0,F.Z)(this,"controlContainer",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"controls",[]),(0,F.Z)(this,"unAddControls",[])}return(0,W.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Ct.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Ct.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=ci(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=ra("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=l.map(function(d){return n+d}).join(" ");t[l.filter(function(d){return!["row","column"].includes(d)}).join("")]=ra("div",f,i)}function s(l){var f=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,er.Z)(f),[_l[l]])}Object.values(En).forEach(function(l){a(s(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&ki(this.controlCorners[t]);this.controlContainer&&ki(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,n=window.MutationObserver;if(n)for(var i=function(){var f=s[a],d=f.match(/^(top|bottom)(left|right)$/);if(d){var _=(0,Rn.Z)(d,3),x=_[1],A=_[2],C=t.controlCorners["".concat(x).concat(A)],I=new n(function(D){var Z=(0,Rn.Z)(D,1),J=Z[0].target;C&&(C.style[x]=J.clientHeight+"px")});I.observe(t.controlCorners["".concat(A).concat(x)],{childList:!0,attributes:!0})}},a=0,s=Object.keys(this.controlCorners);a<s.length;a++)i()}}]),e}())||Kn),Cu,sd,sc=(Cu=(0,Zt.b2)(),Cu(sd=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"markers",[]),(0,F.Z)(this,"markerLayers",[]),(0,F.Z)(this,"unAddMarkers",[]),(0,F.Z)(this,"unAddMarkerLayers",[])}return(0,W.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ct.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||sd),xp,Gv,ag=(xp=(0,Zt.b2)(),xp(Gv=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"popups",[]),(0,F.Z)(this,"unAddPopups",[])}return(0,W.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,er.Z)(this.popups),(0,er.Z)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ct.IMapService)}}]),e}())||Gv),pf=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Zc=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Vc=function(e){return e.AND="and",e.OR="or",e}({}),vs=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Ep={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},og=Ep,No,za,sg=pi.merge,ug={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},lg={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Vc.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},cg=(No=(0,Zt.b2)(),No(za=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"sceneConfigCache",{}),(0,F.Z)(this,"layerConfigCache",{}),(0,F.Z)(this,"layerAttributeConfigCache",{})}return(0,W.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return og[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,j.Z)((0,j.Z)({},ug),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=(0,j.Z)({},sg({},this.sceneConfigCache[t],lg,i))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,j.Z)((0,j.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||za);function Ui(e,r,t,n){t&&Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Bi(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(s){a[s]=n[s]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(s,l){return l(e,r,s)||s},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}var Fl=O(98333),df=Math.PI/180,fg=512,Uo=4003e4;function Sp(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,s=e.highPrecision,l=s===void 0?!1:s,f=e.flipY,d=f===void 0?!1:f;a=a!==void 0?a:Math.pow(2,i);var _={},x=fg*a,A=Math.cos(t*df),C=x/360,I=C/A,D=x/Uo/A;if(_.pixelsPerMeter=[D,-D,D],_.metersPerPixel=[1/D,-1/D,1/D],_.pixelsPerDegree=[C,-I,D],_.degreesPerPixel=[1/C,-1/I,1/D],l){var Z=df*Math.tan(t*df)/A,J=C*Z/2,ce=x/Uo*Z,xe=ce/I*D;_.pixelsPerDegree2=[0,-J,ce],_.pixelsPerMeter2=[xe,0,xe],d&&(_.pixelsPerDegree2[1]=-_.pixelsPerDegree2[1],_.pixelsPerMeter2[1]=-_.pixelsPerMeter2[1])}return d&&(_.pixelsPerMeter[1]=-_.pixelsPerMeter[1],_.metersPerPixel[1]=-_.metersPerPixel[1],_.pixelsPerDegree[1]=-_.pixelsPerDegree[1],_.degreesPerPixel[1]=-_.degreesPerPixel[1]),_}var Ku=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),jc={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},ud,Xd,Bh,uc,Xv,hg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],k0=(ud=(0,Zt.b2)(),Xd=(0,Zt.f3)(Ct.ICameraService),ud(Bh=(uc=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"needRefresh",!0),Ui(this,"cameraService",Xv,this),(0,F.Z)(this,"coordinateSystem",void 0),(0,F.Z)(this,"viewportCenter",void 0),(0,F.Z)(this,"viewportCenterProjection",void 0),(0,F.Z)(this,"pixelsPerDegree",void 0),(0,F.Z)(this,"pixelsPerDegree2",void 0),(0,F.Z)(this,"pixelsPerMeter",void 0)}return(0,W.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),s=Sp({latitude:a[1],zoom:n}),l=s.pixelsPerMeter,f=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Ku.LNGLAT||this.coordinateSystem===Ku.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Ku.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===Ku.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var s=Sp({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=s.pixelsPerMeter,f=s.pixelsPerDegree,d=s.pixelsPerDegree2,_=this.cameraService.getViewMatrix(),x=this.cameraService.getProjectionMatrix(),A=sr.multiply([],x,_),C=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=Fl.fF([],[C[0],C[1],0,1],A),_=this.cameraService.getViewMatrixUncentered()||_,A=sr.multiply([],x,_),A=sr.multiply([],A,hg),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=d}}]),e}(),Xv=Bi(uc.prototype,"cameraService",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uc))||Bh),is,vf;function pg(e){var r=o();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u=(is=(0,Zt.b2)(),is(vf=function(e){(0,je.Z)(t,e);var r=pg(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"renderMap",new Map),(0,F.Z)((0,Le.Z)(n),"enable",!1),(0,F.Z)((0,Le.Z)(n),"renderEnable",!1),(0,F.Z)((0,Le.Z)(n),"cacheLogs",{}),n}return(0,W.Z)(t,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var s=this;if(this.enable){var l=i.split("."),f=null;l.forEach(function(d,_){f!==null?(f[d]||(f[d]={}),_!==l.length-1&&(f=f[d])):(s.cacheLogs[d]||(s.cacheLogs[d]={}),_!==l.length-1&&(f=s.cacheLogs[d])),_===l.length-1&&(f[d]=(0,j.Z)((0,j.Z)({time:Date.now()},f[d]),a))})}}},{key:"getLog",value:function(i){var a=this;switch((0,Hs.Z)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(s){return a.cacheLogs[s]}).filter(function(s){return s!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Co():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,(0,j.Z)((0,j.Z)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var s=a.renderStart,l=Date.now();this.emit("renderEnd",(0,j.Z)((0,j.Z)({},a),{},{renderEnd:l,renderDuration:l-s})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(Fn.EventEmitter))||vf),c=O(50840),m=O.n(c),b=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),E,T,M,B,G;function Q(e){var r=ee();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function ee(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pe={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},_e=(E=(0,Zt.b2)(),T=(0,Zt.f3)(Ct.IMapService),E(M=(B=function(e){(0,je.Z)(t,e);var r=Q(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"indragging",!1),Ui((0,Le.Z)(n),"mapService",G,(0,Le.Z)(n)),(0,F.Z)((0,Le.Z)(n),"hammertime",void 0),(0,F.Z)((0,Le.Z)(n),"lastClickTime",0),(0,F.Z)((0,Le.Z)(n),"lastClickXY",[-1,-1]),(0,F.Z)((0,Le.Z)(n),"clickTimer",void 0),(0,F.Z)((0,Le.Z)(n),"$containter",void 0),(0,F.Z)((0,Le.Z)(n),"onDrag",function(l){var f=n.interactionEvent(l);f.type=pe[f.type],f.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(b.Drag,f)}),(0,F.Z)((0,Le.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var f=n.interactionEvent(l);n.emit(b.Hover,f)}),(0,F.Z)((0,Le.Z)(n),"onTouch",function(l){var f=l.touches[0];n.onHover({clientX:f.clientX,clientY:f.clientY,type:"touchstart"})}),(0,F.Z)((0,Le.Z)(n),"onTouchEnd",function(l){if(l.changedTouches.length>0){var f=l.changedTouches[0];n.onHover({clientX:f.clientX,clientY:f.clientY,type:"touchend"})}}),(0,F.Z)((0,Le.Z)(n),"onTouchMove",function(l){var f=l.changedTouches[0];n.onHover({clientX:f.clientX,clientY:f.clientY,type:"touchmove"})}),(0,F.Z)((0,Le.Z)(n),"onHover",function(l){var f=l.clientX,d=l.clientY,_=f,x=d,A=l.type,C=n.mapService.getMapContainer();if(C){var I=C.getBoundingClientRect(),D=I.top,Z=I.left;_=_-Z-C.clientLeft,x=x-D-C.clientTop}var J=n.mapService.containerToLngLat([_,x]);if(A==="click"){n.isDoubleTap(_,x,J);return}if(A==="touch"){n.isDoubleTap(_,x,J);return}A!=="click"&&A!=="dblclick"&&n.emit(b.Hover,{x:_,y:x,lngLat:J,type:A,target:l})}),n}return(0,W.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(b.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,s=i.y;this.emit(b.Hover,{x:a,y:s})}},{key:"triggerSelect",value:function(i){this.emit(b.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(b.Active,{featureId:i})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new(m()).Manager(i);a.add(new(m()).Tap({event:"dblclick",taps:2})),a.add(new(m()).Tap({event:"click"})),a.add(new(m()).Pan({threshold:0,pointers:0})),a.add(new(m()).Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("touchstart",this.onTouch),i.addEventListener("touchend",this.onTouchEnd),i.addEventListener("touchmove",this.onTouchMove),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("touchstart",this.onTouch),i.removeEventListener("touchend",this.onTouchEnd),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,s=i.pointerType,l,f;s==="touch"?(f=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(f=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var d=this.mapService.getMapContainer();if(d){var _=d.getBoundingClientRect(),x=_.top,A=_.left;l-=A,f-=x}var C=this.mapService.containerToLngLat([l,f]);return{x:l,y:f,lngLat:C,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,s){var l=this,f=new Date().getTime(),d="click";f-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),d="dblclick",this.emit(b.Hover,{x:i,y:a,lngLat:s,type:d})):(this.lastClickTime=f,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){d="click",l.emit(b.Hover,{x:i,y:a,lngLat:s,type:d})},400))}}]),t}(Pi()),G=Bi(B.prototype,"mapService",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B))||M),Ge=0;function Ye(e){var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Ge++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function yt(e){var r,t=!0;if((e==null||(r=e.target)===null||r===void 0?void 0:r.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,s=Array.from(i.classList);if(s.includes("l7-marker")||s.includes("l7-popup")){t=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return t}var ot=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({}),Dt,Ht,ir,ur,xr,Wr,on,Dn,Sn,Gn,An,wi,ai;function Ln(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Fi(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Fi(e,r){if(e){if(typeof e=="string")return _i(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _i(e,r)}}function _i(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Qi=(Dt=(0,Zt.b2)(),Ht=(0,Zt.f3)(Ct.IMapService),ir=(0,Zt.f3)(Ct.IRendererService),ur=(0,Zt.f3)(Ct.IGlobalConfigService),xr=(0,Zt.f3)(Ct.IInteractionService),Wr=(0,Zt.f3)(Ct.ILayerService),Dt(on=(Dn=function(){function e(){var r=this;(0,ne.Z)(this,e),(0,F.Z)(this,"pickedColors",void 0),(0,F.Z)(this,"pickedTileLayers",[]),Ui(this,"mapService",Sn,this),Ui(this,"rendererService",Gn,this),Ui(this,"configService",An,this),Ui(this,"interactionService",wi,this),Ui(this,"layerService",ai,this),(0,F.Z)(this,"pickingFBO",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0),(0,F.Z)(this,"alreadyInPicking",!1),(0,F.Z)(this,"pickBufferScale",1),(0,F.Z)(this,"pickFromPickingFBO",function(){var t=(0,Nt.Z)(ve().mark(function n(i,a){var s,l,f,d,_,x,A,C,I,D,Z,J,ce,xe,Xe,bt,pt,et,Pt,jt,Ar,gr,Xr;return ve().wrap(function(qn){for(;;)switch(qn.prev=qn.next){case 0:if(s=a.x,l=a.y,f=a.lngLat,d=a.type,_=a.target,x=!1,A=r.rendererService,C=A.readPixelsAsync,I=A.getContainer,D=r.getContainerSize(I()),Z=D.width,J=D.height,Z*=va,J*=va,ce=i.getLayerConfig(),xe=ce.enableHighlight,Xe=ce.enableSelect,bt=s*va,pt=l*va,!(bt>Z-1*va||bt<0||pt>J-1*va||pt<0)){qn.next=11;break}return qn.abrupt("return",!1);case 11:return qn.next=13,C({x:Math.floor(bt/r.pickBufferScale),y:Math.floor((J-(l+1)*va)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:r.pickingFBO});case 13:return et=qn.sent,r.pickedColors=et,et[0]!==0||et[1]!==0||et[2]!==0?(Pt=Fa(et),jt=i.layerPickService.getFeatureById(Pt),Pt!==i.getCurrentPickId()&&d==="mousemove"&&(d="mouseenter"),Ar={x:s,y:l,type:d,lngLat:f,featureId:Pt,feature:jt,target:_},jt&&(x=!0,i.setCurrentPickId(Pt),r.triggerHoverOnLayer(i,Ar))):(gr={x:s,y:l,lngLat:f,type:i.getCurrentPickId()!==null&&d==="mousemove"?"mouseout":"un"+d,featureId:null,target:_,feature:null},r.triggerHoverOnLayer(i,(0,j.Z)((0,j.Z)({},gr),{},{type:"unpick"})),r.triggerHoverOnLayer(i,gr),i.setCurrentPickId(null)),xe&&i.layerPickService.highlightPickedFeature(et),Xe&&d==="click"&&(et==null?void 0:et.toString())!==[0,0,0,0].toString()&&(Xr=Fa(et),i.getCurrentSelectedId()===null||Xr!==i.getCurrentSelectedId()?(i.layerPickService.selectFeature(et),i.setCurrentSelectedId(Xr)):(i.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null))),qn.abrupt("return",x);case 19:case"end":return qn.stop()}},n)}));return function(n,i){return t.apply(this,arguments)}}())}return(0,W.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,s=n.getContainer,l=this.getContainerSize(s()),f=l.width,d=l.height;f*=va,d*=va,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,f=Math.round(f/this.pickBufferScale),d=Math.round(d/this.pickBufferScale);var _=i({width:f,height:d,usage:ot.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=a({color:_,depth:!0,width:f,height:d}),this.interactionService.on(b.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a,s){var l=this,f,d,_,x;return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return f=this.rendererService,d=f.useFramebufferAsync,_=f.clear,this.resizePickingFBO(),i.hooks.beforePickingEncode.call(),C.next=5,d(this.pickingFBO,(0,Nt.Z)(ve().mark(function I(){return ve().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:_({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.renderModels({ispick:!0});case 2:case"end":return Z.stop()}},I)})));case 5:return i.hooks.afterPickingEncode.call(),C.next=8,this.pickBox(i,a);case 8:x=C.sent,s(x);case 10:case"end":return C.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a){var s=this,l,f,d,_,x,A,C,I,D,Z,J,ce,xe,Xe,bt,pt,et,Pt,jt,Ar,gr;return ve().wrap(function(mn){for(;;)switch(mn.prev=mn.next){case 0:if(l=a.map(function(qn){var ea=qn<0?0:qn;return Math.floor(ea*va/s.pickBufferScale)}),f=(0,Rn.Z)(l,4),d=f[0],_=f[1],x=f[2],A=f[3],C=this.rendererService,I=C.readPixelsAsync,D=C.getContainer,Z=this.getContainerSize(D()),J=Z.width,ce=Z.height,J*=va,ce*=va,!(d>(J-1)*va/this.pickBufferScale||x<0||_>(ce-1)*va/this.pickBufferScale||A<0)){mn.next=7;break}return mn.abrupt("return",[]);case 7:return xe=Math.min(J/this.pickBufferScale,x)-d,Xe=Math.min(ce/this.pickBufferScale,A)-_,mn.next=11,I({x:d,y:Math.floor(ce/this.pickBufferScale-(A+1)),width:xe,height:Xe,data:new Uint8Array(xe*Xe*4),framebuffer:this.pickingFBO});case 11:for(bt=mn.sent,pt=[],et={},Pt=0;Pt<bt.length/4;Pt=Pt+1)jt=bt.slice(Pt*4,Pt*4+4),Ar=Fa(jt),Ar!==-1&&!et[Ar]&&(gr=i.layerPickService.getFeatureById(Ar),pt.push((0,j.Z)((0,j.Z)({},gr),{},{pickedFeatureIdx:Ar})),et[Ar]=!0);return mn.abrupt("return",pt);case 16:case"end":return mn.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,s=a===void 0?"":a,l=i.cursorEnabled;if(l){var f=this.mapService.version,d=f==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),_=d==null?void 0:d.style.getPropertyValue("cursor");n==="unmousemove"&&_!==""?d==null||d.style.setProperty("cursor",""):n==="mousemove"&&(d==null||d.style.setProperty("cursor",s))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/va,height:t.height/va}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){s.next=2;break}return s.abrupt("return");case 2:return this.alreadyInPicking=!0,s.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=va,a*=va,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){var a=this,s,l,f,d,_,x,A;return ve().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:s=this.rendererService,l=s.clear,f=s.useFramebufferAsync,this.resizePickingFBO(),d=this.layerService.getRenderList(),_=Ln(d.filter(function(D){return D.needPick(i.type)}).reverse()),I.prev=4,A=ve().mark(function D(){var Z,J;return ve().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return Z=x.value,Z.tileLayer||Z.hooks.beforePickingEncode.call(),xe.next=4,f(a.pickingFBO,(0,Nt.Z)(ve().mark(function Xe(){return ve().wrap(function(pt){for(;;)switch(pt.prev=pt.next){case 0:l({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Z.layerPickService.pickRender(i);case 2:case"end":return pt.stop()}},Xe)})));case 4:return Z.tileLayer||Z.hooks.afterPickingEncode.call(),xe.next=7,a.pickFromPickingFBO(Z,i);case 7:if(J=xe.sent,a.layerService.pickedLayerId=J?+Z.id:-1,!(J&&!Z.getLayerConfig().enablePropagation)){xe.next=11;break}return xe.abrupt("return",1);case 11:case"end":return xe.stop()}},D)}),_.s();case 7:if((x=_.n()).done){I.next=13;break}return I.delegateYield(A(),"t0",9);case 9:if(!I.t0){I.next=11;break}return I.abrupt("break",13);case 11:I.next=7;break;case 13:I.next=18;break;case 15:I.prev=15,I.t1=I.catch(4),_.e(I.t1);case 18:return I.prev=18,_.f(),I.finish(18);case 21:case"end":return I.stop()}},n,this,[[4,15,18,21]])}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){yt(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),Sn=Bi(Dn.prototype,"mapService",[Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gn=Bi(Dn.prototype,"rendererService",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),An=Bi(Dn.prototype,"configService",[ur],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi=Bi(Dn.prototype,"interactionService",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ai=Bi(Dn.prototype,"layerService",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn))||on),Yn=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ne.Z)(this,e),(0,F.Z)(this,"autoStart",void 0),(0,F.Z)(this,"startTime",0),(0,F.Z)(this,"oldTime",0),(0,F.Z)(this,"running",!1),(0,F.Z)(this,"elapsedTime",0),this.autoStart=r}return(0,W.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),ua,Za,fo,oo,Va,ja,Go,Xo,Ps;function zo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Gs(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Gs(e,r){if(e){if(typeof e=="string")return go(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return go(e,r)}}function go(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ms(e){var r=ji();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function ji(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ta=pi.throttle,Ea=(ua=(0,Zt.b2)(),Za=(0,Zt.f3)(Ct.IRendererService),fo=(0,Zt.f3)(Ct.IMapService),oo=(0,Zt.f3)(Ct.IDebugService),ua(Va=(ja=function(e){(0,je.Z)(t,e);var r=ms(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"pickedLayerId",-1),(0,F.Z)((0,Le.Z)(n),"clock",new Yn),(0,F.Z)((0,Le.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Le.Z)(n),"layers",[]),(0,F.Z)((0,Le.Z)(n),"layerList",[]),(0,F.Z)((0,Le.Z)(n),"layerRenderID",void 0),(0,F.Z)((0,Le.Z)(n),"sceneInited",!1),(0,F.Z)((0,Le.Z)(n),"animateInstanceCount",0),(0,F.Z)((0,Le.Z)(n),"shaderPicking",!0),(0,F.Z)((0,Le.Z)(n),"enableRender",!0),Ui((0,Le.Z)(n),"renderService",Go,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"mapService",Xo,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"debugService",Ps,(0,Le.Z)(n)),(0,F.Z)((0,Le.Z)(n),"reRender",Ta(function(){n.renderLayers()},32)),(0,F.Z)((0,Le.Z)(n),"throttleRenderLayers",Ta(function(){n.renderLayers()},16)),n}return(0,W.Z)(t,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s=this;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var d=(0,Nt.Z)(ve().mark(function _(x){return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(x.startInit){C.next=4;break}return C.next=3,x.init();case 3:s.updateLayerRenderList();case 4:case"end":return C.stop()}},_)}));return function(_){return d.apply(this,arguments)}}());case 2:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s,l){var f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:l?(f=l.layerChildren.indexOf(s),f>-1&&l.layerChildren.splice(f,1)):(d=this.layers.indexOf(s),d>-1&&this.layers.splice(d,1)),s.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return x.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C,I;return ve().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){Z.next=2;break}return Z.abrupt("return");case 2:this.updateLayerRenderList(),s=this.debugService.generateRenderUid(),this.debugService.renderStart(s),this.alreadyInRendering=!0,this.clear(),l=zo(this.layerList);try{for(l.s();!(f=l.n()).done;)d=f.value,d.prerender()}catch(J){l.e(J)}finally{l.f()}this.renderService.beginFrame(),_=zo(this.layerList),Z.prev=11,_.s();case 13:if((x=_.n()).done){Z.next=25;break}if(A=x.value,C=A.getLayerConfig(),I=C.enableMask,A.masks.filter(function(J){return J.inited}).length>0&&I&&this.renderMask(A.masks),!A.getLayerConfig().enableMultiPassRenderer){Z.next=22;break}return Z.next=20,A.renderMultiPass();case 20:Z.next=23;break;case 22:A.render();case 23:Z.next=13;break;case 25:Z.next=30;break;case 27:Z.prev=27,Z.t0=Z.catch(11),_.e(Z.t0);case 30:return Z.prev=30,_.f(),Z.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(s),this.alreadyInRendering=!1;case 36:case"end":return Z.stop()}},a,this,[[11,27,30,33]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var s=i.length>1?Zc.MULTIPLE:Zc.SINGLE,l=zo(i),f;try{for(l.s();!(f=l.n()).done;){var d=f.value;d.render({isStencil:!0,stencilType:s,stencilIndex:a++})}}catch(_){l.e(_)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,s.hooks.beforeRenderData.promise();case 2:l=d.sent,l&&this.renderLayers();case 4:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,s=i.getLayerConfig(),l=s.enableMask,f=l===void 0?!0:l,d=i.tileMask?1:0,_=i.masks.filter(function(D){return D.inited});d=d+(f?_.length:1);var x=d>1?Zc.MULTIPLE:Zc.SINGLE;if((i.tileMask||_.length&&f)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),_.length&&f){var A=zo(_),C;try{for(A.s();!(C=A.n()).done;){var I=C.value;I.render({isStencil:!0,stencilType:x,stencilIndex:a++})}}catch(D){A.e(D)}finally{A.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:x,stencilIndex:a++,stencilOperation:Vc.OR})}},{key:"renderTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.renderTileLayerMask(s),!s.getLayerConfig().enableMultiPassRenderer){f.next=6;break}return f.next=4,s.renderMultiPass();case 4:f.next=8;break;case 6:return f.next=8,s.render();case 8:case"end":return f.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=bi(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),t}(Fn.EventEmitter),Go=Bi(ja.prototype,"renderService",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=Bi(ja.prototype,"mapService",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ps=Bi(ja.prototype,"debugService",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja))||Va),xi=O(91),K=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),Os=pi.isNil,Ha=function(){function e(r){var t=this;(0,ne.Z)(this,e),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"type",void 0),(0,F.Z)(this,"scale",void 0),(0,F.Z)(this,"descriptor",void 0),(0,F.Z)(this,"featureBufferLayout",[]),(0,F.Z)(this,"needRescale",!1),(0,F.Z)(this,"needRemapping",!1),(0,F.Z)(this,"needRegenerateVertices",!1),(0,F.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,F.Z)(this,"vertexAttribute",void 0),(0,F.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,s){var l,f=(l=t.scale)===null||l===void 0?void 0:l.scalers[s].func,d=f(a);return d})}),this.setProps(r)}return(0,W.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,er.Z)(t));if(!Os(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Zo=["buffer","update","name"],ks=["buffer","update","name"],$i,lc,Ru,cc,ho,fc,Nl=($i={},(0,F.Z)($i,K.FLOAT,4),(0,F.Z)($i,K.UNSIGNED_BYTE,1),(0,F.Z)($i,K.UNSIGNED_SHORT,2),$i),Ap=(lc=(0,Zt.b2)(),Ru=(0,Zt.f3)(Ct.IRendererService),lc(cc=(ho=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"attributesAndIndices",void 0),Ui(this,"rendererService",fc,this),(0,F.Z)(this,"attributes",[]),(0,F.Z)(this,"triangulation",void 0),(0,F.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,W.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Ha(t),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(t){var n=this.attributes.findIndex(function(i){return i.name===t});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var i,a=n.name,s=(i=n.scale)===null||i===void 0?void 0:i.field;(t[a]||s&&t[s])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute((0,j.Z)((0,j.Z)({},n),{},{name:t})));var s=n.scale;s&&a&&(a.scale=s,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(bt){return bt.name===t});if(l&&l.descriptor){var f=l.descriptor,d=f.update,_=f.buffer,x=f.size,A=x===void 0?0:x,C=Nl[_.type||K.FLOAT];if(d){var I=this.featureLayout,D=I.elements,Z=I.sizePerElement,J=D.slice(i,a);if(!J.length)return;var ce=J[0].offset,xe=ce*A*C,Xe=J.map(function(bt,pt){for(var et=bt.featureIdx,Pt=bt.vertices,jt=bt.normals,Ar=Pt.length/Z,gr=[],Xr=0;Xr<Ar;Xr++){var mn=jt?jt.slice(Xr*3,Xr*3+3):[];gr.push.apply(gr,(0,er.Z)(d(n[et],et,Pt.slice(Xr*Z,Xr*Z+Z),pt,mn)))}return gr}).flat();l.vertexAttribute.updateBuffer({data:Xe,offset:xe}),s==null||s.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(J){return J.resetDescriptor(),J.descriptor}),l=0,f=0,d=[],_=3;t.forEach(function(J,ce){var xe=a.triangulation(J,i),Xe=xe.indices,bt=xe.vertices,pt=xe.normals,et=xe.size,Pt=xe.indexes,jt=xe.count;typeof jt=="number"&&(f+=jt),Xe.forEach(function(mn){d.push(mn+l)}),_=et;var Ar=bt.length/et;a.featureLayout.sizePerElement=_,a.featureLayout.elements.push({featureIdx:ce,vertices:bt,normals:pt,offset:l}),l+=Ar;for(var gr=function(qn){var ea=(pt==null?void 0:pt.slice(qn*3,qn*3+3))||[],Ma=bt.slice(qn*et,qn*et+et),Ko=0;Pt&&Pt[qn]!==void 0&&(Ko=Pt[qn]),s.forEach(function(Vo,qs){if(Vo&&Vo.update){var Al;(Al=Vo.buffer.data).push.apply(Al,(0,er.Z)(Vo.update(J,ce,Ma,qn,ea,Ko)))}})},Xr=0;Xr<Ar;Xr++)gr(Xr)});var x=this.rendererService,A=x.createAttribute,C=x.createBuffer,I=x.createElements,D={};s.forEach(function(J,ce){if(J){var xe=J.buffer,Xe=J.update,bt=J.name,pt=(0,xi.Z)(J,Zo),et=A((0,j.Z)({buffer:C(xe)},pt));D[J.name||""]=et,a.attributes[ce].vertexAttribute=et}});var Z=I({data:d,type:K.UNSIGNED_INT,count:d.length});return this.attributesAndIndices={attributes:D,elements:Z,count:f},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(C){return C.resetDescriptor(),C.descriptor}),s=0,l=[],f=3;t.forEach(function(C,I){var D=i.triangulation(C),Z=D.indices,J=D.vertices,ce=D.normals,xe=D.size,Xe=D.indexes;Z.forEach(function(Pt){l.push(Pt+s)}),f=xe;var bt=J.length/xe;i.featureLayout.sizePerElement=f,i.featureLayout.elements.push({featureIdx:I,vertices:J,normals:ce,offset:s}),s+=bt;for(var pt=function(jt){var Ar=(ce==null?void 0:ce.slice(jt*3,jt*3+3))||[],gr=J.slice(jt*xe,jt*xe+xe),Xr=0;Xe&&Xe[jt]!==void 0&&(Xr=Xe[jt]),a.forEach(function(mn,qn){if(mn&&mn.update){var ea;(ea=mn.buffer.data).push.apply(ea,(0,er.Z)(mn.update(C,I,gr,jt,Ar,Xr)))}})},et=0;et<bt;et++)pt(et)});var d=this.rendererService,_=d.createAttribute,x=d.createBuffer,A={};return a.forEach(function(C,I){if(C){var D=C.buffer,Z=C.update,J=C.name,ce=(0,xi.Z)(C,ks),xe=_((0,j.Z)({buffer:x(D)},ce));A[C.name||""]=xe,i.attributes[I].vertexAttribute=xe}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),fc=Bi(ho.prototype,"rendererService",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho))||cc),mf=O(34155);function qf(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(x){s(x)}}function f(_){try{d(n.throw(_))}catch(x){s(x)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,r||[])).next())})}function hc(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function gf(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,a=[],s;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return a}function Fh(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,a;n<i;n++)(a||!(n in r))&&(a||(a=Array.prototype.slice.call(r,0,n)),a[n]=r[n]);return e.concat(a||Array.prototype.slice.call(r))}function Kf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Nh={exports:{}},Uh={exports:{}},Qf={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=r.default})(Qf,Qf.exports);var as={},zh={exports:{}},Jf={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return t.call(this,n,a)}},e.exports=r.default})(Jf,Jf.exports);var Mu={};Object.defineProperty(Mu,"__esModule",{value:!0}),Mu.fallback=wp,Mu.wrap=Cp;var Tp=Mu.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,$d=Mu.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Yd=Mu.hasNextTick=typeof mf=="object"&&typeof mf.nextTick=="function";function wp(e){setTimeout(e,0)}function Cp(e){return function(r){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return r.apply(void 0,t)})}}var eh;Tp?eh=queueMicrotask:$d?eh=setImmediate:Yd?eh=mf.nextTick:eh=wp,Mu.default=Cp(eh),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=f;var t=Jf.exports,n=l(t),i=Mu,a=l(i),s=as;function l(x){return x&&x.__esModule?x:{default:x}}function f(x){return(0,s.isAsync)(x)?function(){for(var A=[],C=arguments.length;C--;)A[C]=arguments[C];var I=A.pop(),D=x.apply(this,A);return d(D,I)}:(0,n.default)(function(A,C){var I;try{I=x.apply(this,A)}catch(D){return C(D)}if(I&&typeof I.then=="function")return d(I,C);C(null,I)})}function d(x,A){return x.then(function(C){_(A,null,C)},function(C){_(A,C&&C.message?C:new Error(C))})}function _(x,A,C){try{x(A,C)}catch(I){(0,a.default)(function(D){throw D},I)}}e.exports=r.default}(zh,zh.exports),Object.defineProperty(as,"__esModule",{value:!0}),as.isAsyncIterable=as.isAsyncGenerator=as.isAsync=void 0;var ld=zh.exports,cd=fd(ld);function fd(e){return e&&e.__esModule?e:{default:e}}function hd(e){return e[Symbol.toStringTag]==="AsyncFunction"}function Rp(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function qd(e){return typeof e[Symbol.asyncIterator]=="function"}function Mp(e){if(typeof e!="function")throw new Error("expected a function");return hd(e)?(0,cd.default)(e):e}as.default=Mp,as.isAsync=hd,as.isAsyncGenerator=Rp,as.isAsyncIterable=qd;var pc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var s=this,l=[],f=arguments.length;f--;)l[f]=arguments[f];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(d,_){l[i-1]=function(x){for(var A=[],C=arguments.length-1;C-- >0;)A[C]=arguments[C+1];if(x)return _(x);d(A.length>1?A:A[0])},n.apply(s,l)})}return a}e.exports=r.default})(pc,pc.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Qf.exports,n=f(t),i=as,a=f(i),s=pc.exports,l=f(s);function f(d){return d&&d.__esModule?d:{default:d}}r.default=(0,l.default)(function(d,_,x){var A=(0,n.default)(_)?[]:{};d(_,function(C,I,D){(0,a.default)(C)(function(Z){for(var J,ce=[],xe=arguments.length-1;xe-- >0;)ce[xe]=arguments[xe+1];ce.length<2&&(J=ce,ce=J[0]),A[I]=ce,D(Z)})},function(C){return x(C,A)})},3),e.exports=r.default}(Uh,Uh.exports);var yf={exports:{}},th={exports:{}},rh={exports:{}},Zh={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){function i(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n!==null){var l=n;n=null,l.apply(this,a)}}return Object.assign(i,n),i}e.exports=r.default})(Zh,Zh.exports);var Kd={exports:{}},pd={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=r.default})(pd,pd.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=_;var t=Qf.exports,n=s(t),i=pd.exports,a=s(i);function s(x){return x&&x.__esModule?x:{default:x}}function l(x){var A=-1,C=x.length;return function(){return++A<C?{value:x[A],key:A}:null}}function f(x){var A=-1;return function(){var I=x.next();return I.done?null:(A++,{value:I.value,key:A})}}function d(x){var A=x?Object.keys(x):[],C=-1,I=A.length;return function D(){var Z=A[++C];return Z==="__proto__"?D():C<I?{value:x[Z],key:Z}:null}}function _(x){if((0,n.default)(x))return l(x);var A=(0,a.default)(x);return A?f(A):d(x)}e.exports=r.default}(Kd,Kd.exports);var Ip={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var s=n;n=null,s.apply(this,i)}}e.exports=r.default})(Ip,Ip.exports);var dd={exports:{}},vd={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t={};r.default=t,e.exports=r.default})(vd,vd.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=vd.exports,n=i(t);function i(s){return s&&s.__esModule?s:{default:s}}function a(s,l,f,d){var _=!1,x=!1,A=!1,C=0,I=0;function D(){C>=l||A||_||(A=!0,s.next().then(function(ce){var xe=ce.value,Xe=ce.done;if(!(x||_)){if(A=!1,Xe){_=!0,C<=0&&d(null);return}C++,f(xe,I,Z),I++,D()}}).catch(J))}function Z(ce,xe){if(C-=1,!x){if(ce)return J(ce);if(ce===!1){_=!0,x=!0;return}if(xe===n.default||_&&C<=0)return _=!0,d(null);D()}}function J(ce){x||(A=!1,_=!0,d(ce))}D()}e.exports=r.default}(dd,dd.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Zh.exports,n=C(t),i=Kd.exports,a=C(i),s=Ip.exports,l=C(s),f=as,d=dd.exports,_=C(d),x=vd.exports,A=C(x);function C(I){return I&&I.__esModule?I:{default:I}}r.default=function(I){return function(D,Z,J){if(J=(0,n.default)(J),I<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!D)return J(null);if((0,f.isAsyncGenerator)(D))return(0,_.default)(D,I,Z,J);if((0,f.isAsyncIterable)(D))return(0,_.default)(D[Symbol.asyncIterator](),I,Z,J);var ce=(0,a.default)(D),xe=!1,Xe=!1,bt=0,pt=!1;function et(jt,Ar){if(!Xe)if(bt-=1,jt)xe=!0,J(jt);else if(jt===!1)xe=!0,Xe=!0;else{if(Ar===A.default||xe&&bt<=0)return xe=!0,J(null);pt||Pt()}}function Pt(){for(pt=!0;bt<I&&!xe;){var jt=ce();if(jt===null){xe=!0,bt<=0&&J(null);return}bt+=1,Z(jt.value,jt.key,(0,l.default)(et))}pt=!1}Pt()}},e.exports=r.default}(rh,rh.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=rh.exports,n=f(t),i=as,a=f(i),s=pc.exports,l=f(s);function f(_){return _&&_.__esModule?_:{default:_}}function d(_,x,A,C){return(0,n.default)(x)(_,(0,a.default)(A),C)}r.default=(0,l.default)(d,4),e.exports=r.default}(th,th.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=th.exports,n=s(t),i=pc.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d,_){return(0,n.default)(f,1,d,_)}r.default=(0,a.default)(l,3),e.exports=r.default}(yf,yf.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=Uh.exports,n=s(t),i=yf.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,n.default)(a.default,f,d)}e.exports=r.default}(Nh,Nh.exports);var nh=Kf(Nh.exports),wa=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,nh(this.tasks)},e.prototype.tap=function(r,t){var n=this;this.tasks.push(function(i){t.apply(void 0,Fh([],gf(n.args),!1)),i(null,r)})},e}(),bl={exports:{}},$v={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Qf.exports,n=Z(t),i=vd.exports,a=Z(i),s=th.exports,l=Z(s),f=Zh.exports,d=Z(f),_=Ip.exports,x=Z(_),A=as,C=Z(A),I=pc.exports,D=Z(I);function Z(Xe){return Xe&&Xe.__esModule?Xe:{default:Xe}}function J(Xe,bt,pt){pt=(0,d.default)(pt);var et=0,Pt=0,jt=Xe.length,Ar=!1;jt===0&&pt(null);function gr(Xr,mn){Xr===!1&&(Ar=!0),Ar!==!0&&(Xr?pt(Xr):(++Pt===jt||mn===a.default)&&pt(null))}for(;et<jt;et++)bt(Xe[et],et,(0,x.default)(gr))}function ce(Xe,bt,pt){return(0,l.default)(Xe,1/0,bt,pt)}function xe(Xe,bt,pt){var et=(0,n.default)(Xe)?J:ce;return et(Xe,(0,C.default)(bt),pt)}r.default=(0,D.default)(xe,3),e.exports=r.default})($v,$v.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=$v.exports,n=s(t),i=Uh.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,a.default)(n.default,f,d)}e.exports=r.default}(bl,bl.exports);var ih=Kf(bl.exports),dg=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ih(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return qf(n,void 0,void 0,function(){return hc(this,function(a){switch(a.label){case 0:return[4,t()];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),Qd={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Zh.exports,n=_(t),i=Ip.exports,a=_(i),s=as,l=_(s),f=pc.exports,d=_(f);function _(A){return A&&A.__esModule?A:{default:A}}function x(A,C){if(C=(0,n.default)(C),!Array.isArray(A))return C(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return C();var I=0;function D(J){var ce=(0,l.default)(A[I++]);ce.apply(void 0,J.concat([(0,a.default)(Z)]))}function Z(J){for(var ce=[],xe=arguments.length-1;xe-- >0;)ce[xe]=arguments[xe+1];if(J!==!1){if(J||I===A.length)return C.apply(void 0,[J].concat(ce));D(ce)}}D([])}r.default=(0,d.default)(x),e.exports=r.default})(Qd,Qd.exports);var md=Kf(Qd.exports),_f=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return md(this.tasks)},e.prototype.tap=function(r,t){this.tasks.length===0?this.tasks.push(function(n){var i=t();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=t.apply(void 0,Fh([],gf(n),!1));i(a?null:!1,r)})},e}(),gd=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return nh(this.tasks)},e.prototype.tap=function(r,t){this.tasks.push(function(n){var i=t();n(i,r)})},e}(),yd=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,nh(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return qf(n,void 0,void 0,function(){return hc(this,function(a){switch(a.label){case 0:return[4,t.apply(void 0,Fh([],gf(this.args),!1))];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),Jd=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,nh(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return qf(n,void 0,void 0,function(){var a;return hc(this,function(s){switch(s.label){case 0:return[4,t.apply(void 0,Fh([],gf(this.args),!1))];case 1:return a=s.sent(),i(a,r),[2]}})})})},e}(),ev=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return md(this.tasks)},e.prototype.tapPromise=function(r,t){this.tasks.length===0?this.tasks.push(function(n){t().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){t(n).then(function(a){i(null,a)})})},e}(),Yv=O(63844),vg=O.n(Yv),Pp,qv,Kv,Qv,Jv,em,Iu,_d,tm,dc,mg,rm,ah,Vh,jh,Hh,Wh,nm,Ds,im,am,tv,rv,Hc,om,nv,iv,sm,av,um,lm,ov,cm,Op,fm;function sv(e){var r=D0();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function D0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gg=(Pp=(0,Zt.b2)(),qv=(0,Zt.f3)(Ct.SceneID),Kv=(0,Zt.f3)(Ct.IIconService),Qv=(0,Zt.f3)(Ct.IFontService),Jv=(0,Zt.f3)(Ct.IControlService),em=(0,Zt.f3)(Ct.IGlobalConfigService),Iu=(0,Zt.f3)(Ct.IMapService),_d=(0,Zt.f3)(Ct.ICoordinateSystemService),tm=(0,Zt.f3)(Ct.IRendererService),dc=(0,Zt.f3)(Ct.ILayerService),mg=(0,Zt.f3)(Ct.IDebugService),rm=(0,Zt.f3)(Ct.ICameraService),ah=(0,Zt.f3)(Ct.IInteractionService),Vh=(0,Zt.f3)(Ct.IPickingService),jh=(0,Zt.f3)(Ct.IShaderModuleService),Hh=(0,Zt.f3)(Ct.IMarkerService),Wh=(0,Zt.f3)(Ct.IPopupService),Pp(nm=(Ds=function(e){(0,je.Z)(t,e);var r=sv(t);function t(){var n;return(0,ne.Z)(this,t),n=r.call(this),(0,F.Z)((0,Le.Z)(n),"destroyed",!1),(0,F.Z)((0,Le.Z)(n),"loaded",!1),Ui((0,Le.Z)(n),"id",im,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"iconService",am,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"fontService",tv,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"controlService",rv,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"configService",Hc,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"map",om,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"coordinateSystemService",nv,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"rendererService",iv,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"layerService",sm,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"debugService",av,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"cameraService",um,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"interactionService",lm,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"pickingService",ov,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"shaderModuleService",cm,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"markerService",Op,(0,Le.Z)(n)),Ui((0,Le.Z)(n),"popupService",fm,(0,Le.Z)(n)),(0,F.Z)((0,Le.Z)(n),"inited",!1),(0,F.Z)((0,Le.Z)(n),"rendering",!1),(0,F.Z)((0,Le.Z)(n),"$container",void 0),(0,F.Z)((0,Le.Z)(n),"canvas",void 0),(0,F.Z)((0,Le.Z)(n),"markerContainer",void 0),(0,F.Z)((0,Le.Z)(n),"resizeDetector",void 0),(0,F.Z)((0,Le.Z)(n),"hooks",void 0),(0,F.Z)((0,Le.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,F.Z)((0,Le.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new yd},n}return(0,W.Z)(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Nt.Z)(ve().mark(function s(){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),f.next=3,new Promise(function(d){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),d()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(b.Drag,a.addSceneEvent.bind(a));case 10:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Nt.Z)(ve().mark(function s(){var l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(f=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,f?a.$container=f:a.$container=Ye(a.configService.getSceneConfig(a.id).id||""),!a.$container){x.next=14;break}return a.canvas=ra("canvas","",a.$container),a.setCanvas(),x.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),a.resizeDetector=vg()({strategy:"scroll"}),a.resizeDetector.listenTo(a.$container,a.handleWindowResized),window.matchMedia&&((d=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||d===void 0||d.addListener(a.handleWindowResized.bind("screen"))),x.next=15;break;case 14:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 15:a.pickingService.init(a.id);case 16:case"end":return x.stop()}},s)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){var l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return f=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],x.next=3,this.render();case 3:return d=s==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png"),x.abrupt("return",d);case 5:case"end":return x.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=ra("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var s;(s=i.$container)===null||s===void 0||s.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,s=va,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d&&(d.width=l*s,d.height=f*s),this.rendererService.viewport({x:0,y:0,width:s*l,height:s*f})}},{key:"setCanvas",value:function(){var i,a,s=va,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d.width=l*s,d.height=f*s,d.style.width="100%",d.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(Fn.EventEmitter),im=Bi(Ds.prototype,"id",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=Bi(Ds.prototype,"iconService",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=Bi(Ds.prototype,"fontService",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv=Bi(Ds.prototype,"controlService",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hc=Bi(Ds.prototype,"configService",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=Bi(Ds.prototype,"map",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=Bi(Ds.prototype,"coordinateSystemService",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=Bi(Ds.prototype,"rendererService",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm=Bi(Ds.prototype,"layerService",[dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),av=Bi(Ds.prototype,"debugService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=Bi(Ds.prototype,"cameraService",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=Bi(Ds.prototype,"interactionService",[ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov=Bi(Ds.prototype,"pickingService",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=Bi(Ds.prototype,"shaderModuleService",[jh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=Bi(Ds.prototype,"markerService",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=Bi(Ds.prototype,"popupService",[Wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ds))||nm);function L0(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var yg=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function _g(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t={};return e=e.replace(yg,function(n,i,a){var s=a.split(":"),l=s[0].trim(),f="";switch(s.length>1&&(f=s[1].trim()),i){case"bool":f=f==="true";break;case"float":case"int":f=Number(f);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":f?f=f.replace("[","").replace("]","").split(",").reduce(function(d,_){return d.push(Number(_.trim())),d},[]):f=new Array(L0(i)).fill(0);break;default:}return t[l]=f,"".concat(r?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:t}}function hm(e){var r=_g(e,!0),t=r.content,n=r.uniforms;return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,s){s=s.trim().replace(/^.*$/gm,function(_){return"uniform ".concat(_)});var l=_g(s),f=l.content,d=l.uniforms;return Object.assign(n,d),"".concat(a,`{
`).concat(f,`
};`)}),{content:t,uniforms:n}}function bg(e){var r={};return e.replace(yg,function(t,n,i){var a=i.trim();return r[a]?"":(r[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var xg,Eg,B0=pi.uniq,vc="#define PI 3.14159265359",uv=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,pm=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};

layout(std140) uniform LayerUniforms {
  mat4 u_Mvp;
  vec2 u_sceneCenterMercator;
};
`,kp=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,Sg=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,P2=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,O2=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,k2=`layout(location = 3) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,D2=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Qy=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,L2=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,B2=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Jy=/precision\s+(high|low|medium)p\s+float/,e_=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,F2=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,N2=/void\s+main\s*\([^)]*\)\s*\{\n?/,UF=/}\n?[^{}]*$/,U2=(xg=(0,Zt.b2)(),xg(Eg=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"moduleCache",{}),(0,F.Z)(this,"rawContentCache",{})}return(0,W.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:vc,fs:vc}),this.registerModule("decode",{vs:uv,fs:""}),this.registerModule("scene_uniforms",{vs:pm,fs:pm}),this.registerModule("picking_uniforms",{vs:kp,fs:kp}),this.registerModule("projection",{vs:Qy,fs:Qy}),this.registerModule("project",{vs:D2,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:B2}),this.registerModule("lighting",{vs:P2,fs:""}),this.registerModule("light",{vs:Sg,fs:""}),this.registerModule("picking",{vs:k2,fs:O2}),this.registerModule("rotation_2d",{vs:L2,fs:""})}},{key:"registerModule",value:function(t,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,s=n.uniforms,l=n.inject,f=hm(i),d=f.content,_=f.uniforms,x=hm(a),A=x.content,C=x.uniforms;this.rawContentCache[t]={fs:A,inject:l,uniforms:(0,j.Z)((0,j.Z)((0,j.Z)({},_),C),s),vs:d}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this,i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,s=this.rawContentCache[t].inject,l={};s!=null&&s["vs:#decl"]&&(i=(s==null?void 0:s["vs:#decl"])+i,l=hm(s==null?void 0:s["vs:#decl"]).uniforms),s!=null&&s["vs:#main-start"]&&(i=i.replace(N2,function(J){return J+(s==null?void 0:s["vs:#main-start"])})),s!=null&&s["fs:#decl"]&&(a=(s==null?void 0:s["fs:#decl"])+a);var f=this.processModule(i,[],"vs"),d=f.content,_=f.includeList,x=this.processModule(a,[],"fs"),A=x.content,C=x.includeList,I="",D=B0(_.concat(C).concat(t)).reduce(function(J,ce){return(0,j.Z)((0,j.Z)({},J),n.rawContentCache[ce].uniforms)},(0,j.Z)({},l));Jy.test(A)||(I=I+e_),I=I+A;var Z="";return Jy.test(d)||(Z=Z+e_),Z=Z+d,this.moduleCache[t]={fs:I.trim(),uniforms:D,vs:Z.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,s=t.replace(F2,function(l,f){var d=f.split(" "),_=d[0].replace(/"/g,"");if(n.indexOf(_)>-1)return"";var x=a.rawContentCache[_][i];n.push(_);var A=a.processModule(x,n,i),C=A.content;return C});return{content:s,includeList:n}}},{key:"injectDefines",value:function(t){var n=Object.keys(t).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(t[a],`;
`)},`
`);return n}}]),e}())||Eg);function z2(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=(0,Ie.Z)(e),e!==null););return e}function ka(){return typeof Reflect!="undefined"&&Reflect.get?ka=Reflect.get.bind():ka=function(r,t,n){var i=z2(r,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?r:n):a.value}},ka.apply(this,arguments)}var lv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),t_,r_,Ag=(t_=(0,Zt.b2)(),t_(r_=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"shaderModuleService",void 0),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"cameraService",void 0),(0,F.Z)(this,"mapService",void 0),(0,F.Z)(this,"interactionService",void 0),(0,F.Z)(this,"layerService",void 0),(0,F.Z)(this,"config",void 0)}return(0,W.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return lv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Ct.IRendererService),this.cameraService=t.getContainer().get(Ct.ICameraService),this.mapService=t.getContainer().get(Ct.IMapService),this.interactionService=t.getContainer().get(Ct.IInteractionService),this.layerService=t.getContainer().get(Ct.ILayerService),this.shaderModuleService=t.getContainer().get(Ct.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||r_),n_,i_;function Z2(e){var r=V2();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j2=(n_=(0,Zt.b2)(),n_(i_=function(e){(0,je.Z)(t,e);var r=Z2(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){ka((0,Ie.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Ag))||i_),a_,o_,s_,F0,u_;function H2(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=W2(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function W2(e,r){if(e){if(typeof e=="string")return l_(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l_(e,r)}}function l_(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var G2=(a_=(0,Zt.b2)(),o_=(0,Zt.f3)(Ct.IPostProcessor),a_(s_=(F0=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"passes",[]),Ui(this,"postProcessor",u_,this),(0,F.Z)(this,"layer",void 0),(0,F.Z)(this,"renderFlag",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0)}return(0,W.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=(0,Nt.Z)(ve().mark(function n(){var i,a,s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:i=H2(this.passes),f.prev=1,i.s();case 3:if((a=i.n()).done){f.next=9;break}return s=a.value,f.next=7,s.render(this.layer);case 7:f.next=3;break;case 9:f.next=14;break;case 11:f.prev=11,f.t0=f.catch(1),i.e(f.t0);case 14:return f.prev=14,i.f(),f.finish(14);case 17:return f.next=19,this.postProcessor.render(this.layer);case 19:case"end":return f.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===lv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),u_=Bi(F0.prototype,"postProcessor",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0))||s_),c_,f_;function X2(e){var r=$2();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function $2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y2=(c_=(0,Zt.b2)(),c_(f_=function(e){(0,je.Z)(t,e);var r=X2(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"pickingFBO",void 0),(0,F.Z)((0,Le.Z)(n),"layer",void 0),(0,F.Z)((0,Le.Z)(n),"width",0),(0,F.Z)((0,Le.Z)(n),"height",0),(0,F.Z)((0,Le.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Le.Z)(n),"pickFromPickingFBO",function(l){var f=l.x,d=l.y,_=l.lngLat,x=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(x))){var A=n.rendererService,C=A.getViewportSize,I=A.readPixelsAsync,D=A.useFramebuffer,Z=C(),J=Z.width,ce=Z.height,xe=n.layer.getLayerConfig(),Xe=xe.enableHighlight,bt=xe.enableSelect,pt=f*va,et=d*va;if(!(pt>J||pt<0||et>ce||et<0)){var Pt;D(n.pickingFBO,(0,Nt.Z)(ve().mark(function jt(){var Ar,gr,Xr,mn,qn;return ve().wrap(function(Ma){for(;;)switch(Ma.prev=Ma.next){case 0:return Ma.next=2,I({x:Math.round(pt),y:Math.round(ce-(d+1)*va),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO});case 2:Pt=Ma.sent,Pt[0]!==0||Pt[1]!==0||Pt[2]!==0?(gr=Fa(Pt),Xr=n.layer.getSource().getFeatureById(gr),mn={x:f,y:d,type:x,lngLat:_,featureId:gr,feature:Xr},Xr&&(n.layer.setCurrentPickId(gr),n.triggerHoverOnLayer(mn))):(qn={x:f,y:d,lngLat:_,type:n.layer.getCurrentPickId()===null?"un"+x:"mouseout",featureId:null,feature:null},n.triggerHoverOnLayer((0,j.Z)((0,j.Z)({},qn),{},{type:"unpick"})),n.triggerHoverOnLayer(qn),n.layer.setCurrentPickId(null)),Xe&&n.highlightPickedFeature(Pt),bt&&x==="click"&&((Ar=Pt)===null||Ar===void 0?void 0:Ar.toString())!==[0,0,0,0].toString()&&n.selectFeature(Pt);case 6:case"end":return Ma.stop()}},jt)})))}}}),n}return(0,W.Z)(t,[{key:"getType",value:function(){return lv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){ka((0,Ie.Z)(t.prototype),"init",this).call(this,i,a),this.layer=i;var s=this.rendererService,l=s.createTexture2D,f=s.createFramebuffer,d=s.getViewportSize,_=d(),x=_.width,A=_.height,C=l({width:x,height:A,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=f({color:C}),this.interactionService.on(b.Hover,this.pickFromPickingFBO),this.interactionService.on(b.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(b.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var s=this.rendererService,l=s.getViewportSize,f=s.useFramebuffer,d=s.clear,_=l(),x=_.width,A=_.height;this.alreadyInRendering=!0,(this.width!==x||this.height!==A)&&(this.pickingFBO.resize({width:x,height:A}),this.width=x,this.height=A),f(this.pickingFBO,function(){d({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var C=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(C),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=(0,Rn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeHighlight.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=(0,Rn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeSelect.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,s=ca(a);this.selectFeature(new Uint8Array(s))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,s=ca(a);this.highlightPickedFeature(new Uint8Array(s))}}]),t}(Ag))||f_),h_,p_,d_,N0,v_,q2=pi.camelCase,K2=pi.isNil,Q2=pi.upperFirst,J2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Gh=(h_=(0,Zt.b2)(),p_=(0,Zt.f3)(Ct.IShaderModuleService),h_(d_=(N0=function(){function e(){(0,ne.Z)(this,e),Ui(this,"shaderModuleService",v_,this),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"config",void 0),(0,F.Z)(this,"quad",J2),(0,F.Z)(this,"enabled",!0),(0,F.Z)(this,"renderToScreen",!1),(0,F.Z)(this,"model",void 0),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"optionsToUpdate",{})}return(0,W.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return lv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Ct.IRendererService),this.shaderModuleService=t.getContainer().get(Ct.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,s=i.createBuffer,l=i.createModel,f=this.setupShaders(),d=f.vs,_=f.fs,x=f.uniforms;this.model=l({vs:d,fs:_,attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:K.FLOAT}),size:2})},uniforms:(0,j.Z)((0,j.Z)({u_Texture:null},x),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),s=this.rendererService,l=s.useFramebuffer,f=s.getViewportSize,d=s.clear,_=f(),x=_.width,A=_.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){d({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var C=(0,j.Z)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[x,A]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(C.u_BloomFinal=1,C.u_Texture2=n),i.model.draw({uniforms:C})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,j.Z)((0,j.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){K2(t[i])||(n["u_".concat(Q2(q2(i)))]=t[i])}),n}}]),e}(),v_=Bi(N0.prototype,"shaderModuleService",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0))||d_),m_,g_;function eA(e){var r=tA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function tA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rA=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,nA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,U0=pi.isNil,iA=(m_=(0,Zt.b2)(),m_(g_=function(e){(0,je.Z)(t,e);var r=eA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:nA,fs:rA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,j.Z)((0,j.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return U0(i.bloomRadius)||(a.u_radius=i.bloomRadius),U0(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),U0(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(Gh))||g_),y_,__;function aA(e){var r=oA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,uA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lA=pi.isNil,cA=(y_=(0,Zt.b2)(),y_(__=function(e){(0,je.Z)(t,e);var r=aA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:uA,fs:sA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,j.Z)((0,j.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return lA(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(Gh))||__),b_,x_;function fA(e){var r=hA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,dA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,vA=pi.isNil,mA=(b_=(0,Zt.b2)(),b_(x_=function(e){(0,je.Z)(t,e);var r=fA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:dA,fs:pA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,j.Z)((0,j.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return vA(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(Gh))||x_),E_,S_;function gA(e){var r=yA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function yA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _A=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,bA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xA=(E_=(0,Zt.b2)(),E_(S_=function(e){(0,je.Z)(t,e);var r=gA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:bA,fs:_A});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,j.Z)((0,j.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),t}(Gh))||S_),A_,T_;function EA(e){var r=SA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function SA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,TA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wA=(A_=(0,Zt.b2)(),A_(T_=function(e){(0,je.Z)(t,e);var r=EA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:TA,fs:AA}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Gh))||T_),w_,C_;function CA(e){var r=RA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function RA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,IA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,PA=(w_=(0,Zt.b2)(),w_(C_=function(e){(0,je.Z)(t,e);var r=CA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:IA,fs:MA});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,j.Z)((0,j.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),t}(Gh))||C_),R_,M_;function OA(e){var r=kA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function kA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,LA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,BA=(R_=(0,Zt.b2)(),R_(M_=function(e){(0,je.Z)(t,e);var r=OA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:LA,fs:DA});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,j.Z)((0,j.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),t}(Gh))||M_),I_,P_;function FA(e){var r=NA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function NA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,zA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ZA=(I_=(0,Zt.b2)(),I_(P_=function(e){(0,je.Z)(t,e);var r=FA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:zA,fs:UA}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Gh))||P_),O_,k_;function VA(e){var r=jA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function jA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,WA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,GA=(O_=(0,Zt.b2)(),O_(k_=function(e){(0,je.Z)(t,e);var r=VA(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:HA,fs:WA}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Gh))||k_),D_,L_,B_,F_,cv,N_,XA=(D_=(0,Zt.b2)(),L_=(0,Zt.f3)(Ct.IRendererService),B_=(0,Zt.zY)(),D_(F_=(cv=function(){function e(){(0,ne.Z)(this,e),Ui(this,"rendererService",N_,this),(0,F.Z)(this,"passes",[]),(0,F.Z)(this,"readFBO",void 0),(0,F.Z)(this,"writeFBO",void 0)}return(0,W.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),s=a.width,l=a.height;return i({x:0,y:0,width:s,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(t.readFBO,(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.getReadFBOTex();case 2:s=d.sent,l=0;case 4:if(!(l<4)){d.next=11;break}return d.next=7,a.render(i,s);case 7:this.swap(),l++,d.next=4;break;case 11:case"end":return d.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){var a,s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=0;case 1:if(!(a<this.passes.length)){f.next=15;break}if(s=this.passes[a],s.setRenderToScreen(this.isLastEnabledPass(a)),s.getName()!=="bloom"){f.next=9;break}return f.next=7,this.renderBloomPass(i,s);case 7:f.next=12;break;case 9:return f.next=11,s.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,f.next=1;break;case 15:case"end":return f.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),N_=Bi(cv.prototype,"rendererService",[L_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bi(cv.prototype,"init",[B_],Object.getOwnPropertyDescriptor(cv.prototype,"init"),cv.prototype),cv))||F_),U_,z_;function $A(e){var r=YA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=(U_=(0,Zt.b2)(),U_(z_=function(e){(0,je.Z)(t,e);var r=$A(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getType",value:function(){return lv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){ka((0,Ie.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,s=a.useFramebuffer,l=a.clear,f=i.multiPassRenderer.getPostProcessor().getReadFBO();s(f,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:f}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(d){d.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Ag))||z_),Z_,V_,j_,z0,H_;function KA(e){var r=QA();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,W_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,eT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function G_(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var tT=1,rT=(Z_=(0,Zt.b2)(),V_=(0,Zt.f3)(Ct.IShaderModuleService),Z_(j_=(z0=function(e){(0,je.Z)(t,e);var r=KA(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),Ui((0,Le.Z)(n),"shaderModuleService",H_,(0,Le.Z)(n)),(0,F.Z)((0,Le.Z)(n),"haltonSequence",[]),(0,F.Z)((0,Le.Z)(n),"accumulatingId",0),(0,F.Z)((0,Le.Z)(n),"frame",0),(0,F.Z)((0,Le.Z)(n),"timer",void 0),(0,F.Z)((0,Le.Z)(n),"sampleRenderTarget",void 0),(0,F.Z)((0,Le.Z)(n),"prevRenderTarget",void 0),(0,F.Z)((0,Le.Z)(n),"outputRenderTarget",void 0),(0,F.Z)((0,Le.Z)(n),"copyRenderTarget",void 0),(0,F.Z)((0,Le.Z)(n),"blendModel",void 0),(0,F.Z)((0,Le.Z)(n),"outputModel",void 0),(0,F.Z)((0,Le.Z)(n),"copyModel",void 0),n}return(0,W.Z)(t,[{key:"getType",value:function(){return lv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){ka((0,Ie.Z)(t.prototype),"init",this).call(this,i,a);var s=this.rendererService,l=s.createFramebuffer,f=s.createTexture2D;this.sampleRenderTarget=l({color:f({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:f({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:f({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:f({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE})});for(var d=0;d<30;d++)this.haltonSequence.push([G_(d,2),G_(d,3)]);this.blendModel=this.createTriangleModel("blend-pass",JA),this.outputModel=this.createTriangleModel("copy-pass",W_,{blend:{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE_MINUS_SRC_ALPHA,srcAlpha:K.ONE,dstAlpha:K.ONE_MINUS_SRC_ALPHA},equation:{rgb:K.FUNC_ADD,alpha:K.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",W_)}},{key:"render",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,_=f(),x=_.width,A=_.height;this.sampleRenderTarget.resize({width:x,height:A}),this.prevRenderTarget.resize({width:x,height:A}),this.outputRenderTarget.resize({width:x,height:A}),this.copyRenderTarget.resize({width:x,height:A}),this.resetFrame(),this.stopAccumulating();var C=i.multiPassRenderer.getPostProcessor().getReadFBO();d(C,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:C}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function D(Z){!a.accumulatingId||Z!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){D(Z)}))};this.accumulatingId=tT++,this.timer=window.setTimeout(function(){I(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,_=f(),x=_.width,A=_.height,C=i.getLayerConfig(),I=C.jitterScale,D=I===void 0?1:I,Z=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Z[0]*2-1)/x*D,(Z[1]*2-1)/A*D),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),d(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var J=i.getLayerConfig();d(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:J.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(d(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),d(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var ce=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ce,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,s){this.shaderModuleService.registerModule(i,{vs:eT,fs:a});var l=this.shaderModuleService.getModule(i),f=l.vs,d=l.fs,_=l.uniforms,x=this.rendererService,A=x.createAttribute,C=x.createBuffer,I=x.createModel;return I((0,j.Z)({vs:f,fs:d,attributes:{a_Position:A({buffer:C({data:[-4,-4,4,-4,0,4],type:K.FLOAT}),size:2})},uniforms:(0,j.Z)({},_),depth:{enable:!1},count:3},s))}}]),t}(Ag),H_=Bi(z0.prototype,"shaderModuleService",[V_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z0))||j_),dm=new Zt.W2;dm.bind(Ct.IGlobalConfigService).to(cg).inSingletonScope(),(0,Zt.GW)((0,Zt.b2)(),Fn.EventEmitter),dm.bind(Ct.IEventEmitter).to(Fn.EventEmitter);var X_=(0,Ai.Z)(dm,!1),Z0=function(r){var t=X_.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},zF=function(r){var t=X_.lazyMultiInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},Ul=dm,nT=0;function iT(){var e=new Zt.W2;return e.parent=dm,e.bind(Ct.SceneID).toConstantValue("".concat(nT++)),e.bind(Ct.IShaderModuleService).to(U2).inSingletonScope(),e.bind(Ct.ILayerService).to(Ea).inSingletonScope(),e.bind(Ct.IDebugService).to(u).inSingletonScope(),e.bind(Ct.ISceneService).to(gg).inSingletonScope(),e.bind(Ct.ICameraService).to(Nn).inSingletonScope(),e.bind(Ct.ICoordinateSystemService).to(k0).inSingletonScope(),e.bind(Ct.IInteractionService).to(_e).inSingletonScope(),e.bind(Ct.IPickingService).to(Qi).inSingletonScope(),e.bind(Ct.IControlService).to(od).inSingletonScope(),e.bind(Ct.IMarkerService).to(sc).inSingletonScope(),e.bind(Ct.IIconService).to(pr).inSingletonScope(),e.bind(Ct.IFontService).to(gt).inSingletonScope(),e.bind(Ct.IPopupService).to(ag).inSingletonScope(),e.bind(Ct.INormalPass).to(j2).whenTargetNamed("clear"),e.bind(Ct.INormalPass).to(Y2).whenTargetNamed("pixelPicking"),e.bind(Ct.INormalPass).to(qA).whenTargetNamed("render"),e.bind(Ct.INormalPass).to(rT).whenTargetNamed("taa"),e.bind(Ct.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Ct.INormalPass,t)}}),e.bind(Ct.IPostProcessingPass).to(wA).whenTargetNamed("copy"),e.bind(Ct.IPostProcessingPass).to(iA).whenTargetNamed("bloom"),e.bind(Ct.IPostProcessingPass).to(cA).whenTargetNamed("blurH"),e.bind(Ct.IPostProcessingPass).to(mA).whenTargetNamed("blurV"),e.bind(Ct.IPostProcessingPass).to(ZA).whenTargetNamed("noise"),e.bind(Ct.IPostProcessingPass).to(GA).whenTargetNamed("sepia"),e.bind(Ct.IPostProcessingPass).to(xA).whenTargetNamed("colorHalftone"),e.bind(Ct.IPostProcessingPass).to(PA).whenTargetNamed("hexagonalPixelate"),e.bind(Ct.IPostProcessingPass).to(BA).whenTargetNamed("ink"),e.bind(Ct.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Ct.IPostProcessingPass,t);return n.setName(t),n}}),e}function vm(e){var r=new Zt.W2;return r.parent=e,r.bind(Ct.IStyleAttributeService).to(Ap).inSingletonScope(),r.bind(Ct.IMultiPassRenderer).to(G2).inSingletonScope(),r.bind(Ct.IPostProcessor).to(XA).inSingletonScope(),r}var aT=null;function ZF(e){return aT.indexOf(e)}var $_=pi.clamp,oT=2,VF=4,sT=64,jF=128,uT=256,lT=512,HF=8192,WF=16384,GF=32768,cT=null,Y_=131072,XF=262144,fT=524288,$F=1048576,hT=2097152,YF=4194304,pT=8388608,dT=16777216,vT=null;function Tg(e,r){return e=$_(Math.floor(e),0,255),r=$_(Math.floor(r),0,255),256*e+r}function qF(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,a=e.shape,s=e.opacity,l=e.stroke,f=e.strokeWidth,d=e.strokeOpacity,_=[],x=[],A=[],C=[Tg(r[0],r[1]),Tg(r[2],r[3])],I=[Tg(l[0],l[1]),Tg(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(D){var Z=_slicedToArray(D,2),J=Z[0],ce=Z[1];_.push([].concat(C,[(J+1)*pT+(ce+1)*hT+getShapeIndex(a)*Y_+t,(n+512)*fT+(i+512)*sT])),x.push([].concat(I,[f,d])),A.push([s,0,0,0])}),{packedBuffer:_,packedBuffer2:x,packedBuffer3:A}}function KF(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*vT+t*dT+n*Y_+t*cT+n*lT+t*uT+n*oT+t}var bd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Ls={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},eo=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),fv=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Un=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),mT=["mapload","mapchange","mapAfterFrameChange"],wg=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Pu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),gT=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n,i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f,d){n({x:t.x,y:t.y,z:t.z},function(_,x){if(_||x.length===0){d(_);return}x&&li([{data:x,bands:[0]}],i,a,function(A,C){A?d(A):C&&f(C)})})}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),yT=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(s,l){n({x:t.x,y:t.y,z:t.z},function(f,d){if(f||!d){l(f);return}d instanceof ArrayBuffer?vu(d,function(_,x){_&&l(_),s(x)}):d instanceof HTMLImageElement?s(d):l(f)})}));case 1:case"end":return a.stop()}},r)}));return function(t,n){return e.apply(this,arguments)}}();function _T(e,r){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return v(t,r)}):e.map(function(t){return{url:v(t.url,r),bands:t.bands||[0]}}):v(e,r)}function bT(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(r){return{url:r,bands:[0]}}):e}function q_(e,r){e.xhrCancel=function(){r.map(function(t){t.abort()})}}var xT=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n,i,a,s){var l,f,d,_,x,A;return ve().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(l=bT(n.url),!(l.length>1)){I.next=15;break}return I.next=4,ET(l,n);case 4:if(f=I.sent,d=f.rasterFiles,_=f.xhrList,x=f.errList,q_(t,_),!(x.length>0)){I.next=12;break}return i(x,null),I.abrupt("return");case 12:li(d,a,s,i),I.next=17;break;case 15:A=Ri(n,function(D,Z){if(D)i(D);else if(Z){var J=[{data:Z,bands:l[0].bands}];li(J,a,s,i)}}),q_(t,[A]);case 17:case"end":return I.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function ET(e,r){return V0.apply(this,arguments)}function V0(){return V0=(0,Nt.Z)(ve().mark(function e(r,t){var n,i,a,s,l,f,d,_,x,A,C;return ve().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:n=[],i=[],a=[],s=0;case 4:if(!(s<r.length)){D.next=20;break}return l=r[s],f=(0,j.Z)((0,j.Z)({},t),{},{url:l.url}),d=l.bands,D.next=10,Gi((0,j.Z)((0,j.Z)({},f),{},{type:"arrayBuffer"}));case 10:_=D.sent,x=_.err,A=_.data,C=_.xhr,x&&a.push(x),i.push(C),n.push({data:A,bands:d});case 17:s++,D.next=4;break;case 20:return D.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return D.stop()}},e)})),V0.apply(this,arguments)}var ST=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n,i,a,s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l={url:_T(t,n)},d.abrupt("return",new Promise(function(_,x){xT(i,l,function(A,C){A?x(A):C&&_(C)},a,s)}));case 2:case"end":return d.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}(),K_=function(){var e=(0,Nt.Z)(ve().mark(function r(t,n,i,a){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return l=Array.isArray(t)?t[0]:t,a.wmtsOptions?(f=(a==null?void 0:a.getURLFromTemplate)||p,s=f(l,(0,j.Z)((0,j.Z)({},n),a.wmtsOptions))):(d=(a==null?void 0:a.getURLFromTemplate)||v,s=d(l,n)),x.abrupt("return",new Promise(function(A,C){var I,D=Ba({url:s,type:(a==null||(I=a.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(Z,J){Z?C(Z):J&&A(J)},a.transformResponse);i.xhrCancel=function(){return D.cancel()}}));case 3:case"end":return x.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),Q_=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},AT={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},QF=[Pu.ARRAYBUFFER,Pu.RGB];function TT(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function wT(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(TT(e))throw new Error("tile server url is error");var t=(r==null?void 0:r.dataType)||Pu.IMAGE;t===Pu.RGB&&(t=Pu.ARRAYBUFFER);var n=function(s,l){switch(t){case Pu.IMAGE:return K_(e,s,l,r);case Pu.CUSTOMIMAGE:case Pu.CUSTOMTERRAINRGB:return yT(l,r==null?void 0:r.getCustomData);case Pu.ARRAYBUFFER:return ST(e,s,l,(r==null?void 0:r.format)||Q_,r==null?void 0:r.operation);case Pu.CUSTOMARRAYBUFFER:case Pu.CUSTOMRGB:return gT(l,r==null?void 0:r.getCustomData,(r==null?void 0:r.format)||Q_,r==null?void 0:r.operation);default:return K_(e,s,l,r)}},i=(0,j.Z)((0,j.Z)((0,j.Z)({},AT),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var CT=["extent","min","max","width","height","format","operation"];function RT(e,r){var t=r.extent,n=r.min,i=r.max,a=r.width,s=r.height,l=r.format,f=r.operation,d=(0,xi.Z)(r,CT),_;if(l===void 0||Nc(e))_=Array.from(e);else{var x=Array.isArray(e)?e:[e];_=vn(x,l,f)}var A={_id:1,dataArray:[(0,j.Z)((0,j.Z)({_id:1,data:_,width:a,height:s},d),{},{min:n,max:i,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return A}var MT={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},IT=function(){var e=(0,Nt.Z)(ve().mark(function r(t){return ve().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var s=(0,Rn.Z)(t.bounds,4),l=s[0],f=s[1],d=s[2],_=s[3],x={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(l+d)/2,y:(f+_)/2},geometry:{type:"LineString",coordinates:[[d,_],[d,f],[l,f],[l,f]]}}]}}};a(x)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function PT(e,r){var t=function(a){return IT(a)},n=(0,j.Z)((0,j.Z)((0,j.Z)({},MT),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var OT=["extent","width","height"];function kT(e,r){var t=r.extent,n=r.width,i=r.height,a=(0,xi.Z)(r,OT);e.length<3&&console.warn("RGB\u89E3\u6790\u9700\u8981\u4E09\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");for(var s=a.bands||[0,1,2],l=(0,Rn.Z)(s,3),f=l[0],d=l[1],_=l[2],x=[e[f],e[d],e[_]],A=[],C=(a==null?void 0:a.countCut)||[2,98],I=(0,Rn.Z)(C,2),D=I[0],Z=I[1],J=(a==null?void 0:a.RMinMax)||Pr(x[0],D,Z),ce=(a==null?void 0:a.GMinMax)||Pr(x[1],D,Z),xe=(a==null?void 0:a.BMinMax)||Pr(x[2],D,Z),Xe=0;Xe<x[0].length;Xe++)A.push(Math.max(0,x[0][Xe]-J[0])),A.push(Math.max(0,x[1][Xe]-ce[0])),A.push(Math.max(0,x[2][Xe]-xe[0]));var bt={_id:1,dataArray:[(0,j.Z)((0,j.Z)({_id:1,data:A,width:n,height:i,rMinMax:J,gMinMax:ce,bMinMax:xe},a),{},{coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return bt}var DT=["extent","width","height"];function LT(e,r){var t=r.extent,n=r.width,i=r.height,a=(0,xi.Z)(r,DT);e.length<2&&console.warn("RGB\u89E3\u6790\u9700\u89812\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");for(var s=a.bands||[0,1],l=(0,Rn.Z)(s,2),f=l[0],d=l[1],_=[e[f],e[d]],x=[],A=0;A<_[0].length;A++)x.push((_[1][A]-_[0][A])/(_[1][A]+_[0][A]));var C={_id:1,dataArray:[(0,j.Z)((0,j.Z)({_id:1,data:x,width:n,height:i},a),{},{coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return C}var BT=O(72571),FT=O(69848),NT=O.n(FT);function J_(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,s=r.minZoom,l=s===void 0?0:s,f=r.zoom,d=f===void 0?2:f;if(e.pointIndex){var _=e.pointIndex.getClusters(e.extent,Math.floor(d));return e.dataArray=UT(_),e}var x=new(NT())({radius:n,minZoom:l,maxZoom:a}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(C){return{type:"Feature",geometry:{type:"Point",coordinates:C.coordinates},properties:(0,j.Z)({},C)}}),x.load(A.features),x}function UT(e){return e.map(function(r,t){return(0,j.Z)({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function zT(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function ZT(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function e1(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function VT(e){if(e.length===0)throw new Error("mean requires at least one data point");return e1(e)/e.length}var jT={min:ZT,max:zT,mean:VT,sum:e1};function HT(e){var r=WT();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GT=pi.cloneDeep,t1=pi.isFunction,XT=pi.isString,$T=pi.mergeWith;function YT(e,r){if(Array.isArray(r))return r}var qT=function(e){(0,je.Z)(t,e);var r=HT(t);function t(n,i){var a;return(0,ne.Z)(this,t),a=r.call(this),(0,F.Z)((0,Le.Z)(a),"type","source"),(0,F.Z)((0,Le.Z)(a),"isTile",!1),(0,F.Z)((0,Le.Z)(a),"inited",!1),(0,F.Z)((0,Le.Z)(a),"hooks",{init:new wa}),(0,F.Z)((0,Le.Z)(a),"parser",{type:"geojson"}),(0,F.Z)((0,Le.Z)(a),"transforms",[]),(0,F.Z)((0,Le.Z)(a),"cluster",!1),(0,F.Z)((0,Le.Z)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,F.Z)((0,Le.Z)(a),"invalidExtent",!1),(0,F.Z)((0,Le.Z)(a),"dataArrayChanged",!1),(0,F.Z)((0,Le.Z)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return(0,W.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,s=this.clusterOptions,l=s.method,f=l===void 0?"sum":l,d=s.field,_=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,_.forEach(function(x){x.id||(x.properties.point_count=1)}),(d||t1(f))&&(_=_.map(function(x){var A=x.id;if(A){var C=a.clusterIndex.getLeaves(A,1/0),I=C.map(function(J){return J.properties}),D;if(XT(f)&&d){var Z=Gf(I,d);D=jT[f](Z)}t1(f)&&(D=f(I)),x.properties.stat=D}else x.properties.point_count=1;return x})),this.data=Y("geojson")({type:"FeatureCollection",features:_}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,s=a.type,l=s===void 0?"geojson":s,f=a.geometry;if(l==="geojson"&&!this.cluster){var d=i<this.originData.features.length?this.originData.features[i]:"null",_=GT(d);if(_!=null&&_.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var x=this.data.dataArray.find(function(A){return A._id===i});_.properties=x}return _}else return l==="json"&&f?this.data.dataArray.find(function(A){return A._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(s){return s._id===i?(0,j.Z)((0,j.Z)({},s),a):s}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var s=this.data.dataArray.find(function(l){return l[i]===a});return s==null?void 0:s._id}},{key:"setData",value:function(i,a){var s=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){s.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,s)}},{key:"reloadTileByLnglat",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,s)}},{key:"getTileExtent",value:function(i,a){var s;return(s=this.tileset)===null||s===void 0?void 0:s.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,s){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,s)}},{key:"reloadTileByExtent",value:function(i,a){var s;(s=this.tileset)===null||s===void 0||s.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s=this;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",new Promise(function(d,_){try{s.excuteParser(),s.initCluster(),s.executeTrans(),d({})}catch(x){_(x)}}));case 1:case"end":return f.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=$T(this.cfg,i,YT);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,j.Z)((0,j.Z)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",s=Y(a);this.data=s(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=Vu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new Vf((0,j.Z)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(s){var l=s.type,f=ue(l)(i.data,s);Object.assign(i.data,f)})}},{key:"initCluster",value:function(){if(this.cluster){var i=this.clusterOptions||{};this.clusterIndex=J_(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(a=ju(Kl(this.extent),i)),a[0].concat(a[1])}}]),t}(BT.EventEmitter);function KT(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function r1(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=QT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function QT(e,r){if(e){if(typeof e=="string")return n1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return n1(e,r)}}function n1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var j0=6378e3;function JT(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*j0)*(256<<20)/2,s=ew(t,i),l=s.gridHash,f=s.gridOffset,d=iw(l,f,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:d}}function ew(e,r){var t=1/0,n=-1/0,i,a=r1(e),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(xe){a.e(xe)}finally{a.f()}var f=(t+n)/2,d=tw(r,f);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d};var _={},x=r1(e),A;try{for(x.s();!(A=x.n()).done;){var C=A.value,I=C.coordinates[1],D=C.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(D)){var Z=Math.floor((I+90)/d.yOffset),J=Math.floor((D+180)/d.xOffset),ce="".concat(Z,"-").concat(J);_[ce]=_[ce]||{count:0,points:[]},_[ce].count+=1,_[ce].points.push(C)}}}catch(xe){x.e(xe)}finally{x.f()}return{gridHash:_,gridOffset:d}}function tw(e,r){var t=rw(e),n=nw(r,e);return{yOffset:t,xOffset:n}}function rw(e){return e/j0*(180/Math.PI)}function nw(e,r){return r/j0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function iw(e,r,t){return Object.keys(e).reduce(function(n,i,a){var s=i.split("-"),l=parseInt(s[0],10),f=parseInt(s[1],10),d={};if(t.field&&t.method){var _=Nf(e[i].points,t.field);d[t.method]=Ic[t.method](_)}return Object.assign(d,{_id:a,coordinates:Ya([-180+r.xOffset*(f+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(d),n},[])}var hv=Math.PI/3,aw=[0,hv,2*hv,3*hv,4*hv,5*hv];function ow(e){return e[0]}function sw(e){return e[1]}function uw(){var e=0,r=0,t=1,n=1,i=ow,a=sw,s,l,f;function d(x){var A={},C=[],I,D=x.length;for(I=0;I<D;++I)if(!(isNaN(J=+i.call(null,Z=x[I],I,x))||isNaN(ce=+a.call(null,Z,I,x)))){var Z,J,ce,xe=Math.round(ce=ce/f),Xe=Math.round(J=J/l-(xe&1)/2),bt=ce-xe;if(Math.abs(bt)*3>1){var pt=J-Xe,et=Xe+(J<Xe?-1:1)/2,Pt=xe+(ce<xe?-1:1),jt=J-et,Ar=ce-Pt;pt*pt+bt*bt>jt*jt+Ar*Ar&&(Xe=et+(xe&1?1:-1)/2,xe=Pt)}var gr=Xe+"-"+xe,Xr=A[gr];Xr?Xr.push(Z):(C.push(Xr=A[gr]=[Z]),Xr.x=(Xe+(xe&1)/2)*l,Xr.y=xe*f)}return C}function _(x){var A=0,C=0;return aw.map(function(I){var D=Math.sin(I)*x,Z=-Math.cos(I)*x,J=D-A,ce=Z-C;return A=D,C=Z,[J,ce]})}return d.hexagon=function(x){return"m"+_(x==null?s:+x).join("l")+"z"},d.centers=function(){for(var x=[],A=Math.round(r/f),C=Math.round(e/l),I=A*f;I<n+s;I+=f,++A)for(var D=C*l+(A&1)*l/2;D<t+l/2;D+=l)x.push([D,I]);return x},d.mesh=function(){var x=_(s).slice(0,4).join("l");return d.centers().map(function(A){return"M"+A+"m"+x}).join("")},d.x=function(x){return arguments.length?(i=x,d):i},d.y=function(x){return arguments.length?(a=x,d):a},d.radius=function(x){return arguments.length?(s=+x,l=s*2*Math.sin(hv),f=s*1.5,d):s},d.size=function(x){return arguments.length?(e=r=0,t=+x[0],n=+x[1],d):[t-e,n-r]},d.extent=function(x){return arguments.length?(e=+x[0][0],r=+x[0][1],t=+x[1][0],n=+x[1][1],d):[[e,r],[t,n]]},d.radius(1)}var lw=6378e3;function cw(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,s=a===void 0?"sum":a,l=i/(2*Math.PI*lw)*(256<<20)/2,f=t.map(function(A){var C=Ya(A.coordinates),I=(0,Rn.Z)(C,2),D=I[0],Z=I[1];return(0,j.Z)((0,j.Z)({},A),{},{coordinates:[D,Z]})}),d=uw().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),_=d(f),x={dataArray:_.map(function(A,C){var I;if(r.field&&s){var D=Nf(A,r.field);A[s]=Ic[s](D)}return I={},(0,F.Z)(I,r.method,A[s]),(0,F.Z)(I,"count",A.length),(0,F.Z)(I,"rawData",A),(0,F.Z)(I,"coordinates",[A.x,A.y]),(0,F.Z)(I,"_id",C),I}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return x}function fw(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(s){a[s[t]]=s}),e.dataArray=e.dataArray.map(function(s){var l=s[n];return(0,j.Z)((0,j.Z)({},s),a[l])}),e}function hw(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}V("rasterTile",wT),V("mvt",Dr),V("geojsonvt",rt),V("testTile",PT),V("geojson",Jp),V("jsonTile",Xt),V("image",Jt),V("csv",ac),V("json",Kp),V("raster",Fr),V("rasterRgb",RT),V("rgb",kT),V("ndi",LT),H("cluster",J_),H("filter",KT),H("join",fw),H("map",hw),H("grid",JT),H("hexagon",cw);var i1=qT,Cg=O(10578),pw=O.n(Cg);function dw(e){var r=vw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw=function(e){(0,je.Z)(t,e);var r=dw(t);function t(n){var i;return(0,ne.Z)(this,t),i=r.call(this),(0,F.Z)((0,Le.Z)(i),"added",!1),(0,F.Z)((0,Le.Z)(i),"preLngLat",{lng:0,lat:0}),(0,F.Z)((0,Le.Z)(i),"onMarkerDragStart",function(a){var s=i.mapsService.getContainer();if(s){i.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});var l=s.getClientRects()[0],f=l.left,d=l.top,_=a.x,x=a.y;i.preLngLat=i.mapsService.containerToLngLat([_-f,x-d]),i.mapsService.on("mousemove",i.onMarkerDragMove),document.addEventListener("mouseup",i.onMarkerDragEnd),i.emit("dragstart",i.lngLat)}}),(0,F.Z)((0,Le.Z)(i),"onMarkerDragMove",function(a){var s=i.preLngLat,l=s.lng,f=s.lat,d=a.lnglat,_=d.lng,x=d.lat,A={lng:i.lngLat.lng+_-l,lat:i.lngLat.lat+x-f};i.setLnglat(A),i.preLngLat=a.lnglat,i.emit("dragging",A)}),(0,F.Z)((0,Le.Z)(i),"onMarkerDragEnd",function(a){i.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),i.mapsService.off("mousemove",i.onMarkerDragMove),document.removeEventListener("mouseup",i.onMarkerDragEnd),i.emit("dragend",i.lngLat)}),(0,F.Z)((0,Le.Z)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=(0,j.Z)((0,j.Z)({},i.getDefault()),n),bh(["update","onMove","onMapClick"],(0,Le.Z)(i)),i.init(),i}return(0,W.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:_a.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Ct.IMapService),this.sceneSerive=i.get(Ct.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&ki(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var s=this.markerOption.element;return s&&ki(s),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.updateDraggable(),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){this.markerOption.draggable=i,this.updateDraggable()}},{key:"getDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(this.mapsService){var i=this.markerOption,a=i.element,s=i.anchor;this.updatePosition(),gu(a,"".concat(Ia[s]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updateDraggable",value:function(){var i=this.markerOption.element;i==null||i.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(i==null||i.addEventListener("mousedown",this.onMarkerDragStart))}},{key:"updatePosition",value:function(){if(this.mapsService){var i=this.markerOption,a=i.element,s=i.offsets,l=this.lngLat,f=l.lng,d=l.lat,_=this.mapsService.lngLatToContainer([f,d]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var x=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=x.containerHeight,C=x.containerWidth,I=x.bounds;if(!I)return;if(Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(_.x>C){var D=this.mapsService.lngLatToContainer([f-360,d]);_.x=D.x}if(_.x<0){var Z=this.mapsService.lngLatToContainer([f+360,d]);_.x=Z.x}}(_.x>C||_.x<0||_.y>A||_.y<0)&&(a.style.display="none"),a.style.left=_.x+s[0]+"px",a.style.top=_.y-s[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,s=this.markerOption,l=s.color,f=s.anchor;if(!a){this.defaultMarker=!0,a=ra("div"),this.markerOption.element=a;var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height","48px"),d.setAttributeNS(null,"width","48px"),d.setAttributeNS(null,"viewBox","0 0 1024 1024");var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),_.setAttributeNS(null,"fill",l),d.appendChild(_),a.appendChild(d)}au(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(x){var A,C,I=((A=i.markerOption)===null||A===void 0?void 0:A.style)&&((C=i.markerOption)===null||C===void 0?void 0:C.style[x]);a&&(a.style[x]=I)}),Hl(a,f,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||$l()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(Cg.EventEmitter);function JF(e){var r=gw();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eN=pi.merge,tN=null,rN=O(4157);function yw(e){var r=_w();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function _w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pv=function(e){(0,je.Z)(t,e);var r=yw(t);function t(n){var i;return(0,ne.Z)(this,t),i=r.call(this),t.controlCount++,i.controlOption=(0,j.Z)((0,j.Z)({},i.getDefault(n)),n||{}),i}return(0,W.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(s){var l=(0,Rn.Z)(s,2),f=l[0],d=l[1];d===void 0&&(i[f]=a[f])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=(0,j.Z)((0,j.Z)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(Ct.IMapService),this.renderService=i.get(Ct.IRendererService),this.layerService=i.get(Ct.ILayerService),this.controlService=i.get(Ct.IControlService),this.configService=i.get(Ct.IGlobalConfigService),this.scene=i.get(Ct.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),au(this.container,"l7-control");var a=this.controlOption,s=a.className,l=a.style;return s&&this.setClassName(s),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;ki(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return ra("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;mu(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;au(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:En.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:En.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,s=this.controlOption.className;s&&mu(a,s),i&&au(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var s=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?s.insertBefore(a,s.firstChild):s.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(pw());(0,F.Z)(pv,"controlCount",0);function bw(e){var r=xw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rg=function(e){(0,je.Z)(t,e);var r=bw(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"isDisable",!1),n}return(0,W.Z)(t,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var s;(s=this.button)===null||s===void 0||s.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ra("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,s=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(s),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,s=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(s),ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&ki(this.buttonIcon),i){var a,s=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(s){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,s)}else{var f;(f=this.button)===null||f===void 0||f.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(this.button)if(mu(this.button,"l7-button-control--row"),mu(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var s;a=ra("div","l7-button-control__text"),(s=this.button)===null||s===void 0||s.appendChild(a),this.buttonText=a}a.innerText=i,au(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(ki(this.buttonText),this.buttonText=void 0)}}]),t}(pv);function Ew(e){var r=Sw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a1=function(e){(0,je.Z)(t,e);var r=Ew(t);function t(n,i){var a;return(0,ne.Z)(this,t),a=r.call(this),(0,F.Z)((0,Le.Z)(a),"isShow",!1),(0,F.Z)((0,Le.Z)(a),"timeout",null),(0,F.Z)((0,Le.Z)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),mu(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&t.conflictPopperList.forEach(function(s){s!==(0,Le.Z)(a)&&s.isShow&&s.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),(0,Le.Z)(a)}),(0,F.Z)((0,Le.Z)(a),"hide",function(){return a.isShow&&(au(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),(0,Le.Z)(a)}),(0,F.Z)((0,Le.Z)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){a.isShow&&(a.hide(),a.timeout=null)},300))}),(0,F.Z)((0,Le.Z)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),(0,F.Z)((0,Le.Z)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),(0,F.Z)((0,Le.Z)(a),"onPopperUnClick",function(s){Jc(s.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),(0,F.Z)((0,Le.Z)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),(0,F.Z)((0,Le.Z)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&t.conflictPopperList.push((0,Le.Z)(a)),a}return(0,W.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(Pl(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),ki(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,s=a.container,l=a.offset,f=l===void 0?[0,0]:l,d=a.placement,_=(0,Rn.Z)(f,2),x=_[0],A=_[1],C=this.button.getBoundingClientRect(),I=s.getBoundingClientRect(),D=Qc(C,I),Z=D.left,J=D.right,ce=D.top,xe=D.bottom,Xe=!1,bt=!1;/^(left|right)/.test(d)?(d.includes("left")?i.right="".concat(C.width+J,"px"):d.includes("right")&&(i.left="".concat(C.width+Z,"px")),d.includes("start")?i.top="".concat(ce,"px"):d.includes("end")?i.bottom="".concat(xe,"px"):(i.top="".concat(ce+C.height/2,"px"),bt=!0,i.transform="translate(".concat(x,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(d)&&(d.includes("top")?i.bottom="".concat(C.height+xe,"px"):d.includes("bottom")&&(i.top="".concat(C.height+ce,"px")),d.includes("start")?i.left="".concat(Z,"px"):d.includes("end")?i.right="".concat(J,"px"):(i.left="".concat(Z+C.width/2,"px"),Xe=!0,i.transform="translate(calc(".concat(x,"px - 50%), ").concat(A,"px)"))),i.transform="translate(calc(".concat(x,"px - ").concat(Xe?"50%":"0%","), calc(").concat(A,"px - ").concat(bt?"50%":"0%",")");var pt=d.split("-");pt.length&&au(this.popperDOM,pt.map(function(et){return"l7-popper-".concat(et)}).join(" ")),Sc(this.popperDOM,_h(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,s=i.className,l=s===void 0?"":s,f=i.content,d=ra("div","l7-popper l7-popper-hide ".concat(l)),_=ra("div","l7-popper-content"),x=ra("div","l7-popper-arrow");return d.appendChild(_),d.appendChild(x),a.appendChild(d),this.popperDOM=d,this.contentDOM=_,f&&this.setContent(f),d}}]),t}(Cg.EventEmitter);(0,F.Z)(a1,"conflictPopperList",[]);function Aw(e){var r=Tw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ww={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},Cw=function(e){(0,je.Z)(t,e);var r=Aw(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),ka((0,Ie.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,s=ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:s.position;return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":ww[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=ka((0,Ie.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,s=a.popperClassName,l=a.popperPlacement,f=a.popperTrigger,d=this.mapsService.getMapContainer();return this.popper=new a1(this.button,{className:s,placement:l,trigger:f,container:d,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if(ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),t}(Rg);function Rw(e){var r=Mw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xd=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(xd||{}),o1=function(e){(0,je.Z)(t,e);var r=Rw(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"selectValue",[]),(0,F.Z)((0,Le.Z)(n),"createNormalOption",function(l){var f=n.selectValue.includes(l.value),d=ra("div","l7-select-control-item ".concat(f?xd.ActiveOptionClassName:""));n.getIsMultiple()?d.appendChild(n.createCheckbox(f)):d.appendChild(n.createRadio(f)),l.icon&&d.appendChild(l.icon);var _=ra("span");return _.innerText=l.text,d.appendChild(_),d}),(0,F.Z)((0,Le.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var f=n.selectValue.findIndex(function(d){return d===l.value});f>-1?n.selectValue.splice(f,1):n.selectValue=[].concat((0,er.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,W.Z)(t,[{key:"setOptions",value:function(i){ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=ka((0,Ie.Z)(t.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=this.transSelectValue(i);this.optionDOMList.forEach(function(l){var f=l.getAttribute(xd.OptionValueAttrKey),d=l.querySelector("input[type=checkbox]"),_=l.querySelector("input[type=radio]"),x=s.includes(f),A=function(I,D){gh(l,xd.ActiveOptionClassName,D),I&&ba(I,D)};A(d,x),A(_,x)}),this.selectValue=s,a&&this.emit("selectChange",this.getIsMultiple()?s:s[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,s=this.isImageOptions(),l=ra("div",s?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&au(l,"l7-select-control--multiple");var f=i.map(function(d,_){var x=s?a.createImageOption(d):a.createNormalOption(d);return x.setAttribute(xd.OptionValueAttrKey,d.value),x.setAttribute(xd.OptionIndexAttrKey,window.String(_)),x.addEventListener("click",a.onItemClick.bind(a,d)),x});return l.append.apply(l,(0,er.Z)(f)),this.optionDOMList=f,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),s=ra("div","l7-select-control-item ".concat(a?xd.ActiveOptionClassName:"")),l=ra("img");l.setAttribute("src",i.img),op(l),s.appendChild(l);var f=ra("div","l7-select-control-item-row");this.getIsMultiple()&&s.appendChild(this.createCheckbox(a));var d=ra("span");return d.innerText=i.text,f.appendChild(d),s.appendChild(f),s}},{key:"createCheckbox",value:function(i){var a=ra("input");return a.setAttribute("type","checkbox"),i&&ba(a,!0),a}},{key:"createRadio",value:function(i){var a=ra("input");return a.setAttribute("type","radio"),i&&ba(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),t}(Cw),Xh=function(r){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(r)),t.appendChild(n),t};function Iw(e){var r=Pw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ow=function(e){(0,je.Z)(t,e);var r=Iw(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"onClick",(0,Nt.Z)(ve().mark(function l(){var f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(f=n.controlOption.onExport,_.t0=f==null,_.t0){_.next=8;break}return _.t1=f,_.next=6,n.getImage();case 6:_.t2=_.sent,(0,_.t1)(_.t2);case 8:case"end":return _.stop()}},l)}))),(0,F.Z)((0,Le.Z)(n),"mergeImage",(0,Nt.Z)(ve().mark(function l(){var f,d,_,x,A,C,I,D,Z,J,ce,xe,Xe,bt,pt=arguments;return ve().wrap(function(Pt){for(;;)switch(Pt.prev=Pt.next){case 0:for(_=n.controlOption.imageType,x=(f=(d=n.mapsService.getContainer())===null||d===void 0?void 0:d.getBoundingClientRect())!==null&&f!==void 0?f:{},A=x.width,C=A===void 0?0:A,I=x.height,D=I===void 0?0:I,Z=document.createElement("canvas"),Z.width=C,Z.height=D,J=Z.getContext("2d"),ce=pt.length,xe=new Array(ce),Xe=0;Xe<ce;Xe++)xe[Xe]=pt[Xe];return Pt.next=9,Promise.all(xe.map(function(jt){return new Promise(function(Ar){var gr=new Image;gr.onload=function(){Ar(gr)},gr.src=jt})}));case 9:return bt=Pt.sent,bt.forEach(function(jt){J==null||J.drawImage(jt,0,0,C,D)}),Pt.abrupt("return",Z.toDataURL("image/".concat(_)));case 12:case"end":return Pt.stop()}},l)}))),n}return(0,W.Z)(t,[{key:"onAdd",value:function(){var i=ka((0,Ie.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Xh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.mapsService.exportMap("png");case 2:return s=d.sent,d.next=5,this.scene.exportPng("png");case 5:return l=d.sent,d.abrupt("return",this.mergeImage.apply(this,(0,er.Z)([s,l].filter(function(_){return _}))));case 7:case"end":return d.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Rg);function kw(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Dw(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Dw(e,r){if(e){if(typeof e=="string")return s1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s1(e,r)}}function s1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var u1=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],$h=function(){if(typeof document=="undefined")return!1;for(var e=u1[0],r={},t=0,n=u1;t<n.length;t++){var i=n[t],a=i==null?void 0:i[1];if(a in document){var s=kw(i.entries()),l;try{for(s.s();!(l=s.n()).done;){var f=(0,Rn.Z)(l.value,2),d=f[0],_=f[1];r[e[d]]=_}}catch(x){s.e(x)}finally{s.f()}return r}}return!1}(),l1={change:$h.fullscreenchange,error:$h.fullscreenerror},mc={request:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){mc.off("change",l),n()};mc.on("change",a);var s=r[$h.requestFullscreen](t);s instanceof Promise&&s.then(a).catch(i)})},exit:function(){return new Promise(function(r,t){if(!mc.isFullscreen){r();return}var n=function a(){mc.off("change",a),r()};mc.on("change",n);var i=document[$h.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)})},toggle:function(r,t){return mc.isFullscreen?mc.exit():mc.request(r,t)},onchange:function(r){mc.on("change",r)},onerror:function(r){mc.on("error",r)},on:function(r,t){var n=l1[r];n&&document.addEventListener(n,t,!1)},off:function(r,t){var n=l1[r];n&&document.removeEventListener(n,t,!1)},raw:$h};Object.defineProperties(mc,{isFullscreen:{get:function(){return!!document[$h.fullscreenElement]}},element:{enumerable:!0,get:function(){var r;return(r=document[$h.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:function(){return!!document[$h.fullscreenEnabled]}}}),$h||(mc={isEnabled:!1});var H0=mc;function Lw(e){var r=Bw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Bw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fw=function(e){(0,je.Z)(t,e);var r=Lw(t);function t(n){var i;return(0,ne.Z)(this,t),i=r.call(this,n),(0,F.Z)((0,Le.Z)(i),"isFullscreen",!1),(0,F.Z)((0,Le.Z)(i),"toggleFullscreen",(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!H0.isEnabled){l.next=3;break}return l.next=3,H0.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),(0,F.Z)((0,Le.Z)(i),"onClick",function(){i.toggleFullscreen()}),(0,F.Z)((0,Le.Z)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,s=a.btnText,l=a.btnIcon,f=a.title,d=a.exitBtnText,_=a.exitBtnIcon,x=a.exitTitle;i.isFullscreen?(i.setBtnTitle(x),i.setBtnText(d),i.setBtnIcon(_)):(i.setBtnTitle(f),i.setBtnText(s),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),H0.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return(0,W.Z)(t,[{key:"setOptions",value:function(i){var a=i.exitBtnText,s=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(s),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=ka((0,Ie.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=Ns(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){ka((0,Ie.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:Xh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Xh("l7-icon-exit-fullscreen")})}}]),t}(Rg);function Nw(e){var r=Uw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zw=function(e){(0,je.Z)(t,e);var r=Nw(t);function t(n){var i;return(0,ne.Z)(this,t),i=r.call(this,n),(0,F.Z)((0,Le.Z)(i),"getGeoLocation",function(){return new Promise(function(a,s){window.navigator.geolocation.getCurrentPosition(function(l){var f=l.coords,d=f!=null?f:{},_=d.longitude,x=d.latitude;!isNaN(_)&&!isNaN(x)?a([_,x]):s()},function(l){s(l)})})}),(0,F.Z)((0,Le.Z)(i),"onClick",(0,Nt.Z)(ve().mark(function a(){var s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(window.navigator.geolocation){_.next=2;break}return _.abrupt("return");case 2:return s=i.controlOption.transform,_.next=5,i.getGeoLocation();case 5:if(l=_.sent,f=i.mapsService.getZoom(),_.t0=i.mapsService,_.t1=f>15?f:15,!s){_.next=15;break}return _.next=12,s(l);case 12:_.t2=_.sent,_.next=16;break;case 15:_.t2=l;case 16:_.t3=_.t2,_.t0.setZoomAndCenter.call(_.t0,_.t1,_.t3);case 18:case"end":return _.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return(0,W.Z)(t,[{key:"getDefault",value:function(i){return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:Xh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=ka((0,Ie.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),t}(Rg);function Zw(e){var r=Vw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function c1(e){return Object.keys(e!=null?e:{}).every(function(r){return["layer","name","img"].includes(r)})}var f1=function(e){(0,je.Z)(t,e);var r=Zw(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,F.Z)((0,Le.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,F.Z)((0,Le.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var f=n.selectValue.includes(l.name),d=l.isVisible();f&&!d&&l.show(),!f&&d&&l.hide()})}),n}return(0,W.Z)(t,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var s=[];return a.forEach(function(l){if(l instanceof Object&&(c1(l)?s.push(l.layer):s.push(l)),typeof l=="string"){var f=i.getLayer(l)||i.getLayerByName(l);f&&s.push(f)}}),s}return i.getLayers()||[]}},{key:"getDefault",value:function(i){var a;return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Xh("l7-icon-layer"),options:[],multiple:(a=i==null?void 0:i.multiple)!==null&&a!==void 0?a:!0})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,s=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(c1(l))return{text:l.name||l.layer.name,value:l.layer.name,img:s?l.img:void 0};if(typeof l=="string"){var f=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:f==null?void 0:f.name,value:f==null?void 0:f.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers","multiple"]);ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i),a&&(this.controlOption.multiple===!1&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"handleSingleSelection",value:function(){this.layers.forEach(function(i,a){a===0?i.show():i.hide()})}},{key:"onAdd",value:function(){var i;return this.controlOption.multiple===!1&&this.handleSingleSelection(),(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),ka((0,Ie.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return this.controlOption.multiple}}]),t}(o1);function jw(e){var r=Hw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h1=function(e){(0,je.Z)(t,e);var r=jw(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getDefault",value:function(){return{position:En.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=ra("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(Pl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,s=a.href,l=a.img,f=ra("img");if(f.setAttribute("src",l),f.setAttribute("aria-label","AntV logo"),op(f),s){var d=ra("a","l7-control-logo-link");d.target="_blank",d.href=s,d.rel="noopener nofollow",d.setAttribute("rel","noopener nofollow"),d.appendChild(f),i.appendChild(d)}else i.appendChild(f)}}]),t}(pv),Ww={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},Gw={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function Xw(e){var r=$w();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function $w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yw=function(e){(0,je.Z)(t,e);var r=Xw(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,W.Z)(t,[{key:"getDefault",value:function(i){return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Xh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?Gw:Ww;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var s=(0,Rn.Z)(a,2),l=s[0],f=s[1];return typeof f=="string"&&l!=="blank"}).map(function(a){var s,l=(0,Rn.Z)(a,2),f=l[0],d=l[1],_=(s=i[f])!==null&&s!==void 0?s:{},x=_.text,A=_.img;return{text:x!=null?x:f,value:d,img:A,key:f}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var s,l,f=this.controlOption.defaultValue;this.controlOption.defaultValue=(s=(l=this.controlOption.options.find(function(_){return _.key===f}))===null||l===void 0?void 0:l.value)!==null&&s!==void 0?s:f}else{var d=this.getMapStyle();d?this.controlOption.defaultValue=d:this.mapsService.map.once("styledata",function(){var _=a.mapsService.getMapStyle();a.controlOption.defaultValue=_,a.setSelectValue(_,!1)})}return this.on("selectChange",this.onMapThemeChange),ka((0,Ie.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(o1);function qw(e){var r=Kw();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qw=function(e){(0,je.Z)(t,e);var r=qw(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"location",[0,0]),(0,F.Z)((0,Le.Z)(n),"onMouseMove",function(l){var f=n.location,d=l.lngLat||l.lnglat,_=n.controlOption.transform;d&&(f=[d.lng,d.lat]),n.location=f,_&&(f=_(f)),n.insertLocation2HTML(f),n.emit("locationChange",f)}),n}return(0,W.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:En.BOTTOMLEFT,transform:function(s){var l=(0,Rn.Z)(s,2),f=l[0],d=l[1];return[+(+f).toFixed(6),+(+d).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=ra("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),t}(pv);function Jw(e){var r=eC();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=function(e){(0,je.Z)(t,e);var r=Jw(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"update",function(){var l=n.mapsService,f=n.controlOption.maxWidth,d=l.getSize()[1]/2,_=l.containerToLngLat([0,d]),x=l.containerToLngLat([f,d]),A=ql([_.lng,_.lat],[x.lng,x.lat]);n.updateScales(A)}),n}return(0,W.Z)(t,[{key:"getDefault",value:function(i){return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:En.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=ra("div",i);this.resetScaleLines(a);var s=this.controlOption.updateWhenIdle;return this.mapsService.on(s?"moveend":"mapmove",this.update),this.mapsService.on(s?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,s=a.metric,l=a.imperial;s&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){Pl(i);var a=this.controlOption,s=a.metric,l=a.imperial,f=a.maxWidth,d=a.lockWidth;d&&Sc(i,"width: ".concat(f,"px")),s&&(this.mScale=ra("div","l7-control-scale-line",i)),l&&(this.iScale=ra("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,s){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*s)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),s=i/a;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,a*s}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),s=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,s,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,s,l,f;a>5280?(s=a/5280,l=this.getRoundNum(s),this.updateScale(this.iScale,l+" mi",l/s)):(f=this.getRoundNum(a),this.updateScale(this.iScale,f+" ft",f/a))}}]),t}(pv),p1=O(15085),Dp,d1=(Dp={},(0,F.Z)(Dp,pf.additive,{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Dp,pf.none,{enable:!1}),(0,F.Z)(Dp,pf.normal,{enable:!0,func:{srcRGB:K.SRC_ALPHA,dstRGB:K.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Dp,pf.subtractive,{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE,srcAlpha:K.ZERO,dstAlpha:K.ONE_MINUS_SRC_COLOR},equation:{rgb:K.FUNC_SUBTRACT,alpha:K.FUNC_SUBTRACT}}),(0,F.Z)(Dp,pf.max,{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE},equation:{rgb:K.MAX_EXT}}),(0,F.Z)(Dp,pf.min,{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE},equation:{rgb:K.MIN_EXT}}),Dp);function v1(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function m1(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),s=a.enableTAA;return s?i.add(n("taa")):i.add(n("render")),v1(r).forEach(function(l){var f=(0,Rn.Z)(l,2),d=f[0],_=f[1];i.add(t(d),_)}),i.add(t("copy")),i}var rC=function(){function e(r){(0,ne.Z)(this,e),this.layer=r}return(0,W.Z)(e,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),i=n.get(Ct.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);i.renderTileLayerMask(a),a.renderModels({ispick:!0})}},{key:"pick",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(s=this.layer.getContainer(),l=s.get(Ct.IPickingService),i.type!=="RasterLayer"){d.next=4;break}return d.abrupt("return",this.pickRasterLayer(i,a));case 4:return this.pickRender(a),d.abrupt("return",l.pickFromPickingFBO(i,a));case 6:case"end":return d.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"pickRasterLayer",value:function(t,n,i){var a=this.layer.getContainer(),s=a.get(Ct.IPickingService),l=a.get(Ct.IMapService),f=this.layer.getSource().extent,d=Ol(n.lngLat,f),_={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},x=i||t;if(d){var A=this.readRasterValue(t,f,l,n.x,n.y);return _.rasterValue=A,s.triggerHoverOnLayer(x,_),!0}else return _.type=n.type==="mousemove"?"mouseout":"un"+n.type,s.triggerHoverOnLayer(x,(0,j.Z)((0,j.Z)({},_),{},{type:"unpick"})),s.triggerHoverOnLayer(x,_),!1}},{key:"readRasterValue",value:function(t,n,i,a,s){var l=t.getSource().data.dataArray[0],f=(0,Rn.Z)(n,4),d=f[0],_=d===void 0?0:d,x=f[1],A=x===void 0?0:x,C=f[2],I=C===void 0?10:C,D=f[3],Z=D===void 0?-10:D,J=i.lngLatToContainer([_,A]),ce=i.lngLatToContainer([I,Z]),xe=ce.x-J.x,Xe=J.y-ce.y,bt=[(a-J.x)/xe,(s-ce.y)/Xe],pt=l.width||1,et=l.height||1,Pt=Math.floor(bt[0]*pt),jt=Math.floor(bt[1]*et),Ar=Math.max(0,jt-1)*pt+Pt,gr=l.data[Ar];return gr}},{key:"selectFeature",value:function(t){var n=this.layer,i=(0,Rn.Z)(t,3),a=i[0],s=i[1],l=i[2];n.hooks.beforeSelect.call([a,s,l])}},{key:"highlightPickedFeature",value:function(t){var n=(0,Rn.Z)(t,3),i=n[0],a=n[1],s=n[2];this.layer.hooks.beforeHighlight.call([i,a,s])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),nC=function(){function e(r){(0,ne.Z)(this,e),this.layer=r;var t=this.layer.getContainer();this.rendererService=t.get(Ct.IRendererService)}return(0,W.Z)(e,[{key:"getColorTexture",value:function(t,n){var i=this.getTextureKey(t,n);return this.key===i?this.colorTexture:(this.createColorTexture(t,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(t,n),s=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1,unorm:!0});return this.colorTexture=s,s}},{key:"setColorTexture",value:function(t,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return us(t);case"quantize":return Qo(t);case"custom":return Bu(t,n);case"linear":return ma(t,n);default:return Wo(t)}}},{key:"getTextureKey",value:function(t,n){var i;return"".concat(t.colors.join("_"),"_").concat(t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),iC=["passes"],aC=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption","pickingEnabled"],g1,W0,y1;function oC(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=sC(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function sC(e,r){if(e){if(typeof e=="string")return _1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _1(e,r)}}function _1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function uC(e){var r=lC();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G0=pi.isEqual,b1=pi.isFunction,x1=pi.isNumber,Ou=pi.isObject,cC=pi.isPlainObject,fC=pi.isUndefined,E1=0,Lp=(g1=Z0(Ct.IGlobalConfigService),W0=function(e){(0,je.Z)(t,e);var r=uC(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ne.Z)(this,t),n=r.call(this),(0,F.Z)((0,Le.Z)(n),"id","".concat(E1++)),(0,F.Z)((0,Le.Z)(n),"name","".concat(E1)),(0,F.Z)((0,Le.Z)(n),"visible",!0),(0,F.Z)((0,Le.Z)(n),"zIndex",0),(0,F.Z)((0,Le.Z)(n),"inited",!1),(0,F.Z)((0,Le.Z)(n),"layerModelNeedUpdate",!1),(0,F.Z)((0,Le.Z)(n),"pickedFeatureID",null),(0,F.Z)((0,Le.Z)(n),"selectedFeatureID",null),(0,F.Z)((0,Le.Z)(n),"styleNeedUpdate",!1),(0,F.Z)((0,Le.Z)(n),"forceRender",!1),(0,F.Z)((0,Le.Z)(n),"clusterZoom",0),(0,F.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,F.Z)((0,Le.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,F.Z)((0,Le.Z)(n),"hooks",{init:new Jd,afterInit:new gd,beforeRender:new gd,beforeRenderData:new ev,afterRender:new wa,beforePickingEncode:new wa,afterPickingEncode:new wa,beforeHighlight:new wa(["pickedColor"]),afterHighlight:new wa,beforeSelect:new wa(["pickedColor"]),afterSelect:new wa,beforeDestroy:new wa,afterDestroy:new wa}),(0,F.Z)((0,Le.Z)(n),"models",[]),(0,F.Z)((0,Le.Z)(n),"startInit",!1),(0,F.Z)((0,Le.Z)(n),"layerChildren",[]),(0,F.Z)((0,Le.Z)(n),"masks",[]),Ui((0,Le.Z)(n),"configService",y1,(0,Le.Z)(n)),(0,F.Z)((0,Le.Z)(n),"animateOptions",{enable:!1}),(0,F.Z)((0,Le.Z)(n),"currentPickId",null),(0,F.Z)((0,Le.Z)(n),"encodeStyleAttribute",{}),(0,F.Z)((0,Le.Z)(n),"enableShaderEncodeStyles",[]),(0,F.Z)((0,Le.Z)(n),"enableDataEncodeStyles",[]),(0,F.Z)((0,Le.Z)(n),"pendingStyleAttributes",[]),(0,F.Z)((0,Le.Z)(n),"scaleOptions",{}),(0,F.Z)((0,Le.Z)(n),"animateStatus",!1),(0,F.Z)((0,Le.Z)(n),"isDestroyed",!1),(0,F.Z)((0,Le.Z)(n),"uniformBuffers",[]),(0,F.Z)((0,Le.Z)(n),"encodeDataLength",0),(0,F.Z)((0,Le.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var s=n.layerSource.getSourceCfg().autoRender;s&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,W.Z)(t,[{key:"addMask",value:function(i){this.masks.push(i),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=(0,j.Z)((0,j.Z)({},this.needUpdateConfig),i);else{var s=this.container.get(Ct.SceneID);this.configService.setLayerConfig(s,this.id,(0,j.Z)((0,j.Z)((0,j.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s=this,l,f,d,_,x,A,C;return ve().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:l=this.container.get(Ct.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ct.IIconService),this.fontService=this.container.get(Ct.IFontService),this.rendererService=this.container.get(Ct.IRendererService),this.layerService=this.container.get(Ct.ILayerService),this.debugService=this.container.get(Ct.IDebugService),this.interactionService=this.container.get(Ct.IInteractionService),this.pickingService=this.container.get(Ct.IPickingService),this.mapService=this.container.get(Ct.IMapService),f=this.getLayerConfig(),d=f.enableMultiPassRenderer,_=f.passes,d&&_!==null&&_!==void 0&&_.length&&_.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(Ct.ICameraService),this.coordinateService=this.container.get(Ct.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ct.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ct.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ct.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ct.IStyleAttributeService),d&&(this.multiPassRenderer=this.container.get(Ct.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(Z){var J=Z.attributeName,ce=Z.attributeField,xe=Z.attributeValues,Xe=Z.updateOptions;s.styleAttributeService.updateStyleAttribute(J,{scale:(0,j.Z)({field:ce},s.splitValuesAndCallbackInAttribute(xe,ce?void 0:s.getLayerConfig()[J]))},Xe)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ct.ILayerPlugin),x=oC(this.plugins);try{for(x.s();!(A=x.n()).done;)C=A.value,C.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(Z){x.e(Z)}finally{x.f()}return this.layerPickService=new rC(this),this.textureService=new nC(this),this.log(Ls.LayerInitStart),D.next=31,this.hooks.init.promise();case 31:this.log(Ls.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return D.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(s,".").concat(i),f={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,f)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,s){return this.updateStyleAttribute("color",i,a,s),this}},{key:"texture",value:function(i,a,s){return this.updateStyleAttribute("texture",i,a,s),this}},{key:"rotate",value:function(i,a,s){return this.updateStyleAttribute("rotate",i,a,s),this}},{key:"size",value:function(i,a,s){return this.updateStyleAttribute("size",i,a,s),this}},{key:"filter",value:function(i,a,s){var l=this.updateStyleAttribute("filter",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,s){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,s){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:s}),this}},{key:"animate",value:function(i){var a={};return Ou(i)?(a.enable=!0,a=(0,j.Z)((0,j.Z)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var s=this;return this.inited?(this.log(Ls.SourceInitStart,vs.UPDATE),this.layerSource.setData(i,a),this.log(Ls.SourceInitEnd,vs.UPDATE)):this.on("inited",function(){s.log(Ls.SourceInitStart,vs.UPDATE);var l=s.getSource();l?s.layerSource.setData(i,a):s.source(new i1(i,a)),s.layerSource.once("update",function(){s.log(Ls.SourceInitEnd,vs.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,s=i.passes,l=(0,xi.Z)(i,iC);s&&v1(s).forEach(function(d){var _=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(d[0]);_&&_.updateOptions(d[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var f=l;return Object.keys(l).forEach(function(d){var _=l[d];Array.isArray(_)&&_.length===2&&!x1(_[0])&&!x1(_[1])&&(f[d]={field:_[0],value:_[1]})}),this.encodeStyle(f),this.updateLayerConfig(f),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(s){[].concat((0,er.Z)(a.enableShaderEncodeStyles),(0,er.Z)(a.enableDataEncodeStyles)).includes(s)&&cC(i[s])&&(i[s].field||i[s].value)&&!G0(a.encodeStyleAttribute[s],i[s])?(a.encodeStyleAttribute[s]=i[s],a.updateStyleAttribute(s,i[s].field,i[s].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[s]&&(delete a.encodeStyleAttribute[s],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var s=(0,j.Z)({},this.scaleOptions);if(Ou(i)?this.scaleOptions=(0,j.Z)((0,j.Z)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!G0(s,this.scaleOptions)){var l=Ou(i)?i:(0,F.Z)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Ou(i)?!0:i,Ou(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var s=this;if(Ou(i)){var l=i.x,f=l===void 0?0:l,d=i.y,_=d===void 0?0:d;this.updateLayerConfig({highlightColor:Ou(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Ou(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:f,y:_})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Ou(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Ou(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(ca(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Ou(i)?!0:i,Ou(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var s=this;if(Ou(i)){var l=i.x,f=l===void 0?0:l,d=i.y,_=d===void 0?0:d;this.updateLayerConfig({selectColor:Ou(a)?a.color:this.getLayerConfig().selectColor,selectMix:Ou(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:f,y:_})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Ou(a)?a.color:this.getLayerConfig().selectColor,selectMix:Ou(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(ca(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),s=a.visible,l=a.minZoom,f=l===void 0?-1/0:l,d=a.maxZoom,_=d===void 0?1/0:d;return!!s&&i>=f&&i<_}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var s=this.getLayerConfig(),l=s.passes,f=l===void 0?[]:l;this.multiPassRenderer=m1(this,f,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var d=this.rendererService.getViewportSize(),_=d.width,x=d.height;this.multiPassRenderer.resize(_,x)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),s=a.extent,l=s.some(function(f){return Math.abs(f)===1/0});return l?this:(this.mapService.fitBounds([[s[0],s[1]],[s[2],s[3]]],i),this)}},{key:"destroy",value:function(){var i,a,s,l,f,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(A){A.destroy()}),this.layerChildren.map(function(A){return A.destroy(!1)}),this.layerChildren=[];var _=this.getLayerConfig(),x=_.maskfence;x&&(this.masks.map(function(A){return A.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(s=this.layerModel)===null||s===void 0||s.clearModels(d),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(f=this.debugService)===null||f===void 0||f.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var f=l.type;if(a.coordCenter===void 0){var d,_=a.layerSource.center;a.coordCenter=_,(d=a.mapService)!==null&&d!==void 0&&d.setCoordCenter&&a.mapService.setCoordCenter(_)}if(f==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,s,l,f=this.styleAttributeService.getLayerStyleAttribute(i),d=(f==null||(a=f.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(s=d[0].option)===null||s===void 0?void 0:s.type,field:f==null||(l=f.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var s=a.range().map(function(d){return(0,F.Z)({value:a.invertExtent(d)},i,d)});return s}else if(a.ticks){var l=a.ticks().map(function(d){return(0,F.Z)({value:d},i,a(d))});return l}else if(a!=null&&a.domain){var f=a.domain().filter(function(d){return!fC(d)}).map(function(d){return(0,F.Z)({value:d},i,a(d))});return f}return[]}},{key:"pick",value:function(i){var a=i.x,s=i.y;this.interactionService.triggerHover({x:a,y:s})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){var l=this,f,d,_,x,A,C,I,D,Z,J,ce,xe,Xe,bt;return ve().wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return f=s.moduleName,d=s.vertexShader,_=s.fragmentShader,x=s.inject,A=s.triangulation,C=s.styleOption,I=s.pickingEnabled,D=I===void 0?!0:I,Z=(0,xi.Z)(s,aC),this.shaderModuleService.registerModule(f,{vs:d,fs:_,inject:x}),J=this.shaderModuleService.getModule(f),ce=J.vs,xe=J.fs,Xe=J.uniforms,bt=this.rendererService.createModel,et.abrupt("return",new Promise(function(Pt){var jt=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,C),Ar=jt.attributes,gr=jt.elements,Xr=jt.count,mn=[].concat((0,er.Z)(l.layerModel.uniformBuffers),(0,er.Z)(l.rendererService.uniformBuffers),[l.getLayerUniformBuffer()]);D&&mn.push(l.getPickingUniformBuffer());var qn=(0,j.Z)({attributes:Ar,uniforms:Xe,fs:xe,vs:ce,elements:gr,blend:d1[pf.normal],uniformBuffers:mn,textures:l.layerModel.textures},Z);Xr&&(qn.count=Xr);var ea=bt(qn);Pt(ea)}));case 5:case"end":return et.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,s=this.styleAttributeService.createAttributes(this.encodedData,a),l=s.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),s=a.enableHighlight,l=s===void 0?!0:s,f=a.enableSelect,d=f===void 0?!0:f,_=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&d&&(_=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(_=!0),this.isVisible()&&_}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,s.render();case 2:case"end":return f.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(s){s.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a),textures:i.layerModel.textures},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,s,l){var f=this.configService.getAttributeConfig(this.id)||{};return G0(f[i],{field:a,values:s})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,(0,F.Z)({},i,{field:a,values:s})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:(0,j.Z)({field:a},this.splitValuesAndCallbackInAttribute(s,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:s,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.models.forEach(function(_){return _.destroy()}),this.models=[],this.uniformBuffers.forEach(function(_){_.destroy()}),this.uniformBuffers=[],s=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(s),l=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(l),d.next=10,this.layerModel.initModels();case 10:this.models=d.sent;case 11:case"end":return d.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getLayerUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[1]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:b1(i)?void 0:i,callback:b1(i)?i:void 0}}}]),t}(p1.EventEmitter),y1=Bi(W0.prototype,"configService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W0);function hC(e,r){return{enable:e,mask:255,func:{cmp:K.EQUAL,ref:r?1:0,mask:1}}}function S1(e){return e.maskOperation===Vc.OR?{enable:!0,mask:255,func:{cmp:K.ALWAYS,ref:1,mask:255},opFront:{fail:K.KEEP,zfail:K.REPLACE,zpass:K.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Zc.SINGLE||e.stencilIndex===0?K.ALWAYS:K.LESS,ref:e.stencilType===Zc.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:K.KEEP,zfail:K.REPLACE,zpass:K.REPLACE}}}var Qn=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function pC(e){switch(e){case"rotation":return{name:"Rotation",type:Un.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Qn.ROTATION,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(t){var n=t.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:Un.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Qn.STROKE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(t){var n=t.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:Un.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Qn.OPACITY,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(t){var n=t.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:Un.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:Qn.EXTRUSION_BASE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(t){var n=t.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:Un.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Qn.OFFSETS,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(t){var n=t.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:Un.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(t){var n=t.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var dC={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},Mg={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function nN(e){var r="";return Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?r+="vec".concat(n.length," ").concat(t,`;
`):r+="flot ".concat(t,`;
`)}),r}function A1(e){return Math.max(Math.ceil(e/4)*4,4)}var T1,X0,w1,$0={opacity:Qn.OPACITY,stroke:Qn.STROKE,offsets:Qn.OFFSETS,rotation:Qn.ROTATION,extrusionBase:Qn.EXTRUSION_BASE,thetaOffset:15},Wa=(T1=Z0(Ct.IGlobalConfigService),X0=function(){function e(r){(0,ne.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"textures",[]),(0,F.Z)(this,"preStyleAttribute",{}),(0,F.Z)(this,"encodeStyleAttribute",{}),Ui(this,"configService",w1,this),this.layer=r,this.rendererService=r.getContainer().get(Ct.IRendererService),this.pickingService=r.getContainer().get(Ct.IPickingService),this.shaderModuleService=r.getContainer().get(Ct.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Ct.IStyleAttributeService),this.mapService=r.getContainer().get(Ct.IMapService),this.iconService=r.getContainer().get(Ct.IIconService),this.fontService=r.getContainer().get(Ct.IFontService),this.cameraService=r.getContainer().get(Ct.ICameraService),this.layerService=r.getContainer().get(Ct.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t}return(0,W.Z)(e,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return d1[pf[i]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,s=n.maskInside,l=s===void 0?!0:s,f=n.enableMask,d=n.maskOperation,_=d===void 0?Vc.AND:d;if(this.layer.type==="MaskLayer")return S1({isStencil:!0,stencilType:Zc.SINGLE});if(t.isStencil)return S1((0,j.Z)((0,j.Z)({},t),{},{maskOperation:_}));var x=a||f&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return hC(x,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var i=(0,j.Z)((0,j.Z)({},n.uniformsOption),t.uniformsOption);return!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var r=(0,Nt.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var r=(0,Nt.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var r=(0,Nt.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){t[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(Mg[l]," u_").concat(l,";"));var f=$0[l];!f&&l==="THETA_OFFSET"&&(f=15),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat($0[l],") in ").concat(Mg[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var s="";return this.layer.enableShaderEncodeStyles.forEach(function(l){s+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(Mg[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(Mg[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":s}}},{key:"getStyleAttribute",value:function(){var t=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!t.layer.encodeStyleAttribute[i]){var a=t.layer.getLayerConfig()[i],s=typeof a=="undefined"?dC[i]:a;i==="stroke"&&(s=bi(s)),n["u_"+i]=s}}),n}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=pC(n);i&&(t.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=$0[n]))})}},{key:"updateEncodeAttribute",value:function(t,n){this.encodeStyleAttribute[t]=n}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(A1(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),n.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(A1(n.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(t){var n=0,i=[];return Object.values(t).forEach(function(a){Array.isArray(a)?(i.push.apply(i,(0,er.Z)(a)),n+=a.length):typeof a=="number"?(i.push(a),n+=1):typeof a=="boolean"&&(i.push(Number(a)),n+=1)}),{uniformsOption:t,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t,n,i=this.getUniformsBufferInfo(this.getStyleAttribute()),a=i.uniformsArray,s=this.getCommonUniformsInfo(),l=s.uniformsArray;(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)}),(n=this.commonUnifoms)===null||n===void 0||n.subData({offset:0,data:new Uint8Array(new Float32Array(l).buffer)})}}]),e}(),w1=Bi(X0.prototype,"configService",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X0),C1=100,iN=36,aN=40;function R1(e){return e/180*Math.acos(-1)}function M1(e){var r=R1(e[0])+Math.PI/2,t=R1(e[1]),n=C1+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),s=n*Math.sin(t);return[a,s,i]}function oN(e,r){var t=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),a=vec3.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var s=typeof r.segments!="undefined"?r.segments:32,l=2+s,f=2*l,d=[],_=[],x=[],A=[],C=[],I=[],D=0;D<=l;D++){for(var Z=D/l,J=Z*Math.PI,ce=0;ce<=f;ce++){var xe=ce/f,Xe=xe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-J),mat4.identity(t),mat4.rotateY(t,t,Xe),vec3.transformMat4(a,i,n),vec3.transformMat4(a,a,t),vec3.scale(a,a,-e),x.push(a.slice()),A.push.apply(A,_toConsumableArray(a.slice())),vec3.normalize(a,a),C.push.apply(C,_toConsumableArray(a.slice())),I.push([xe,1-Z]),A.push(xe,1-Z)}if(D>0)for(var bt=x.length,pt=bt-2*(f+1);pt+f+2<bt;pt++)d.push([pt,pt+1,pt+f+1]),_.push(pt,pt+1,pt+f+1),d.push([pt+f+1,pt+1,pt+f+2]),_.push(pt+f+1,pt+1,pt+f+2)}return{cells:d,positions:x,uvs:I,positionsArr:A,indicesArr:_,normalArr:C}}var Ig=Br.Ue(),sN=Br.Ue(),Xs=Br.Ue(),Bp=Br.Ue(),dv=Br.Ue();function Y0(e,r,t,n,i){Br.IH(e,t,n),Br.Fv(e,e),r=Br.al(-e[1],e[0]);var a=Br.al(-t[1],t[0]);return[i/Br.AK(r,a),r]}function Fp(e,r){return Br.t8(e,-r[1],r[0])}function vv(e,r,t){return Br.lu(e,r,t),Br.Fv(e,e),e}function q0(e,r){return e[0]===r[0]&&e[1]===r[1]}function uN(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var vC=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ne.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Br.al(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,W.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.simpleSegment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],D=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,J=this.simpleSegment(i,s,x,C,D,A,I,Z);s+=J}if(this.dash)for(var ce=0;ce<i.positions.length/6;ce++)i.positions[ce*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,x=t[l-1];x.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],C=t[l];C.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],D=l<t.length-1?[].concat((0,er.Z)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,Z=l<n.length-1?n[l+1]:null,J=this.segment_gaode2(i,s,x,C,D,A,I,Z);s+=J}if(this.dash)for(var ce=0;ce<i.positions.length/6;ce++)i.positions[ce*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,_=this.segment(n,a,l,f,d);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=Ya([a[0],a[1]]),A=Ya([i[0],i[1]]);vv(Xs,x,A);var C=0;if(this.dash&&(C=this.lineSegmentDistance(x,A),this.totalDistance+=C),this.normal||(this.normal=Br.Ue(),Fp(this.normal,Xs)),this.started||(this.started=!0,this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-C)),f.push(n+0,n+1,n+2),!s)Fp(this.normal,Xs),this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Ya([s[0],s[1]]);q0(x,I)&&Br.IH(I,x,Br.Fv(I,Br.$X(I,x,A))),vv(Bp,I,x);var D=Y0(dv,Br.Ue(),Xs,Bp,this.thickness),Z=(0,Rn.Z)(D,2),J=Z[0],ce=Z[1],xe=Br.AK(dv,this.normal)<0?-1:1;this.extrusions(d,_,a,ce,J,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),xe=-1,Br.JG(this.normal,ce),l+=2,this.lastFlip=xe}return l}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,f,d){var _=0,x=t.indices,A=t.positions,C=t.normals,I=this.cap==="square",D=this.join==="bevel",Z=Ya([f[0],f[1]]),J=Ya([l[0],l[1]]);vv(Xs,a,i);var ce=0;if(this.dash&&(ce=this.lineSegmentDistance(Z,J),this.totalDistance+=ce),this.normal||(this.normal=Br.Ue(),Fp(this.normal,Xs)),!this.started)if(this.started=!0,I){var xe=Br.Ue(),Xe=Br.Ue();Br.IH(xe,this.normal,Xs),Br.IH(Xe,this.normal,Xs),C.push(Xe[0],Xe[1],0),C.push(xe[0],xe[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-ce,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-ce,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,i,this.normal,this.thickness,this.totalDistance-ce);if(x.push(n+0,n+1,n+2),s){q0(a,s)&&Br.IH(s,a,Br.Fv(s,Br.$X(s,a,i))),vv(Bp,s,a);var et=Y0(dv,Br.Ue(),Xs,Bp,this.thickness),Pt=(0,Rn.Z)(et,2),jt=Pt[0],Ar=Pt[1],gr=Br.AK(dv,this.normal)<0?-1:1,Xr=D;if(!Xr&&this.join==="miter"){var mn=jt;mn>this.miterLimit&&(Xr=!0)}Xr?(C.push(this.normal[0],this.normal[1],0),C.push(Ar[0],Ar[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*gr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*gr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,(0,er.Z)(this.lastFlip!==-gr?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),Fp(Ig,Bp),Br.JG(this.normal,Ig),C.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*gr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,C,a,Ar,jt,this.totalDistance),x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),gr=-1,Br.JG(this.normal,Ar),_+=2),this.lastFlip=gr}else{if(Fp(this.normal,Xs),I){var bt=Br.Ue(),pt=Br.Ue();Br.lu(pt,Xs,this.normal),Br.IH(bt,Xs,this.normal),C.push(pt[0],pt[1],0),C.push(bt[0],bt[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,C,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"segment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,_=t.normals,x=this.cap==="square",A=this.join==="bevel",C=Ya([a[0],a[1]]),I=Ya([i[0],i[1]]);vv(Xs,C,I);var D=0;if(this.dash&&(D=this.lineSegmentDistance(C,I),this.totalDistance+=D),this.normal||(this.normal=Br.Ue(),Fp(this.normal,Xs)),!this.started)if(this.started=!0,x){var Z=Br.Ue(),J=Br.Ue();Br.IH(Z,this.normal,Xs),Br.IH(J,this.normal,Xs),_.push(J[0],J[1],0),_.push(Z[0],Z[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-D,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-D,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-D);if(f.push(n+0,n+1,n+2),s){var Xe=Ya([s[0],s[1]]);q0(C,Xe)&&Br.IH(Xe,C,Br.Fv(Xe,Br.$X(Xe,C,I))),vv(Bp,Xe,C);var bt=Y0(dv,Br.Ue(),Xs,Bp,this.thickness),pt=(0,Rn.Z)(bt,2),et=pt[0],Pt=pt[1],jt=Br.AK(dv,this.normal)<0?-1:1,Ar=A;if(!Ar&&this.join==="miter"){var gr=et;gr>this.miterLimit&&(Ar=!0)}Ar?(_.push(this.normal[0],this.normal[1],0),_.push(Pt[0],Pt[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*jt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*jt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,er.Z)(this.lastFlip!==-jt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),Fp(Ig,Bp),Br.JG(this.normal,Ig),_.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*jt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,_,a,Pt,et,this.totalDistance),f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),jt=-1,Br.JG(this.normal,Pt),l+=2),this.lastFlip=jt}else{if(Fp(this.normal,Xs),x){var ce=Br.Ue(),xe=Br.Ue();Br.lu(xe,Xs,this.normal),Br.IH(ce,Xs,this.normal),_.push(xe[0],xe[1],0),_.push(ce[0],ce[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,er.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}(),Na=O(77160);function mC(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Oo().flatten(e),a=i.vertices,s=i.dimensions,l=[],f=[],d=0;d<a.length/s;d++)s===2?l.push(a[d*2],a[d*2+1],1):l.push(a[d*3],a[d*3+1],1);var _=Oo()(i.vertices,i.holes,i.dimensions);f.push.apply(f,(0,er.Z)(_));for(var x=function(){var I=i.vertices.slice(A*s,(A+1)*s),D=i.vertices.slice((A+1)*s,(A+2)*s);D.length===0&&(D=i.vertices.slice(0,s));var Z=l.length/3;l.push(I[0],I[1],1,D[0],D[1],1,I[0],I[1],0,D[0],D[1],0),f.push.apply(f,(0,er.Z)([0,2,1,2,3,1].map(function(J){return J+Z})))},A=0;A<n;A++)x();return{positions:l,index:f}}function gC(e){var r=Oo().flatten(e),t=Oo()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function I1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Oo().flatten(e),s=a.vertices,l=a.dimensions,f=[],d=[],_=[],x=0;x<s.length/l;x++)f.push(s[x*l],s[x*l+1],1,-1,-1),_.push(0,0,1);var A=Oo()(a.vertices,a.holes,a.dimensions);d.push.apply(d,(0,er.Z)(A));for(var C=function(){var Z=a.vertices.slice(I*l,(I+1)*l),J=a.vertices.slice((I+1)*l,(I+2)*l);J.length===0&&(J=a.vertices.slice(0,l));var ce=f.length/5;f.push(Z[0],Z[1],1,0,0,J[0],J[1],1,.1,0,Z[0],Z[1],0,0,.8,J[0],J[1],0,.1,.8);var xe=yC([J[0],J[1],1],[Z[0],Z[1],0],[Z[0],Z[1],1],r);_.push.apply(_,(0,er.Z)(xe).concat((0,er.Z)(xe),(0,er.Z)(xe),(0,er.Z)(xe))),d.push.apply(d,(0,er.Z)([1,2,0,3,2,1].map(function(Xe){return Xe+ce})))},I=0;I<i;I++)C();return{positions:f,index:d,normals:_}}function yC(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=Na.create(),a=Na.create(),s=Na.create();n&&(e=Eh(e),r=Eh(r),t=Eh(t));var l=Na.fromValues.apply(Na,(0,er.Z)(e)),f=Na.fromValues.apply(Na,(0,er.Z)(r)),d=Na.fromValues.apply(Na,(0,er.Z)(t));Na.sub(i,d,f),Na.sub(a,l,f),Na.cross(s,i,a);var _=Na.create();return Na.normalize(_,s),_}var Wc,mm=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),gm=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function ym(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(s){var l=Math.sin(s+Math.PI/4),f=Math.cos(s+Math.PI/4);return[l,f,0]});return a}function K0(){return ym(30)}function P1(){return ym(4)}function O1(){return ym(3)}function k1(){return ym(6,1)}function D1(){return ym(5)}var mv=(Wc={},(0,F.Z)(Wc,gm.CIRCLE,K0),(0,F.Z)(Wc,gm.HEXAGON,k1),(0,F.Z)(Wc,gm.TRIANGLE,O1),(0,F.Z)(Wc,gm.SQUARE,P1),(0,F.Z)(Wc,gm.PENTAGON,D1),(0,F.Z)(Wc,mm.CYLINDER,K0),(0,F.Z)(Wc,mm.HEXAGONCOLUMN,k1),(0,F.Z)(Wc,mm.TRIANGLECOLUMN,O1),(0,F.Z)(Wc,mm.SQUARECOLUMN,P1),(0,F.Z)(Wc,mm.PENTAGONCOLUMN,D1),Wc),Pg={};function Og(e){var r=Qs(e.coordinates);return{vertices:[].concat((0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r),(0,er.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function L1(e){var r=Qs(e.coordinates),t=M1(r);return{vertices:[].concat((0,er.Z)(t),(0,er.Z)(t),(0,er.Z)(t),(0,er.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Q0(e){var r=e.shape,t=wC(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function _C(e){var r=Qs(e.coordinates);return{vertices:(0,er.Z)(r),indices:[0],size:r.length}}function bC(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new vC({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function lN(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r),[1,0,0],_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function xC(e){var r=e.coordinates,t=e.originCoordinates,n=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var i=EC(r,t),a=i.results,s=i.totalDistance;return a.map(function(l){n.push(l[0],l[1],l[2],l[3],0,s)}),{vertices:n,indices:[],normals:[],size:6,count:a.length}}function cN(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],size:4,count:0};var n=SC(r),i=n.results;return i.map(function(a){t.push(a[0],a[1],a[2],a[3])}),{vertices:t,indices:[],size:4,count:i.length}}function B1(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function gv(e,r){return e.length<3&&e.push(0),r!==void 0&&e.push(r),e}function EC(e,r){var t=e,n=r||e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=r.flat(),n=r.flat());var i=0;if(t.length<2)return{results:t,totalDistance:0};var a=[],s=gv(t[0],i);a.push(s);for(var l=1;l<t.length-1;l++){var f=B1(Ya(n[l-1]),Ya(n[l]));i+=f;var d=gv(t[l],i);a.push(d),a.push(d)}var _=B1(Ya(n[n.length-2]),Ya(n[n.length-1]));return i+=_,a.push(gv(t[t.length-1],i)),{results:a,totalDistance:i}}function SC(e){if(e.length<2)return{results:e};var r=[],t=gv(e[0]);r.push(t);for(var n=1;n<e.length-1;n++){var i=gv(e[n]);r.push(i),r.push(i)}return r.push(gv(e[e.length-1])),{results:r}}function J0(e){var r=e.coordinates,t=Oo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Oo()(n,a,i),vertices:n,size:i}}function AC(e){var r=e.coordinates,t=Oo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Oo()(n,a,i),vertices:TC(n),size:i+4}}function TC(e){for(var r=[],t=fp(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var s=e[a],l=e[a+1];r.push.apply(r,[s,l,0].concat((0,er.Z)(n),[i]))}return r}function ey(e){var r=e.coordinates,t=I1(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function F1(e){var r=e.shape,t=RC(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function kg(e){var r=e.coordinates,t=[].concat((0,er.Z)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],(0,er.Z)(r[1]),[0,1,0],(0,er.Z)(r[0]),[0,0,1],(0,er.Z)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function ty(e,r){for(var t=r.segmentNumber,n=t===void 0?30:t,i=e.coordinates,a=[],s=[],l=function(_){a.push(_,1,_,i[0][0],i[0][1],i[1][0],i[1][1],_,-1,_,i[0][0],i[0][1],i[1][0],i[1][1]),_!==n-1&&s.push.apply(s,(0,er.Z)([0,1,2,1,3,2].map(function(x){return _*2+x})))},f=0;f<n;f++)l(f);return{vertices:a,indices:s,size:7}}function N1(e){var r=e.coordinates;r.length===2&&r.push(0);var t=Dg(-1,1),n=Dg(1,1),i=Dg(-1,-1),a=Dg(1,-1),s=[].concat((0,er.Z)(r),(0,er.Z)(t),(0,er.Z)(r),(0,er.Z)(i),(0,er.Z)(r),(0,er.Z)(a),(0,er.Z)(r),(0,er.Z)(n)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function wC(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Pg&&Pg[e])return Pg[e];var t=mv[e]?mv[e]():mv.cylinder(),n=I1([t],r);return Pg[e]=n,n}function fN(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),a,s,l,f=vec3.create(),d=vec3.create(),_=vec3.create(),x=0,A=r.length;x<A;x+=3){a=r[x+0]*3,s=r[x+1]*3,l=r[x+2]*3;var C=[e[a],e[a+1]],I=[e[s],e[s+1]],D=[e[l],e[l+1]];n&&(C=lngLatToMeters(C),I=lngLatToMeters(I),D=lngLatToMeters(D));var Z=C,J=_slicedToArray(Z,2),ce=J[0],xe=J[1],Xe=vec3.fromValues(ce,xe,e[a+2]),bt=I,pt=_slicedToArray(bt,2),et=pt[0],Pt=pt[1],jt=vec3.fromValues(et,Pt,e[s+2]),Ar=D,gr=_slicedToArray(Ar,2),Xr=gr[0],mn=gr[1],qn=vec3.fromValues(Xr,mn,e[l+2]);vec3.sub(f,qn,jt),vec3.sub(d,Xe,jt),vec3.cross(_,f,d),i[a]+=f[0],i[a+1]+=f[1],i[a+2]+=f[2],i[s]+=f[0],i[s+1]+=f[1],i[s+2]+=f[2],i[l]+=f[0],i[l+1]+=f[1],i[l+2]+=f[2]}return CC(i),i}function CC(e){for(var r=0,t=e.length;r<t;r+=3){var n=vec3.fromValues(e[r],e[r+1],e[r+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,r)}}function hN(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function RC(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=mv[e]?mv[e]():mv.circle(),n=r.indexOf(e)===-1?gC([t]):mC([t]);return n}function Dg(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function pN(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function dN(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function MC(e){var r=IC();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }
   
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,OC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,kC=function(e){(0,je.Z)(t,e);var r=MC(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.baseColor,f=l===void 0?"rgb(16,16,16)":l,d=i.brightColor,_=d===void 0?"rgb(255,176,38)":d,x=i.windowColor,A=x===void 0?"rgb(30,60,89)":x,C=i.time,I=C===void 0?0:C,D=i.sweep,Z=D===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:D,J={u_baseColor:bi(f),u_brightColor:bi(_),u_windowColor:bi(A),u_circleSweepColor:[].concat((0,er.Z)(bi(Z.sweepColor).slice(0,3)),[1]),u_cityCenter:Z.sweepCenter||this.cityCenter,u_circleSweep:Z.enable?1:0,u_cityMinSize:this.cityMinSize*Z.sweepRadius,u_circleSweepSpeed:Z.sweepSpeed,u_opacity:s,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||I},ce=this.getUniformsBufferInfo(J);return ce}},{key:"calCityGeo",value:function(){var i=(0,Rn.Z)(this.layer.getSource().extent,4),a=i[0],s=i[1],l=i[2],f=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(f+s)/2]);var d=this.mapService.lngLatToCoord([l,f]),_=this.mapService.lngLatToCoord([a,s]);this.cityMinSize=Math.sqrt(Math.pow(d[0]-_[0],2)+Math.pow(d[1]-_[1],2))/4}else{var x=l-a,A=f-s;this.cityCenter=[(l+a)/2,(f+s)/2],this.cityMinSize=Math.sqrt(Math.pow(x,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:OC,fragmentShader:PC,triangulation:ey,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:K.BACK}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Wa);function DC(e){var r=LC();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BC=function(e){(0,je.Z)(t,e);var r=DC(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","CityBuildingLayer"),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new kC(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Lp);function FC(e){var r=NC();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UC=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,zC=`layout(location = 0) in vec3 a_Position;\r
layout(location = 1) in vec4 a_Color;\r
layout(location = 10) in vec3 a_Pos;\r
\r
layout(std140) uniform commonUniforms {\r
    vec2 u_radius;\r
    float u_opacity;\r
    float u_coverage;\r
    float u_angle;\r
};\r
\r
\r
out vec4 v_color;\r
\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
  v_color.a *= u_opacity;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,ZC=function(e){(0,je.Z)(t,e);var r=FC(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:zC,fragmentShader:UC,triangulation:F1,primitive:K.TRIANGLES,depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Wa);function VC(e){var r=jC();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HC=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,WC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  setPickingColor(a_PickingColor);
}
`,GC=function(e){(0,je.Z)(t,e);var r=VC(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:WC,fragmentShader:HC,triangulation:Q0,primitive:K.TRIANGLES,depth:{enable:!0}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{shaderLocation:Qn.SIZE,name:"a_Size",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Wa),vN=O(83557);function XC(e,r){for(var t=[],n=[],i=[],a=e+1,s=r+1,l=e/2,f=r/2,d=0;d<s;d++)for(var _=d-f,x=0;x<a;x++){var A=x-l;n.push(A/l,-_/f,0),i.push(x/e),i.push(1-d/r)}for(var C=0;C<r;C++)for(var I=0;I<e;I++){var D=I+a*C,Z=I+a*(C+1),J=I+1+a*(C+1),ce=I+1+a*C;t.push(D,Z,ce),t.push(Z,J,ce)}return{vertices:n,indices:t,uvs:i}}var U1,z1;function $C(e){var r=YC();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qC=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,KC=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,QC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,JC=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,e3=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,t3=`layout(location = 0) in vec3 a_Position;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_Dir;


layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"
#pragma include "picking"

void main(){
    vec3 picking_color_placeholder = u_PickingColor;

    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,r3=pi.isEqual,Z1=(U1=(0,Zt.b2)(),U1(z1=function(e){(0,je.Z)(t,e);var r=$C(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"colorModelUniformBuffer",[]),(0,F.Z)((0,Le.Z)(n),"heat3DModelUniformBuffer",[]),n}return(0,W.Z)(t,[{key:"prerender",value:function(){var i=this,a=this.rendererService,s=a.clear,l=a.useFramebuffer;l(this.heatmapFramerBuffer,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.heatmapFramerBuffer}),i.drawIntensityMode()})}},{key:"render",value:function(i){var a=this.layer.getLayerConfig(),s=a.rampColors;r3(this.preRampColors,s)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C,I,D;return ve().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return l=this.rendererService,f=l.createFramebuffer,d=l.getViewportSize,_=l.createTexture2D,x=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(x==null||(s=x.scale)===null||s===void 0?void 0:s.field)||"heatmap",this.shapeType=A,J.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=J.sent,this.colorModel=A==="heatmap"?this.buildHeatmap():this.build3dHeatMap(),C=d(),I=C.width,D=C.height,this.heatmapTexture=_({width:Math.floor(I/4),height:Math.floor(D/4),wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,min:K.LINEAR,mag:K.LINEAR,usage:ot.RENDER_TARGET}),this.heatmapFramerBuffer=f({color:this.heatmapTexture,depth:!0,width:Math.floor(I/4),height:Math.floor(D/4)}),this.updateColorTexture(),J.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return J.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Un.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=N1,f.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:t3,fragmentShader:e3,triangulation:N1,depth:{enable:!1},cull:{enable:!0,face:sa(this.mapService.version)}});case 4:return s=f.sent,f.abrupt("return",s);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:JC,fs:QC}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService,d=f.createAttribute,_=f.createElements,x=f.createBuffer,A=f.createModel;return A({vs:a,fs:s,uniformBuffers:[].concat((0,er.Z)(this.colorModelUniformBuffer),(0,er.Z)(this.rendererService.uniformBuffers)),attributes:{a_Position:d({shaderLocation:Qn.POSITION,buffer:x({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:K.FLOAT}),size:3}),a_Uv:d({shaderLocation:Qn.UV,buffer:x({data:[0,1,1,1,0,0,1,0],type:K.FLOAT}),size:2})},uniforms:(0,j.Z)({},l),depth:{enable:!1},elements:_({data:[0,2,1,2,3,1],type:K.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),s=a.intensity,l=s===void 0?10:s,f=a.radius,d=f===void 0?5:f,_={u_radius:d,u_intensity:l};this.uniformBuffers[0].subData({offset:0,data:[d,l]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:_,blend:{enable:!0,func:{srcRGB:K.ONE,srcAlpha:1,dstRGB:K.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,f=l===void 0?1:l,d={u_opacity:f,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},_=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[f]}),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:d,textures:_,blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,f=l===void 0?1:l,d=sr.create();sr.invert(d,this.cameraService.getViewProjectionMatrixUncentered());var _={u_opacity:f,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,er.Z)(d)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat((0,er.Z)(_.u_ViewProjectionMatrixUncentered),(0,er.Z)(_.u_InverseViewProjectionMatrix),[f])});var x=[this.heatmapTexture,this.colorTexture];(a=this.colorModel)===null||a===void 0||a.draw({uniforms:_,textures:x,blend:{enable:!0,func:{srcRGB:K.SRC_ALPHA,srcAlpha:1,dstRGB:K.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),s=a.width,l=a.height,f=XC(s/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:KC,fs:qC}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];var d=this.shaderModuleService.getModule("heatmap3dColor"),_=d.vs,x=d.fs,A=d.uniforms,C=this.rendererService,I=C.createAttribute,D=C.createElements,Z=C.createBuffer,J=C.createModel;return J({vs:_,fs:x,attributes:{a_Position:I({shaderLocation:Qn.POSITION,buffer:Z({data:f.vertices,type:K.FLOAT}),size:3}),a_Uv:I({shaderLocation:Qn.UV,buffer:Z({data:f.uvs,type:K.FLOAT}),size:2})},primitive:K.TRIANGLES,uniformBuffers:[].concat((0,er.Z)(this.heat3DModelUniformBuffer),(0,er.Z)(this.rendererService.uniformBuffers)),uniforms:(0,j.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:K.SRC_ALPHA,srcAlpha:1,dstRGB:K.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:D({data:f.indices,type:K.UNSIGNED_INT,count:f.indices.length})})}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),s=a.rampColors,l=Wo(s);this.colorTexture=i({data:l.data,usage:ot.SAMPLED,width:l.width,height:l.height,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,min:K.NEAREST,mag:K.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=s}}]),t}(Wa))||z1);function n3(e){var r=i3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a3=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,o3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 10) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,s3=function(e){(0,je.Z)(t,e);var r=n3(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:o3,fragmentShader:a3,triangulation:F1,depth:{enable:!1},primitive:K.TRIANGLES});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Wa),u3={heatmap:Z1,heatmap3d:Z1,grid:ZC,grid3d:GC,hexagon:s3},l3=u3;function c3(e){var r=f3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function f3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h3=function(e){(0,je.Z)(t,e);var r=c3(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","HeatMapLayer"),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new l3[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"prerender",value:function(){var i=this.getModelType();i==="heatmap"&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=this.getLayerConfig(),l=s.shape3d,f=this.getSource(),d=f.data.type,_=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return _==="heatmap"||_==="heatmap3d"?"heatmap":d==="hexagon"?(l==null?void 0:l.indexOf(_))===-1?"hexagon":"grid3d":d==="grid"?(l==null?void 0:l.indexOf(_))===-1?"grid":"grid3d":"heatmap"}}]),t}(Lp);function p3(e){var r=v3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function v3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m3=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,g3=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,y3=function(e){(0,je.Z)(t,e);var r=p3(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.brightness,l=i.contrast,f=i.saturation,d=i.gamma,_={u_opacity:ml(a,1),u_brightness:ml(s,1),u_contrast:ml(l,1),u_saturation:ml(f,1),u_gamma:ml(d,1)};this.textures=[this.texture];var x=this.getUniformsBufferInfo(_);return x}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"loadTexture",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return s=this.rendererService.createTexture2D,this.texture=s({height:1,width:1}),l=this.layer.getSource(),_.next=5,l.data.images;case 5:f=_.sent,this.texture=s({data:f[0],width:f[0].width,height:f[0].height,mag:K.LINEAR,min:K.LINEAR});case 7:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:g3,fragmentShader:m3,triangulation:kg,primitive:K.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Wa),_3={image:y3},b3=_3;function x3(e){var r=E3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function E3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V1=function(e){(0,je.Z)(t,e);var r=x3(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","ImageLayer"),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new b3[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(Lp);function S3(e){var r=A3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function A3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T3=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,w3=`#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9



  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  //\u8BA1\u7B97dashArray\u548CdistanceRatio \u8F93\u51FA\u5230\u7247\u5143
  vec2 s = source;
  vec2 t = target;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,C3={solid:0,dash:1},mN=pi.isNumber,R3=function(e){(0,je.Z)(t,e);var r=S3(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5]:x,C=i.forward,I=C===void 0?!0:C,D=i.lineTexture,Z=D===void 0?!1:D,J=i.iconStep,ce=J===void 0?100:J,xe=i.segmentNumber,Xe=xe===void 0?30:xe,bt=this.layer.getLayerConfig(),pt=bt.animateOption,et=A;_!=="dash"&&(et=[0,0]),et.length===2&&et.push(0,0);var Pt=0,jt=[0,0,0,0],Ar=[0,0,0,0];a&&s&&(jt=bi(a),Ar=bi(s),Pt=1),this.rendererService.getDirty()&&this.texture.bind();var gr={u_animate:this.animateOption2Array(pt),u_dash_array:et,u_sourceColor:jt,u_targetColor:Ar,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:Xe,u_lineDir:I?1:-1,u_icon_step:ce,u_line_texture:Z?1:0,u_textureBlend:f==="normal"?0:1,u_blur:.9,u_line_type:C3[_||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:Pt},Xr=this.getUniformsBufferInfo(gr);return Xr}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:T3,vert:w3,type:""}}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C;return ve().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return this.initUniformsBuffer(),s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),_=d.frag,x=d.vert,A=d.type,D.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:ty,depth:{enable:!1},styleOption:{segmentNumber:f}});case 5:return C=D.sent,D.abrupt("return",[C]);case 7:case"end":return D.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Wa);function M3(e){var r=I3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function I3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

// varying vec2 v_normal;
in vec4 v_dash_array;
in vec4 v_color;
in vec4 v_line_data;
in float v_segmentIndex;
in vec2 v_iconMapUV;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,O3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,k3={solid:0,dash:1},j1=function(e){(0,je.Z)(t,e);var r=M3(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5]:x,C=i.lineTexture,I=C===void 0?!1:C,D=i.iconStep,Z=D===void 0?100:D,J=i.segmentNumber,ce=J===void 0?30:J,xe=i.globalArcHeight,Xe=xe===void 0?10:xe,bt=this.layer.getLayerConfig(),pt=bt.animateOption;A.length===2&&A.push(0,0);var et=0,Pt=[0,0,0,0],jt=[0,0,0,0];a&&s&&(Pt=bi(a),jt=bi(s),et=1),this.rendererService.getDirty()&&this.texture.bind();var Ar={u_animate:this.animateOption2Array(pt),u_dash_array:A,u_sourceColor:Pt,u_targetColor:jt,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:C1,u_global_height:Xe,segmentNumber:ce,u_line_type:k3[_]||0,u_icon_step:Z,u_line_texture:I?1:0,u_textureBlend:f==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:et},gr=this.getUniformsBufferInfo(Ar);return gr}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:P3,vert:O3,type:""}}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C;return ve().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),_=d.frag,x=d.vert,A=d.type,D.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:ty,styleOption:{segmentNumber:f}});case 4:return C=D.sent,D.abrupt("return",[C]);case 6:case"end":return D.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Wa),H1={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},zl=1/2;function D3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?1:i;return{vertices:[0,zl*e,1*e*n,-(a+zl)*e,1*e*n,(a-zl)*e,0,zl*e,1*e*n,-(a+zl)*e,1*e*n,(a-zl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function L3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function B3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function F3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function N3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function U3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i,s=K0(),l=Oo().flatten([s]),f=Oo()(l.vertices,l.holes,l.dimensions),d=s.map(function(_){return[_[0]*n*e,_[1]*a]}).flat();return{vertices:[].concat((0,er.Z)(d),(0,er.Z)(d)),dimensions:2,indices:f.map(function(_){return _+s.length}),outLineIndices:f,normals:[].concat((0,er.Z)(s.map(function(_){return[_[1]*a,_[0]*n*e,1]}).flat()),(0,er.Z)(new Array(s.length*3).fill(0)))}}function z3(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=(0,Hs.Z)(t.source)==="object"?t.source.type:t.source,i=(0,Hs.Z)(t.target)==="object"?t.target.type:t.target,a=(0,Hs.Z)(t.source)==="object"?t.source:{},s=a.width,l=s===void 0?n?H1[n]:0:s,f=a.height,d=f===void 0?2:f,_=(0,Hs.Z)(t.target)==="object"?t.target:{},x=_.width,A=x===void 0?i?H1[i]:0:x,C=_.height,I=C===void 0?2:C;return{vertices:[0,zl,1*l].concat((0,er.Z)(e),[1,zl,-1*A],(0,er.Z)(e),[1,-zl,-1*A],(0,er.Z)(e),[0,-zl,1*l],(0,er.Z)(e),[0,zl,1*l],(0,er.Z)(e),[1,zl,-1*A],(0,er.Z)(e),[1,-zl,-1*A],(0,er.Z)(e),[0,-zl,1*l],(0,er.Z)(e)),outLineIndices:[0,1,2,0,2,3].map(function(D){return D+r}),indices:[4,5,6,4,6,7].map(function(D){return D+r}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function W1(e,r){var t=(0,Hs.Z)(e)==="object"?e.type:e,n=r==="source"?1:-1,i=(0,Hs.Z)(e)==="object"?e:{};switch(t){case"circle":return U3(n,i);case"triangle":return L3(n,i);case"diamond":return F3(n,i);case"rect":return B3(n,i);case"classic":return N3(n,i);case"halfTriangle":return D3(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function Z3(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat((0,er.Z)(r),[1,2,-3],(0,er.Z)(r),[1,1,-3],(0,er.Z)(r),[0,1,0],(0,er.Z)(r),[0,0,0],(0,er.Z)(r),[1,0,0],(0,er.Z)(r),[1,2,-3],(0,er.Z)(r),[1,1,-3],(0,er.Z)(r),[0,1,0],(0,er.Z)(r),[0,0,0],(0,er.Z)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function V3(e,r){return r?j3(e,r):Z3(e)}function j3(e,r){var t=e.coordinates.flat(),n=r,i=n.target,a=i===void 0?"classic":i,s=n.source,l=s===void 0?"circle":s,f=G1(W1(l,"source"),t,0,0),d=z3(t,f.vertices.length/7,r),_=G1(W1(a,"target"),t,1,f.vertices.length/7+d.vertices.length/7),x={vertices:[].concat((0,er.Z)(f.vertices),(0,er.Z)(d.vertices),(0,er.Z)(_.vertices)),indices:[].concat((0,er.Z)(f.outLineIndices),(0,er.Z)(d.outLineIndices),(0,er.Z)(_.outLineIndices),(0,er.Z)(f.indices),(0,er.Z)(d.indices),(0,er.Z)(_.indices)),normals:[].concat((0,er.Z)(f.normals),(0,er.Z)(d.normals),(0,er.Z)(_.normals)),size:7};return x}function G1(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,s=e.indices,l=e.dimensions,f=e.outLineIndices,d=0;d<a.length;d+=l)i.push.apply(i,[t,a[d+1],a[d]].concat((0,er.Z)(r)));return(0,j.Z)((0,j.Z)({},e),{},{vertices:i,indices:s.map(function(_){return _+n}),outLineIndices:f.map(function(_){return _+n})})}function H3(e){var r=W3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function W3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G3=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,X3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7
   
  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,$3=function(e){(0,je.Z)(t,e);var r=H3(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,s=a===void 0?2:a,l=i.strokeWidth,f=l===void 0?1:l,d=i.strokeOpacity,_=d===void 0?1:d,x={u_gap_width:s,u_stroke_width:f,u_stroke_opacity:_},A=this.getUniformsBufferInfo(x);return A}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:X3,fragmentShader:G3,inject:this.getInject(),triangulation:V3,styleOption:this.layer.getLayerConfig().symbol,primitive:K.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a,s,l,f,d){return d}}})}}]),t}(Wa);function Y3(e){var r=q3();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function q3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_line_data;
in vec2 v_iconMapUV;
in vec4 v_dash_array;
in float v_distance_ratio;
in vec4 v_color;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Q3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
  mix(source, target, segmentRatio),
  sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }
  else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,J3={solid:0,dash:1},eR=function(e){(0,je.Z)(t,e);var r=Y3(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5]:x,C=i.lineTexture,I=C===void 0?!1:C,D=i.iconStep,Z=D===void 0?100:D,J=i.segmentNumber,ce=J===void 0?30:J,xe=this.layer.getLayerConfig(),Xe=xe.animateOption;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var bt=0,pt=[0,0,0,0],et=[0,0,0,0];a&&s&&(pt=bi(a),et=bi(s),bt=1);var Pt=this.layer.getLayerAnimateTime();isNaN(Pt)&&(Pt=0);var jt={u_animate:this.animateOption2Array(Xe),u_dash_array:A,u_sourceColor:pt,u_targetColor:et,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:ce,u_line_type:J3[_]||0,u_icon_step:Z,u_line_texture:I?1:0,u_textureBlend:f==="normal"?0:1,u_time:Pt,u_linearColor:bt},Ar=this.getUniformsBufferInfo(jt);return Ar}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,x.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:Q3,fragmentShader:K3,triangulation:ty,styleOption:{segmentNumber:f},inject:this.getInject(),depth:{enable:!1}});case 3:return d=x.sent,x.abrupt("return",[d]);case 5:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Un.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Wa),gN=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),X1=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),tR=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),ry=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),yN=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function rR(e){var r=nR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function nR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iR=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,aR=`
#define Animate 0.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in vec3 a_DistanceAndIndexAndMiter;
layout(location = 13) in vec4 a_Normal_Total_Distance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};


out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,_N={solid:0,dash:1},$1=function(e){(0,je.Z)(t,e);var r=rR(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"textureEventFlag",!1),(0,F.Z)((0,Le.Z)(n),"texture",n.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,F.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.textures.length===0&&(n.textures=[n.texture]),n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,x=i.dashArray,A=x===void 0?[10,5,0,0]:x,C=i.lineTexture,I=C===void 0?!1:C,D=i.iconStep,Z=D===void 0?100:D,J=i.vertexHeightScale,ce=J===void 0?20:J,xe=i.strokeWidth,Xe=xe===void 0?0:xe,bt=i.raisingHeight,pt=bt===void 0?0:bt,et=i.heightfixed,Pt=et===void 0?!1:et,jt=i.linearDir,Ar=jt===void 0?X1.VERTICAL:jt,gr=i.blur,Xr=gr===void 0?[1,1,1,0]:gr,mn=A;_!=="dash"&&(mn=[0,0,0,0]),mn.length===2&&mn.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var qn=this.layer.getLayerConfig(),ea=qn.animateOption,Ma=0,Ko=[0,0,0,0],Vo=[0,0,0,0];a&&s&&(Ko=bi(a),Vo=bi(s),Ma=1);var qs={u_animate:this.animateOption2Array(ea),u_dash_array:mn,u_blur:Xr,u_sourceColor:Ko,u_targetColor:Vo,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:Z,u_heightfixed:Number(Pt),u_vertexScale:ce,u_raisingHeight:Number(pt),u_strokeWidth:Xe,u_textureBlend:f===tR.NORMAL?0:1,u_line_texture:I?1:0,u_linearDir:Ar===X1.VERTICAL?1:0,u_linearColor:Ma,u_time:this.layer.getLayerAnimateTime()||0},Al=this.getUniformsBufferInfo(qs);return Al}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C;return ve().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!1:l,d=this.getShaders(),_=d.frag,x=d.vert,A=d.type,this.layer.triangulation=jf,D.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:x,fragmentShader:_,triangulation:jf,inject:this.getInject(),depth:{enable:f}});case 5:return C=D.sent,D.abrupt("return",[C]);case 7:case"end":return D.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:iR,vert:aR,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Un.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:10,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(s,l,f,d,_,x){return x===void 0?[f[3],10,f[4]]:[f[3],x,f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:Un.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(s,l,f,d,_){return[].concat((0,er.Z)(_),[f[5]])}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Wa);function oR(e){var r=sR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function sR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uR=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,lR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color; 
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_SizeDistanceAndTotalDistance.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,bN=pi.isNumber,cR=function(e){(0,je.Z)(t,e);var r=oR(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.lineType,f=l===void 0?"solid":l,d=i.dashArray,_=d===void 0?[10,5,0,0]:d,x=i.vertexHeightScale,A=x===void 0?20:x,C=_;f!=="dash"&&(C=[0,0,0,0]),C.length===2&&C.push(0,0);var I=0,D=[0,0,0,0],Z=[0,0,0,0];a&&s&&(D=bi(a),Z=bi(s),I=1);var J={u_sourceColor:D,u_targetColor:Z,u_dash_array:C,u_vertexScale:A,u_linearColor:I},ce=this.getUniformsBufferInfo(J);return ce}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:uR,vert:lR,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.initUniformsBuffer(),s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,A.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,triangulation:xC,inject:this.getInject(),primitive:K.LINES,depth:{enable:!1},pick:!1});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Un.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:Qn.SIZE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(a,s,l){var f=a.size,d=f===void 0?1:f,_=Array.isArray(d)?[d[0],d[1]]:[d,0];return[_[0],_[1],l[3],l[5]]}}})}}]),t}(Wa);function fR(e){var r=hR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function hR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pR=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
in vec2 v_iconMapUV;
in float v_blur;
in float v_radio;
in vec4 v_color;
in vec4 v_dataset;

out vec4 outputColor;
#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,dR=`#define Animate 0.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in float a_Miter;
layout(location = 11) in float a_Total_Distance;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_iconMapUV;
layout(location = 15) in float a_Distance;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out float v_radio;
out vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,vR=function(e){(0,je.Z)(t,e);var r=fR(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.heightfixed,_=d===void 0?!1:d,x=i.lineTexture,A=x===void 0?!1:x,C=i.iconStep,I=C===void 0?100:C,D=i.iconStepCount,Z=D===void 0?1:D,J=this.layer.getLayerConfig(),ce=J.animateOption;this.rendererService.getDirty()&&this.texture.bind();var xe=0,Xe=[0,0,0,0],bt=[0,0,0,0];a&&s&&(Xe=bi(a),bt=bi(s),xe=1);var pt={u_animate:this.animateOption2Array(ce),u_sourceColor:Xe,u_targetColor:bt,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:I,u_heightfixed:Number(_),u_linearColor:xe,u_line_texture:A?1:0,u_textureBlend:f==="normal"?0:1,u_iconStepCount:Z,u_time:this.layer.getLayerAnimateTime()||0},et=this.getUniformsBufferInfo(pt);return et}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:dR,fragmentShader:pR,triangulation:bC,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Un.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s,l,f){return[f[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Un.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(s,l,f,d,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Un.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Wa),mR={arc:R3,arc3d:j1,greatcircle:eR,wall:vR,line:$1,simple:cR,flowline:$3,earthArc3d:j1},gR=mR;function yR(e){var r=_R();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function _R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ny=function(e){(0,je.Z)(t,e);var r=yR(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","LineLayer"),(0,F.Z)((0,Le.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,F.Z)((0,Le.Z)(n),"arrowInsertCount",0),(0,F.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new gR[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(s){if(Array.isArray(s.coordinates)&&Array.isArray(s.coordinates[0])&&Array.isArray(s.coordinates[0][0])){var l=(0,j.Z)({},s);s.coordinates.map(function(f){a.push((0,j.Z)((0,j.Z)({},l),{},{coordinates:f}))})}else a.push(s)}),a}}]),t}(Lp);function bR(e){var r=xR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function xR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ER=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,SR=`
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Y1(e){var r=e.coordinates;return{vertices:(0,er.Z)(r),indices:[0],size:r.length}}var AR=function(e){(0,je.Z)(t,e);var r=bR(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.strokeOpacity,l=s===void 0?1:s,f=i.strokeWidth,d=f===void 0?0:f,_=i.stroke,x=_===void 0?"#fff":_,A={u_stroke_color:bi(x),u_additive:a==="additive"?1:0,u_stroke_opacity:l,u_stroke_width:d},C=this.getUniformsBufferInfo(A);return C}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=Y1,this.initUniformsBuffer(),f.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:SR,fragmentShader:ER,inject:this.getInject(),triangulation:Y1,depth:{enable:!1},primitive:K.POINTS});case 4:return s=f.sent,f.abrupt("return",[s]);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Wa);function TR(e){var r=wR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function wR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CR=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,RR=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;


layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,MR=pi.isNumber,IR=function(e){(0,je.Z)(t,e);var r=TR(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"raiseCount",0),(0,F.Z)((0,Le.Z)(n),"raiseRepeat",0),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,f=l===void 0?1:l,d=i.sourceColor,_=i.targetColor,x=i.pickLight,A=x===void 0?!1:x,C=i.heightfixed,I=C===void 0?!0:C,D=i.opacityLinear,Z=D===void 0?{enable:!1,dir:"up"}:D,J=i.lightEnable,ce=J===void 0?!0:J,xe=0,Xe=[0,0,0,0],bt=[0,0,0,0];if(d&&_&&(Xe=bi(d),bt=bi(_),xe=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var pt=s.speed,et=pt===void 0?.01:pt;this.raiseCount+=et,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var Pt={u_sourceColor:Xe,u_targetColor:bt,u_linearColor:xe,u_pickLight:Number(A),u_heightfixed:Number(I),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:MR(f)?f:1,u_opacitylinear:Number(Z.enable),u_opacitylinear_dir:Z.dir==="up"?1:0,u_lightEnable:Number(ce)},jt=this.getUniformsBufferInfo(Pt);return jt}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption.repeat,f=l===void 0?1:l,this.raiseRepeat=f,x.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:RR,fragmentShader:CR,triangulation:Q0,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:sa(this.mapService.version)},blend:this.getBlend()});case 4:return d=x.sent,x.abrupt("return",[d]);case 6:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Un.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a){var s=Qs(a.coordinates);return M1([s[0],s[1]])}}})}}]),t}(Wa);function PR(e){var r=OR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function OR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kR=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,DR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}`,LR=function(e){(0,je.Z)(t,e);var r=PR(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,f=l===void 0?0:l,d=i.blend,_=i.blur,x=_===void 0?0:_;this.layer.getLayerConfig();var A={u_additive:d==="additive"?1:0,u_stroke_opacity:s,u_stroke_width:f,u_blur:x},C=this.getUniformsBufferInfo(A);return C}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=L1,f.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:DR,fragmentShader:kR,triangulation:L1,inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(s,l,f,d){var _=(0,Rn.Z)(f,3),x=_[0],A=_[1],C=_[2],I=Na.fromValues(0,0,1),D=Na.fromValues(x,0,C),Z=x>=0?Na.angle(I,D):Math.PI*2-Na.angle(I,D),J=Math.PI*2-Math.asin(A/100),ce=sr.create();sr.rotateY(ce,ce,Z),sr.rotateX(ce,ce,J);var xe=Na.fromValues(1,1,0);Na.transformMat4(xe,xe,ce),Na.normalize(xe,xe);var Xe=Na.fromValues(-1,1,0);Na.transformMat4(Xe,Xe,ce),Na.normalize(Xe,Xe);var bt=Na.fromValues(-1,-1,0);Na.transformMat4(bt,bt,ce),Na.normalize(bt,bt);var pt=Na.fromValues(1,-1,0);Na.transformMat4(pt,pt,ce),Na.normalize(pt,pt);var et=[].concat((0,er.Z)(xe),(0,er.Z)(Xe),(0,er.Z)(bt),(0,er.Z)(pt)),Pt=d%4*3;return[et[Pt],et[Pt+1],et[Pt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Un.Attribute,descriptor:{name:"a_Shape",shaderLocation:Qn.SHAPE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.layer.getLayerConfig().shape2d,_=d.indexOf(f);return[_]}}})}}]),t}(Wa);function BR(e){var r=FR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function FR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NR=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,UR=`#define pi 3.1415926535

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,q1=function(e){(0,je.Z)(t,e);var r=BR(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"raiseCount",0),(0,F.Z)((0,Le.Z)(n),"raiseRepeat",0),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,f=i.targetColor,d=i.pickLight,_=d===void 0?!1:d,x=i.heightfixed,A=x===void 0?!1:x,C=i.opacityLinear,I=C===void 0?{enable:!1,dir:"up"}:C,D=i.lightEnable,Z=D===void 0?!0:D,J=0,ce=[0,0,0,0],xe=[0,0,0,0];if(l&&f&&(ce=bi(l),xe=bi(f),J=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var Xe=s.speed,bt=Xe===void 0?.01:Xe;this.raiseCount+=bt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var pt={u_pickLight:Number(_),u_heightfixed:Number(A),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:J,u_sourceColor:ce,u_targetColor:xe,u_opacitylinear:Number(I.enable),u_opacitylinear_dir:I.dir==="up"?1:0,u_lightEnable:Number(Z)},et=this.getUniformsBufferInfo(pt);return et}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x;return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!0:l,d=s.animateOption.repeat,_=d===void 0?1:d,this.raiseRepeat=_,this.initUniformsBuffer(),C.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:UR,fragmentShader:NR,triangulation:Q0,inject:this.getInject(),cull:{enable:!0,face:sa(this.mapService.version)},depth:{enable:f}});case 5:return x=C.sent,C.abrupt("return",[x]);case 7:case"end":return C.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a){var s=Qs(a.coordinates);return[s[0],s[1],0]}}})}}]),t}(Wa);function zR(e){var r=ZR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function ZR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VR=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,jR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;   
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,K1=function(e){(0,je.Z)(t,e);var r=zR(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,f=l===void 0?0:l,d=i.blend,_=i.blur,x=_===void 0?0:_,A=i.raisingHeight,C=A===void 0?0:A,I=i.heightfixed,D=I===void 0?!1:I,Z=i.unit,J=Z===void 0?"pixel":Z,ce=this.getAnimateUniforms().u_time;isNaN(ce)&&(ce=-1);var xe={u_blur_height_fixed:[x,Number(C),Number(D)],u_stroke_width:f,u_additive:d==="additive"?1:0,u_stroke_opacity:s,u_size_unit:ry[J],u_time:ce,u_animate:this.getAnimateUniforms().u_animate},Xe=this.getUniformsBufferInfo(xe);return Xe}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),dp)}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C;return ve().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption,f=l===void 0?{enable:!1}:l,d=this.getShaders(f),_=d.frag,x=d.vert,A=d.type,this.layer.triangulation=dp,this.initUniformsBuffer(),D.next=6,this.layer.buildLayerModel({moduleName:A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:dp,depth:{enable:!1}});case 6:return C=D.sent,D.abrupt("return",[C]);case 8:case"end":return D.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){return{frag:VR,vert:jR,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(s,l,f,d){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=d%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Un.Attribute,descriptor:{name:"a_Shape",shaderLocation:Qn.SHAPE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.indexOf(f);return[d]}}})}}]),t}(Wa);function HR(e){var r=WR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function WR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GR=`in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,XR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,$R=function(e){(0,je.Z)(t,e);var r=HR(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"meter2coord",1),(0,F.Z)((0,Le.Z)(n),"isMeter",!1),(0,F.Z)((0,Le.Z)(n),"radian",0),(0,F.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:K.LINEAR,min:K.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0}),n.textures=[n.texture]}),n}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l,d=i.unit,_=d===void 0?"pixel":d;this.rendererService.getDirty()&&this.texture.bind();var x={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(f),u_raisingHeight:Number(s),u_size_unit:ry[_]},A=this.getUniformsBufferInfo(x);return A}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Og)}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:XR,fragmentShader:GR,triangulation:Og,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:sa(this.mapService.version)}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},_=d.x,x=d.y;return[_,x]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(s,l,f,d){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=d%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}})}}]),t}(Wa);function YR(e){var r=qR();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function qR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KR=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,QR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Q1=function(e){(0,je.Z)(t,e);var r=YR(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:K.LINEAR,min:K.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,W.Z)(t,[{key:"getUninforms",value:function(){this.rendererService.getDirty()&&this.texture.bind();var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l,d={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(s),u_heightfixed:Number(f),u_texture:this.texture};this.textures=[this.texture];var _=this.getUniformsBufferInfo(d);return _}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:QR,fragmentShader:KR,triangulation:_C,inject:this.getInject(),depth:{enable:!1},primitive:K.POINTS});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},_=d.x,x=d.y;return[_,x]}}})}}]),t}(Wa);function JR(e){var r=eM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function eM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tM=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,rM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function J1(e){var r=e.coordinates;return{vertices:(0,er.Z)(r),indices:[0],size:r.length}}var eb=function(e){(0,je.Z)(t,e);var r=JR(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i={u_size_scale:.5},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=J1,this.initUniformsBuffer(),f.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:rM,fragmentShader:tM,triangulation:J1,inject:this.getInject(),depth:{enable:!1},primitive:K.POINTS,pick:!1});case 4:return s=f.sent,f.abrupt("return",[s]);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Wa);function nM(e){var r=iM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function iM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aM=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,oM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
  offset = project_pixel(offset);
  
  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,sM=function(e){(0,je.Z)(t,e);var r=nM(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.speed,l=s===void 0?1:s,f=i.unit,d=f===void 0?"pixel":f,_={u_additive:a==="additive"?1:0,u_size_unit:ry[d],u_speed:l,u_time:this.layer.getLayerAnimateTime()},x=this.getUniformsBufferInfo(_);return x}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Og)}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:oM,fragmentShader:aM,triangulation:Og,inject:this.getInject(),depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Un.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Qn.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a,s,l,f){var d=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_=f%4*3;return[d[_],d[_+1],d[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{shaderLocation:Qn.SIZE,name:"a_Size",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?5:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Wa);function uM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=lM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function lM(e,r){if(e){if(typeof e=="string")return tb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tb(e,r)}}function tb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var cM=function(){function e(r,t,n){(0,ne.Z)(this,e),(0,F.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,W.Z)(e,[{key:"insert",value:function(t,n,i,a,s){this.forEachCell(n,i,a,s,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s)}},{key:"query",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!1,s)}},{key:"hitTest",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!0,s)}},{key:"insertBoxCell",value:function(t,n,i,a,s,l){this.boxCells[s].push(l)}},{key:"queryHitTest",value:function(t,n,i,a,s,l){if(i<0||t>this.width||a<0||n>this.height)return s?!1:[];var f=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(s)return!0;for(var d=0;d<this.boxKeys.length;d++)f.push({key:this.boxKeys[d],x1:this.bboxes[d*4],y1:this.bboxes[d*4+1],x2:this.bboxes[d*4+2],y2:this.bboxes[d*4+3]});return l?f.filter(l):f}var _={hitTest:s,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,f,_,l),s?f.length>0:f}},{key:"queryCell",value:function(t,n,i,a,s,l,f,d){var _=f.seenUids,x=this.boxCells[s];if(x!==null){var A=this.bboxes,C=uM(x),I;try{for(C.s();!(I=C.n()).done;){var D=I.value;if(!_.box[D]){_.box[D]=!0;var Z=D*4;if(t<=A[Z+2]&&n<=A[Z+3]&&i>=A[Z+0]&&a>=A[Z+1]&&(!d||d(this.boxKeys[D]))){if(f.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[D],x1:A[Z],y1:A[Z+1],x2:A[Z+2],y2:A[Z+3]})}}}}catch(J){C.e(J)}finally{C.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,s,l,f,d){for(var _=this.convertToXCellCoord(t),x=this.convertToYCellCoord(n),A=this.convertToXCellCoord(i),C=this.convertToYCellCoord(a),I=_;I<=A;I++)for(var D=x;D<=C;D++){var Z=this.xCellCount*D+I;if(s.call(this,t,n,i,a,Z,l,f,d))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),fM=cM,hM=function(){function e(r,t){(0,ne.Z)(this,e),(0,F.Z)(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new fM(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,W.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,s=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,s)||this.grid.hitTest(n,i,a,s)?{box:[]}:{box:[n,i,a,s]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=Fl.al(n,i,0,1),s=Fl.Ue(),l=sr.fromValues.apply(sr,(0,er.Z)(t));return Fl.fF(s,a,l),{x:(s[0]/s[3]+1)/2*this.width+this.viewportPadding,y:(-s[1]/s[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function rb(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=pM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function pM(e,r){if(e){if(typeof e=="string")return nb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return nb(e,r)}}function nb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ib(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function ab(e,r,t,n,i){if(i){var a=e[n],s=a.glyph;if(s)for(var l=r[s].advance*a.scale,f=(e[n].x+l)*i,d=t;d<=n;d++)e[d].x-=f}}function ob(e,r,t,n,i,a,s){var l=(r-t)*i,f=(-n*s+.5)*a,d=rb(e),_;try{for(d.s();!(_=d.n()).done;){var x=_.value;x.x+=l,x.y+=f}}catch(A){d.e(A)}finally{d.f()}}function dM(e,r,t,n,i,a,s){var l=-8,f=0,d=l,_=0,x=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,C=x.length;t.forEach(function(ce){if(ce.split("").forEach(function(Xe){var bt=r[Xe],pt=0;bt&&(x.push({glyph:Xe,x:f,y:d+pt,vertical:!1,scale:1,metrics:bt}),f+=bt.advance+s)}),x.length!==C){var xe=f-s;_=Math.max(xe,_),ab(x,r,C,x.length-1,A)}f=0,d-=n+5});var I=ib(i),D=I.horizontalAlign,Z=I.verticalAlign;ob(x,A,D,Z,_,n,t.length);var J=d-l;e.top+=-Z*J,e.bottom=e.top-J,e.left+=-D*_,e.right=e.left+_}function vM(e,r,t,n,i,a,s){var l=-8,f=0,d=l,_=0,x=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,C=x.length;t.forEach(function(ce){var xe=r[ce],Xe=0;if(xe&&(x.push({glyph:ce,x:xe.advance/2,y:d+Xe,vertical:!1,scale:1,metrics:xe}),f+=xe.advance+s),x.length!==C){var bt=f-s;_=Math.max(bt,_),ab(x,r,C,x.length-1,A)}f=0,d-=n+5});var I=ib(i),D=I.horizontalAlign,Z=I.verticalAlign;ob(x,A,D,Z,_,n,t.length);var J=d-l;e.top+=-Z*J,e.bottom=e.top-J,e.left+=-D*_,e.right=e.left+_}function mM(e,r,t,n,i,a){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,f=e.split(`
`),d=[],_={positionedGlyphs:d,top:s[1],bottom:s[1],left:s[0],right:s[0],lineCount:f.length,text:e};return l?vM(_,r,f,t,n,i,a):dM(_,r,f,t,n,i,a),d.length?_:!1}function gM(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],s=rb(i),l;try{for(s.s();!(l=s.n()).done;){var f=l.value,d=f.metrics,_=4,x=d.advance*f.scale/2,A=t?[f.x+x,f.y]:[0,0],C=t?[0,0]:[f.x+x+r[0],f.y+r[1]],I=(0-_)*f.scale-x+C[0],D=(0-_)*f.scale+C[1],Z=I+d.width*f.scale,J=D+d.height*f.scale,ce={x:I,y:D},xe={x:Z,y:D},Xe={x:I,y:J},bt={x:Z,y:J};a.push({tl:ce,tr:xe,bl:Xe,br:bt,tex:d,glyphOffset:A})}}catch(pt){s.e(pt)}finally{s.f()}return a}function yM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_M(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function _M(e,r){if(e){if(typeof e=="string")return sb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return sb(e,r)}}function sb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function bM(e){var r=xM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function xM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ub=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,lb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_textOffsets;
layout(location = 14) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,_m=pi.isEqual;function cb(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,s=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,f){n.push.apply(n,(0,er.Z)(s).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,er.Z)(s),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,er.Z)(s),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,er.Z)(s),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+f*4,1+f*4,2+f*4,2+f*4,3+f*4,0+f*4)}),{vertices:n,indices:i,size:7}}var fb=function(e){(0,je.Z)(t,e);var r=bM(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"glyphInfoMap",{}),(0,F.Z)((0,Le.Z)(n),"currentZoom",-1),(0,F.Z)((0,Le.Z)(n),"textureHeight",0),(0,F.Z)((0,Le.Z)(n),"textCount",0),(0,F.Z)((0,Le.Z)(n),"preTextStyle",{}),(0,F.Z)((0,Le.Z)(n),"mapping",(0,Nt.Z)(ve().mark(function l(){return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n.initGlyph(),n.updateTexture(),d.next=4,n.reBuildModel();case 4:case"end":return d.stop()}},l)}))),n}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,s=a===void 0?"#fff":a,l=i.strokeWidth,f=l===void 0?0:l,d=i.halo,_=d===void 0?.5:d,x=i.gamma,A=x===void 0?2:x,C=i.raisingHeight,I=C===void 0?0:C,D=this.getFontServiceMapping(),Z=this.getFontServiceCanvas();D&&Object.keys(D).length!==this.textCount&&Z&&(this.updateTexture(),this.textCount=Object.keys(D).length),this.preTextStyle=this.getTextStyle();var J={u_stroke_color:bi(s),u_sdf_map_size:[(Z==null?void 0:Z.width)||1,(Z==null?void 0:Z.height)||1],u_raisingHeight:Number(I),u_stroke_width:f,u_gamma_scale:A,u_halo_blur:_},ce=this.getUniformsBufferInfo(J);return ce}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 6:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.layer.getLayerConfig(),l=s.textAllowOverlap,f=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),f||this.filterGlyphs(),x.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:lb,fragmentShader:ub,inject:this.getInject(),triangulation:cb.bind(this),depth:{enable:!1}});case 6:return d=x.sent,x.abrupt("return",[d]);case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C,I,D,Z,J;return ve().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:if(s=this.getTextStyle(),l=s.textAllowOverlap,f=l===void 0?!1:l,d=s.textAnchor,_=d===void 0?"center":d,x=s.textOffset,A=s.padding,C=s.fontFamily,I=s.fontWeight,!(!_m(A,this.preTextStyle.padding)||!_m(x,this.preTextStyle.textOffset)||!_m(_,this.preTextStyle.textAnchor)||!_m(C,this.preTextStyle.fontFamily)||!_m(I,this.preTextStyle.fontWeight))){xe.next=5;break}return xe.next=4,this.mapping();case 4:return xe.abrupt("return",!0);case 5:if(!f){xe.next=7;break}return xe.abrupt("return",!1);case 7:if(D=this.mapService.getZoom(),Z=this.mapService.getBounds(),J=Sa(this.extent,Z),!(Math.abs(this.currentZoom-D)>.5||!J||f!==this.preTextStyle.textAllowOverlap)){xe.next=14;break}return xe.next=13,this.reBuildModel();case 13:return xe.abrupt("return",!0);case 14:return xe.abrupt("return",!1);case 15:case"end":return xe.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Un.Attribute,descriptor:{shaderLocation:10,name:"a_textOffsets",buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Un.Attribute,descriptor:{name:"a_tex",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return ju(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var _=d.shape,x=_===void 0?"":_;x=x.toString();var A=yM(x),C;try{for(A.s();!(C=A.n()).done;){var I=C.value;f.indexOf(I)===-1&&f.push(I)}}catch(D){A.e(D)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var _=d.shape,x=_===void 0?"":_;x="".concat(x),f.indexOf(x)===-1&&f.push(x)}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l,d=i.textAllowOverlap,_=d===void 0?!1:d,x=i.padding,A=x===void 0?[0,0]:x,C=i.textAnchor,I=C===void 0?"center":C,D=i.textOffset,Z=D===void 0?[0,0]:D,J=i.opacity,ce=J===void 0?1:J,xe=i.strokeOpacity,Xe=xe===void 0?1:xe,bt=i.strokeWidth,pt=bt===void 0?0:bt,et=i.stroke,Pt=et===void 0?"#000":et;return{fontWeight:s,fontFamily:f,textAllowOverlap:_,padding:A,textAnchor:I,textOffset:Z,opacity:ce,strokeOpacity:Xe,strokeWidth:pt,stroke:Pt}}},{key:"generateGlyphLayout",value:function(i){var a=this,s=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),f=l.spacing,d=f===void 0?2:f,_=l.textAnchor,x=_===void 0?"center":_,A=l.textOffset,C=this.rawEncodeData;this.glyphInfo=C.map(function(I){var D=I.shape,Z=D===void 0?"":D,J=I.id,ce=I.size,xe=ce===void 0?1:ce,Xe=I.textOffset?I.textOffset:A||[0,0],bt=I.textAnchor?I.textAnchor:x||"center",pt=mM(Z.toString(),s,xe,bt,"left",d,Xe,i),et=gM(pt,Xe,!1);return I.shaping=pt,I.glyphQuads=et,I.centroid=Qs(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?Qs(I.originCoordinates):I.originCentroid=I.centroid,a.glyphInfoMap[J]={shaping:pt,glyphQuads:et,centroid:Qs(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(f,"_").concat(s))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(f,"_").concat(s))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.padding,l=s===void 0?[0,0]:s,f=a.textAllowOverlap,d=f===void 0?!1:f;if(!d){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var _=this.rendererService.getViewportSize(),x=_.width,A=_.height,C=new hM(x,A),I=this.glyphInfo.filter(function(D){var Z=D.shaping,J=D.id,ce=J===void 0?0:J,xe=D.version==="GAODE2.x"?D.originCentroid:D.centroid,Xe=D.size,bt=Xe/16,pt=i.mapService.lngLatToContainer(xe),et=C.placeCollisionBox({x1:Z.left*bt-l[0],x2:Z.right*bt+l[0],y1:Z.top*bt-l[1],y2:Z.bottom*bt+l[1],anchorPointX:pt.x,anchorPointY:pt.y}),Pt=et.box;return Pt&&Pt.length?(C.insertCollisionBox(Pt,ce),!0):!1});I.forEach(function(D){i.glyphInfoMap[D.id]=D})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,s=a===void 0?!1:a;s?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(s)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:K.LINEAR,min:K.LINEAR,width:a.width,height:a.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.filterGlyphs(),f.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:lb,fragmentShader:ub,triangulation:cb.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:s=f.sent,this.layer.models=[s];case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Wa),EM={fillImage:$R,fill:K1,radar:sM,image:Q1,normal:eb,simplePoint:AR,extrude:q1,text:fb,earthFill:LR,earthExtrude:IR},SM=EM;function AM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=TM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function TM(e,r){if(e){if(typeof e=="string")return hb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hb(e,r)}}function hb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function wM(e){var r=CM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function CM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lg=function(e){(0,je.Z)(t,e);var r=wM(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","PointLayer"),(0,F.Z)((0,Le.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,F.Z)((0,Le.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,F.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new SM[s](this),f.next=5,this.initLayerModels();case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,s=i.values,l=this.getLayerConfig(),f=l.shape2d,d=this.iconService.getIconMap();if(a&&(f==null?void 0:f.indexOf(a))!==-1)return"fill";if(s==="text")return"text";if(s&&s instanceof Array){var _=AM(s),x;try{for(_.s();!(x=_.n()).done;){var A=x.value;if(typeof A=="string"&&d.hasOwnProperty(A))return"image"}}catch(C){_.e(C)}finally{_.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=a.billboard,d=f===void 0?!0:f,_=this.iconService.getIconMap(),x=i.find(function(C){return C.hasOwnProperty("shape")});if(x){var A=x.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||d===!1?"fillImage":(s==null?void 0:s.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":_.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Lp);function RM(e){return iy.apply(this,arguments)}function iy(){return iy=(0,Nt.Z)(ve().mark(function e(r){var t,n,i;return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!window.createImageBitmap){s.next=14;break}return s.next=3,fetch(r);case 3:return t=s.sent,s.t0=createImageBitmap,s.next=7,t.blob();case 7:return s.t1=s.sent,s.next=10,(0,s.t0)(s.t1);case 10:return n=s.sent,s.abrupt("return",n);case 14:return i=new window.Image,s.abrupt("return",new Promise(function(l){i.onload=function(){return l(i)},i.src=r,i.crossOrigin="Anonymous"}));case 16:case"end":return s.stop()}},e)})),iy.apply(this,arguments)}function MM(e){var r=IM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function IM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PM=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,OM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,kM=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,DM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;
   
  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,LM=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,BM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,FM=function(e){(0,je.Z)(t,e);var r=MM(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.mapTexture,s=i.heightfixed,l=s===void 0?!1:s,f=i.raisingHeight,d=f===void 0?0:f,_=i.topsurface,x=_===void 0?!0:_,A=i.sidesurface,C=A===void 0?!0:A,I=i.sourceColor,D=i.targetColor,Z=0,J=[1,1,1,1],ce=[1,1,1,1];I&&D&&(J=bi(I),ce=bi(D),Z=1);var xe={u_sourceColor:J,u_targetColor:ce,u_linearColor:Z,u_topsurface:Number(x),u_sidesurface:Number(C),u_heightfixed:Number(l),u_raisingHeight:Number(d)};a&&this.texture&&(xe.u_texture=this.texture,this.textures=[this.texture]);var Xe=this.getUniformsBufferInfo(xe);return Xe}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,depth:{enable:!0},inject:this.getInject(),triangulation:ey});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,s=i.mapTexture;return s?{frag:kM,vert:DM,type:"polygonExtrudeTexture"}:a?{frag:LM,vert:BM,type:"polygonExtrudePickLight"}:{frag:PM,vert:OM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,s=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],f=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var d=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],s),_=(0,Rn.Z)(d,2),x=_[0],A=_[1],C=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],s),I=(0,Rn.Z)(C,2),D=I[0],Z=I[1];l=D-x,f=Z-A,a=[x,A,D,Z]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Un.Attribute,descriptor:{name:"a_uvs",shaderLocation:Qn.UV,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(ce,xe,Xe){var bt=Xe[0],pt=Xe[1];return[(bt-a[0])/l,(pt-a[1])/f,Xe[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(ce,xe,Xe,bt,pt){return pt}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(ce){var xe=ce.size,Xe=xe===void 0?10:xe;return Array.isArray(Xe)?[Xe[0]]:[Xe]}}})}},{key:"loadTexture",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(s=this.layer.getLayerConfig(),l=s.mapTexture,f=this.rendererService.createTexture2D,this.texture=f({height:1,width:1}),!l){x.next=8;break}return x.next=6,RM(l);case 6:d=x.sent,this.texture=f({data:d,width:d.width,height:d.height,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,min:K.LINEAR,mag:K.LINEAR});case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Wa);function NM(e){var r=UM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function UM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zM=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,ZM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos);
   float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,VM=function(e){(0,je.Z)(t,e);var r=NM(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i={},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:ey,depth:{enable:!0}});case 4:return _=A.sent,A.abrupt("return",[_]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:zM,vert:ZM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Un.Attribute,descriptor:{name:"a_Normal",shaderLocation:Qn.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Un.Attribute,descriptor:{name:"a_Size",shaderLocation:Qn.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Wa);function jM(e){var r=HM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function HM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WM=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,GM=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,XM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 15) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,$M=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};


out vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,YM=function(e){(0,je.Z)(t,e);var r=jM(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.opacityLinear,f=l===void 0?{enable:!1,dir:"in"}:l,d={u_raisingHeight:Number(s),u_opacitylinear:Number(f.enable),u_dir:f.dir==="in"?1:0},_=this.getUniformsBufferInfo(d);return _}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x;return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return s=this.getModelParams(),l=s.frag,f=s.vert,d=s.triangulation,_=s.type,this.initUniformsBuffer(),this.layer.triangulation=d,C.next=5,this.layer.buildLayerModel({moduleName:_,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:d,primitive:K.TRIANGLES,depth:{enable:!1}});case 5:return x=C.sent,C.abrupt("return",[x]);case 7:case"end":return C.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1,dir:"in"}:a;s.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Un.Attribute,descriptor:{name:"a_linear",shaderLocation:Qn.LINEAR,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:function(f,d,_){return[_[3],_[4],_[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1}:a;return s.enable?{frag:GM,vert:XM,type:"polygonLinear",triangulation:AC}:{frag:WM,vert:$M,type:"polygonFill",triangulation:Ph}}}]),t}(Wa);function qM(e){var r=KM();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function KM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QM=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,JM=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};


out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,xN=pi.isNumber,eI=function(e){(0,je.Z)(t,e);var r=qM(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.watercolor,s=a===void 0?"#6D99A8":a,l=i.watercolor2,f=l===void 0?"#0F121C":l,d={u_watercolor:bi(s),u_watercolor2:bi(f),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};this.textures=[this.texture1,this.texture2,this.texture3];var _=this.getUniformsBufferInfo(d);return _}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:JM,fragmentShader:QM,inject:this.getInject(),triangulation:J0,primitive:K.TRIANGLES,depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,s;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(s=this.texture3)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,Rn.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],_=f-s,x=d-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Un.Attribute,descriptor:{name:"a_uv",shaderLocation:Qn.UV,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(C,I,D,Z){var J=C.version==="GAODE2.x"?C.originCoordinates[0][Z]:D,ce=(0,Rn.Z)(J,2),xe=ce[0],Xe=ce[1];return[(xe-s)/_,(Xe-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,s={height:0,width:0};this.texture1=a(s),this.texture2=a(s),this.texture3=a(s),l(function(d){i.texture1=f(d[0]),i.texture2=f(d[1]),i.texture3=f(d[2]),i.layerService.reRender()});function l(d){var _=0,x=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(C){var I=new Image;I.crossOrigin="",I.src=C,x.push(I),I.onload=function(){_++,_===3&&d(x)}})}function f(d){return a({data:d,width:d.width,height:d.height,wrapS:K.MIRRORED_REPEAT,wrapT:K.MIRRORED_REPEAT,min:K.LINEAR,mag:K.LINEAR})}}}]),t}(Wa);function tI(e){var r=rI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function rI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nI=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,iI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 14) in vec2 a_uv;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;


#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,EN=pi.isNumber,aI=function(e){(0,je.Z)(t,e);var r=tI(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.speed,s=a===void 0?.5:a,l={u_speed:s,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};this.textures=[this.texture];var f=this.getUniformsBufferInfo(l);return f}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:iI,fragmentShader:nI,triangulation:J0,inject:this.getInject(),primitive:K.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,Rn.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],_=f-s,x=d-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Un.Attribute,descriptor:{name:"a_uv",shaderLocation:Qn.UV,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(C,I,D,Z){var J=C.version==="GAODE2.x"?C.originCoordinates[0][Z]:D,ce=(0,Rn.Z)(J,2),xe=ce[0],Xe=ce[1];return[(xe-s)/_,(Xe-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:1,width:1});var f=new Image;f.crossOrigin="",s?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),f.src=s):f.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",f.onload=function(){i.texture=l({data:f,width:f.width,height:f.height,wrapS:K.MIRRORED_REPEAT,wrapT:K.MIRRORED_REPEAT,min:K.LINEAR,mag:K.LINEAR}),i.layerService.reRender()}}}]),t}(Wa),oI={fill:YM,line:$1,extrude:FM,text:fb,point_fill:K1,point_image:Q1,point_normal:eb,point_extrude:q1,water:aI,ocean:eI,extrusion:VM},sI=oI;function uI(e){var r=lI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function lI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bg=function(e){(0,je.Z)(t,e);var r=uI(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","PolygonLayer"),(0,F.Z)((0,Le.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new sI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s==="fill"||!s?"fill":s==="extrude"?"extrude":s==="extrusion"?"extrusion":s==="water"?"water":s==="ocean"?"ocean":s==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=this.iconService.getIconMap(),d=i.find(function(x){return x.hasOwnProperty("shape")});if(d){var _=d.shape;return _==="dot"?"point_normal":(s==null?void 0:s.indexOf(_))!==-1?"point_fill":(l==null?void 0:l.indexOf(_))!==-1?"point_extrude":f.hasOwnProperty(_)?"point_image":"text"}else return"fill"}}]),t}(Lp);function cI(e){var r=fI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function fI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hI=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,pI=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,pb=function(e){(0,je.Z)(t,e);var r=cI(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.clampLow,f=l===void 0?!0:l,d=i.clampHigh,_=d===void 0?!0:d,x=i.noDataValue,A=x===void 0?-9999999:x,C=i.domain,I=i.rampColors,D=C||xc(I);this.colorTexture=this.layer.textureService.getColorTexture(I,D);var Z={u_domain:D,u_opacity:s||1,u_noDataValue:A,u_clampLow:f?1:0,u_clampHigh:(typeof _!="undefined"?_:f)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};this.textures=[this.texture,this.colorTexture];var J=this.getUniformsBufferInfo(Z);return J}},{key:"getRasterData",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){var l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(s.data)){A.next=4;break}return A.abrupt("return",{data:s.data,width:s.width,height:s.height});case 4:return A.next=6,s.data;case 6:return l=A.sent,f=l.rasterData,d=l.width,_=l.height,A.abrupt("return",{data:Array.from(f),width:d,height:_});case 11:case"end":return A.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C,I,D;return ve().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService,f=l.createTexture2D,d=l.queryVerdorInfo,_=s.data.dataArray[0],J.next=6,this.getRasterData(_);case 6:return x=J.sent,A=x.data,C=x.width,I=x.height,this.texture=f({data:new Float32Array(A),width:C,height:I,format:d()==="WebGL1"?K.LUMINANCE:K.RED,type:K.FLOAT,alignment:1}),J.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:pI,fragmentShader:hI,triangulation:kg,primitive:K.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return D=J.sent,J.abrupt("return",[D]);case 15:case"end":return J.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{shaderLocation:Qn.UV,name:"a_Uv",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Wa),dI=["data"],vI=["rasterData"];function mI(e){var r=gI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function gI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yI=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,_I=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,bI=function(e){(0,je.Z)(t,e);var r=mI(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"dataOption",{}),n}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.noDataValue,f=l===void 0?0:l,d=this.dataOption,_=d.rMinMax,x=_===void 0?[0,255]:_,A=d.gMinMax,C=A===void 0?[0,255]:A,I=d.bMinMax,D=I===void 0?[0,255]:I,Z={u_rminmax:x,u_gminmax:C,u_bminmax:D,u_opacity:s||1,u_noDataValue:f,u_texture:this.texture};this.textures=[this.texture];var J=this.getUniformsBufferInfo(Z);return J}},{key:"getRasterData",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){var l,f,d,_,x;return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!Array.isArray(s.data)){C.next=4;break}return l=s.data,f=(0,xi.Z)(s,dI),this.dataOption=f,C.abrupt("return",(0,j.Z)({data:l},f));case 4:return C.next=6,s.data;case 6:if(d=C.sent,_=d.rasterData,x=(0,xi.Z)(d,vI),this.dataOption=x,!Array.isArray(_)){C.next=14;break}return C.abrupt("return",(0,j.Z)({data:_},x));case 14:return C.abrupt("return",(0,j.Z)({data:Array.from(_)},x));case 15:case"end":return C.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A,C;return ve().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,f=s.data.dataArray[0],D.next=6,this.getRasterData(f);case 6:return d=D.sent,_=d.data,x=d.width,A=d.height,this.texture=l({data:new Float32Array(_),width:x,height:A,format:K.RGB,type:K.FLOAT}),D.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:_I,fragmentShader:yI,triangulation:kg,primitive:K.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return C=D.sent,D.abrupt("return",[C]);case 15:case"end":return D.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Wa);function xI(e){var r=EI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function EI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SI=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,AI=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
   vec4 u_unpack;
   vec2 u_domain;
   float u_opacity;
   float u_noDataValue;
   float u_clampLow;
   float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,TI=function(e){(0,je.Z)(t,e);var r=xI(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.clampLow,l=s===void 0?!0:s,f=i.clampHigh,d=f===void 0?!0:f,_=i.noDataValue,x=_===void 0?-9999999:_,A=i.domain,C=i.rampColors,I=i.colorTexture,D=i.rScaler,Z=D===void 0?6553.6:D,J=i.gScaler,ce=J===void 0?25.6:J,xe=i.bScaler,Xe=xe===void 0?.1:xe,bt=i.offset,pt=bt===void 0?1e4:bt,et=A||xc(C),Pt=I;I?this.layer.textureService.setColorTexture(I,C,et):Pt=this.layer.textureService.getColorTexture(C,et);var jt={u_unpack:[Z,ce,Xe,pt],u_domain:et,u_opacity:a||1,u_noDataValue:x,u_clampLow:l,u_clampHigh:typeof d!="undefined"?d:l,u_texture:this.texture,u_colorTexture:Pt};this.textures=[this.texture,Pt];var Ar=this.getUniformsBufferInfo(jt);return Ar}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,x.next=5,s.data.images;case 5:return f=x.sent,this.texture=l({data:f[0],width:f[0].width,height:f[0].height,min:K.LINEAR,mag:K.LINEAR}),x.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:AI,fragmentShader:SI,triangulation:kg,primitive:K.TRIANGLES,depth:{enable:!1}});case 9:return d=x.sent,x.abrupt("return",[d]);case 11:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Un.Attribute,descriptor:{name:"a_Uv",shaderLocation:Qn.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Wa),wI={raster:pb,rasterRgb:bI,raster3d:pb,rasterTerrainRgb:TI},CI=wI;function RI(e){var r=MI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function MI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fg=function(e){(0,je.Z)(t,e);var r=RI(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","RasterLayer"),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new CI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(Lp);function II(e){var r=PI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function PI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OI=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,kI=`layout(location = 0) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,DI=function(e){(0,je.Z)(t,e);var r=II(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,j.Z)((0,j.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.color,f=l===void 0?"#000":l,d={u_color:bi(f),u_opacity:s||1},_=this.getUniformsBufferInfo(d);return _}},{key:"initModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:kI,fragmentShader:OI,triangulation:J0,depth:{enable:!1},pick:!1});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Wa),LI={fill:DI},BI=LI;function FI(e){var r=NI();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function NI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=function(e){(0,je.Z)(t,e);var r=FI(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"type","MaskLayer"),n}return(0,W.Z)(t,[{key:"buildModels",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new BI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Lp),vb,mb,gb,yb,Ng,_b,bb,UI=pi.cloneDeep,zI=(vb=(0,Zt.b2)(),mb=(0,Zt.f3)(Ct.IMapService),gb=(0,Zt.f3)(Ct.IFontService),vb(yb=(Ng=function(){function e(){(0,ne.Z)(this,e),Ui(this,"mapService",_b,this),Ui(this,"fontService",bb,this)}return(0,W.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,Nt.Z)(ve().mark(function s(){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t.log(Ls.MappingStart,vs.INIT),i.generateMaping(t,{styleAttributeService:a}),t.log(Ls.MappingEnd,vs.INIT);case 3:case"end":return f.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var s=(0,Nt.Z)(ve().mark(function l(f){var d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(f){x.next=2;break}return x.abrupt("return",f);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Ls.MappingStart,vs.UPDATE),d=i.generateMaping(t,{styleAttributeService:a}),t.log(Ls.MappingEnd,vs.UPDATE),x.abrupt("return",d);case 7:case"end":return x.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var s=t.getSource();if(!(t.layerModelNeedUpdate||!s||!s.inited)){var l=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),d=s.data.dataArray;if(!(Array.isArray(d)&&d.length===0)){var _=l.filter(function(C){return C.needRemapping}),x=d;if(f!=null&&f.needRemapping&&f!==null&&f!==void 0&&f.scale&&(x=d.filter(function(C){return i.applyAttributeMapping(f,C)[0]})),_.length){var A=i.mapping(t,_,x,t.getEncodedData());t.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),f=t.getSource().data.dataArray,d=f;l!=null&&l.scale&&(d=f.filter(function(x){return i.applyAttributeMapping(l,x)[0]})),d=t.processData(d);var _=this.mapping(t,s,d,void 0);return t.setEncodedData(_),t.emit("dataUpdate",null),!0}},{key:"mapping",value:function(t,n,i,a){var s=this,l=n.filter(function(d){return d.scale!==void 0}).filter(function(d){return d.name!=="filter"}),f=i.map(function(d,_){var x=a?a[_]:{},A=(0,j.Z)({id:d._id,coordinates:d.coordinates},x);return l.forEach(function(C){var I=s.applyAttributeMapping(C,d);(C.name==="color"||C.name==="stroke")&&(I=I.map(function(D){return bi(D)})),A[C.name]=Array.isArray(I)&&I.length===1?I[0]:I,C.name==="shape"&&(A.shape=s.fontService.getIconFontKey(A[C.name]))}),A});return n.forEach(function(d){d.needRemapping=!1}),this.adjustData2Amap2Coordinates(f,t),this.adjustData2SimpleCoordinates(f),f}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;t.filter(function(s){return!s.originCoordinates}).map(function(s){s.version="GAODE2.x",s.originCoordinates=UI(s.coordinates),s.coordinates=i.mapService.coordToAMap2RelativeCoordinates(s.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version==="SIMPLE"&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(s){var l=[];s.map(function(f){l.push(n.mapService.simpleMapCoord.unproject(f))}),i.push(l)}),i}else{var a=[];return t.map(function(s){a.push(n.mapService.simpleMapCoord.unproject(s))}),a}}},{key:"applyAttributeMapping",value:function(t,n){var i;if(!t.scale)return[];var a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],s=[];a.forEach(function(f){var d,_=f.field;(n.hasOwnProperty(_)||((d=t.scale)===null||d===void 0?void 0:d.type)==="variable")&&s.push(n[_])});var l=t.mapping?t.mapping(s):[];return l}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],a=Hu(i),s=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return s}}]),e}(),_b=Bi(Ng.prototype,"mapService",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bb=Bi(Ng.prototype,"fontService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng))||yb),xb,Eb,ZI=(xb=(0,Zt.b2)(),xb(Eb=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Ct.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,Nt.Z)(ve().mark(function i(){var a,s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.log(Ls.SourceInitStart,vs.INIT),a=t.getSource(),a||(s=t.sourceOption||t.defaultSourceConfig,l=s.data,f=s.options,a=new i1(l,f),t.setSource(a)),!a.inited){_.next=8;break}n.updateClusterData(t),t.log(Ls.SourceInitEnd,vs.INIT),_.next=10;break;case 8:return _.next=10,new Promise(function(x){a.on("update",function(A){A.type==="inited"&&(n.updateClusterData(t),t.log(Ls.SourceInitEnd,vs.INIT)),x(null)})});case 10:case"end":return _.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Nt.Z)(ve().mark(function i(){var a,s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=n.updateClusterData(t),s=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=a||s,d.abrupt("return",l);case 5:case"end":return d.stop()}},i)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),i=n.cluster,a=n.clusterOptions.zoom,s=a===void 0?0:a,l=this.mapService.getZoom()-1,f=t.dataState.dataSourceNeedUpdate;return i&&f&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(s!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||Eb);function Sb(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function VI(e){return e.length===1&&(e=jI(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function jI(e){return function(r,t){return Sb(e(r),t)}}var Ab=VI(Sb),SN=Ab.right,AN=Ab.left,TN=null;function Tb(e,r){var t=e.length,n=-1,i,a,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=s=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),s<i&&(s=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=s=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),s<i&&(s=i));return[a,s]}var wb=Array.prototype,wN=wb.slice,CN=wb.map,ay=Math.sqrt(50),oy=Math.sqrt(10),sy=Math.sqrt(2);function RN(e,r,t){var n,i=-1,a,s,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=HI(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),s=new Array(a=Math.ceil(r-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),s=new Array(a=Math.ceil(e-r+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function HI(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=ay?10:a>=oy?5:a>=sy?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=ay?10:a>=oy?5:a>=sy?2:1)}function MN(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=ay?i*=10:a>=oy?i*=5:a>=sy&&(i*=2),r<e?-i:i}function IN(){var e=identity,r=extent,t=sturges;function n(i){var a,s=i.length,l,f=new Array(s);for(a=0;a<s;++a)f[a]=e(i[a],a,i);var d=r(f),_=d[0],x=d[1],A=t(f,_,x);Array.isArray(A)||(A=tickStep(_,x,A),A=range(Math.ceil(_/A)*A,x,A));for(var C=A.length;A[0]<=_;)A.shift(),--C;for(;A[C-1]>x;)A.pop(),--C;var I=new Array(C+1),D;for(a=0;a<=C;++a)D=I[a]=[],D.x0=a>0?A[a-1]:_,D.x1=a<C?A[a]:x;for(a=0;a<s;++a)l=f[a],_<=l&&l<=x&&I[bisect(A,l,0,C)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function PN(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Cb(e,r,t,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*r+(4-6*a+3*s)*t+(1+3*e+3*a-3*s)*n+s*i)/6}function WI(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,l=n<r-1?e[n+2]:2*a-i;return Cb((t-n/r)*r,s,i,a,l)}}function GI(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],a=e[n%r],s=e[(n+1)%r],l=e[(n+2)%r];return Cb((t-n/r)*r,i,a,s,l)}}function Rb(e){return function(){return e}}function Mb(e,r){return function(t){return e+t*r}}function XI(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function ON(e,r){var t=r-e;return t?Mb(e,t>180||t<-180?t-360*Math.round(t/360):t):constant(isNaN(e)?r:e)}function $I(e){return(e=+e)==1?Ib:function(r,t){return t-r?XI(r,t,e):Rb(isNaN(r)?t:r)}}function Ib(e,r){var t=r-e;return t?Mb(e,t):Rb(isNaN(e)?r:e)}var kN=function e(r){var t=$I(r);function n(i,a){var s=t((i=(0,Ho.B8)(i)).r,(a=(0,Ho.B8)(a)).r),l=t(i.g,a.g),f=t(i.b,a.b),d=Ib(i.opacity,a.opacity);return function(_){return i.r=s(_),i.g=l(_),i.b=f(_),i.opacity=d(_),i+""}}return n.gamma=e,n}(1);function Pb(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),s,l;for(s=0;s<t;++s)l=(0,Ho.B8)(r[s]),n[s]=l.r||0,i[s]=l.g||0,a[s]=l.b||0;return n=e(n),i=e(i),a=e(a),l.opacity=1,function(f){return l.r=n(f),l.g=i(f),l.b=a(f),l+""}}}var YI=Pb(WI),DN=Pb(GI);function uy(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function Ob(e){return e.length===1&&(e=qI(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function qI(e){return function(r,t){return uy(e(r),t)}}var kb=Ob(uy),KI=kb.right,LN=kb.left,Ug=KI,Db=Array.prototype,BN=Db.slice,FN=Db.map,ly=Math.sqrt(50),cy=Math.sqrt(10),fy=Math.sqrt(2);function Lb(e,r,t){var n,i=-1,a,s,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=zg(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),s=new Array(a=Math.ceil(r-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),s=new Array(a=Math.ceil(e-r+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function zg(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=ly?10:a>=cy?5:a>=fy?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=ly?10:a>=cy?5:a>=fy?2:1)}function hy(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=ly?i*=10:a>=cy?i*=5:a>=fy&&(i*=2),r<e?-i:i}function NN(){var e=identity,r=extent,t=sturges;function n(i){var a,s=i.length,l,f=new Array(s);for(a=0;a<s;++a)f[a]=e(i[a],a,i);var d=r(f),_=d[0],x=d[1],A=t(f,_,x);Array.isArray(A)||(A=tickStep(_,x,A),A=range(Math.ceil(_/A)*A,x,A));for(var C=A.length;A[0]<=_;)A.shift(),--C;for(;A[C-1]>x;)A.pop(),--C;var I=new Array(C+1),D;for(a=0;a<=C;++a)D=I[a]=[],D.x0=a>0?A[a-1]:_,D.x1=a<C?A[a]:x;for(a=0;a<s;++a)l=f[a],_<=l&&l<=x&&I[bisect(A,l,0,C)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function UN(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function QI(e){return e===null?NaN:+e}function JI(e,r,t){if(t==null&&(t=QI),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),s=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return s+(l-s)*(i-a)}}var Gc="$";function Zg(){}Zg.prototype=Bb.prototype={constructor:Zg,has:function(e){return Gc+e in this},get:function(e){return this[Gc+e]},set:function(e,r){return this[Gc+e]=r,this},remove:function(e){var r=Gc+e;return r in this&&delete this[r]},clear:function(){for(var e in this)e[0]===Gc&&delete this[e]},keys:function(){var e=[];for(var r in this)r[0]===Gc&&e.push(r.slice(1));return e},values:function(){var e=[];for(var r in this)r[0]===Gc&&e.push(this[r]);return e},entries:function(){var e=[];for(var r in this)r[0]===Gc&&e.push({key:r.slice(1),value:this[r]});return e},size:function(){var e=0;for(var r in this)r[0]===Gc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Gc)return!1;return!0},each:function(e){for(var r in this)r[0]===Gc&&e(this[r],r.slice(1),this)}};function Bb(e,r){var t=new Zg;if(e instanceof Zg)e.each(function(l,f){t.set(f,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var s in e)t.set(s,e[s]);return t}var py=Bb;function zN(){var e=[],r=[],t,n,i;function a(l,f,d,_){if(f>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var x=-1,A=l.length,C=e[f++],I,D,Z=map(),J,ce=d();++x<A;)(J=Z.get(I=C(D=l[x])+""))?J.push(D):Z.set(I,[D]);return Z.each(function(xe,Xe){_(ce,Xe,a(xe,f,d,_))}),ce}function s(l,f){if(++f>e.length)return l;var d,_=r[f-1];return n!=null&&f>=e.length?d=l.entries():(d=[],l.each(function(x,A){d.push({key:A,values:s(x,f)})})),_!=null?d.sort(function(x,A){return _(x.key,A.key)}):d}return i={object:function(l){return a(l,0,eP,tP)},map:function(l){return a(l,0,Fb,Nb)},entries:function(l){return s(a(l,0,Fb,Nb),0)},key:function(l){return e.push(l),i},sortKeys:function(l){return r[e.length-1]=l,i},sortValues:function(l){return t=l,i},rollup:function(l){return n=l,i}}}function eP(){return{}}function tP(e,r,t){e[r]=t}function Fb(){return map()}function Nb(e,r,t){e.set(r,t)}function Vg(){}var Ed=py.prototype;Vg.prototype=rP.prototype={constructor:Vg,has:Ed.has,add:function(e){return e+="",this[Gc+e]=e,this},remove:Ed.remove,clear:Ed.clear,values:Ed.keys,size:Ed.size,empty:Ed.empty,each:Ed.each};function rP(e,r){var t=new Vg;if(e instanceof Vg)e.each(function(a){t.add(a)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var ZN=null,Ub=Array.prototype,zb=Ub.map,Sd=Ub.slice;function Np(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function Zb(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var Vb={name:"implicit"};function jg(){var e=py(),r=[],t=[],n=Vb;function i(a){var s=a+"",l=e.get(s);if(!l){if(n!==Vb)return n;e.set(s,l=r.push(a))}return t[(l-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=py();for(var s=-1,l=a.length,f,d;++s<l;)e.has(d=(f=a[s])+"")||e.set(d,r.push(f));return i},i.range=function(a){return arguments.length?(t=Sd.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return jg(r,t).unknown(n)},Np.apply(i,arguments),i}function jb(){var e=ordinal().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,a,s=!1,l=0,f=0,d=.5;delete e.unknown;function _(){var x=r().length,A=n[1]<n[0],C=n[A-0],I=n[1-A];i=(I-C)/Math.max(1,x-l+f*2),s&&(i=Math.floor(i)),C+=(I-C-i*(x-l))*d,a=i*(1-l),s&&(C=Math.round(C),a=Math.round(a));var D=sequence(x).map(function(Z){return C+i*Z});return t(A?D.reverse():D)}return e.domain=function(x){return arguments.length?(r(x),_()):r()},e.range=function(x){return arguments.length?(n=[+x[0],+x[1]],_()):n.slice()},e.rangeRound=function(x){return n=[+x[0],+x[1]],s=!0,_()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(x){return arguments.length?(s=!!x,_()):s},e.padding=function(x){return arguments.length?(l=Math.min(1,f=+x),_()):l},e.paddingInner=function(x){return arguments.length?(l=Math.min(1,x),_()):l},e.paddingOuter=function(x){return arguments.length?(f=+x,_()):f},e.align=function(x){return arguments.length?(d=Math.max(0,Math.min(1,x)),_()):d},e.copy=function(){return jb(r(),n).round(s).paddingInner(l).paddingOuter(f).align(d)},initRange.apply(_(),arguments)}function Hb(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Hb(r())},e}function VN(){return Hb(jb.apply(null,arguments).paddingInner(1))}function Wb(e,r,t,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*r+(4-6*a+3*s)*t+(1+3*e+3*a-3*s)*n+s*i)/6}function nP(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,l=n<r-1?e[n+2]:2*a-i;return Wb((t-n/r)*r,s,i,a,l)}}function iP(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],a=e[n%r],s=e[(n+1)%r],l=e[(n+2)%r];return Wb((t-n/r)*r,i,a,s,l)}}function dy(e){return function(){return e}}function Gb(e,r){return function(t){return e+t*r}}function aP(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function jN(e,r){var t=r-e;return t?Gb(e,t>180||t<-180?t-360*Math.round(t/360):t):constant(isNaN(e)?r:e)}function oP(e){return(e=+e)==1?Xb:function(r,t){return t-r?aP(r,t,e):dy(isNaN(r)?t:r)}}function Xb(e,r){var t=r-e;return t?Gb(e,t):dy(isNaN(e)?r:e)}var $b=function e(r){var t=oP(r);function n(i,a){var s=t((i=(0,Ho.B8)(i)).r,(a=(0,Ho.B8)(a)).r),l=t(i.g,a.g),f=t(i.b,a.b),d=Xb(i.opacity,a.opacity);return function(_){return i.r=s(_),i.g=l(_),i.b=f(_),i.opacity=d(_),i+""}}return n.gamma=e,n}(1);function Yb(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),s,l;for(s=0;s<t;++s)l=(0,Ho.B8)(r[s]),n[s]=l.r||0,i[s]=l.g||0,a[s]=l.b||0;return n=e(n),i=e(i),a=e(a),l.opacity=1,function(f){return l.r=n(f),l.g=i(f),l.b=a(f),l+""}}}var HN=Yb(nP),WN=Yb(iP);function GN(e,r){return(isNumberArray(r)?numberArray:qb)(e,r)}function qb(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),a=new Array(t),s;for(s=0;s<n;++s)i[s]=yy(e[s],r[s]);for(;s<t;++s)a[s]=r[s];return function(l){for(s=0;s<n;++s)a[s]=i[s](l);return a}}function sP(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}}function Hg(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}}function uP(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=yy(e[i],r[i]):n[i]=r[i];return function(a){for(i in t)n[i]=t[i](a);return n}}var vy=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gy=new RegExp(vy.source,"g");function lP(e){return function(){return e}}function cP(e){return function(r){return e(r)+""}}function fP(e,r){var t=vy.lastIndex=gy.lastIndex=0,n,i,a,s=-1,l=[],f=[];for(e=e+"",r=r+"";(n=vy.exec(e))&&(i=gy.exec(r));)(a=i.index)>t&&(a=r.slice(t,a),l[s]?l[s]+=a:l[++s]=a),(n=n[0])===(i=i[0])?l[s]?l[s]+=i:l[++s]=i:(l[++s]=null,f.push({i:s,x:Hg(n,i)})),t=gy.lastIndex;return t<r.length&&(a=r.slice(t),l[s]?l[s]+=a:l[++s]=a),l.length<2?f[0]?cP(f[0].x):lP(r):(r=f.length,function(d){for(var _=0,x;_<r;++_)l[(x=f[_]).i]=x.x(d);return l.join("")})}function hP(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(a){for(i=0;i<t;++i)n[i]=e[i]*(1-a)+r[i]*a;return n}}function pP(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function yy(e,r){var t=typeof r,n;return r==null||t==="boolean"?dy(r):(t==="number"?Hg:t==="string"?(n=(0,Ho.ZP)(r))?(r=n,$b):fP:r instanceof Ho.ZP?$b:r instanceof Date?sP:pP(r)?hP:Array.isArray(r)?qb:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?uP:Hg)(e,r)}function dP(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}}function vP(e){return function(){return e}}function mP(e){return+e}var Kb=[0,1];function Qu(e){return e}function _y(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:vP(isNaN(r)?NaN:.5)}function Qb(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function gP(e,r,t){var n=e[0],i=e[1],a=r[0],s=r[1];return i<n?(n=_y(i,n),a=t(s,a)):(n=_y(n,i),a=t(a,s)),function(l){return a(n(l))}}function yP(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++s<n;)i[s]=_y(e[s],e[s+1]),a[s]=t(r[s],r[s+1]);return function(l){var f=Ug(e,l,1,n)-1;return a[f](i[f](l))}}function Wg(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function by(){var e=Kb,r=Kb,t=yy,n,i,a,s=Qu,l,f,d;function _(){return l=Math.min(e.length,r.length)>2?yP:gP,f=d=null,x}function x(A){return isNaN(A=+A)?a:(f||(f=l(e.map(n),r,t)))(n(s(A)))}return x.invert=function(A){return s(i((d||(d=l(r,e.map(n),Hg)))(A)))},x.domain=function(A){return arguments.length?(e=zb.call(A,mP),s===Qu||(s=Qb(e)),_()):e.slice()},x.range=function(A){return arguments.length?(r=Sd.call(A),_()):r.slice()},x.rangeRound=function(A){return r=Sd.call(A),t=dP,_()},x.clamp=function(A){return arguments.length?(s=A?Qb(e):Qu,x):s!==Qu},x.interpolate=function(A){return arguments.length?(t=A,_()):t},x.unknown=function(A){return arguments.length?(a=A,x):a},function(A,C){return n=A,i=C,_()}}function Jb(e,r){return by()(e,r)}var _P=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Gg(e){if(!(r=_P.exec(e)))throw new Error("invalid format: "+e);var r;return new xy({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}Gg.prototype=xy.prototype;function xy(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}xy.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function bP(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Xg(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function yv(e){return e=Xg(Math.abs(e)),e?e[1]:NaN}function xP(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(yv(r)/3)))*3-yv(Math.abs(e)))}function EP(e,r){return function(t,n){for(var i=t.length,a=[],s=0,l=e[0],f=0;i>0&&l>0&&(f+l+1>n&&(l=Math.max(1,n-f)),a.push(t.substring(i-=l,i+l)),!((f+=l+1)>n));)l=e[s=(s+1)%e.length];return a.reverse().join(r)}}function SP(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}}function AP(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var ex;function TP(e,r){var t=Xg(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-(ex=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+Xg(e,Math.max(0,r+a-1))[0]}function tx(e,r){var t=Xg(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var rx={"%":function(e,r){return(e*100).toFixed(r)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:bP,e:function(e,r){return e.toExponential(r)},f:function(e,r){return e.toFixed(r)},g:function(e,r){return e.toPrecision(r)},o:function(e){return Math.round(e).toString(8)},p:function(e,r){return tx(e*100,r)},r:tx,s:TP,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function nx(e){return e}var ix=Array.prototype.map,ax=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function wP(e){var r=e.grouping===void 0||e.thousands===void 0?nx:EP(ix.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?nx:SP(ix.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",f=e.nan===void 0?"NaN":e.nan+"";function d(x){x=Gg(x);var A=x.fill,C=x.align,I=x.sign,D=x.symbol,Z=x.zero,J=x.width,ce=x.comma,xe=x.precision,Xe=x.trim,bt=x.type;bt==="n"?(ce=!0,bt="g"):rx[bt]||(xe===void 0&&(xe=12),Xe=!0,bt="g"),(Z||A==="0"&&C==="=")&&(Z=!0,A="0",C="=");var pt=D==="$"?t:D==="#"&&/[boxX]/.test(bt)?"0"+bt.toLowerCase():"",et=D==="$"?n:/[%p]/.test(bt)?s:"",Pt=rx[bt],jt=/[defgprs%]/.test(bt);xe=xe===void 0?6:/[gprs]/.test(bt)?Math.max(1,Math.min(21,xe)):Math.max(0,Math.min(20,xe));function Ar(gr){var Xr=pt,mn=et,qn,ea,Ma;if(bt==="c")mn=Pt(gr)+mn,gr="";else{gr=+gr;var Ko=gr<0||1/gr<0;if(gr=isNaN(gr)?f:Pt(Math.abs(gr),xe),Xe&&(gr=AP(gr)),Ko&&+gr==0&&I!=="+"&&(Ko=!1),Xr=(Ko?I==="("?I:l:I==="-"||I==="("?"":I)+Xr,mn=(bt==="s"?ax[8+ex/3]:"")+mn+(Ko&&I==="("?")":""),jt){for(qn=-1,ea=gr.length;++qn<ea;)if(Ma=gr.charCodeAt(qn),48>Ma||Ma>57){mn=(Ma===46?i+gr.slice(qn+1):gr.slice(qn))+mn,gr=gr.slice(0,qn);break}}}ce&&!Z&&(gr=r(gr,1/0));var Vo=Xr.length+gr.length+mn.length,qs=Vo<J?new Array(J-Vo+1).join(A):"";switch(ce&&Z&&(gr=r(qs+gr,qs.length?J-mn.length:1/0),qs=""),C){case"<":gr=Xr+gr+mn+qs;break;case"=":gr=Xr+qs+gr+mn;break;case"^":gr=qs.slice(0,Vo=qs.length>>1)+Xr+gr+mn+qs.slice(Vo);break;default:gr=qs+Xr+gr+mn;break}return a(gr)}return Ar.toString=function(){return x+""},Ar}function _(x,A){var C=d((x=Gg(x),x.type="f",x)),I=Math.max(-8,Math.min(8,Math.floor(yv(A)/3)))*3,D=Math.pow(10,-I),Z=ax[8+I/3];return function(J){return C(D*J)+Z}}return{format:d,formatPrefix:_}}var $g,Ey,ox;CP({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function CP(e){return $g=wP(e),Ey=$g.format,ox=$g.formatPrefix,$g}function RP(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,yv(r)-yv(e))+1}function MP(e){return Math.max(0,-yv(Math.abs(e)))}function IP(e,r,t,n){var i=hy(e,r,t),a;switch(n=Gg(n==null?",f":n),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=xP(i,s))&&(n.precision=a),ox(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=RP(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=MP(i))&&(n.precision=a-(n.type==="%")*2);break}}return Ey(n)}function bm(e){var r=e.domain;return e.ticks=function(t){var n=r();return Lb(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return IP(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,s=n[i],l=n[a],f;return l<s&&(f=s,s=l,l=f,f=i,i=a,a=f),f=zg(s,l,t),f>0?(s=Math.floor(s/f)*f,l=Math.ceil(l/f)*f,f=zg(s,l,t)):f<0&&(s=Math.ceil(s*f)/f,l=Math.floor(l*f)/f,f=zg(s,l,t)),f>0?(n[i]=Math.floor(s/f)*f,n[a]=Math.ceil(l/f)*f,r(n)):f<0&&(n[i]=Math.ceil(s*f)/f,n[a]=Math.floor(l*f)/f,r(n)),e},e}function sx(){var e=Jb(Qu,Qu);return e.copy=function(){return Wg(e,sx())},Np.apply(e,arguments),bm(e)}function PP(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map.call(n,number),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return PP(e).unknown(r)},e=arguments.length?map.call(e,number):[0,1],linearish(t)}function ux(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],s;return a<i&&(s=t,t=n,n=s,s=i,i=a,a=s),e[t]=r.floor(i),e[n]=r.ceil(a),e}function lx(e){return Math.log(e)}function cx(e){return Math.exp(e)}function OP(e){return-Math.log(-e)}function kP(e){return-Math.exp(-e)}function DP(e){return isFinite(e)?+("1e"+e):e<0?0:e}function LP(e){return e===10?DP:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function BP(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function fx(e){return function(r){return-e(-r)}}function FP(e){var r=e(lx,cx),t=r.domain,n=10,i,a;function s(){return i=BP(n),a=LP(n),t()[0]<0?(i=fx(i),a=fx(a),e(OP,kP)):e(lx,cx),r}return r.base=function(l){return arguments.length?(n=+l,s()):n},r.domain=function(l){return arguments.length?(t(l),s()):t()},r.ticks=function(l){var f=t(),d=f[0],_=f[f.length-1],x;(x=_<d)&&(A=d,d=_,_=A);var A=i(d),C=i(_),I,D,Z,J=l==null?10:+l,ce=[];if(!(n%1)&&C-A<J){if(A=Math.round(A)-1,C=Math.round(C)+1,d>0){for(;A<C;++A)for(D=1,I=a(A);D<n;++D)if(Z=I*D,!(Z<d)){if(Z>_)break;ce.push(Z)}}else for(;A<C;++A)for(D=n-1,I=a(A);D>=1;--D)if(Z=I*D,!(Z<d)){if(Z>_)break;ce.push(Z)}}else ce=Lb(A,C,Math.min(C-A,J)).map(a);return x?ce.reverse():ce},r.tickFormat=function(l,f){if(f==null&&(f=n===10?".0e":","),typeof f!="function"&&(f=Ey(f)),l===1/0)return f;l==null&&(l=10);var d=Math.max(1,n*l/r.ticks().length);return function(_){var x=_/a(Math.round(i(_)));return x*n<n-.5&&(x*=n),x<=d?f(_):""}},r.nice=function(){return t(ux(t(),{floor:function(l){return a(Math.floor(i(l)))},ceil:function(l){return a(Math.ceil(i(l)))}}))},r}function hx(){var e=FP(by()).domain([1,10]);return e.copy=function(){return Wg(e,hx()).base(e.base())},Np.apply(e,arguments),e}function px(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function dx(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function NP(e){var r=1,t=e(px(r),dx(r));return t.constant=function(n){return arguments.length?e(px(r=+n),dx(r)):r},linearish(t)}function UP(){var e=NP(transformer());return e.copy=function(){return copy(e,UP()).constant(e.constant())},initRange.apply(e,arguments)}function vx(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function zP(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ZP(e){return e<0?-e*e:e*e}function VP(e){var r=e(Qu,Qu),t=1;function n(){return t===1?e(Qu,Qu):t===.5?e(zP,ZP):e(vx(t),vx(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},bm(r)}function Sy(){var e=VP(by());return e.copy=function(){return Wg(e,Sy()).exponent(e.exponent())},Np.apply(e,arguments),e}function XN(){return Sy.apply(null,arguments).exponent(.5)}function mx(){var e=[],r=[],t=[],n;function i(){var s=0,l=Math.max(1,r.length);for(t=new Array(l-1);++s<l;)t[s-1]=JI(e,s/l);return a}function a(s){return isNaN(s=+s)?n:r[Ug(t,s)]}return a.invertExtent=function(s){var l=r.indexOf(s);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},a.domain=function(s){if(!arguments.length)return e.slice();e=[];for(var l=0,f=s.length,d;l<f;++l)d=s[l],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(uy),i()},a.range=function(s){return arguments.length?(r=Sd.call(s),i()):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return mx().domain(e).range(r).unknown(n)},Np.apply(a,arguments)}function gx(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function s(f){return f<=f?i[Ug(n,f,0,t)]:a}function l(){var f=-1;for(n=new Array(t);++f<t;)n[f]=((f+1)*r-(f-t)*e)/(t+1);return s}return s.domain=function(f){return arguments.length?(e=+f[0],r=+f[1],l()):[e,r]},s.range=function(f){return arguments.length?(t=(i=Sd.call(f)).length-1,l()):i.slice()},s.invertExtent=function(f){var d=i.indexOf(f);return d<0?[NaN,NaN]:d<1?[e,n[0]]:d>=t?[n[t-1],r]:[n[d-1],n[d]]},s.unknown=function(f){return arguments.length&&(a=f),s},s.thresholds=function(){return n.slice()},s.copy=function(){return gx().domain([e,r]).range(i).unknown(a)},Np.apply(bm(s),arguments)}function yx(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[Ug(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=Sd.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=Sd.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var s=r.indexOf(a);return[e[s-1],e[s]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return yx().domain(e).range(r).unknown(t)},Np.apply(i,arguments)}var Ay=new Date,Ty=new Date;function xl(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var s=i(a),l=i.ceil(a);return a-s<l-a?s:l},i.offset=function(a,s){return r(a=new Date(+a),s==null?1:Math.floor(s)),a},i.range=function(a,s,l){var f=[],d;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<s)||!(l>0))return f;do f.push(d=new Date(+a)),r(a,l),e(a);while(d<a&&a<s);return f},i.filter=function(a){return xl(function(s){if(s>=s)for(;e(s),!a(s);)s.setTime(s-1)},function(s,l){if(s>=s)if(l<0)for(;++l<=0;)for(;r(s,-1),!a(s););else for(;--l>=0;)for(;r(s,1),!a(s););})},t&&(i.count=function(a,s){return Ay.setTime(+a),Ty.setTime(+s),e(Ay),e(Ty),Math.floor(t(Ay,Ty))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(s){return n(s)%a===0}:function(s){return i.count(0,s)%a===0}):i}),i}var wy=xl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});wy.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:xl(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var _v=wy,$N=wy.range,_x=xl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),jP=_x,YN=_x.range,Yg=1e3,xm=6e4,bx=36e5,xx=864e5,Ex=6048e5;function Ad(e){return xl(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*xm)/Ex})}var Cy=Ad(0),qg=Ad(1),HP=Ad(2),WP=Ad(3),bv=Ad(4),GP=Ad(5),XP=Ad(6),qN=Cy.range,KN=qg.range,QN=HP.range,JN=WP.range,e6=bv.range,t6=GP.range,r6=XP.range,Sx=xl(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*xm)/xx},function(e){return e.getDate()-1}),Ry=Sx,n6=Sx.range,Ax=xl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Yg-e.getMinutes()*xm)},function(e,r){e.setTime(+e+r*bx)},function(e,r){return(r-e)/bx},function(e){return e.getHours()}),$P=Ax,i6=Ax.range,Tx=xl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Yg)},function(e,r){e.setTime(+e+r*xm)},function(e,r){return(r-e)/xm},function(e){return e.getMinutes()}),YP=Tx,a6=Tx.range,Cx=xl(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*Yg)},function(e,r){return(r-e)/Yg},function(e){return e.getUTCSeconds()}),qP=Cx,o6=Cx.range,Kg=xl(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});Kg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?xl(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):Kg};var KP=Kg,s6=Kg.range;function Td(e){return xl(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/Ex})}var Rx=Td(0),Qg=Td(1),QP=Td(2),JP=Td(3),xv=Td(4),eO=Td(5),tO=Td(6),u6=Rx.range,l6=Qg.range,c6=QP.range,f6=JP.range,h6=xv.range,p6=eO.range,d6=tO.range,Mx=xl(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/xx},function(e){return e.getUTCDate()-1}),Ix=Mx,v6=Mx.range,My=xl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});My.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:xl(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var Em=My,m6=My.range;function Iy(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Py(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Sm(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function rO(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,s=e.shortDays,l=e.months,f=e.shortMonths,d=Am(i),_=Tm(i),x=Am(a),A=Tm(a),C=Am(s),I=Tm(s),D=Am(l),Z=Tm(l),J=Am(f),ce=Tm(f),xe={a:Ko,A:Vo,b:qs,B:Al,c:null,d:Bx,e:Bx,f:TO,g:LO,G:FO,H:EO,I:SO,j:AO,L:Fx,m:wO,M:CO,p:PF,q:OF,Q:jx,s:Hx,S:RO,u:MO,U:IO,V:PO,w:OO,W:kO,x:null,X:null,y:DO,Y:BO,Z:NO,"%":Vx},Xe={a:kF,A:DF,b:LF,B:BF,c:null,d:Ux,e:Ux,f:VO,g:QO,G:ek,H:UO,I:zO,j:ZO,L:zx,m:jO,M:HO,p:FF,q:NF,Q:jx,s:Hx,S:WO,u:GO,U:XO,V:$O,w:YO,W:qO,x:null,X:null,y:KO,Y:JO,Z:tk,"%":Vx},bt={a:Ar,A:gr,b:Xr,B:mn,c:qn,d:Dx,e:Dx,f:yO,g:kx,G:Ox,H:Lx,I:Lx,j:dO,L:gO,m:pO,M:vO,p:jt,q:hO,Q:bO,s:xO,S:mO,u:sO,U:uO,V:lO,w:oO,W:cO,x:ea,X:Ma,y:kx,Y:Ox,Z:fO,"%":_O};xe.x=pt(t,xe),xe.X=pt(n,xe),xe.c=pt(r,xe),Xe.x=pt(t,Xe),Xe.X=pt(n,Xe),Xe.c=pt(r,Xe);function pt(fi,Ca){return function(Xa){var Cn=[],jl=-1,jo=0,_c=fi.length,bc,Dd,I2;for(Xa instanceof Date||(Xa=new Date(+Xa));++jl<_c;)fi.charCodeAt(jl)===37&&(Cn.push(fi.slice(jo,jl)),(Dd=Px[bc=fi.charAt(++jl)])!=null?bc=fi.charAt(++jl):Dd=bc==="e"?" ":"0",(I2=Ca[bc])&&(bc=I2(Xa,Dd)),Cn.push(bc),jo=jl+1);return Cn.push(fi.slice(jo,jl)),Cn.join("")}}function et(fi,Ca){return function(Xa){var Cn=Sm(1900,void 0,1),jl=Pt(Cn,fi,Xa+="",0),jo,_c;if(jl!=Xa.length)return null;if("Q"in Cn)return new Date(Cn.Q);if("s"in Cn)return new Date(Cn.s*1e3+("L"in Cn?Cn.L:0));if(Ca&&!("Z"in Cn)&&(Cn.Z=0),"p"in Cn&&(Cn.H=Cn.H%12+Cn.p*12),Cn.m===void 0&&(Cn.m="q"in Cn?Cn.q:0),"V"in Cn){if(Cn.V<1||Cn.V>53)return null;"w"in Cn||(Cn.w=1),"Z"in Cn?(jo=Py(Sm(Cn.y,0,1)),_c=jo.getUTCDay(),jo=_c>4||_c===0?Qg.ceil(jo):Qg(jo),jo=Ix.offset(jo,(Cn.V-1)*7),Cn.y=jo.getUTCFullYear(),Cn.m=jo.getUTCMonth(),Cn.d=jo.getUTCDate()+(Cn.w+6)%7):(jo=Iy(Sm(Cn.y,0,1)),_c=jo.getDay(),jo=_c>4||_c===0?qg.ceil(jo):qg(jo),jo=Ry.offset(jo,(Cn.V-1)*7),Cn.y=jo.getFullYear(),Cn.m=jo.getMonth(),Cn.d=jo.getDate()+(Cn.w+6)%7)}else("W"in Cn||"U"in Cn)&&("w"in Cn||(Cn.w="u"in Cn?Cn.u%7:"W"in Cn?1:0),_c="Z"in Cn?Py(Sm(Cn.y,0,1)).getUTCDay():Iy(Sm(Cn.y,0,1)).getDay(),Cn.m=0,Cn.d="W"in Cn?(Cn.w+6)%7+Cn.W*7-(_c+5)%7:Cn.w+Cn.U*7-(_c+6)%7);return"Z"in Cn?(Cn.H+=Cn.Z/100|0,Cn.M+=Cn.Z%100,Py(Cn)):Iy(Cn)}}function Pt(fi,Ca,Xa,Cn){for(var jl=0,jo=Ca.length,_c=Xa.length,bc,Dd;jl<jo;){if(Cn>=_c)return-1;if(bc=Ca.charCodeAt(jl++),bc===37){if(bc=Ca.charAt(jl++),Dd=bt[bc in Px?Ca.charAt(jl++):bc],!Dd||(Cn=Dd(fi,Xa,Cn))<0)return-1}else if(bc!=Xa.charCodeAt(Cn++))return-1}return Cn}function jt(fi,Ca,Xa){var Cn=d.exec(Ca.slice(Xa));return Cn?(fi.p=_[Cn[0].toLowerCase()],Xa+Cn[0].length):-1}function Ar(fi,Ca,Xa){var Cn=C.exec(Ca.slice(Xa));return Cn?(fi.w=I[Cn[0].toLowerCase()],Xa+Cn[0].length):-1}function gr(fi,Ca,Xa){var Cn=x.exec(Ca.slice(Xa));return Cn?(fi.w=A[Cn[0].toLowerCase()],Xa+Cn[0].length):-1}function Xr(fi,Ca,Xa){var Cn=J.exec(Ca.slice(Xa));return Cn?(fi.m=ce[Cn[0].toLowerCase()],Xa+Cn[0].length):-1}function mn(fi,Ca,Xa){var Cn=D.exec(Ca.slice(Xa));return Cn?(fi.m=Z[Cn[0].toLowerCase()],Xa+Cn[0].length):-1}function qn(fi,Ca,Xa){return Pt(fi,r,Ca,Xa)}function ea(fi,Ca,Xa){return Pt(fi,t,Ca,Xa)}function Ma(fi,Ca,Xa){return Pt(fi,n,Ca,Xa)}function Ko(fi){return s[fi.getDay()]}function Vo(fi){return a[fi.getDay()]}function qs(fi){return f[fi.getMonth()]}function Al(fi){return l[fi.getMonth()]}function PF(fi){return i[+(fi.getHours()>=12)]}function OF(fi){return 1+~~(fi.getMonth()/3)}function kF(fi){return s[fi.getUTCDay()]}function DF(fi){return a[fi.getUTCDay()]}function LF(fi){return f[fi.getUTCMonth()]}function BF(fi){return l[fi.getUTCMonth()]}function FF(fi){return i[+(fi.getUTCHours()>=12)]}function NF(fi){return 1+~~(fi.getUTCMonth()/3)}return{format:function(fi){var Ca=pt(fi+="",xe);return Ca.toString=function(){return fi},Ca},parse:function(fi){var Ca=et(fi+="",!1);return Ca.toString=function(){return fi},Ca},utcFormat:function(fi){var Ca=pt(fi+="",Xe);return Ca.toString=function(){return fi},Ca},utcParse:function(fi){var Ca=et(fi+="",!0);return Ca.toString=function(){return fi},Ca}}}var Px={"-":"",_:" ",0:"0"},du=/^\s*\d+/,nO=/^%/,iO=/[\\^$*+?|[\]().{}]/g;function Ga(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function aO(e){return e.replace(iO,"\\$&")}function Am(e){return new RegExp("^(?:"+e.map(aO).join("|")+")","i")}function Tm(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function oO(e,r,t){var n=du.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function sO(e,r,t){var n=du.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function uO(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function lO(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function cO(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function Ox(e,r,t){var n=du.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function kx(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function fO(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function hO(e,r,t){var n=du.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function pO(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function Dx(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function dO(e,r,t){var n=du.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function Lx(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function vO(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function mO(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function gO(e,r,t){var n=du.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function yO(e,r,t){var n=du.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function _O(e,r,t){var n=nO.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function bO(e,r,t){var n=du.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function xO(e,r,t){var n=du.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function Bx(e,r){return Ga(e.getDate(),r,2)}function EO(e,r){return Ga(e.getHours(),r,2)}function SO(e,r){return Ga(e.getHours()%12||12,r,2)}function AO(e,r){return Ga(1+Ry.count(_v(e),e),r,3)}function Fx(e,r){return Ga(e.getMilliseconds(),r,3)}function TO(e,r){return Fx(e,r)+"000"}function wO(e,r){return Ga(e.getMonth()+1,r,2)}function CO(e,r){return Ga(e.getMinutes(),r,2)}function RO(e,r){return Ga(e.getSeconds(),r,2)}function MO(e){var r=e.getDay();return r===0?7:r}function IO(e,r){return Ga(Cy.count(_v(e)-1,e),r,2)}function Nx(e){var r=e.getDay();return r>=4||r===0?bv(e):bv.ceil(e)}function PO(e,r){return e=Nx(e),Ga(bv.count(_v(e),e)+(_v(e).getDay()===4),r,2)}function OO(e){return e.getDay()}function kO(e,r){return Ga(qg.count(_v(e)-1,e),r,2)}function DO(e,r){return Ga(e.getFullYear()%100,r,2)}function LO(e,r){return e=Nx(e),Ga(e.getFullYear()%100,r,2)}function BO(e,r){return Ga(e.getFullYear()%1e4,r,4)}function FO(e,r){var t=e.getDay();return e=t>=4||t===0?bv(e):bv.ceil(e),Ga(e.getFullYear()%1e4,r,4)}function NO(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+Ga(r/60|0,"0",2)+Ga(r%60,"0",2)}function Ux(e,r){return Ga(e.getUTCDate(),r,2)}function UO(e,r){return Ga(e.getUTCHours(),r,2)}function zO(e,r){return Ga(e.getUTCHours()%12||12,r,2)}function ZO(e,r){return Ga(1+Ix.count(Em(e),e),r,3)}function zx(e,r){return Ga(e.getUTCMilliseconds(),r,3)}function VO(e,r){return zx(e,r)+"000"}function jO(e,r){return Ga(e.getUTCMonth()+1,r,2)}function HO(e,r){return Ga(e.getUTCMinutes(),r,2)}function WO(e,r){return Ga(e.getUTCSeconds(),r,2)}function GO(e){var r=e.getUTCDay();return r===0?7:r}function XO(e,r){return Ga(Rx.count(Em(e)-1,e),r,2)}function Zx(e){var r=e.getUTCDay();return r>=4||r===0?xv(e):xv.ceil(e)}function $O(e,r){return e=Zx(e),Ga(xv.count(Em(e),e)+(Em(e).getUTCDay()===4),r,2)}function YO(e){return e.getUTCDay()}function qO(e,r){return Ga(Qg.count(Em(e)-1,e),r,2)}function KO(e,r){return Ga(e.getUTCFullYear()%100,r,2)}function QO(e,r){return e=Zx(e),Ga(e.getUTCFullYear()%100,r,2)}function JO(e,r){return Ga(e.getUTCFullYear()%1e4,r,4)}function ek(e,r){var t=e.getUTCDay();return e=t>=4||t===0?xv(e):xv.ceil(e),Ga(e.getUTCFullYear()%1e4,r,4)}function tk(){return"+0000"}function Vx(){return"%"}function jx(e){return+e}function Hx(e){return Math.floor(+e/1e3)}var Ev,Wx,rk,nk,ik;ak({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ak(e){return Ev=rO(e),Wx=Ev.format,rk=Ev.parse,nk=Ev.utcFormat,ik=Ev.utcParse,Ev}var wm=1e3,Cm=wm*60,Rm=Cm*60,Mm=Rm*24,ok=Mm*7,Gx=Mm*30,Oy=Mm*365;function sk(e){return new Date(e)}function uk(e){return e instanceof Date?+e:+new Date(+e)}function Xx(e,r,t,n,i,a,s,l,f){var d=Jb(Qu,Qu),_=d.invert,x=d.domain,A=f(".%L"),C=f(":%S"),I=f("%I:%M"),D=f("%I %p"),Z=f("%a %d"),J=f("%b %d"),ce=f("%B"),xe=f("%Y"),Xe=[[s,1,wm],[s,5,5*wm],[s,15,15*wm],[s,30,30*wm],[a,1,Cm],[a,5,5*Cm],[a,15,15*Cm],[a,30,30*Cm],[i,1,Rm],[i,3,3*Rm],[i,6,6*Rm],[i,12,12*Rm],[n,1,Mm],[n,2,2*Mm],[t,1,ok],[r,1,Gx],[r,3,3*Gx],[e,1,Oy]];function bt(et){return(s(et)<et?A:a(et)<et?C:i(et)<et?I:n(et)<et?D:r(et)<et?t(et)<et?Z:J:e(et)<et?ce:xe)(et)}function pt(et,Pt,jt,Ar){if(et==null&&(et=10),typeof et=="number"){var gr=Math.abs(jt-Pt)/et,Xr=Ob(function(mn){return mn[2]}).right(Xe,gr);Xr===Xe.length?(Ar=hy(Pt/Oy,jt/Oy,et),et=e):Xr?(Xr=Xe[gr/Xe[Xr-1][2]<Xe[Xr][2]/gr?Xr-1:Xr],Ar=Xr[1],et=Xr[0]):(Ar=Math.max(hy(Pt,jt,et),1),et=l)}return Ar==null?et:et.every(Ar)}return d.invert=function(et){return new Date(_(et))},d.domain=function(et){return arguments.length?x(zb.call(et,uk)):x().map(sk)},d.ticks=function(et,Pt){var jt=x(),Ar=jt[0],gr=jt[jt.length-1],Xr=gr<Ar,mn;return Xr&&(mn=Ar,Ar=gr,gr=mn),mn=pt(et,Ar,gr,Pt),mn=mn?mn.range(Ar,gr+1):[],Xr?mn.reverse():mn},d.tickFormat=function(et,Pt){return Pt==null?bt:f(Pt)},d.nice=function(et,Pt){var jt=x();return(et=pt(et,jt[0],jt[jt.length-1],Pt))?x(ux(jt,et)):d},d.copy=function(){return Wg(d,Xx(e,r,t,n,i,a,s,l,f))},d}function lk(){return Np.apply(Xx(_v,jP,Cy,Ry,$P,YP,qP,KP,Wx).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function g6(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Jg(){var e=0,r=1,t,n,i,a,s=Qu,l=!1,f;function d(_){return isNaN(_=+_)?f:s(i===0?.5:(_=(a(_)-t)*i,l?Math.max(0,Math.min(1,_)):_))}return d.domain=function(_){return arguments.length?(t=a(e=+_[0]),n=a(r=+_[1]),i=t===n?0:1/(n-t),d):[e,r]},d.clamp=function(_){return arguments.length?(l=!!_,d):l},d.interpolator=function(_){return arguments.length?(s=_,d):s},d.unknown=function(_){return arguments.length?(f=_,d):f},function(_){return a=_,t=_(e),n=_(r),i=t===n?0:1/(n-t),d}}function Im(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function $x(){var e=bm(Jg()(Qu));return e.copy=function(){return Im(e,$x())},Zb.apply(e,arguments)}function ck(){var e=loggish(Jg()).domain([1,10]);return e.copy=function(){return Im(e,ck()).base(e.base())},initInterpolator.apply(e,arguments)}function fk(){var e=symlogish(Jg());return e.copy=function(){return Im(e,fk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Yx(){var e=powish(Jg());return e.copy=function(){return Im(e,Yx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function y6(){return Yx.apply(null,arguments).exponent(.5)}function hk(){var e=[],r=identity;function t(n){if(!isNaN(n=+n))return r((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,s;i<a;++i)s=n[i],s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return hk(r).domain(e)},initInterpolator.apply(t,arguments)}function e0(){var e=0,r=.5,t=1,n,i,a,s,l,f=Qu,d,_=!1,x;function A(C){return isNaN(C=+C)?x:(C=.5+((C=+d(C))-i)*(C<i?s:l),f(_?Math.max(0,Math.min(1,C)):C))}return A.domain=function(C){return arguments.length?(n=d(e=+C[0]),i=d(r=+C[1]),a=d(t=+C[2]),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A):[e,r,t]},A.clamp=function(C){return arguments.length?(_=!!C,A):_},A.interpolator=function(C){return arguments.length?(f=C,A):f},A.unknown=function(C){return arguments.length?(x=C,A):x},function(C){return d=C,n=C(e),i=C(r),a=C(t),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A}}function qx(){var e=bm(e0()(Qu));return e.copy=function(){return Im(e,qx())},Zb.apply(e,arguments)}function pk(){var e=loggish(e0()).domain([.1,1,10]);return e.copy=function(){return copy(e,pk()).base(e.base())},initInterpolator.apply(e,arguments)}function dk(){var e=symlogish(e0());return e.copy=function(){return copy(e,dk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Kx(){var e=powish(e0());return e.copy=function(){return copy(e,Kx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function _6(){return Kx.apply(null,arguments).exponent(.5)}function Qx(e){var r,t=[];function n(i){return i==null?r:i}return n.invert=n,n.domain=n.range=function(i){return i?(t=i,i):t},n.unknown=function(i){return i?(r=i,i):r},n.copy=function(){return Qx(e).unknown(r)},n}var gc,Jx,eE,ky=pi.isNil,vk=pi.isString,mk=pi.uniq,gk=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,yk=(gc={},(0,F.Z)(gc,eo.LINEAR,sx),(0,F.Z)(gc,eo.POWER,Sy),(0,F.Z)(gc,eo.LOG,hx),(0,F.Z)(gc,eo.IDENTITY,Qx),(0,F.Z)(gc,eo.SEQUENTIAL,$x),(0,F.Z)(gc,eo.TIME,lk),(0,F.Z)(gc,eo.QUANTILE,mx),(0,F.Z)(gc,eo.QUANTIZE,gx),(0,F.Z)(gc,eo.THRESHOLD,yx),(0,F.Z)(gc,eo.CAT,jg),(0,F.Z)(gc,eo.DIVERGING,qx),gc),_k=(Jx=(0,Zt.b2)(),Jx(eE=function(){function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"scaleOptions",{})}return(0,W.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Nt.Z)(ve().mark(function s(){var l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(t.log(Ls.ScaleInitStart,vs.INIT),i.scaleOptions=t.getScaleOptions(),f=a.getLayerStyleAttributes(),d=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(d)&&d.length===0)){x.next=8;break}return x.abrupt("return");case 8:i.caculateScalesForAttributes(f||[],d);case 9:t.log(Ls.ScaleInitEnd,vs.INIT);case 10:case"end":return x.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var s=(0,Nt.Z)(ve().mark(function l(f){var d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(f){A.next=2;break}return A.abrupt("return",f);case 2:if(t.log(Ls.ScaleInitStart,vs.UPDATE),i.scaleOptions=t.getScaleOptions(),d=a.getLayerStyleAttributes(),_=t.getSource().data.dataArray,!(Array.isArray(_)&&_.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(d||[],_),t.log(Ls.ScaleInitEnd,vs.UPDATE),t.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var s=a.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&s){var f=s.filter(function(d){return d.needRescale});f.length&&i.caculateScalesForAttributes(f,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;t.forEach(function(a){if(a.scale){var s=a.scale,l=a.scale.field;s.names=i.parseFields(ky(l)?[]:l);var f=[];s.names.forEach(function(d){var _;f.push(i.createScale(d,a.name,(_=a.scale)===null||_===void 0?void 0:_.values,n))}),f.some(function(d){return d.type===fv.VARIABLE})?(s.type=fv.VARIABLE,f.forEach(function(d){if(!s.callback&&s.values!=="text"){var _;switch((_=d.option)===null||_===void 0?void 0:_.type){case eo.LOG:case eo.LINEAR:case eo.POWER:if(s.values&&s.values.length>2){var x=d.scale.ticks(s.values.length);d.scale.domain(x)}s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case eo.QUANTILE:case eo.QUANTIZE:case eo.THRESHOLD:d.scale.range(s.values);break;case eo.IDENTITY:break;case eo.CAT:s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case eo.DIVERGING:case eo.SEQUENTIAL:d.scale.interpolator(YI(s.values));break}}if(s.values==="text"){var A;d.scale.range((A=d.option)===null||A===void 0?void 0:A.domain)}})):(s.type=fv.CONSTANT,s.defaultValues=f.map(function(d,_){return d.scale(s.names[_])})),s.scalers=f.map(function(d){return{field:d.field,func:d.scale,option:d.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:vk(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var s,l,f=this.scaleOptions[n]&&((s=this.scaleOptions[n])===null||s===void 0?void 0:s.field)===t?this.scaleOptions[n]:this.scaleOptions[t],d={field:t,scale:void 0,type:fv.VARIABLE,option:f};if(!a||!a.length)return f&&f.type?d.scale=this.createDefaultScale(f):(d.scale=jg([t]),d.type=fv.CONSTANT),d;var _=(l=a.find(function(C){return!ky(C[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||ky(_)&&!f)d.scale=jg([t]),d.type=fv.CONSTANT;else{var x=f&&f.type||this.getDefaultType(_);i==="text"&&(x=eo.CAT),i===void 0&&(x=eo.IDENTITY);var A=this.createScaleConfig(x,t,f,a);d.scale=this.createDefaultScale(A),d.option=A}return d}},{key:"getDefaultType",value:function(t){var n=eo.LINEAR;return typeof t=="string"&&(n=gk.test(t)?eo.TIME:eo.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,a){var s={type:t},l=[];if(t===eo.QUANTILE){var f=new Map;a==null||a.forEach(function(x){f.set(x._id,x[n])}),l=Array.from(f.values())}else l=(a==null?void 0:a.map(function(x){return x[n]}))||[];if(i!=null&&i.domain)s.domain=i==null?void 0:i.domain;else if(t===eo.CAT||t===eo.IDENTITY)s.domain=mk(l);else if(t===eo.QUANTILE)s.domain=l;else if(t===eo.DIVERGING){var d=Tb(l),_=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(d[0]+d[1])/2;s.domain=[d[0],_,d[1]]}else s.domain=Tb(l);return(0,j.Z)((0,j.Z)({},s),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=t.unknown,s=t.clamp,l=t.nice,f=yk[n]();return i&&f.domain&&f.domain(i),a&&f.unknown(a),s!==void 0&&f.clamp&&f.clamp(s),l!==void 0&&f.nice&&f.nice(l),f}}]),e}())||eE),tE,rE,bk=(tE=(0,Zt.b2)(),tE(rE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(i){i.addUniforms((0,j.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||rE),nE,iE,xk=(nE=(0,Zt.b2)(),nE(iE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!t.tileLayer&&i&&i.length>0){var s;(s=t.masks).push.apply(s,(0,er.Z)(i)),t.updateLayerConfig({mask:a})}})}}]),e}())||iE),Ek=function(){function e(r){var t=r.rendererService,n=r.layerService,i=r.parent;(0,ne.Z)(this,e),(0,F.Z)(this,"tileResource",new Map),(0,F.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=i}return(0,W.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(a){return a.key===t}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);if(t.isVisible)if(t.parent){var i=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(t.parent){var a=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,i=t==null?void 0:t.children;return i.length===0?!0:i.every(function(a){var s=n.getTile(a==null?void 0:a.key);return s?(s==null?void 0:s.isLoaded)===!0:!0})}},{key:"render",value:function(){var r=(0,Nt.Z)(ve().mark(function n(){var i=this,a,s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=this.getRenderLayers(),s=a.map(function(){var d=(0,Nt.Z)(ve().mark(function _(x){return ve().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,i.layerService.renderTileLayer(x);case 2:case"end":return C.stop()}},_)}));return function(_){return d.apply(this,arguments)}}()),f.next=4,Promise.all(s);case 4:case"end":return f.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,er.Z)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,er.Z)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),Sk=O(32676);function Ak(e,r,t){t===void 0&&(t={});var n=yn(e),i=yn(r),a=Sk.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?vr(a[0],t.properties):nn(a,t.properties)}var Tk=Ak,wk=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(a){var s=vr(a.coordinates);n===null?n=s:n=Tk(n,s)}),i&&(n.properties=(0,j.Z)({},i)),n}}]),e}(),Pm="select",Om="active",Ck=function(){function e(r){var t=r.layerService,n=r.tileLayerService,i=r.parent;(0,ne.Z)(this,e),(0,F.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=i,this.tileSourceService=new wk}return(0,W.Z)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(t)}}},{key:"pick",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(s=this.parent.getContainer(),l=s.get(Ct.IPickingService),i.type!=="RasterLayer"){x.next=8;break}if(f=this.tileLayerService.getVisibleTileBylngLat(a.lngLat),!(f&&f.getMainLayer()!==void 0)){x.next=7;break}return d=f.getMainLayer(),x.abrupt("return",d.layerPickService.pickRasterLayer(d,a,this.parent));case 7:return x.abrupt("return",!1);case 8:return this.pickRender(a),x.abrupt("return",l.pickFromPickingFBO(i,a));case 10:case"end":return x.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"selectFeature",value:function(t){var n=(0,Rn.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Pm,l),this.updateHighLight(i,a,s,Pm)}},{key:"highlightPickedFeature",value:function(t){var n=(0,Rn.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Om,l),this.updateHighLight(i,a,s,Om)}},{key:"updateHighLight",value:function(t,n,i,a){this.tileLayerService.tiles.map(function(s){var l=s.getMainLayer();switch(a){case Pm:l==null||l.hooks.beforeSelect.call([t,n,i]);break;case Om:l==null||l.hooks.beforeHighlight.call([t,n,i]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(Pm),n=this.tilePickID.get(Om);if(t){var i=this.pickId2Color(t),a=(0,Rn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.updateHighLight(s,l,f,Pm);return}if(n){var d=this.pickId2Color(n),_=(0,Rn.Z)(d,3),x=_[0],A=_[1],C=_[2];this.updateHighLight(x,A,C,Om);return}}},{key:"color2PickId",value:function(t,n,i){return Fa(new Uint8Array([t,n,i]))}},{key:"pickId2Color",value:function(t){return ca(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,(0,er.Z)(a.getFeatureById(t)))}),i}},{key:"pickRasterLayer",value:function(t,n,i){return!1}}]),e}();function Rk(e){return e==="PolygonLayer"?Bg:e==="LineLayer"?ny:Lg}function Mk(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function Ik(e){var r=Pk();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Pk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wd=function(e){(0,je.Z)(t,e);var r=Ik(t);function t(n,i){var a;return(0,ne.Z)(this,t),a=r.call(this),(0,F.Z)((0,Le.Z)(a),"visible",!0),(0,F.Z)((0,Le.Z)(a),"layers",[]),(0,F.Z)((0,Le.Z)(a),"isLoaded",!1),(0,F.Z)((0,Le.Z)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return(0,W.Z)(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=(0,Rn.Z)(this.sourceTile.bounds,4),s=a[0],l=a[1],f=a[2],d=a[3],_=i.lng,x=i.lat;return _>=s&&_<=f&&x>=l&&x<=d}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return(0,j.Z)((0,j.Z)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:Mk(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),s=a.maskLayers,l=[];return s==null||s.forEach(function(f){if(!f.tileLayer)return l.push(f),f;var d=f.tileLayer,_=d.getTile(i.sourceTile.key),x=_==null?void 0:_.getLayers()[0];x&&l.push(x)}),l}},{key:"addTileMask",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return s=new Bg({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),l=vm(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),_.next=5,s.init();case 5:return this.tileMask=s,f=this.getMainLayer(),f!==void 0&&(f.tileMask=s),_.abrupt("return",s);case 9:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s,l){var f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return f=vm(this.parent.sceneContainer),l.setContainer(f,this.parent.sceneContainer),_.next=4,l.init();case 4:s.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return _.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s.isTileLayer=!0,l=vm(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),this.layers.push(s),d.next=6,s.init();case 6:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(s){s.updateLayerConfig((0,F.Z)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),t}(p1.EventEmitter);function Ok(e){var r=kk();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function kk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dk=function(e){(0,je.Z)(t,e);var r=Ok(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.getSourceOption(),l=s.data.features[0].properties,f=new ny().source(s.data,s.options).size(1).shape("line").color("red"),d=new Lg({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),x.next=6,this.addLayer(f);case 6:return x.next=8,this.addLayer(d);case 8:this.isLoaded=!0;case 9:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),t}(wd);function Lk(e){var r=Bk();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Bk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fk=function(e){(0,je.Z)(t,e);var r=Lk(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new V1((0,j.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,D=A;d[D]((C=s[D])===null||C===void 0?void 0:C.field,(I=s[D])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(wd);function Nk(e){var r=Uk();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Uk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zk=function(e){(0,je.Z)(t,e);var r=Nk(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new db((0,j.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,D=A;d[D]((C=s[D])===null||C===void 0?void 0:C.field,(I=s[D])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=a.featureId,f=this.getFeatures(s);return{data:{type:"FeatureCollection",features:f},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),t}(wd),Zk=["rasterData"];function Vk(e){var r=jk();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function jk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hk=function(e){(0,je.Z)(t,e);var r=Vk(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Fg((0,j.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,D=A;d[D]((C=s[D])===null||C===void 0?void 0:C.field,(I=s[D])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,xi.Z)(a,Zk);return{data:s,options:{parser:(0,j.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),t}(wd);function Wk(e){var r=Gk();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function Gk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xk=function(e){(0,je.Z)(t,e);var r=Wk(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Fg((0,j.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var C,I,D=A;d[D]((C=s[D])===null||C===void 0?void 0:C.field,(I=s[D])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(wd),$k=["rasterData"];function Yk(e){var r=qk();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kk={positions:[0,1],colors:["#000","#fff"]},Qk=function(e){(0,je.Z)(t,e);var r=Yk(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_,x,A;return ve().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=this.getLayerOptions(),_=d.rampColors,x=d.domain,this.colorTexture=this.parent.textureService.getColorTexture(_,x),A=new Fg((0,j.Z)((0,j.Z)({},l),{},{colorTexture:this.colorTexture})).source(f.data,f.options),s&&Object.keys(s).forEach(function(D){var Z,J,ce=D;A[ce]((Z=s[ce])===null||Z===void 0?void 0:Z.field,(J=s[ce])===null||J===void 0?void 0:J.values)}),I.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,xi.Z)(a,$k);return{data:s,options:{parser:(0,j.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];var f=s,d=f.rampColors,_=d===void 0?Kk:d,x=f.domain;this.colorTexture=this.parent.textureService.getColorTexture(_,x||xc(_)),this.layers.forEach(function(A){return A.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),t}(wd);function Jk(e){var r=e4();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function e4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t0=function(e){(0,je.Z)(t,e);var r=Jk(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=Rk(this.parent.type),d=this.getSourceOption(),d){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return _=new f((0,j.Z)({},l)).source(d.data,d.options),Object.keys(s).forEach(function(C){var I,D,Z=C;_[Z]((I=s[Z])===null||I===void 0?void 0:I.field,(D=s[Z])===null||D===void 0?void 0:D.values)}),A.next=12,this.addLayer(_);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(_),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=s===void 0?"defaultLayer":s,f=a.featureId,d=f===void 0?"id":f,_=this.getFeatures(l);return{data:{type:"FeatureCollection",features:_},options:{parser:{type:"geojson",featureId:d},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var s=a.getSource().data.dataArray.filter(function(l){return l._id===i});return s}}]),t}(wd);function t4(e){var r=e.type;switch(r){case"PolygonLayer":return t0;case"LineLayer":return t0;case"PointLayer":return t0;case"TileDebugLayer":return Dk;case"MaskLayer":return zk;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case Pu.RGB:case Pu.CUSTOMRGB:return Hk;case Pu.ARRAYBUFFER:case Pu.CUSTOMARRAYBUFFER:return Qk;case Pu.TERRAINRGB:case Pu.CUSTOMTERRAINRGB:return Xk;default:return Fk}default:return t0}}var r4=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],n4=pi.debounce,aE=function(){function e(r){var t=this;(0,ne.Z)(this,e),(0,F.Z)(this,"initedTileset",!1),(0,F.Z)(this,"mapchange",function(){var i;if(t.parent.isVisible()!==!1){var a=t.getCurrentView(),s=a.latLonBounds,l=a.zoom;if(t.mapService.version==="GAODE1.x"){var f=t.parent.getLayerConfig(),d=f.visible;l<2&&d?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):l>=2&&!d&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===l&&t.lastViewStates.latLonBounds.toString()===s.toString()||(t.lastViewStates={zoom:l,latLonBounds:s},(i=t.tilesetManager)===null||i===void 0||i.throttleUpdate(l,s))}}),(0,F.Z)(this,"viewchange",n4(this.mapchange,24)),this.parent=r;var n=this.parent.getContainer();this.rendererService=n.get(Ct.IRendererService),this.layerService=n.get(Ct.ILayerService),this.mapService=n.get(Ct.IMapService),this.pickingService=n.get(Ct.IPickingService),this.tileLayerService=new Ek({rendererService:this.rendererService,layerService:this.layerService,parent:r}),this.tilePickService=new Ck({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:r}),this.parent.setLayerPickService(this.tilePickService),this.proxy(r),this.initTileSetManager()}return(0,W.Z)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,s=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(s,a)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var r=(0,Nt.Z)(ve().mark(function n(){var i=this,a,s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.tilesetManager){d.next=2;break}return d.abrupt("return");case 2:return a=this.parent.getMinZoom(),s=this.parent.getMaxZoom(),l=this.tilesetManager.tiles.filter(function(_){return _.isLoaded}).filter(function(_){return _.isVisibleChange}).filter(function(_){return _.data}).filter(function(_){return _.z>=a&&_.z<s}),d.next=7,Promise.all(l.map(function(){var _=(0,Nt.Z)(ve().mark(function x(A){var C,I;return ve().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(i.tileLayerService.hasTile(A.key)){Z.next=9;break}return C=t4(i.parent),I=new C(A,i.parent),Z.next=5,I.initTileLayer();case 5:i.tilePickService.setPickState(),I.getLayers().length!==0&&(i.tileLayerService.addTile(I),i.tileLayerService.updateTileVisible(A),i.layerService.reRender()),Z.next=12;break;case 9:i.tileLayerService.updateTileVisible(A),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return Z.stop()}},x)}));return function(x){return _.apply(this,arguments)}}()));case 7:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 8:case"end":return d.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;r4.forEach(function(i){var a=t[i].bind(t);t[i]=function(){for(var s=arguments.length,l=new Array(s),f=0;f<s;f++)l[f]=arguments[f];return a.apply(void 0,l),n.getLayers().map(function(d){d[i].apply(d,l)}),i==="style"&&n.getTiles().forEach(function(d){return d.styleUpdate.apply(d,l)}),t}})}}]),e}(),oE,sE,i4=(oE=(0,Zt.b2)(),oE(sE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"build",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.prepareBuildModel(),s.next=3,i.buildModels();case 3:case"end":return s.stop()}},n)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Nt.Z)(ve().mark(function i(){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!t.getSource().isTile){s.next=4;break}return t.prepareBuildModel(),t.tileLayer=new aE(t),s.abrupt("return");case 4:return t.log(Ls.BuildModelStart,vs.INIT),s.next=7,n.initLayerModel(t);case 7:t.log(Ls.BuildModelEnd,vs.INIT);case 8:case"end":return s.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Nt.Z)(ve().mark(function a(s){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s){f.next=2;break}return f.abrupt("return",!1);case 2:if(!t.getSource().isTile){f.next=5;break}return t.tileLayer=new aE(t),f.abrupt("return",!1);case 5:return t.log(Ls.BuildModelStart,vs.UPDATE),f.next=8,n.prepareLayerModel(t);case 8:return t.log(Ls.BuildModelEnd,vs.UPDATE),f.abrupt("return",!0);case 10:case"end":return f.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||sE),uE,lE,a4=(uE=(0,Zt.b2)(),uE(lE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&t.fitBounds(a),t.styleNeedUpdate=!1})}}]),e}())||lE),cE,fE,o4=["type"],hE={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},s4={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},u4={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},l4={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function c4(e){var r={u_DirectionalLights:new Array(3).fill((0,j.Z)({},u4)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,j.Z)({},l4)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[s4]),e.forEach(function(t){var n=t.type,i=n===void 0?"directional":n,a=(0,xi.Z)(t,o4),s=hE[i].lights,l=hE[i].num,f=r[l];r[s][f]=(0,j.Z)((0,j.Z)({},r[s][f]),a),r[l]++}),r}var f4=(cE=(0,Zt.b2)(),cE(fE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms((0,j.Z)({},c4()))})})}}]),e}())||fE),pE,dE,h4=(pE=(0,Zt.b2)(),pE(dE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var f=t.getLayerConfig(),d=f.enableMultiPassRenderer,_=f.passes,x=_===void 0?[]:_;i.enabled=!!d&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=m1(t,x,s,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var f=a.getViewportSize(),d=f.width,_=f.height;t.multiPassRenderer.resize(d,_)}})}}]),e}())||dE),vE,mE,p4=pi.isNumber,Sv={NONE:0,ENCODE:1,HIGHLIGHT:2},d4=(vE=(0,Zt.b2)(),vE(mE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"pickOption2Array",value:function(){var t=[];return this.pickingUniformMap.forEach(function(n,i){p4(n)?t.push(n):t.push.apply(t,(0,er.Z)(n))}),t}},{key:"updatePickOption",value:function(t,n){var i=this;Object.keys(t).forEach(function(f){i.pickingUniformMap.set(f,t[f])});var a=n.getLayerConfig().pickingBuffer||0,s=Number(n.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",a),this.pickingUniformMap.set("u_shaderPick",s);var l=n.getPickingUniformBuffer();l.subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.styleAttributeService,l;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_EnableSelect",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:Un.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Qn.PICKING_COLOR,buffer:{data:[],type:K.FLOAT},size:3,update:function(x){var A=x.id;return d?ca(A):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;d&&t.isVisible()&&(i.updatePickOption({u_PickingStage:Sv.ENCODE},t),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:Sv.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;d&&t.isVisible()&&(i.updatePickOption({u_PickingStage:Sv.HIGHLIGHT},t),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:Sv.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var d=t.getLayerConfig(),_=d.highlightColor,x=d.activeMix,A=x===void 0?0:x,C=typeof _=="string"?bi(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Fa(new Uint8Array(f))});var I={u_PickingStage:Sv.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:C.map(function(D){return D*255}),u_activeMix:A};i.updatePickOption(I,t),t.models.forEach(function(D){return D.addUniforms(I)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var d=t.getLayerConfig(),_=d.selectColor,x=d.selectMix,A=x===void 0?0:x,C=typeof _=="string"?bi(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Fa(new Uint8Array(f))});var I={u_PickingStage:Sv.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:C.map(function(D){return D*255}),u_activeMix:A,u_CurrentSelectedId:f,u_SelectColor:C.map(function(D){return D*255}),u_EnableSelect:1};i.updatePickOption(I,t),t.models.forEach(function(D){return D.addUniforms(I)})})}}]),e}())||mE),v4=["mvt","geojsonvt","testTile"];function m4(e){var r=e.getSource();return v4.includes(r.parser.type)}function b6(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var gE,yE,g4=(gE=(0,Zt.b2)(),gE(yE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){m4(t)||i.registerBuiltinAttributes(a,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:Un.Attribute,descriptor:{name:"a_Position",shaderLocation:Qn.POSITION,buffer:{data:[],type:K.FLOAT},size:3,update:function(i,a,s){return s.length===2?[s[0],s[1],0]:[s[0],s[1],s[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:Un.Attribute,descriptor:{name:"a_Color",shaderLocation:Qn.COLOR,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:Un.Attribute,descriptor:{name:"a_vertexId",shaderLocation:Qn.VERTEX_ID,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||yE),_E,bE,xE,EE,SE,AE,TE,Cd,wE,CE,RE,ME,IE,y4=(_E=(0,Zt.b2)(),bE=(0,Zt.f3)(Ct.ICameraService),xE=(0,Zt.f3)(Ct.ICoordinateSystemService),EE=(0,Zt.f3)(Ct.IRendererService),SE=(0,Zt.f3)(Ct.IMapService),AE=(0,Zt.f3)(Ct.ILayerService),_E(TE=(Cd=function(){function e(){(0,ne.Z)(this,e),Ui(this,"cameraService",wE,this),Ui(this,"coordinateSystemService",CE,this),Ui(this,"rendererService",RE,this),Ui(this,"mapService",ME,this),Ui(this,"layerService",IE,this)}return(0,W.Z)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var f=t.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(f),i==="GAODE2.x"){n.setLayerCenter(t),a=n.mapService.map.customCoords.getMVPMatrix(),s=n.mapService.getCustomCoordCenter();var d=t.getLayerUniformBuffer();d.subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,er.Z)(a),(0,er.Z)(s))).buffer)})}var _=n.rendererService.getViewportSize(),x=_.width,A=_.height,C=n.generateUBO(a,s,x,A),I=C.data,D=C.uniforms;if(n.layerService.alreadyInRendering&&n.rendererService.uniformBuffers[0]){var Z=n.rendererService.uniformBuffers[0];Z.subData({offset:0,data:I})}var J=n.rendererService.queryVerdorInfo();J==="WebGL1"&&t.models.forEach(function(ce){ce.addUniforms((0,j.Z)((0,j.Z)({},D),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,n,i,a){var s,l=this.cameraService.getProjectionMatrix(),f=this.cameraService.getViewMatrix(),d=this.cameraService.getViewProjectionMatrix(),_=this.cameraService.getModelMatrix(),x=this.coordinateSystemService.getViewportCenterProjection(),A=this.coordinateSystemService.getPixelsPerDegree(),C=this.cameraService.getZoom(),I=this.coordinateSystemService.getPixelsPerDegree2(),D=this.cameraService.getZoomScale(),Z=this.coordinateSystemService.getPixelsPerMeter(),J=this.coordinateSystemService.getCoordinateSystem(),ce=this.cameraService.getCameraPosition(),xe=window.devicePixelRatio,Xe=this.coordinateSystemService.getViewportCenter(),bt=[i,a],pt=this.cameraService.getFocalDistance(),et=[].concat((0,er.Z)(f),(0,er.Z)(l),(0,er.Z)(d),(0,er.Z)(_),(0,er.Z)(x),(0,er.Z)(A),[C],(0,er.Z)(I),[D],(0,er.Z)(Z),[J],(0,er.Z)(ce),[xe],(0,er.Z)(Xe),bt,[pt,0,0,0]);return{data:et,uniforms:(s={},(0,F.Z)(s,bd.ProjectionMatrix,l),(0,F.Z)(s,bd.ViewMatrix,f),(0,F.Z)(s,bd.ViewProjectionMatrix,d),(0,F.Z)(s,bd.Zoom,C),(0,F.Z)(s,bd.ZoomScale,D),(0,F.Z)(s,bd.FocalDistance,pt),(0,F.Z)(s,bd.CameraPosition,ce),(0,F.Z)(s,jc.CoordinateSystem,J),(0,F.Z)(s,jc.ViewportCenter,Xe),(0,F.Z)(s,jc.ViewportCenterProjection,x),(0,F.Z)(s,jc.PixelsPerDegree,A),(0,F.Z)(s,jc.PixelsPerDegree2,I),(0,F.Z)(s,jc.PixelsPerMeter,Z),(0,F.Z)(s,jc.Mvp,t),(0,F.Z)(s,"u_sceneCenterMercator",n),(0,F.Z)(s,"u_ViewportSize",bt),(0,F.Z)(s,"u_ModelMatrix",_),(0,F.Z)(s,"u_DevicePixelRatio",xe),s)}}}]),e}(),wE=Bi(Cd.prototype,"cameraService",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CE=Bi(Cd.prototype,"coordinateSystemService",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RE=Bi(Cd.prototype,"rendererService",[EE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=Bi(Cd.prototype,"mapService",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IE=Bi(Cd.prototype,"layerService",[AE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||TE),PE,OE,_4=(PE=(0,Zt.b2)(),PE(OE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||OE),kE,DE,b4=(kE=(0,Zt.b2)(),kE(DE=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&i.updateStyleAttribute(t,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter");if(s&&s.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,t.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}}]),e}())||DE);Ul.bind(Ct.ILayerPlugin).to(ZI).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(g4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(_k).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(zI).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(a4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(xk).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(b4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(_4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(h4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(y4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(bk).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(f4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(d4).inRequestScope(),Ul.bind(Ct.ILayerPlugin).to(i4).inRequestScope();function x6(e){var r=x4();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function x4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E6=null;function E4(e){var r=S4();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function S4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A4=function(e){(0,je.Z)(t,e);var r=E4(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,F.Z)((0,Le.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,F.Z)((0,Le.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,W.Z)(t,[{key:"getDefault",value:function(i){return(0,j.Z)((0,j.Z)({},ka((0,Ie.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:En.BOTTOMRIGHT,name:"zoom",zoomInText:Xh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Xh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){ka((0,Ie.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=ra("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){Pl(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,s,l,f){var d=ra("button",s,l);return typeof i=="string"?d.innerHTML=i:d.append(i),d.title=a,f&&d.addEventListener("click",f),d}}]),t}(pv);function T4(e){var r=w4();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function w4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LE=function(e){(0,je.Z)(t,e);var r=T4(t);function t(n){var i;(0,ne.Z)(this,t),i=r.call(this),(0,F.Z)((0,Le.Z)(i),"isShow",!0),(0,F.Z)((0,Le.Z)(i),"onMouseMove",function(s){var l,f=i.mapsService.getMapContainer(),d=(l=f==null?void 0:f.getBoundingClientRect())!==null&&l!==void 0?l:{},_=d.left,x=_===void 0?0:_,A=d.top,C=A===void 0?0:A;i.setPopupPosition(s.clientX-x,s.clientY-C)}),(0,F.Z)((0,Le.Z)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var s=i.lngLat,l=s.lng,f=s.lat,d=i.mapsService.lngLatToContainer([l,f]),_=d.x,x=d.y;i.setPopupPosition(_,x)}}),(0,F.Z)((0,Le.Z)(i),"onKeyDown",function(s){s.keyCode===27&&i.remove()}),(0,F.Z)((0,Le.Z)(i),"onCloseButtonClick",function(s){s.stopPropagation&&s.stopPropagation(),i.hide()}),(0,F.Z)((0,Le.Z)(i),"update",function(){var s=!!i.lngLat,l=i.popupOption,f=l.className,d=l.style,_=l.maxWidth,x=l.anchor,A=l.stopPropagation;if(!(!i.mapsService||!s||!i.content)){var C=i.mapsService.getMarkerContainer();if(!i.container&&C&&(i.container=ra("div","l7-popup ".concat(f!=null?f:""," ").concat(i.isShow?"":"l7-popup-hide"),C),d&&i.container.setAttribute("style",d),i.tip=ra("div","l7-popup-tip",i.container),i.container.appendChild(i.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(Z){i.container.addEventListener(Z,function(J){J.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),gu(i.container,"".concat(Ia[x])),Hl(i.container,x,"popup"),_){var I=i.container.getBoundingClientRect(),D=I.width;D>parseFloat(_)&&(i.container.style.width=_)}else i.container.style.removeProperty("width")}}),i.popupOption=(0,j.Z)((0,j.Z)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return(0,W.Z)(t,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(Ct.IMapService),this.sceneService=i.get(Ct.ISceneService),this.layerService=i.get(Ct.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,s=a.html,l=a.text,f=a.title;return s?this.setHTML(s):l&&this.setText(l),f&&this.setTitle(f),this.emit("open"),this}},{key:"remove",value:function(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&ki(this.content),this.container&&(ki(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=(0,j.Z)((0,j.Z)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(ki(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&mu(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&au(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=ra("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Pl(this.contentTitle),ol(this.contentTitle,i)):this.contentTitle&&(ki(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,s=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,s]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:_a.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),ol(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,s=this.mapsService;s&&(s==null||s.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){s==null||s.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,s=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();s&&(s==null||s.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(s==null||s.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&ki(this.content),this.contentTitle=void 0,this.content=ra("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=Xh("l7-icon-guanbi");au(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(s){s.stopPropagation()}),a.addEventListener("pointerdown",function(s){s.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=ra("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){if(this.container){var s=this.popupOption.offsets;this.container.style.left=i+s[0]+"px",this.container.style.top=a-s[1]+"px"}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(Cg.EventEmitter);function S6(e){var r=C4();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function C4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A6=pi.get,T6=null;function R4(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}R4(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item input[type='radio'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -ms-touch-action: none;
      touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);var M4=O(81550),I4=O.n(M4),P4=function(){function e(r,t){(0,ne.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,f=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,W.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Yh,km,Up,Xc,Dm,zp,Lm,r0,oh,Rd,ku,sh,uh,n0,O4=(Yh={},(0,F.Z)(Yh,K.POINTS,"points"),(0,F.Z)(Yh,K.LINES,"lines"),(0,F.Z)(Yh,K.LINE_LOOP,"line loop"),(0,F.Z)(Yh,K.LINE_STRIP,"line strip"),(0,F.Z)(Yh,K.TRIANGLES,"triangles"),(0,F.Z)(Yh,K.TRIANGLE_FAN,"triangle fan"),(0,F.Z)(Yh,K.TRIANGLE_STRIP,"triangle strip"),Yh),BE=(km={},(0,F.Z)(km,K.STATIC_DRAW,"static"),(0,F.Z)(km,K.DYNAMIC_DRAW,"dynamic"),(0,F.Z)(km,K.STREAM_DRAW,"stream"),km),Dy=(Up={},(0,F.Z)(Up,K.BYTE,"int8"),(0,F.Z)(Up,K.INT,"int32"),(0,F.Z)(Up,K.UNSIGNED_BYTE,"uint8"),(0,F.Z)(Up,K.UNSIGNED_SHORT,"uint16"),(0,F.Z)(Up,K.UNSIGNED_INT,"uint32"),(0,F.Z)(Up,K.FLOAT,"float"),Up),k4=(Xc={},(0,F.Z)(Xc,K.ALPHA,"alpha"),(0,F.Z)(Xc,K.LUMINANCE,"luminance"),(0,F.Z)(Xc,K.LUMINANCE_ALPHA,"luminance alpha"),(0,F.Z)(Xc,K.RGB,"rgb"),(0,F.Z)(Xc,K.RGBA,"rgba"),(0,F.Z)(Xc,K.RGBA4,"rgba4"),(0,F.Z)(Xc,K.RGB5_A1,"rgb5 a1"),(0,F.Z)(Xc,K.RGB565,"rgb565"),(0,F.Z)(Xc,K.DEPTH_COMPONENT,"depth"),(0,F.Z)(Xc,K.DEPTH_STENCIL,"depth stencil"),Xc),D4=(Dm={},(0,F.Z)(Dm,K.DONT_CARE,"dont care"),(0,F.Z)(Dm,K.NICEST,"nice"),(0,F.Z)(Dm,K.FASTEST,"fast"),Dm),FE=(zp={},(0,F.Z)(zp,K.NEAREST,"nearest"),(0,F.Z)(zp,K.LINEAR,"linear"),(0,F.Z)(zp,K.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.Z)(zp,K.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.Z)(zp,K.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.Z)(zp,K.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),zp),NE=(Lm={},(0,F.Z)(Lm,K.REPEAT,"repeat"),(0,F.Z)(Lm,K.CLAMP_TO_EDGE,"clamp"),(0,F.Z)(Lm,K.MIRRORED_REPEAT,"mirror"),Lm),L4=(r0={},(0,F.Z)(r0,K.NONE,"none"),(0,F.Z)(r0,K.BROWSER_DEFAULT_WEBGL,"browser"),r0),B4=(oh={},(0,F.Z)(oh,K.NEVER,"never"),(0,F.Z)(oh,K.ALWAYS,"always"),(0,F.Z)(oh,K.LESS,"less"),(0,F.Z)(oh,K.LEQUAL,"lequal"),(0,F.Z)(oh,K.GREATER,"greater"),(0,F.Z)(oh,K.GEQUAL,"gequal"),(0,F.Z)(oh,K.EQUAL,"equal"),(0,F.Z)(oh,K.NOTEQUAL,"notequal"),oh),UE=(Rd={},(0,F.Z)(Rd,K.FUNC_ADD,"add"),(0,F.Z)(Rd,K.MIN_EXT,"min"),(0,F.Z)(Rd,K.MAX_EXT,"max"),(0,F.Z)(Rd,K.FUNC_SUBTRACT,"subtract"),(0,F.Z)(Rd,K.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Rd),i0=(ku={},(0,F.Z)(ku,K.ZERO,"zero"),(0,F.Z)(ku,K.ONE,"one"),(0,F.Z)(ku,K.SRC_COLOR,"src color"),(0,F.Z)(ku,K.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.Z)(ku,K.SRC_ALPHA,"src alpha"),(0,F.Z)(ku,K.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.Z)(ku,K.DST_COLOR,"dst color"),(0,F.Z)(ku,K.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.Z)(ku,K.DST_ALPHA,"dst alpha"),(0,F.Z)(ku,K.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.Z)(ku,K.CONSTANT_COLOR,"constant color"),(0,F.Z)(ku,K.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.Z)(ku,K.CONSTANT_ALPHA,"constant alpha"),(0,F.Z)(ku,K.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.Z)(ku,K.SRC_ALPHA_SATURATE,"src alpha saturate"),ku),F4=(sh={},(0,F.Z)(sh,K.NEVER,"never"),(0,F.Z)(sh,K.ALWAYS,"always"),(0,F.Z)(sh,K.LESS,"less"),(0,F.Z)(sh,K.LEQUAL,"lequal"),(0,F.Z)(sh,K.GREATER,"greater"),(0,F.Z)(sh,K.GEQUAL,"gequal"),(0,F.Z)(sh,K.EQUAL,"equal"),(0,F.Z)(sh,K.NOTEQUAL,"notequal"),sh),Av=(uh={},(0,F.Z)(uh,K.ZERO,"zero"),(0,F.Z)(uh,K.KEEP,"keep"),(0,F.Z)(uh,K.REPLACE,"replace"),(0,F.Z)(uh,K.INVERT,"invert"),(0,F.Z)(uh,K.INCR,"increment"),(0,F.Z)(uh,K.DECR,"decrement"),(0,F.Z)(uh,K.INCR_WRAP,"increment wrap"),(0,F.Z)(uh,K.DECR_WRAP,"decrement wrap"),uh),N4=(n0={},(0,F.Z)(n0,K.FRONT,"front"),(0,F.Z)(n0,K.BACK,"back"),n0),U4=function(){function e(r,t){(0,ne.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:BE[i||K.STATIC_DRAW],type:Dy[a||K.UNSIGNED_BYTE]})}return(0,W.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),z4=function(){function e(r,t){(0,ne.Z)(this,e);var n=t.data,i=t.usage,a=t.type,s=t.count;this.elements=r.elements({data:n,usage:BE[i||K.STATIC_DRAW],type:Dy[a||K.UNSIGNED_BYTE],count:s})}return(0,W.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),Z4=function(){function e(r,t){(0,ne.Z)(this,e);var n=t.width,i=t.height,a=t.color,s=t.colors,l={width:n,height:i};Array.isArray(s)&&(l.colors=s.map(function(f){return f.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=r.framebuffer(l)}return(0,W.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),$c=O(95147),Tv=O(25897),V4=O(81957),kn=O(97582),zE=O(54146),tt;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(tt||(tt={}));var ya;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"})(ya||(ya={}));var Hi;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Hi||(Hi={}));var Bm;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Bm||(Bm={}));var Zl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Zl||(Zl={}));var Ji;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Ji||(Ji={}));var nu;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(nu||(nu={}));var El;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(El||(El={}));var os;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(os||(os={}));var $s;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})($s||($s={}));var ws;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(ws||(ws={}));var to;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(to||(to={}));var bf;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(bf||(bf={}));var Md;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Md||(Md={}));var ZE;(function(e){e.LOADED="loaded"})(ZE||(ZE={}));var Yi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Yi||(Yi={}));var Du;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(Du||(Du={}));var iu;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(iu||(iu={}));var $o;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})($o||($o={}));function w6(e,r,t,n){var i=Yi.TEXTURE_2D,a=1,s=Du.SAMPLED;return{dimension:i,format:e,width:r,height:t,depthOrArrayLayers:a,mipLevelCount:n,usage:s}}var Yo;(function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"})(Yo||(Yo={}));var lh;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(lh||(lh={}));var wv;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(wv||(wv={}));var a0;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(a0||(a0={}));var Mr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Mr||(Mr={}));var zn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(zn||(zn={}));function C6(e){return e}var wn;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(wn||(wn={}));function ti(e,r,t){return e<<16|r<<8|t}var Ot;(function(e){e[e.ALPHA=ti(Mr.U8,zn.A,wn.None)]="ALPHA",e[e.U8_LUMINANCE=ti(Mr.U8,zn.A,wn.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=ti(Mr.F16,zn.A,wn.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=ti(Mr.F32,zn.A,wn.Luminance)]="F32_LUMINANCE",e[e.F16_R=ti(Mr.F16,zn.R,wn.None)]="F16_R",e[e.F16_RG=ti(Mr.F16,zn.RG,wn.None)]="F16_RG",e[e.F16_RGB=ti(Mr.F16,zn.RGB,wn.None)]="F16_RGB",e[e.F16_RGBA=ti(Mr.F16,zn.RGBA,wn.None)]="F16_RGBA",e[e.F32_R=ti(Mr.F32,zn.R,wn.None)]="F32_R",e[e.F32_RG=ti(Mr.F32,zn.RG,wn.None)]="F32_RG",e[e.F32_RGB=ti(Mr.F32,zn.RGB,wn.None)]="F32_RGB",e[e.F32_RGBA=ti(Mr.F32,zn.RGBA,wn.None)]="F32_RGBA",e[e.U8_R=ti(Mr.U8,zn.R,wn.None)]="U8_R",e[e.U8_R_NORM=ti(Mr.U8,zn.R,wn.Normalized)]="U8_R_NORM",e[e.U8_RG=ti(Mr.U8,zn.RG,wn.None)]="U8_RG",e[e.U8_RG_NORM=ti(Mr.U8,zn.RG,wn.Normalized)]="U8_RG_NORM",e[e.U8_RGB=ti(Mr.U8,zn.RGB,wn.None)]="U8_RGB",e[e.U8_RGB_NORM=ti(Mr.U8,zn.RGB,wn.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=ti(Mr.U8,zn.RGB,wn.sRGB|wn.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=ti(Mr.U8,zn.RGBA,wn.None)]="U8_RGBA",e[e.U8_RGBA_NORM=ti(Mr.U8,zn.RGBA,wn.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=ti(Mr.U8,zn.RGBA,wn.sRGB|wn.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=ti(Mr.U16,zn.R,wn.None)]="U16_R",e[e.U16_R_NORM=ti(Mr.U16,zn.R,wn.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=ti(Mr.U16,zn.RG,wn.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=ti(Mr.U16,zn.RGBA,wn.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=ti(Mr.U16,zn.RGBA,wn.None)]="U16_RGBA",e[e.U16_RGB=ti(Mr.U16,zn.RGB,wn.None)]="U16_RGB",e[e.U16_RG=ti(Mr.U16,zn.RG,wn.None)]="U16_RG",e[e.U32_R=ti(Mr.U32,zn.R,wn.None)]="U32_R",e[e.U32_RG=ti(Mr.U32,zn.RG,wn.None)]="U32_RG",e[e.U32_RGB=ti(Mr.U32,zn.RGB,wn.None)]="U32_RGB",e[e.U32_RGBA=ti(Mr.U32,zn.RGBA,wn.None)]="U32_RGBA",e[e.S8_R=ti(Mr.S8,zn.R,wn.None)]="S8_R",e[e.S8_R_NORM=ti(Mr.S8,zn.R,wn.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=ti(Mr.S8,zn.RG,wn.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=ti(Mr.S8,zn.RGB,wn.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=ti(Mr.S8,zn.RGBA,wn.Normalized)]="S8_RGBA_NORM",e[e.S16_R=ti(Mr.S16,zn.R,wn.None)]="S16_R",e[e.S16_RG=ti(Mr.S16,zn.RG,wn.None)]="S16_RG",e[e.S16_RG_NORM=ti(Mr.S16,zn.RG,wn.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=ti(Mr.S16,zn.RGB,wn.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=ti(Mr.S16,zn.RGBA,wn.None)]="S16_RGBA",e[e.S16_RGBA_NORM=ti(Mr.S16,zn.RGBA,wn.Normalized)]="S16_RGBA_NORM",e[e.S32_R=ti(Mr.S32,zn.R,wn.None)]="S32_R",e[e.S32_RG=ti(Mr.S32,zn.RG,wn.None)]="S32_RG",e[e.S32_RGB=ti(Mr.S32,zn.RGB,wn.None)]="S32_RGB",e[e.S32_RGBA=ti(Mr.S32,zn.RGBA,wn.None)]="S32_RGBA",e[e.U16_RGBA_5551=ti(Mr.U16_PACKED_5551,zn.RGBA,wn.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=ti(Mr.U16_PACKED_565,zn.RGB,wn.Normalized)]="U16_RGB_565",e[e.BC1=ti(Mr.BC1,zn.RGBA,wn.Normalized)]="BC1",e[e.BC1_SRGB=ti(Mr.BC1,zn.RGBA,wn.Normalized|wn.sRGB)]="BC1_SRGB",e[e.BC2=ti(Mr.BC2,zn.RGBA,wn.Normalized)]="BC2",e[e.BC2_SRGB=ti(Mr.BC2,zn.RGBA,wn.Normalized|wn.sRGB)]="BC2_SRGB",e[e.BC3=ti(Mr.BC3,zn.RGBA,wn.Normalized)]="BC3",e[e.BC3_SRGB=ti(Mr.BC3,zn.RGBA,wn.Normalized|wn.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=ti(Mr.BC4_UNORM,zn.R,wn.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=ti(Mr.BC4_SNORM,zn.R,wn.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=ti(Mr.BC5_UNORM,zn.RG,wn.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=ti(Mr.BC5_SNORM,zn.RG,wn.Normalized)]="BC5_SNORM",e[e.D24=ti(Mr.D24,zn.R,wn.Depth)]="D24",e[e.D24_S8=ti(Mr.D24S8,zn.RG,wn.Depth|wn.Stencil)]="D24_S8",e[e.D32F=ti(Mr.D32F,zn.R,wn.Depth)]="D32F",e[e.D32F_S8=ti(Mr.D32FS8,zn.RG,wn.Depth|wn.Stencil)]="D32F_S8",e[e.U8_RGB_RT=ti(Mr.U8,zn.RGB,wn.RenderTarget|wn.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=ti(Mr.U8,zn.RGBA,wn.RenderTarget|wn.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=ti(Mr.U8,zn.RGBA,wn.RenderTarget|wn.Normalized|wn.sRGB)]="U8_RGBA_RT_SRGB"})(Ot||(Ot={}));function o0(e){return e>>>8&255}function ch(e){return e>>>16&255}function Cv(e){return e&255}function VE(e){switch(e){case Mr.F32:case Mr.U32:case Mr.S32:return 4;case Mr.U16:case Mr.S16:case Mr.F16:return 2;case Mr.U8:case Mr.S8:return 1;default:throw new Error("whoops")}}function jE(e){return VE(ch(e))}function R6(e){return o0(e)}function j4(e){var r=VE(ch(e)),t=o0(e);return r*t}function M6(e,r){return e&4294967040|r}function I6(e,r){return e&4294902015|r<<8}function HE(e){var r=Cv(e);if(r&wn.Depth)return Yo.Depth;if(r&wn.Normalized)return Yo.Float;var t=ch(e);if(t===Mr.F16||t===Mr.F32)return Yo.Float;if(t===Mr.U8||t===Mr.U16||t===Mr.U32)return Yo.Uint;if(t===Mr.S8||t===Mr.S16||t===Mr.S32)return Yo.Sint;throw new Error("whoops")}function Oi(e,r){if(r===void 0&&(r=""),!e)throw new Error("Assert fail: ".concat(r))}function Id(e){if(e!=null)return e;throw new Error("Missing object")}function WE(e,r){return e.r===r.r&&e.g===r.g&&e.b===r.b&&e.a===r.a}function GE(e,r){e.r=r.r,e.g=r.g,e.b=r.b,e.a=r.a}function XE(e){var r=e.r,t=e.g,n=e.b,i=e.a;return{r,g:t,b:n,a:i}}function Fm(e,r,t,n){return n===void 0&&(n=1),{r:e,g:r,b:t,a:n}}var s0=Fm(0,0,0,0),P6=Fm(0,0,0,1),H4=Fm(1,1,1,0),O6=Fm(1,1,1,1),Rv=!0;function k6(e,r){r===void 0&&(r=Rv),r&&(e[10]=-e[10],e[14]=-e[14])}function D6(e,r){r===void 0&&(r=Rv),r&&(e[10]=-e[10],e[14]=-e[14]+1)}function W4(e,r){if(r===void 0&&(r=Rv),r)switch(e){case Hi.LESS:return Hi.GREATER;case Hi.LEQUAL:return Hi.GEQUAL;case Hi.GEQUAL:return Hi.LEQUAL;case Hi.GREATER:return Hi.LESS;default:return e}else return e}function L6(e,r){return r===void 0&&(r=Rv),r?1-e:e}function B6(e,r){return r===void 0&&(r=Rv),r?-e:e}function F6(e,r,t,n){if(n===void 0&&(n=Rv),t=W4(t,n),t===Hi.LESS)return e<r;if(t===Hi.LEQUAL)return e<=r;if(t===Hi.GREATER)return e>r;if(t===Hi.GEQUAL)return e>=r;throw new Error("whoops")}function u0(e){return!!(e&&!(e&e-1))}function Mv(e,r){return e!=null?e:r}function G4(e){return e===void 0?null:e}function N6(e,r,t){e.length=r,e.fill(t)}function l0(e,r){var t=r-1;return e+t&~t}function U6(e,r){return((e+r-1)/r|0)*r}function X4(e,r,t){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),s=t(r,e[a]);s<0?i=a:n=a+1}return n}function z6(e,r,t){var n=X4(e,r,t);e.splice(n,0,r)}function Z6(e,r,t){return t?e|=r:e&=~r,e}function $4(e,r){for(var t=new Array(e),n=0;n<e;n++)t[n]=r();return t}function Y4(e,r){r===void 0&&(r=1);var t=e.split(`
`);return t.map(function(n,i){return"".concat(q4(""+(r+i),4," "),"  ").concat(n)}).join(`
`)}function q4(e,r,t){for(t===void 0&&(t="0");e.length<r;)e="".concat(t).concat(e);return e}function V6(e,r){for(var t=[],n=e;n<e+r;n++)t.push(n);return t}function $E(e,r){e.blendDstFactor=r.blendDstFactor,e.blendSrcFactor=r.blendSrcFactor,e.blendMode=r.blendMode}function c0(e,r){return e===void 0&&(e={}),e.compare=r.compare,e.depthFailOp=r.depthFailOp,e.passOp=r.passOp,e.failOp=r.failOp,e.mask=r.mask,e}function YE(e,r){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),$E(e.rgbBlendState,r.rgbBlendState),$E(e.alphaBlendState,r.alphaBlendState),e.channelWriteMask=r.channelWriteMask,e}function Ly(e,r){e.length!==r.length&&(e.length=r.length);for(var t=0;t<r.length;t++)e[t]=YE(e[t],r[t])}function K4(e,r){r.attachmentsState!==void 0&&Ly(e.attachmentsState,r.attachmentsState),e.blendConstant&&r.blendConstant&&GE(e.blendConstant,r.blendConstant),e.depthCompare=Mv(r.depthCompare,e.depthCompare),e.depthWrite=Mv(r.depthWrite,e.depthWrite),e.stencilWrite=Mv(r.stencilWrite,e.stencilWrite),e.stencilFront&&r.stencilFront&&c0(e.stencilFront,r.stencilFront),e.stencilBack&&r.stencilBack&&c0(e.stencilBack,r.stencilBack),e.cullMode=Mv(r.cullMode,e.cullMode),e.frontFace=Mv(r.frontFace,e.frontFace),e.polygonOffset=Mv(r.polygonOffset,e.polygonOffset)}function Iv(e){var r=Object.assign({},e);return r.attachmentsState=[],Ly(r.attachmentsState,e.attachmentsState),r.blendConstant=r.blendConstant&&XE(r.blendConstant),r.stencilFront=c0(void 0,e.stencilFront),r.stencilBack=c0(void 0,e.stencilBack),r}function Q4(e,r){r.channelWriteMask!==void 0&&(e.channelWriteMask=r.channelWriteMask),r.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=r.rgbBlendMode),r.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=r.alphaBlendMode),r.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=r.rgbBlendSrcFactor),r.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=r.alphaBlendSrcFactor),r.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=r.rgbBlendDstFactor),r.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=r.alphaBlendDstFactor)}var qE={blendMode:nu.ADD,blendSrcFactor:Ji.ONE,blendDstFactor:Ji.ZERO},Pd={attachmentsState:[{channelWriteMask:iu.ALL,rgbBlendState:qE,alphaBlendState:qE}],blendConstant:XE(s0),depthWrite:!0,depthCompare:Hi.LEQUAL,stencilWrite:!1,stencilFront:{compare:Hi.ALWAYS,passOp:$o.KEEP,depthFailOp:$o.KEEP,failOp:$o.KEEP},stencilBack:{compare:Hi.ALWAYS,passOp:$o.KEEP,depthFailOp:$o.KEEP,failOp:$o.KEEP},cullMode:Zl.NONE,frontFace:Bm.CCW,polygonOffset:!1};function J4(e,r){e===void 0&&(e=null),r===void 0&&(r=Pd);var t=Iv(r);return e!==null&&K4(t,e),t}var j6=J4({depthCompare:Hi.ALWAYS,depthWrite:!1},Pd);function H6(e,r){return e.attachmentsState===void 0&&(e.attachmentsState=[],Ly(e.attachmentsState,Pd.attachmentsState)),Q4(e.attachmentsState[0],r),e}var KE={texture:null,sampler:null,formatKind:Yo.Float,dimension:Yi.TEXTURE_2D};function Zp(e,r,t){if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}function Pv(e,r){for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=r(e[n]);return t}function e5(e,r){return e.texture===r.texture&&e.binding===r.binding}function QE(e,r){return e.buffer===r.buffer&&e.size===r.size&&e.binding===r.binding&&e.offset===r.offset}function t5(e,r){return e===null?r===null:r===null?!1:e.sampler===r.sampler&&e.texture===r.texture&&e.dimension===r.dimension&&e.formatKind===r.formatKind&&e.comparison===r.comparison}function r5(e,r){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],r.storageBufferBindings=r.storageBufferBindings||[],r.storageTextureBindings=r.storageTextureBindings||[],!(e.samplerBindings.length!==r.samplerBindings.length||!Zp(e.samplerBindings,r.samplerBindings,t5)||!Zp(e.uniformBufferBindings,r.uniformBufferBindings,QE)||!Zp(e.storageBufferBindings,r.storageBufferBindings,QE)||!Zp(e.storageTextureBindings,r.storageTextureBindings,e5))}function JE(e,r){return e.blendMode==r.blendMode&&e.blendSrcFactor===r.blendSrcFactor&&e.blendDstFactor===r.blendDstFactor}function n5(e,r){return!(!JE(e.rgbBlendState,r.rgbBlendState)||!JE(e.alphaBlendState,r.alphaBlendState)||e.channelWriteMask!==r.channelWriteMask)}function f0(e,r){return e.compare==r.compare&&e.depthFailOp===r.depthFailOp&&e.failOp===r.failOp&&e.passOp===r.passOp&&e.mask===r.mask}function i5(e,r){return!Zp(e.attachmentsState,r.attachmentsState,n5)||e.blendConstant&&r.blendConstant&&!WE(e.blendConstant,r.blendConstant)||e.stencilFront&&r.stencilFront&&!f0(e.stencilFront,r.stencilFront)||e.stencilBack&&r.stencilBack&&!f0(e.stencilBack,r.stencilBack)?!1:e.depthCompare===r.depthCompare&&e.depthWrite===r.depthWrite&&e.stencilWrite===r.stencilWrite&&e.cullMode===r.cullMode&&e.frontFace===r.frontFace&&e.polygonOffset===r.polygonOffset}function eS(e,r){return e.id===r.id}function a5(e,r){return e===r}function o5(e,r){return!(e.topology!==r.topology||e.inputLayout!==r.inputLayout||e.sampleCount!==r.sampleCount||e.megaStateDescriptor&&r.megaStateDescriptor&&!i5(e.megaStateDescriptor,r.megaStateDescriptor)||!eS(e.program,r.program)||!Zp(e.colorAttachmentFormats,r.colorAttachmentFormats,a5)||e.depthStencilAttachmentFormat!==r.depthStencilAttachmentFormat)}function s5(e,r){return e.offset===r.offset&&e.shaderLocation===r.shaderLocation&&e.format===r.format&&e.divisor===r.divisor}function u5(e,r){return(0,$c.Z)(e)?(0,$c.Z)(r):(0,$c.Z)(r)?!1:e.arrayStride===r.arrayStride&&e.stepMode===r.stepMode&&Zp(e.attributes,r.attributes,s5)}function l5(e,r){return!(e.indexBufferFormat!==r.indexBufferFormat||!Zp(e.vertexBufferDescriptors,r.vertexBufferDescriptors,u5)||!eS(e.program,r.program))}function W6(e,r){return e.addressModeU===r.addressModeU&&e.addressModeV===r.addressModeV&&e.minFilter===r.minFilter&&e.magFilter===r.magFilter&&e.mipmapFilter===r.mipmapFilter&&e.lodMinClamp===r.lodMinClamp&&e.lodMaxClamp===r.lodMaxClamp&&e.maxAnisotropy===r.maxAnisotropy&&e.compareFunction===r.compareFunction}function c5(e){var r=e.sampler,t=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:r,texture:t,dimension:n,formatKind:i,comparison:a}}function tS(e){var r=e.buffer,t=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:r,offset:i,size:t}}function f5(e){var r=e.binding,t=e.texture;return{binding:r,texture:t}}function h5(e){var r=e.samplerBindings&&Pv(e.samplerBindings,c5),t=e.uniformBufferBindings&&Pv(e.uniformBufferBindings,tS),n=e.storageBufferBindings&&Pv(e.storageBufferBindings,tS),i=e.storageTextureBindings&&Pv(e.storageTextureBindings,f5);return{samplerBindings:r,uniformBufferBindings:t,storageBufferBindings:n,storageTextureBindings:i,pipeline:e.pipeline}}function p5(e){var r=e.inputLayout,t=e.program,n=e.topology,i=e.megaStateDescriptor&&Iv(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:r,megaStateDescriptor:i,program:t,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:s,sampleCount:l}}function d5(e){var r=e.shaderLocation,t=e.format,n=e.offset,i=e.divisor;return{shaderLocation:r,format:t,offset:n,divisor:i}}function v5(e){if((0,$c.Z)(e))return e;var r=e.arrayStride,t=e.stepMode,n=Pv(e.attributes,d5);return{arrayStride:r,stepMode:t,attributes:n}}function m5(e){var r=Pv(e.vertexBufferDescriptors,v5),t=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:r,indexBufferFormat:t,program:n}}var la,g5=/([^[]*)(\[[0-9]+\])?/;function y5(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var r=e.match(g5);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:Number(r[2])||1,isArray:!!r[2]}}function Sl(){var e=null;return function(r,t,n){var i=e!==n;return i&&(r.uniform1i(t,n),e=n),i}}function qo(e,r,t,n){var i=null,a=null;return function(s,l,f){var d=r(f,t),_=d.length,x=!1;if(i===null)i=new Float32Array(_),a=_,x=!0;else{Oi(a===_,"Uniform length cannot change.");for(var A=0;A<_;++A)if(d[A]!==i[A]){x=!0;break}}return x&&(n(s,e,l,d),i.set(d)),x}}function Ju(e,r,t,n){e[r](t,n)}function qh(e,r,t,n){e[r](t,!1,n)}var _5={},b5={},x5={},rS=[0];function By(e,r,t,n){r===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(rS[0]=e,e=rS);var i=e.length;if(e instanceof t)return e;var a=n[i];a||(a=new t(i),n[i]=a);for(var s=0;s<i;s++)a[s]=e[s];return a}function yc(e,r){return By(e,r,Float32Array,_5)}function Vp(e,r){return By(e,r,Int32Array,b5)}function h0(e,r){return By(e,r,Uint32Array,x5)}var E5=(la={},la[tt.FLOAT]=qo.bind(null,"uniform1fv",yc,1,Ju),la[tt.FLOAT_VEC2]=qo.bind(null,"uniform2fv",yc,2,Ju),la[tt.FLOAT_VEC3]=qo.bind(null,"uniform3fv",yc,3,Ju),la[tt.FLOAT_VEC4]=qo.bind(null,"uniform4fv",yc,4,Ju),la[tt.INT]=qo.bind(null,"uniform1iv",Vp,1,Ju),la[tt.INT_VEC2]=qo.bind(null,"uniform2iv",Vp,2,Ju),la[tt.INT_VEC3]=qo.bind(null,"uniform3iv",Vp,3,Ju),la[tt.INT_VEC4]=qo.bind(null,"uniform4iv",Vp,4,Ju),la[tt.BOOL]=qo.bind(null,"uniform1iv",Vp,1,Ju),la[tt.BOOL_VEC2]=qo.bind(null,"uniform2iv",Vp,2,Ju),la[tt.BOOL_VEC3]=qo.bind(null,"uniform3iv",Vp,3,Ju),la[tt.BOOL_VEC4]=qo.bind(null,"uniform4iv",Vp,4,Ju),la[tt.FLOAT_MAT2]=qo.bind(null,"uniformMatrix2fv",yc,4,qh),la[tt.FLOAT_MAT3]=qo.bind(null,"uniformMatrix3fv",yc,9,qh),la[tt.FLOAT_MAT4]=qo.bind(null,"uniformMatrix4fv",yc,16,qh),la[tt.UNSIGNED_INT]=qo.bind(null,"uniform1uiv",h0,1,Ju),la[tt.UNSIGNED_INT_VEC2]=qo.bind(null,"uniform2uiv",h0,2,Ju),la[tt.UNSIGNED_INT_VEC3]=qo.bind(null,"uniform3uiv",h0,3,Ju),la[tt.UNSIGNED_INT_VEC4]=qo.bind(null,"uniform4uiv",h0,4,Ju),la[tt.FLOAT_MAT2x3]=qo.bind(null,"uniformMatrix2x3fv",yc,6,qh),la[tt.FLOAT_MAT2x4]=qo.bind(null,"uniformMatrix2x4fv",yc,8,qh),la[tt.FLOAT_MAT3x2]=qo.bind(null,"uniformMatrix3x2fv",yc,6,qh),la[tt.FLOAT_MAT3x4]=qo.bind(null,"uniformMatrix3x4fv",yc,12,qh),la[tt.FLOAT_MAT4x2]=qo.bind(null,"uniformMatrix4x2fv",yc,8,qh),la[tt.FLOAT_MAT4x3]=qo.bind(null,"uniformMatrix4x3fv",yc,12,qh),la[tt.SAMPLER_2D]=Sl,la[tt.SAMPLER_CUBE]=Sl,la[tt.SAMPLER_3D]=Sl,la[tt.SAMPLER_2D_SHADOW]=Sl,la[tt.SAMPLER_2D_ARRAY]=Sl,la[tt.SAMPLER_2D_ARRAY_SHADOW]=Sl,la[tt.SAMPLER_CUBE_SHADOW]=Sl,la[tt.INT_SAMPLER_2D]=Sl,la[tt.INT_SAMPLER_3D]=Sl,la[tt.INT_SAMPLER_CUBE]=Sl,la[tt.INT_SAMPLER_2D_ARRAY]=Sl,la[tt.UNSIGNED_INT_SAMPLER_2D]=Sl,la[tt.UNSIGNED_INT_SAMPLER_3D]=Sl,la[tt.UNSIGNED_INT_SAMPLER_CUBE]=Sl,la[tt.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Sl,la);function nS(e,r,t){var n=E5[t.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(t.type));return n().bind(null,e,r)}var S5={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function A5(e){return Object.prototype.toString.call(e)in S5}function Nm(e,r){return"#define ".concat(e," ").concat(r)}function T5(e){var r={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(t,n,i){var a=Number(i);return r[n]=isNaN(a)?i:a,""}),r}function w5(e,r){var t=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var s=Number(i);return t.push({location:isNaN(s)?r[i]:s,name:a}),""}),t}function G6(e){var r=[],t=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var s=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var f=__read(l.trim().split(/\s+/),2),d=f[0],_=f[1];s.push({type:d.trim(),name:_.replace(";","").trim()})}),t.push({type:i.trim(),uniforms:s}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var s=a.trim().split(" "),l=s[0]||"",f=s[1]||"",d=f.indexOf("[")>-1;if(f=f.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var _=t.find(function(C){return l===C.type});if(_)if(d)for(var x=function(C){_.uniforms.forEach(function(I){r.push("".concat(f,"[").concat(C,"].").concat(I.name))})},A=0;A<5;A++)x(A);else _.uniforms.forEach(function(C){r.push("".concat(f,".").concat(C.name))})}f&&r.push(f)}}),""}),r}function iS(e){if(e===void 0)return null;var r=/binding\s*=\s*(\d+)/.exec(e);if(r!==null){var t=parseInt(r[1],10);if(!Number.isNaN(t))return t}return null}function C5(e){var r="",t=e;return[t,r]}function jp(e,r,t,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var s=e.glslVersion==="#version 100",l=r==="frag"&&((a=t.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,f=t.replace(`\r
`,`
`).split(`
`).map(function(pt){return pt.replace(/[/][/].*$/,"")}).filter(function(pt){var et=!pt||/^\s+$/.test(pt);return!et}),d="";n!==null&&(d=Object.keys(n).map(function(pt){return Nm(pt,n[pt])}).join(`
`));var _=f.find(function(pt){return pt.startsWith("precision")})||"precision mediump float;",x=i?f.filter(function(pt){return!pt.startsWith("precision")}).join(`
`):f.join(`
`),A="";if(e.viewportOrigin===lh.UPPER_LEFT&&(A+="".concat(Nm("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===wv.ZERO&&(A+="".concat(Nm("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var C=0,I=0,D=0;x=x.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(pt,et,Pt,jt){var Ar=Pt?"".concat(Pt,", "):"";return"layout(".concat(Ar,"set = ").concat(C,", binding = ").concat(I++,") uniform ").concat(jt)}),C++,I=0,Oi(e.separateSamplerTextures),x=x.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(pt,et,Pt,jt,Ar){var gr=iS(Pt);gr===null&&(gr=I++);var Xr=(0,kn.CR)(C5(jt),2),mn=Xr[0],qn=Xr[1];return r==="frag"?`
layout(set = `.concat(C,", binding = ").concat(gr*2+0,") uniform texture").concat(mn," T_").concat(Ar,`;
layout(set = `).concat(C,", binding = ").concat(gr*2+1,") uniform sampler").concat(qn," S_").concat(Ar,";").trim():""}),x=x.replace(r==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(pt,et){return"layout(location = ".concat(D++,") ").concat(et)}),A+="".concat(Nm("gl_VertexID","gl_VertexIndex"),`
`),A+="".concat(Nm("gl_InstanceID","gl_InstanceIndex"),`
`),_=_.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var Z=0;x=x.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(pt,et,Pt,jt,Ar){var gr=iS(Pt);return gr===null&&(gr=Z++),"uniform sampler".concat(jt," ").concat(Ar,"; // BINDING=").concat(gr)})}if(e.separateSamplerTextures)x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(pt,et,Pt){return"sampler".concat(et,"(T_").concat(Pt,", S_").concat(Pt,")")}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(pt,et){return"T_".concat(et)});else{var J=[];x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(pt,et,Pt){return J.push([Pt,et]),Pt}),s&&J.forEach(function(pt){var et=(0,kn.CR)(pt,2),Pt=et[0],jt=et[1];x=x.replace(new RegExp("texture\\(".concat(Pt),"g"),function(){return"texture".concat(jt,"(").concat(Pt)})}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(pt,et){return et})}var ce="".concat(s?"":e.glslVersion,`
`).concat(s&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(s&&r==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?_:"",`
`).concat(A||"").concat(d?d+`
`:"",`
`).concat(x,`
`).trim();if(e.explicitBindingLocations&&r==="frag"&&(ce=ce.replace(/^\b(out)\b/g,function(pt,et){return"layout(location = 0) ".concat(et)})),s){if(r==="frag"&&(ce=ce.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(pt,et,Pt){return"varying ".concat(et," ").concat(Pt,`;
`)})),r==="vert"&&(ce=ce.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(pt,et,Pt){return"varying ".concat(et," ").concat(Pt,`;
`)}),ce=ce.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(pt,et,Pt){return"attribute ".concat(et," ").concat(Pt,`;
`)})),ce=ce.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(pt,et){return et.trim().replace(/^.*$/gm,function(Pt){var jt=Pt.trim();return jt.startsWith("#")?jt:Pt?"uniform ".concat(jt):""})}),r==="frag")if(l){var xe=[];ce=ce.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(pt,et){return xe.push(et),"vec4 ".concat(et,`;
`)});var Xe=ce.lastIndexOf("}");ce=ce.substring(0,Xe)+`
    `.concat(xe.map(function(pt,et){return"gl_FragData[".concat(et,"] = ").concat(pt,`;
    `)}).join(`
`))+ce.substring(Xe)}else{var bt;if(ce=ce.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(pt,et,Pt){return bt=Pt,"".concat(et," ").concat(Pt,`;
`)}),bt){var Xe=ce.lastIndexOf("}");ce=ce.substring(0,Xe)+`
  gl_FragColor = vec4(`.concat(bt,`);
`)+ce.substring(Xe)}}ce=ce.replace(/^\s*layout\((.*)\)/gm,"")}return ce}function X6(e,r,t,n){n===void 0&&(n=null);var i=jp(e,"vert",r,n),a=jp(e,"frag",t,n);return{vert:r,frag:t,preprocessedVert:i,preprocessedFrag:a}}var Yc=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return r.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},r}(zE.Z),R5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Bindings;var l=a.uniformBufferBindings,f=a.samplerBindings;return s.uniformBufferBindings=l||[],s.samplerBindings=f||[],s.bindingLayouts=s.createBindingLayouts(),s}return r.prototype.createBindingLayouts=function(){var t=0,n=0,i=[],a=this.uniformBufferBindings.length,s=this.samplerBindings.length;return i.push({firstUniformBuffer:t,numUniformBuffers:a,firstSampler:n,numSamplers:s}),t+=a,n+=s,{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:i}},r}(Yc);function Xn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function aS(e){var r=ch(e);switch(r){case Mr.BC1:case Mr.BC2:case Mr.BC3:case Mr.BC4_UNORM:case Mr.BC4_SNORM:case Mr.BC5_UNORM:case Mr.BC5_SNORM:return!0;default:return!1}}function oS(e){var r=Cv(e);if(r&wn.Normalized)return!1;var t=ch(e);return t===Mr.S8||t===Mr.S16||t===Mr.S32||t===Mr.U8||t===Mr.U16||t===Mr.U32}function M5(e){switch(e){case bf.STATIC:return tt.STATIC_DRAW;case bf.DYNAMIC:return tt.DYNAMIC_DRAW}}function sS(e){if(e&to.INDEX)return tt.ELEMENT_ARRAY_BUFFER;if(e&to.VERTEX)return tt.ARRAY_BUFFER;if(e&to.UNIFORM)return tt.UNIFORM_BUFFER}function I5(e){switch(e){case ws.TRIANGLES:return tt.TRIANGLES;case ws.POINTS:return tt.POINTS;case ws.TRIANGLE_STRIP:return tt.TRIANGLE_STRIP;case ws.LINES:return tt.LINES;case ws.LINE_STRIP:return tt.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function P5(e){switch(e){case Mr.U8:return tt.UNSIGNED_BYTE;case Mr.U16:return tt.UNSIGNED_SHORT;case Mr.U32:return tt.UNSIGNED_INT;case Mr.S8:return tt.BYTE;case Mr.S16:return tt.SHORT;case Mr.S32:return tt.INT;case Mr.F16:return tt.HALF_FLOAT;case Mr.F32:return tt.FLOAT;default:throw new Error("whoops")}}function O5(e){switch(e){case zn.R:return 1;case zn.RG:return 2;case zn.RGB:return 3;case zn.RGBA:return 4;default:return 1}}function k5(e){var r=ch(e),t=o0(e),n=Cv(e),i=P5(r),a=O5(t),s=!!(n&wn.Normalized);return{size:a,type:i,normalized:s}}function D5(e){switch(e){case Ot.U8_R:return tt.UNSIGNED_BYTE;case Ot.U16_R:return tt.UNSIGNED_SHORT;case Ot.U32_R:return tt.UNSIGNED_INT;default:throw new Error("whoops")}}function Um(e){switch(e){case El.CLAMP_TO_EDGE:return tt.CLAMP_TO_EDGE;case El.REPEAT:return tt.REPEAT;case El.MIRRORED_REPEAT:return tt.MIRRORED_REPEAT;default:throw new Error("whoops")}}function p0(e,r){if(r===$s.LINEAR&&e===os.BILINEAR)return tt.LINEAR_MIPMAP_LINEAR;if(r===$s.LINEAR&&e===os.POINT)return tt.NEAREST_MIPMAP_LINEAR;if(r===$s.NEAREST&&e===os.BILINEAR)return tt.LINEAR_MIPMAP_NEAREST;if(r===$s.NEAREST&&e===os.POINT)return tt.NEAREST_MIPMAP_NEAREST;if(r===$s.NO_MIP&&e===os.BILINEAR)return tt.LINEAR;if(r===$s.NO_MIP&&e===os.POINT)return tt.NEAREST;throw new Error("Unknown texture filter mode")}function Ov(e,r){r===void 0&&(r=0);var t=e;return t.gl_buffer_pages[r/t.pageByteSize|0]}function kv(e){var r=e;return r.gl_texture}function Fy(e){var r=e;return r.gl_sampler}function zm(e,r){e.name=r,e.__SPECTOR_Metadata={name:r}}function uS(e,r){for(var t=[];;){var n=r.exec(e);if(!n)break;t.push(n)}return t}function Hp(e){return e.blendMode==nu.ADD&&e.blendSrcFactor==Ji.ONE&&e.blendDstFactor===Ji.ZERO}function L5(e){switch(e){case a0.OcclusionConservative:return tt.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function B5(e){if(e===Yi.TEXTURE_2D)return tt.TEXTURE_2D;if(e===Yi.TEXTURE_2D_ARRAY)return tt.TEXTURE_2D_ARRAY;if(e===Yi.TEXTURE_CUBE_MAP)return tt.TEXTURE_CUBE_MAP;if(e===Yi.TEXTURE_3D)return tt.TEXTURE_3D;throw new Error("whoops")}function Ny(e,r,t,n){return!(e%t!==0||r%n!==0)}var F5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Buffer;var l=a.viewOrSize,f=a.usage,d=a.hint,_=d===void 0?bf.STATIC:d,x=i.uniformBufferMaxPageByteSize,A=i.gl,C=f&to.UNIFORM;C||(Xn(A)?A.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var I=(0,Tv.Z)(l)?l0(l,4):l0(l.byteLength,4);s.gl_buffer_pages=[];var D;if(C){for(var Z=I;Z>0;)s.gl_buffer_pages.push(s.createBufferPage(Math.min(Z,x),f,_)),Z-=x;D=x}else s.gl_buffer_pages.push(s.createBufferPage(I,f,_)),D=I;return s.pageByteSize=D,s.byteSize=I,s.usage=f,s.gl_target=sS(f),(0,Tv.Z)(l)||s.setSubData(0,new Uint8Array(l.buffer)),C||(Xn(A)?A.bindVertexArray(s.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(s.device.currentBoundVAO)),s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var s=this.device.gl,l=this.pageByteSize,f=t+a,d=t,_=t%l;d<f;){var x=Xn(s)?s.COPY_WRITE_BUFFER:this.gl_target,A=Ov(this,d);if(A.ubo)return;s.bindBuffer(x,A),Xn(s)?s.bufferSubData(x,_,n,i,Math.min(f-d,l)):s.bufferSubData(x,_,n),d+=l,_=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},r.prototype.createBufferPage=function(t,n,i){var a=this.device.gl,s=n&to.UNIFORM;if(!Xn(a)&&s)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),f=sS(n),d=M5(i);return a.bindBuffer(f,l),a.bufferData(f,t,d),l},r}(Yc),N5=function(e){(0,kn.ZT)(r,e);function r(t){var n,i,a,s,l=t.id,f=t.device,d=t.descriptor,_,x=e.call(this,{id:l,device:f})||this;x.type=ya.InputLayout;var A=d.vertexBufferDescriptors,C=d.indexBufferFormat,I=d.program;Oi(C===Ot.U16_R||C===Ot.U32_R||C===null);var D=C!==null?D5(C):null,Z=C!==null?jE(C):null,J=x.device.gl,ce=x.device.ensureResourceExists(Xn(J)?J.createVertexArray():f.OES_vertex_array_object.createVertexArrayOES());Xn(J)?J.bindVertexArray(ce):f.OES_vertex_array_object.bindVertexArrayOES(ce),J.bindBuffer(J.ARRAY_BUFFER,Ov(x.device.fallbackVertexBuffer));try{for(var xe=(0,kn.XA)(d.vertexBufferDescriptors),Xe=xe.next();!Xe.done;Xe=xe.next()){var bt=Xe.value,pt=bt.stepMode,et=bt.attributes;try{for(var Pt=(a=void 0,(0,kn.XA)(et)),jt=Pt.next();!jt.done;jt=Pt.next()){var Ar=jt.value,gr=Ar.shaderLocation,Xr=Ar.format,mn=Ar.divisor,qn=mn===void 0?1:mn,ea=Xn(J)?gr:(_=I.attributes[gr])===null||_===void 0?void 0:_.location,Ma=k5(Xr);if(Ar.vertexFormat=Ma,!(0,$c.Z)(ea)){oS(Xr);var Ko=Ma.size,Vo=Ma.type,qs=Ma.normalized;J.vertexAttribPointer(ea,Ko,Vo,qs,0,0),pt===Md.INSTANCE&&(Xn(J)?J.vertexAttribDivisor(ea,qn):f.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(ea,qn)),J.enableVertexAttribArray(ea)}}}catch(Al){a={error:Al}}finally{try{jt&&!jt.done&&(s=Pt.return)&&s.call(Pt)}finally{if(a)throw a.error}}}}catch(Al){n={error:Al}}finally{try{Xe&&!Xe.done&&(i=xe.return)&&i.call(xe)}finally{if(n)throw n.error}}return Xn(J)?J.bindVertexArray(null):f.OES_vertex_array_object.bindVertexArrayOES(null),x.vertexBufferDescriptors=A,x.vao=ce,x.indexBufferFormat=C,x.indexBufferType=D,x.indexBufferCompByteSize=Z,x.program=I,x}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Xn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},r}(Yc),Uy=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.fake,l=e.call(this,{id:n,device:i})||this;l.type=ya.Texture,a=(0,kn.pi)({dimension:Yi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var f=l.device.gl,d,_,x=l.clampmipLevelCount(a);if(l.immutable=a.usage===Du.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=HE(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=x>=1,!s){_=l.device.ensureResourceExists(f.createTexture());var A=l.device.translateTextureType(a.format),C=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(f.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===Yi.TEXTURE_2D){if(d=tt.TEXTURE_2D,f.bindTexture(d,_),l.immutable)if(Xn(f))f.texStorage2D(d,x,C,a.width,a.height);else{var I=(C===tt.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===Ot.D32F||l.format===Ot.D24_S8)&&!Xn(f)&&!i.WEBGL_depth_texture||(f.texImage2D(d,I,C,a.width,a.height,0,C,A,null),l.mipmaps&&(l.mipmaps=!1,f.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_MIN_FILTER,tt.LINEAR),f.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_S,tt.CLAMP_TO_EDGE),f.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_T,tt.CLAMP_TO_EDGE)))}Oi(a.depthOrArrayLayers===1)}else if(a.dimension===Yi.TEXTURE_2D_ARRAY)d=tt.TEXTURE_2D_ARRAY,f.bindTexture(d,_),l.immutable&&Xn(f)&&f.texStorage3D(d,x,C,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Yi.TEXTURE_3D)d=tt.TEXTURE_3D,f.bindTexture(d,_),l.immutable&&Xn(f)&&f.texStorage3D(d,x,C,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Yi.TEXTURE_CUBE_MAP)d=tt.TEXTURE_CUBE_MAP,f.bindTexture(d,_),l.immutable&&Xn(f)&&f.texStorage2D(d,x,C,a.width,a.height),Oi(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=_,l.gl_target=d,l.mipLevelCount=x,l}return r.prototype.setImageData=function(t,n){n===void 0&&(n=0);var i=this.device.gl;aS(this.format);var a=this.gl_target===tt.TEXTURE_3D||this.gl_target===tt.TEXTURE_2D_ARRAY,s=this.gl_target===tt.TEXTURE_CUBE_MAP,l=A5(t[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var f=t[0],d,_;l?(d=this.width,_=this.height):(d=f.width,_=f.height,this.width=d,this.height=_),i.bindTexture(this.gl_target,this.gl_texture);var x=this.device.translateTextureFormat(this.format),A=Xn(i)?this.device.translateInternalTextureFormat(this.format):x,C=this.device.translateTextureType(this.format);this.preprocessImage();for(var I=0;I<this.depthOrArrayLayers;I++){var D=t[I],Z=this.gl_target;s&&(Z=tt.TEXTURE_CUBE_MAP_POSITIVE_X+I%6),this.immutable?i.texSubImage2D(Z,n,0,0,d,_,x,C,D):Xn(i)?a?i.texImage3D(Z,n,A,d,_,this.depthOrArrayLayers,0,x,C,D):i.texImage2D(Z,n,A,d,_,0,x,C,D):l?i.texImage2D(Z,n,x,d,_,0,x,C,D):i.texImage2D(Z,n,x,x,C,D)}this.mipmaps&&this.generateMipmap(a)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(kv(this))},r.prototype.clampmipLevelCount=function(t){if(t.dimension===Yi.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1){var n=ch(t.format);if(n===Mr.BC1)for(var i=t.width,a=t.height,s=0;s<t.mipLevelCount;s++){if(i<=2||a<=2)return s-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return t.mipLevelCount},r.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(tt.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(tt.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(tt.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},r.prototype.generateMipmap=function(t){t===void 0&&(t=!1);var n=this.device.gl;return!Xn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),t?(n.texParameteri(this.gl_target,tt.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,tt.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,tt.TEXTURE_MIN_FILTER,tt.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,tt.TEXTURE_MAG_FILTER,tt.LINEAR)):n.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_MIN_FILTER,tt.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},r.prototype.isNPOT=function(){var t=this.device.gl;return Xn(t)?!1:!u0(this.width)||!u0(this.height)},r}(Yc),U5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.RenderTarget,s.gl_renderbuffer=null,s.texture=null;var l=s.device.gl,f=a.format,d=a.width,_=a.height,x=a.sampleCount,A=x===void 0?1:x,C=a.texture,I=!1;if((f===Ot.D32F||f===Ot.D24_S8)&&C&&!Xn(l)&&!i.WEBGL_depth_texture&&(C.destroy(),s.texture=null,I=!0),!I&&C)s.texture=C;else{s.gl_renderbuffer=s.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,s.gl_renderbuffer);var D=s.device.translateTextureInternalFormat(f,!0);Xn(l)&&A>1?l.renderbufferStorageMultisample(tt.RENDERBUFFER,A,D,d,_):l.renderbufferStorage(tt.RENDERBUFFER,D,d,_)}return s.format=f,s.width=d,s.height=_,s.sampleCount=A,s}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},r}(Yc),Vl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Vl||(Vl={}));var z5=function(e){(0,kn.ZT)(r,e);function r(t,n){var i=t.id,a=t.device,s=t.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=ya.Program,l.uniformSetters={},l.attributes=[];var f=l.device.gl;return l.descriptor=s,l.gl_program=l.device.ensureResourceExists(f.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Vl.NeedsCompile,l.tryCompileProgram(),l}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},r.prototype.tryCompileProgram=function(){Oi(this.compileState===Vl.NeedsCompile);var t=this.descriptor,n=t.vertex,i=t.fragment,a=this.device.gl;n!=null&&n.glsl&&(i!=null&&i.glsl)&&(this.gl_shader_vert=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Vl.Compiling,Xn(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},r.prototype.readAttributesFromLinkedProgram=function(){for(var t,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=T5(this.descriptor.vertex.glsl),s=w5(this.rawVertexGLSL,a),l=function(_){var x=n.getActiveAttrib(f.gl_program,_),A=x.name,C=x.type,I=x.size,D=n.getAttribLocation(f.gl_program,A),Z=(t=s.find(function(J){return J.name===A}))===null||t===void 0?void 0:t.location;D>=0&&!(0,$c.Z)(Z)&&(f.attributes[Z]={name:A,location:D,type:C,size:I})},f=this,d=0;d<i;d++)l(d)},r.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=t.getActiveUniform(this.gl_program,i),s=y5(a.name).name,l=t.getUniformLocation(this.gl_program,s);if(this.uniformSetters[s]=nS(t,l,a),a&&a.size>1)for(var f=0;f<a.size;f++)l=t.getUniformLocation(this.gl_program,"".concat(s,"[").concat(f,"]")),this.uniformSetters["".concat(s,"[").concat(f,"]")]=nS(t,l,a)}},r.prototype.compileShader=function(t,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,t),i.compileShader(a),a},r.prototype.setUniformsLegacy=function(t){t===void 0&&(t={});var n=this.device.gl;if(!Xn(n)){var i=!1;for(var a in t){i||(n.useProgram(this.gl_program),i=!0);var s=t[a],l=this.uniformSetters[a];if(l){var f=s;f instanceof Uy&&(f=f.textureIndex),l(f)}}}return this},r}(Yc),Z5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.QueryPool;var l=s.device.gl;if(Xn(l)){var f=a.elemCount,d=a.type;s.gl_query=$4(f,function(){return s.device.ensureResourceExists(l.createQuery())}),s.gl_query_type=L5(d)}return s}return r.prototype.queryResultOcclusion=function(t){var n=this.device.gl;if(Xn(n)){var i=this.gl_query[t];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Xn(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},r}(Yc),V5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ya.Readback,a.gl_pbo=null,a.gl_sync=null,a}return r.prototype.clientWaitAsync=function(t,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(s,l){function f(){var d=a.clientWaitSync(t,n,0);if(d==a.WAIT_FAILED){l();return}if(d==a.TIMEOUT_EXPIRED){setTimeout(f,(0,V4.Z)(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}s()}f()})},r.prototype.getBufferSubDataAsync=function(t,n,i,a,s,l){return(0,kn.mG)(this,void 0,void 0,function(){var f;return(0,kn.Jh)(this,function(d){switch(d.label){case 0:return f=this.device.gl,Xn(f)?(this.gl_sync=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0),f.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return d.sent(),f.bindBuffer(t,n),f.getBufferSubData(t,i,a,s,l),f.bindBuffer(t,null),[2,a];case 2:return[2]}})})},r.prototype.readTexture=function(t,n,i,a,s,l,f,d){return f===void 0&&(f=0),d===void 0&&(d=l.byteLength||0),(0,kn.mG)(this,void 0,void 0,function(){var _,x,A,C,I;return(0,kn.Jh)(this,function(D){return _=this.device.gl,x=t,A=this.device.translateTextureFormat(x.format),C=this.device.translateTextureType(x.format),I=j4(x.format),Xn(_)?(this.gl_pbo=this.device.ensureResourceExists(_.createBuffer()),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.bufferData(_.PIXEL_PACK_BUFFER,d,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),_.bindFramebuffer(tt.READ_FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(tt.READ_FRAMEBUFFER,tt.COLOR_ATTACHMENT0,tt.TEXTURE_2D,x.gl_texture,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.readPixels(n,i,a,s,A,C,f*I),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(_.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,f,0)]):[2,this.readTextureSync(t,n,i,a,s,l,f,d)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,f,d){d===void 0&&(d=l.byteLength||0);var _=this.device.gl,x=t,A=this.device.translateTextureType(x.format);return _.bindFramebuffer(tt.FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(tt.FRAMEBUFFER,tt.COLOR_ATTACHMENT0,tt.TEXTURE_2D,x.gl_texture,0),_.pixelStorei(_.PACK_ALIGNMENT,4),_.readPixels(n,i,a,s,_.RGBA,A,l),l},r.prototype.readBuffer=function(t,n,i,a,s){return(0,kn.mG)(this,void 0,void 0,function(){var l;return(0,kn.Jh)(this,function(f){return l=this.device.gl,Xn(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,Ov(t,n),n,i,a,s)]:[2,Promise.reject()]})})},r.prototype.destroy=function(){e.prototype.destroy.call(this),Xn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},r}(Yc),j5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;return f.type=ya.RenderPipeline,f.drawMode=I5((s=a.topology)!==null&&s!==void 0?s:ws.TRIANGLES),f.program=a.program,f.inputLayout=a.inputLayout,f.megaState=(0,kn.pi)((0,kn.pi)({},Iv(Pd)),a.megaStateDescriptor),f.colorAttachmentFormats=a.colorAttachmentFormats.slice(),f.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,f.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,f}return r}(Yc),H5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.ComputePipeline,s.descriptor=a,s}return r}(Yc),W5=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(r){this.creationStacks.set(r,new Error().stack),this.liveObjects.add(r)},e.prototype.trackResourceDestroyed=function(r){this.deletionStacks.has(r)&&console.warn("Object double freed:",r,`

Creation stack: `,this.creationStacks.get(r),`

Deletion stack: `,this.deletionStacks.get(r),`

This stack: `,new Error().stack),this.deletionStacks.set(r,new Error().stack),this.liveObjects.delete(r)},e.prototype.checkForLeaks=function(){var r,t;try{for(var n=(0,kn.XA)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setResourceLeakCheck=function(r,t){t?this.liveObjects.add(r):this.liveObjects.delete(r)},e}(),G5=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Sampler;var d=f.device.gl;if(Xn(d)){var _=f.device.ensureResourceExists(d.createSampler());d.samplerParameteri(_,tt.TEXTURE_WRAP_S,Um(a.addressModeU)),d.samplerParameteri(_,tt.TEXTURE_WRAP_T,Um(a.addressModeV)),d.samplerParameteri(_,tt.TEXTURE_WRAP_R,Um((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU)),d.samplerParameteri(_,tt.TEXTURE_MIN_FILTER,p0(a.minFilter,a.mipmapFilter)),d.samplerParameteri(_,tt.TEXTURE_MAG_FILTER,p0(a.magFilter,$s.NO_MIP)),a.lodMinClamp!==void 0&&d.samplerParameterf(_,tt.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&d.samplerParameterf(_,tt.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(d.samplerParameteri(_,d.TEXTURE_COMPARE_MODE,d.COMPARE_REF_TO_TEXTURE),d.samplerParameteri(_,d.TEXTURE_COMPARE_FUNC,a.compareFunction));var x=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;x>1&&f.device.EXT_texture_filter_anisotropic!==null&&(Oi(a.minFilter===os.BILINEAR&&a.magFilter===os.BILINEAR&&a.mipmapFilter===$s.LINEAR),d.samplerParameterf(_,f.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x)),f.gl_sampler=_}else f.descriptor=a;return f}return r.prototype.setTextureParameters=function(t,n,i){var a,s=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?s.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_MIN_FILTER,tt.LINEAR):s.texParameteri(t,tt.TEXTURE_MIN_FILTER,p0(l.minFilter,l.mipmapFilter)),s.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_S,Um(l.addressModeU)),s.texParameteri(tt.TEXTURE_2D,tt.TEXTURE_WRAP_T,Um(l.addressModeV)),s.texParameteri(t,tt.TEXTURE_MAG_FILTER,p0(l.magFilter,$s.NO_MIP));var f=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;f>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Oi(l.minFilter===os.BILINEAR&&l.magFilter===os.BILINEAR&&l.mipmapFilter===$s.LINEAR),s.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f))},r.prototype.destroy=function(){e.prototype.destroy.call(this),Xn(this.device.gl)&&this.device.gl.deleteSampler(Fy(this))},r.prototype.isNPOT=function(t,n){return!u0(t)||!u0(n)},r}(Yc),X5=function(){function e(){}return e.prototype.dispatchWorkgroups=function(r,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(r,t){},e.prototype.setPipeline=function(r){},e.prototype.setBindings=function(r){},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e}(),$5=function(e){(0,kn.ZT)(r,e);function r(){var t=e!==null&&e.apply(this,arguments)||this;return t.type=ya.RenderBundle,t.commands=[],t}return r.prototype.push=function(t){this.commands.push(t)},r.prototype.replay=function(){this.commands.forEach(function(t){return t()})},r}(Yc),lS=65536,Y5=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,q5=function(){function e(r,t){t===void 0&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Iv(Pd),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=lh.LOWER_LEFT,this.clipSpaceNearZ=wv.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=r,this.contextAttributes=Id(r.getContextAttributes()),Xn(r)?(this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=r.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=r.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=r.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=r.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=r.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=r.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=r.getExtension("EXT_color_buffer_half_float"),r.getExtension("EXT_frag_depth"),r.getExtension("OES_element_index_uint"),r.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=r.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=r.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=r.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=r.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=r.getExtension("KHR_parallel_shader_compile"),Xn(r)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Uy({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Yi.TEXTURE_2D,mipLevelCount:1,usage:Du.RENDER_TARGET,format:this.contextAttributes.alpha===!1?Ot.U8_RGB_RT:Ot.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Yo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:to.VERTEX,hint:bf.STATIC}),Xn(r)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Yi.TEXTURE_2D_ARRAY,Yo.Float),this.fallbackTexture3D=this.createFallbackTexture(Yi.TEXTURE_3D,Yo.Float),this.fallbackTextureCube=this.createFallbackTexture(Yi.TEXTURE_CUBE_MAP,Yo.Float)),this.currentMegaState.depthCompare=Hi.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=iu.ALL,r.enable(r.DEPTH_TEST),r.enable(r.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new W5)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(r,t){var n=r===Yi.TEXTURE_CUBE_MAP?6:1,i=t===Yo.Depth?Ot.D32F:Ot.U8_RGBA_NORM,a=this.createTexture({dimension:r,format:i,usage:Du.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===Yo.Float&&a.setImageData([new Uint8Array(4*n)]),kv(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var r=this.gl;if(this.maxVertexAttribs=r.getParameter(tt.MAX_VERTEX_ATTRIBS),Xn(r)){this.uniformBufferMaxPageByteSize=Math.min(r.getParameter(tt.MAX_UNIFORM_BLOCK_SIZE),lS),this.uniformBufferWordAlignment=r.getParameter(r.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=r.getInternalformatParameter(r.RENDERBUFFER,r.DEPTH32F_STENCIL8,r.SAMPLES);this.supportedSampleCounts=t?(0,kn.ev)([],(0,kn.CR)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=lS;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(r,t,n){var i=this.scTexture;i.width=r,i.height=t,this.scPlatformFramebuffer=G4(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(r,t){switch(t===void 0&&(t=!1),r){case Ot.ALPHA:return tt.ALPHA;case Ot.U8_LUMINANCE:case Ot.F16_LUMINANCE:case Ot.F32_LUMINANCE:return tt.LUMINANCE;case Ot.F16_R:return tt.R16F;case Ot.F16_RG:return tt.RG16F;case Ot.F16_RGB:return tt.RGB16F;case Ot.F16_RGBA:return tt.RGBA16F;case Ot.F32_R:return tt.R32F;case Ot.F32_RG:return tt.RG32F;case Ot.F32_RGB:return tt.RGB32F;case Ot.F32_RGBA:return Xn(this.gl)?tt.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:tt.RGBA;case Ot.U8_R_NORM:return tt.R8;case Ot.U8_RG_NORM:return tt.RG8;case Ot.U8_RGB_NORM:case Ot.U8_RGB_RT:return tt.RGB8;case Ot.U8_RGB_SRGB:return tt.SRGB8;case Ot.U8_RGBA_NORM:case Ot.U8_RGBA_RT:return Xn(this.gl)?tt.RGBA8:t?tt.RGBA4:tt.RGBA;case Ot.U8_RGBA:return tt.RGBA;case Ot.U8_RGBA_SRGB:case Ot.U8_RGBA_RT_SRGB:return tt.SRGB8_ALPHA8;case Ot.U16_R:return tt.R16UI;case Ot.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Ot.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Ot.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Ot.U16_RGBA_5551:return tt.RGB5_A1;case Ot.U16_RGB_565:return tt.RGB565;case Ot.U32_R:return tt.R32UI;case Ot.S8_RGBA_NORM:return tt.RGBA8_SNORM;case Ot.S8_RG_NORM:return tt.RG8_SNORM;case Ot.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Ot.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Ot.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Ot.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Ot.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Ot.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Ot.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Ot.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Ot.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Ot.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Ot.D32F_S8:return Xn(this.gl)?tt.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?tt.DEPTH_STENCIL:tt.DEPTH_COMPONENT16;case Ot.D24_S8:return Xn(this.gl)?tt.DEPTH24_STENCIL8:this.WEBGL_depth_texture?tt.DEPTH_STENCIL:tt.DEPTH_COMPONENT16;case Ot.D32F:return Xn(this.gl)?tt.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?tt.DEPTH_COMPONENT:tt.DEPTH_COMPONENT16;case Ot.D24:return Xn(this.gl)?tt.DEPTH_COMPONENT24:this.WEBGL_depth_texture?tt.DEPTH_COMPONENT:tt.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(r){var t=ch(r);switch(t){case Mr.U8:return tt.UNSIGNED_BYTE;case Mr.U16:return tt.UNSIGNED_SHORT;case Mr.U32:return tt.UNSIGNED_INT;case Mr.S8:return tt.BYTE;case Mr.F16:return tt.HALF_FLOAT;case Mr.F32:return tt.FLOAT;case Mr.U16_PACKED_5551:return tt.UNSIGNED_SHORT_5_5_5_1;case Mr.D32F:return Xn(this.gl)?tt.FLOAT:this.WEBGL_depth_texture?tt.UNSIGNED_INT:tt.UNSIGNED_BYTE;case Mr.D24:return Xn(this.gl)?tt.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?tt.UNSIGNED_SHORT:tt.UNSIGNED_BYTE;case Mr.D24S8:return Xn(this.gl)?tt.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?tt.UNSIGNED_INT_24_8_WEBGL:tt.UNSIGNED_BYTE;case Mr.D32FS8:return tt.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(r){switch(r){case Ot.F32_R:return tt.R32F;case Ot.F32_RG:return tt.RG32F;case Ot.F32_RGB:return tt.RGB32F;case Ot.F32_RGBA:return tt.RGBA32F;case Ot.F16_R:return tt.R16F;case Ot.F16_RG:return tt.RG16F;case Ot.F16_RGB:return tt.RGB16F;case Ot.F16_RGBA:return tt.RGBA16F}return this.translateTextureFormat(r)},e.prototype.translateTextureFormat=function(r){if(aS(r)||r===Ot.F32_LUMINANCE||r===Ot.U8_LUMINANCE)return this.translateTextureInternalFormat(r);var t=Xn(this.gl)||!Xn(this.gl)&&!!this.WEBGL_depth_texture;switch(r){case Ot.D24_S8:case Ot.D32F_S8:return t?tt.DEPTH_STENCIL:tt.RGBA;case Ot.D24:case Ot.D32F:return t?tt.DEPTH_COMPONENT:tt.RGBA}var n=oS(r),i=o0(r);switch(i){case zn.A:return tt.ALPHA;case zn.R:return n?tt.RED_INTEGER:tt.RED;case zn.RG:return n?tt.RG_INTEGER:tt.RG;case zn.RGB:return n?tt.RGB_INTEGER:tt.RGB;case zn.RGBA:return tt.RGBA}},e.prototype.setActiveTexture=function(r){this.currentActiveTexture!==r&&(this.gl.activeTexture(r),this.currentActiveTexture=r)},e.prototype.bindVAO=function(r){this.currentBoundVAO!==r&&(Xn(this.gl)?this.gl.bindVertexArray(r):this.OES_vertex_array_object.bindVertexArrayOES(r),this.currentBoundVAO=r)},e.prototype.programCompiled=function(r){Oi(r.compileState!==Vl.NeedsCompile),r.compileState===Vl.Compiling&&(r.compileState=Vl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(r))},e.prototype.useProgram=function(r){this.currentProgram!==r&&(this.programCompiled(r),this.gl.useProgram(r.gl_program),this.currentProgram=r)},e.prototype.ensureResourceExists=function(r){if(r===null){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}else return r},e.prototype.createBuffer=function(r){return new F5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new Uy({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new G5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){return new U5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.mipLevelCount;return Oi(s===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:r})},e.prototype.createProgram=function(r){var t,n,i,a=(t=r.vertex)===null||t===void 0?void 0:t.glsl;return!((n=r.vertex)===null||n===void 0)&&n.glsl&&(r.vertex.glsl=jp(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((i=r.fragment)===null||i===void 0)&&i.glsl&&(r.fragment.glsl=jp(this.queryVendorInfo(),"frag",r.fragment.glsl)),this.createProgramSimple(r,a)},e.prototype.createProgramSimple=function(r,t){var n=new z5({id:this.getNextUniqueId(),device:this,descriptor:r},t);return n},e.prototype.createBindings=function(r){return new R5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new N5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new j5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePass=function(){return new X5},e.prototype.createComputePipeline=function(r){return new H5({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createReadback=function(){return new V5({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(r,t){return new Z5({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(r){var t,n,i,a,s,l,f=r.colorAttachment;r.depthClearValue=(t=r.depthClearValue)!==null&&t!==void 0?t:"load",r.stencilClearValue=(n=r.stencilClearValue)!==null&&n!==void 0?n:"load";for(var d=0;d<f.length;d++)r.colorAttachmentLevel||(r.colorAttachmentLevel=[]),r.colorAttachmentLevel[d]=(i=r.colorAttachmentLevel[d])!==null&&i!==void 0?i:0,r.colorResolveToLevel||(r.colorResolveToLevel=[]),r.colorResolveToLevel[d]=(a=r.colorResolveToLevel[d])!==null&&a!==void 0?a:0,r.colorClearColor||(r.colorClearColor=[]),r.colorClearColor[d]=(s=r.colorClearColor[d])!==null&&s!==void 0?s:"load",r.colorStore||(r.colorStore=[]),r.colorStore[d]=(l=r.colorStore[d])!==null&&l!==void 0?l:!1},e.prototype.createRenderBundle=function(){return new $5({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(r){this.renderBundle=r},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(r){r.forEach(function(t){t.replay()})},e.prototype.createRenderPass=function(r){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=r,this.formatRenderPassDescriptor(r);var t=r.colorAttachment,n=r.colorAttachmentLevel,i=r.colorClearColor,a=r.colorResolveTo,s=r.colorResolveToLevel,l=r.depthStencilAttachment,f=r.depthClearValue,d=r.stencilClearValue,_=r.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var x=0;x<t.length;x++)this.setRenderPassParametersColor(x,t[x],n[x],a[x],s[x]);this.setRenderPassParametersDepthStencil(l,_),this.validateCurrentAttachments();for(var x=0;x<t.length;x++){var A=i[x];A!=="load"&&this.setRenderPassParametersClearColor(x,A.r,A.g,A.b,A.a)}return this.setRenderPassParametersClearDepthStencil(f,d),this},e.prototype.submitPass=function(r){Oi(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,s){var l=this.gl,f=r,d=i;if(Oi(d.mipLevelCount===1),Oi(f.mipLevelCount===1),Xn(l))f===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,d,0),l.blitFramebuffer(a,s,a+d.width,s+d.height,t,n,t+d.width,n+d.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(f===this.scTexture){var _=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(_,f)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(r,t,n){switch(r){case Ot.BC1_SRGB:case Ot.BC2_SRGB:case Ot.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?Ny(t,n,4,4):!1;case Ot.BC1:case Ot.BC2:case Ot.BC3:return this.WEBGL_compressed_texture_s3tc!==null?Ny(t,n,4,4):!1;case Ot.BC4_UNORM:case Ot.BC4_SNORM:case Ot.BC5_UNORM:case Ot.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?Ny(t,n,4,4):!1;case Ot.U16_R_NORM:case Ot.U16_RG_NORM:case Ot.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case Ot.F32_R:case Ot.F32_RG:case Ot.F32_RGB:case Ot.F32_RGBA:return this.OES_texture_float_linear!==null;case Ot.F16_R:case Ot.F16_RG:case Ot.F16_RGB:case Ot.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(r){var t=this.gl;if(r.compileState===Vl.NeedsCompile)throw new Error("whoops");if(r.compileState===Vl.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=t.getProgramParameter(r.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(r),n}return r.compileState===Vl.NeedsBind||r.compileState===Vl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ya.Buffer)for(var n=r.gl_buffer_pages,i=0;i<n.length;i++)zm(n[i],"".concat(t," Page ").concat(i));else if(r.type===ya.Texture)zm(kv(r),t);else if(r.type===ya.Sampler)zm(Fy(r),t);else if(r.type===ya.RenderTarget){var a=r.gl_renderbuffer;a!==null&&zm(a,t)}else r.type===ya.InputLayout&&zm(r.vao,t)},e.prototype.setResourceLeakCheck=function(r,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(r,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e.prototype.programPatched=function(r,t){Oi(this.shaderDebug)},e.prototype.getBufferData=function(r,t,n){n===void 0&&(n=0);var i=this.gl;Xn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Ov(r,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=r},e.prototype.debugGroupStatisticsBufferUpload=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=r},e.prototype.debugGroupStatisticsTextureBind=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=r},e.prototype.debugGroupStatisticsTriangles=function(r){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=r},e.prototype.reportShaderError=function(r,t){var n=this.gl,i=n.getShaderParameter(r,n.COMPILE_STATUS);if(!i){console.error(Y4(t));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(r)),console.error(n.getShaderInfoLog(r))}return i},e.prototype.checkProgramCompilationForErrors=function(r){var t=this.gl,n=r.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var i=r.descriptor;if(!this.reportShaderError(r.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(r.gl_shader_frag,i.fragment.glsl))return;console.error(t.getProgramInfoLog(r.gl_program))}},e.prototype.bindFramebufferAttachment=function(r,t,n,i){var a=this.gl;if((0,$c.Z)(n))a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,null);else if(n.type===ya.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(r,t,tt.TEXTURE_2D,kv(n.texture),i);else if(n.type===ya.Texture){var s=kv(n);n.dimension===Yi.TEXTURE_2D?a.framebufferTexture2D(r,t,tt.TEXTURE_2D,s,i):Xn(a)&&(n.dimension,Yi.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(r,t){var n=this.gl,i=(0,$c.Z)(t)?wn.Depth|wn.Stencil:Cv(t.format),a=!!(i&wn.Depth),s=!!(i&wn.Stencil);if(a&&s){var l=Xn(this.gl)||!Xn(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(r,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0)}else a?(this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,null,0)):s&&(this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var r=-1,t=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(r===-1?(r=a.sampleCount,t=a.width,n=a.height):(Oi(r===a.sampleCount),Oi(t===a.width),Oi(n===a.height)))}this.currentDepthStencilAttachment&&(r===-1?r=this.currentDepthStencilAttachment.sampleCount:(Oi(r===this.currentDepthStencilAttachment.sampleCount),Oi(t===this.currentDepthStencilAttachment.width),Oi(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=r},e.prototype.setRenderPassParametersBegin=function(r){var t=this.gl;if(Xn(t)?t.bindFramebuffer(tt.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(tt.FRAMEBUFFER,this.renderPassDrawFramebuffer),Xn(t)?t.drawBuffers([tt.COLOR_ATTACHMENT0,tt.COLOR_ATTACHMENT1,tt.COLOR_ATTACHMENT2,tt.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([tt.COLOR_ATTACHMENT0_WEBGL,tt.COLOR_ATTACHMENT1_WEBGL,tt.COLOR_ATTACHMENT2_WEBGL,tt.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=r;n<this.currentColorAttachments.length;n++){var i=Xn(t)?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,a=Xn(t)?tt.COLOR_ATTACHMENT0:tt.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(i,a+n,tt.RENDERBUFFER,null),t.framebufferTexture2D(i,a+n,tt.TEXTURE_2D,null,0)}this.currentColorAttachments.length=r},e.prototype.setRenderPassParametersColor=function(r,t,n,i,a){var s=this.gl,l=Xn(s);(this.currentColorAttachments[r]!==t||this.currentColorAttachmentLevels[r]!==n)&&(this.currentColorAttachments[r]=t,this.currentColorAttachmentLevels[r]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,(l?tt.COLOR_ATTACHMENT0:tt.COLOR_ATTACHMENT0_WEBGL)+r,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[r]!==i||this.currentColorResolveToLevels[r]!==a)&&(this.currentColorResolveTos[r]=i,this.currentColorResolveToLevels[r]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(r,t){var n=this.gl;this.currentDepthStencilAttachment!==r&&(this.currentDepthStencilAttachment=r,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Xn(n)?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(r,t,n,i,a){var s=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[r];l&&l.channelWriteMask!==iu.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(r,!0,!0,!0,!0),l.channelWriteMask=iu.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==iu.ALL&&(s.colorMask(!0,!0,!0,!0),l.channelWriteMask=iu.ALL)}this.setScissorRectEnabled(!1),Xn(s)?s.clearBufferfv(s.COLOR,r,[t,n,i,a]):(s.clearColor(t,n,i,a),s.clear(s.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(r,t){r===void 0&&(r="load"),t===void 0&&(t="load");var n=this.gl;r!=="load"&&(Oi(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Xn(n)?n.clearBufferfv(n.DEPTH,0,[r]):(n.clearDepth(r),n.clear(n.DEPTH_BUFFER_BIT))),t!=="load"&&(Oi(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Xn(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(r){var t=this,n;if(this.renderBundle){this.renderBundle.push(function(){return t.setBindings(r)});return}var i=this.gl,a=r,s=a.uniformBufferBindings,l=a.samplerBindings,f=a.bindingLayouts;Oi(0<f.bindingLayoutTables.length);var d=f.bindingLayoutTables[0];Oi(s.length>=d.numUniformBuffers),Oi(l.length>=d.numSamplers);for(var _=0;_<s.length;_++){var x=s[_];if(x.size!==0){var A=d.firstUniformBuffer+_,C=x.buffer,I=x.offset||0,D=x.size||C.byteSize;if(C!==this.currentUniformBuffers[A]||I!==this.currentUniformBufferByteOffsets[A]||D!==this.currentUniformBufferByteSizes[A]){var Z=I%C.pageByteSize,J=C.gl_buffer_pages[I/C.pageByteSize|0];Oi(Z+D<=C.pageByteSize),Xn(i)&&i.bindBufferRange(i.UNIFORM_BUFFER,A,J,Z,D),this.currentUniformBuffers[A]=C,this.currentUniformBufferByteOffsets[A]=I,this.currentUniformBufferByteSizes[A]=D}}}for(var _=0;_<d.numSamplers;_++){var x=l[_],ce=d.firstSampler+_,xe=x!==null&&x.sampler!==null?Fy(x.sampler):null,Xe=x!==null&&x.texture!==null?kv(x.texture):null;if(this.currentSamplers[ce]!==xe&&(Xn(i)&&i.bindSampler(ce,xe),this.currentSamplers[ce]=xe),this.currentTextures[ce]!==Xe){if(this.setActiveTexture(i.TEXTURE0+ce),Xe!==null){var bt=Id(x).texture,pt=bt.gl_target,et=bt.width,Pt=bt.height;x.texture.textureIndex=ce,i.bindTexture(pt,Xe),Xn(i)||(n=x.sampler)===null||n===void 0||n.setTextureParameters(pt,et,Pt),this.debugGroupStatisticsTextureBind()}else{var jt=(0,kn.pi)((0,kn.pi)({},x),KE),Ar=jt.dimension,gr=jt.formatKind,pt=B5(Ar);i.bindTexture(pt,this.getFallbackTexture((0,kn.pi)({gl_target:pt,formatKind:gr},jt)))}this.currentTextures[ce]=Xe}}},e.prototype.setViewport=function(r,t,n,i){var a=this.gl;a.viewport(r,t,n,i)},e.prototype.setScissorRect=function(r,t,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(r,t,n,i)},e.prototype.applyAttachmentStateIndexed=function(r,t,n){var i=this.gl,a=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(r,!!(n.channelWriteMask&iu.RED),!!(n.channelWriteMask&iu.GREEN),!!(n.channelWriteMask&iu.BLUE),!!(n.channelWriteMask&iu.ALPHA)),t.channelWriteMask=n.channelWriteMask);var s=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||s)&&(Hp(t.rgbBlendState)&&Hp(t.alphaBlendState)?a.enableiOES(r,i.BLEND):Hp(n.rgbBlendState)&&Hp(n.alphaBlendState)&&a.disableiOES(r,i.BLEND)),s&&(a.blendEquationSeparateiOES(r,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(r,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(r,t){var n=this.gl;r.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&iu.RED),!!(t.channelWriteMask&iu.GREEN),!!(t.channelWriteMask&iu.BLUE),!!(t.channelWriteMask&iu.ALPHA)),r.channelWriteMask=t.channelWriteMask);var i=r.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,a=r.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(a||i)&&(Hp(r.rgbBlendState)&&Hp(r.alphaBlendState)?n.enable(n.BLEND):Hp(t.rgbBlendState)&&Hp(t.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),r.rgbBlendState.blendMode=t.rgbBlendState.blendMode,r.alphaBlendState.blendMode=t.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(r){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<r.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],r.attachmentsState[0]);else Oi(r.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],r.attachmentsState[0]);if(WE(n.blendConstant,r.blendConstant)||(t.blendColor(r.blendConstant.r,r.blendConstant.g,r.blendConstant.b,r.blendConstant.a),GE(n.blendConstant,r.blendConstant)),n.depthCompare!==r.depthCompare&&(t.depthFunc(r.depthCompare),n.depthCompare=r.depthCompare),!!n.depthWrite!=!!r.depthWrite&&(t.depthMask(r.depthWrite),n.depthWrite=r.depthWrite),!!n.stencilWrite!=!!r.stencilWrite&&(t.stencilMask(r.stencilWrite?255:0),n.stencilWrite=r.stencilWrite),!f0(n.stencilFront,r.stencilFront)){var a=r.stencilFront,s=a.passOp,l=a.failOp,f=a.depthFailOp,d=a.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==f)&&(t.stencilOpSeparate(t.FRONT,l,f,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=f),n.stencilFront.compare!==d&&(this.setStencilReference(0),n.stencilFront.compare=d)}if(!f0(n.stencilBack,r.stencilBack)){var _=r.stencilBack,s=_.passOp,l=_.failOp,f=_.depthFailOp,d=_.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==f)&&(t.stencilOpSeparate(t.BACK,l,f,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=f),n.stencilBack.compare!==d&&(this.setStencilReference(0),n.stencilBack.compare=d)}(n.stencilFront.mask!==r.stencilFront.mask||n.stencilBack.mask!==r.stencilBack.mask)&&(n.stencilFront.mask=r.stencilFront.mask,n.stencilBack.mask=r.stencilBack.mask,this.applyStencil()),n.cullMode!==r.cullMode&&(n.cullMode===Zl.NONE?t.enable(t.CULL_FACE):r.cullMode===Zl.NONE&&t.disable(t.CULL_FACE),r.cullMode===Zl.BACK?t.cullFace(t.BACK):r.cullMode===Zl.FRONT?t.cullFace(t.FRONT):r.cullMode===Zl.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=r.cullMode),n.frontFace!==r.frontFace&&(t.frontFace(r.frontFace),n.frontFace=r.frontFace),n.polygonOffset!==r.polygonOffset&&(r.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=r.polygonOffset)},e.prototype.validatePipelineFormats=function(r){for(var t=0;t<this.currentColorAttachments.length;t++)var n=this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Oi(this.currentDepthStencilAttachment.format===r.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Oi(this.currentSampleCount===r.sampleCount)},e.prototype.setPipeline=function(r){var t=this;if(this.renderBundle){this.renderBundle.push(function(){return t.setPipeline(r)});return}this.currentPipeline=r,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===Vl.NeedsBind){var i=this.gl,a=n.gl_program,s=n.descriptor,l=uS(s.vertex.glsl,Y5);if(Xn(i))for(var f=0;f<l.length;f++){var d=(0,kn.CR)(l[f],2),_=d[1],x=i.getUniformBlockIndex(a,_);x!==-1&&x!==4294967295&&i.uniformBlockBinding(a,x,f)}for(var A=uS(s.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),f=0;f<A.length;f++){var C=(0,kn.CR)(A[f],3),I=C[1],D=C[2],Z=i.getUniformLocation(a,I);i.uniform1i(Z,parseInt(D))}n.compileState=Vl.ReadyToUse}},e.prototype.setVertexInput=function(r,t,n){var i,a,s=this,l;if(this.renderBundle){this.renderBundle.push(function(){return s.setVertexInput(r,t,n)});return}if(r!==null){Oi(this.currentPipeline.inputLayout===r);var f=r;this.bindVAO(f.vao);for(var d=this.gl,_=0;_<f.vertexBufferDescriptors.length;_++){var x=f.vertexBufferDescriptors[_],A=x.arrayStride,C=x.attributes;try{for(var I=(i=void 0,(0,kn.XA)(C)),D=I.next();!D.done;D=I.next()){var Z=D.value,J=Z.shaderLocation,ce=Z.offset,xe=Xn(d)?J:(l=f.program.attributes[J])===null||l===void 0?void 0:l.location;if(!(0,$c.Z)(xe)){var Xe=t[_];if(Xe===null)continue;var bt=Z.vertexFormat;d.bindBuffer(d.ARRAY_BUFFER,Ov(Xe.buffer));var pt=(Xe.offset||0)+ce;d.vertexAttribPointer(xe,bt.size,bt.type,bt.normalized,A,pt)}}}catch(Pt){i={error:Pt}}finally{try{D&&!D.done&&(a=I.return)&&a.call(I)}finally{if(i)throw i.error}}}if(Oi(n!==null==(f.indexBufferFormat!==null)),n!==null){var et=n.buffer;Oi(et.usage===to.INDEX),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,Ov(et)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Oi(this.currentPipeline.inputLayout===null),Oi(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(r){this.currentStencilRef!==r&&(this.currentStencilRef=r,this.applyStencil())},e.prototype.draw=function(r,t,n,i){var a,s=this;if(this.renderBundle){this.renderBundle.push(function(){return s.draw(r,t,n,i)});return}var l=this.gl,f=this.currentPipeline;if(t){var d=[f.drawMode,n||0,r,t];Xn(l)?l.drawArraysInstanced.apply(l,(0,kn.ev)([],(0,kn.CR)(d),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,(0,kn.ev)([],(0,kn.CR)(d),!1))}else l.drawArrays(f.drawMode,n,r);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndexed=function(r,t,n,i,a){var s,l=this;if(this.renderBundle){this.renderBundle.push(function(){return l.drawIndexed(r,t,n,i,a)});return}var f=this.gl,d=this.currentPipeline,_=Id(d.inputLayout),x=Id(this.currentIndexBufferByteOffset)+n*_.indexBufferCompByteSize;if(t){var A=[d.drawMode,r,_.indexBufferType,x,t];Xn(f)?f.drawElementsInstanced.apply(f,(0,kn.ev)([],(0,kn.CR)(A),!1)):(s=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(s,(0,kn.ev)([],(0,kn.CR)(A),!1))}else f.drawElements(d.drawMode,r,_.indexBufferType,x);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndirect=function(r,t){},e.prototype.drawIndexedIndirect=function(r,t){},e.prototype.beginOcclusionQuery=function(r){var t=this.gl;if(Xn(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[r])}},e.prototype.endOcclusionQuery=function(){var r=this.gl;if(Xn(r)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(r){var t=r;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(r){},e.prototype.endPass=function(){for(var r=this.gl,t=Xn(r),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var s=this.currentColorResolveTos[i],l=!1;s!==null&&(Oi(a.width===s.width&&a.height===s.height),this.setScissorRectEnabled(!1),t&&r.bindFramebuffer(r.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,s===this.scTexture?r.bindFramebuffer(t?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,this.scPlatformFramebuffer):(r.bindFramebuffer(t?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&r.framebufferTexture2D(t?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[i])),t?(r.blitFramebuffer(0,0,a.width,a.height,0,0,s.width,s.height,r.COLOR_BUFFER_BIT,r.LINEAR),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,s),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(r.bindFramebuffer(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),r.bindFramebuffer(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var f=this.currentDepthStencilAttachment;if(f){var d=this.currentDepthStencilResolveTo,l=!1;d&&(Oi(f.width===d.width&&f.height===d.height),this.setScissorRectEnabled(!1),r.bindFramebuffer(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),r.bindFramebuffer(t?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,f),this.bindFramebufferDepthStencilAttachment(t?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,d)),l=!0,t&&r.blitFramebuffer(0,0,f.width,f.height,0,0,d.width,d.height,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(t?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(r.bindFramebuffer(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,f),l=!0),t&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[r.DEPTH_STENCIL_ATTACHMENT])),l&&r.bindFramebuffer(t?tt.READ_FRAMEBUFFER:tt.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r.bindFramebuffer(t?tt.DRAW_FRAMEBUFFER:tt.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(r){if(this.currentScissorEnabled!==r){var t=this.gl;r?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=r}},e.prototype.applyStencil=function(){(0,$c.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(tt.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(tt.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(r){var t=r.gl_target,n=r.formatKind;if(t===tt.TEXTURE_2D)return n===Yo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===tt.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===tt.TEXTURE_3D)return this.fallbackTexture3D;if(t===tt.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(r,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:to.VERTEX|to.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Md.VERTEX,attributes:[{format:Ot.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ws.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[Ot.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Iv(Pd)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:r.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:r}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[r],colorResolveTo:[t],colorClearColor:[H4]}),a=this.getCanvas(),s=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,s,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),K5=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,kn.mG)(this,void 0,void 0,function(){var t,n,i,a,s,l,f,d,_,x,A,C,I;return(0,kn.Jh)(this,function(D){return t=this.pluginOptions,n=t.targets,i=t.xrCompatible,a=t.antialias,s=a===void 0?!1:a,l=t.preserveDrawingBuffer,f=l===void 0?!1:l,d=t.premultipliedAlpha,_=d===void 0?!0:d,x=t.shaderDebug,A=t.trackResources,C={antialias:s,preserveDrawingBuffer:f,stencil:!0,premultipliedAlpha:_,xrCompatible:i},this.handleContextEvents(r),n.includes("webgl2")&&(I=r.getContext("webgl2",C)||r.getContext("experimental-webgl2",C)),!I&&n.includes("webgl1")&&(I=r.getContext("webgl",C)||r.getContext("experimental-webgl",C)),[2,new q5(I,{shaderDebug:x,trackResources:A})]})})},e.prototype.handleContextEvents=function(r){var t=this.pluginOptions,n=t.onContextLost,i=t.onContextRestored,a=t.onContextCreationError;a&&r.addEventListener("webglcontextcreationerror",a,!1),n&&r.addEventListener("webglcontextlost",n,!1),i&&r.addEventListener("webglcontextrestored",i,!1)},e}();let Cs;const cS=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&cS.decode();let Zm=null;function d0(){return(Zm===null||Zm.byteLength===0)&&(Zm=new Uint8Array(Cs.memory.buffer)),Zm}function v0(e,r){return e=e>>>0,cS.decode(d0().subarray(e,e+r))}const Kh=new Array(128).fill(void 0);Kh.push(void 0,null,!0,!1);let Vm=Kh.length;function Q5(e){Vm===Kh.length&&Kh.push(Kh.length+1);const r=Vm;return Vm=Kh[r],Kh[r]=e,r}function m0(e){return Kh[e]}function J5(e){e<132||(Kh[e]=Vm,Vm=e)}function eD(e){const r=m0(e);return J5(e),r}let jm=0;const g0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},tD=typeof g0.encodeInto=="function"?function(e,r){return g0.encodeInto(e,r)}:function(e,r){const t=g0.encode(e);return r.set(t),{read:e.length,written:t.length}};function zy(e,r,t){if(t===void 0){const l=g0.encode(e),f=r(l.length,1)>>>0;return d0().subarray(f,f+l.length).set(l),jm=l.length,f}let n=e.length,i=r(n,1)>>>0;const a=d0();let s=0;for(;s<n;s++){const l=e.charCodeAt(s);if(l>127)break;a[i+s]=l}if(s!==n){s!==0&&(e=e.slice(s)),i=t(i,n,n=s+e.length*3,1)>>>0;const l=d0().subarray(i+s,i+n),f=tD(e,l);s+=f.written}return jm=s,i}let Hm=null;function y0(){return(Hm===null||Hm.byteLength===0)&&(Hm=new Int32Array(Cs.memory.buffer)),Hm}function rD(e,r,t){let n,i;try{const l=Cs.__wbindgen_add_to_stack_pointer(-16),f=zy(e,Cs.__wbindgen_malloc,Cs.__wbindgen_realloc),d=jm,_=zy(r,Cs.__wbindgen_malloc,Cs.__wbindgen_realloc),x=jm;Cs.glsl_compile(l,f,d,_,x,t);var a=y0()[l/4+0],s=y0()[l/4+1];return n=a,i=s,v0(a,s)}finally{Cs.__wbindgen_add_to_stack_pointer(16),Cs.__wbindgen_free(n,i,1)}}class Wm{static __wrap(r){r=r>>>0;const t=Object.create(Wm.prototype);return t.__wbg_ptr=r,t}__destroy_into_raw(){const r=this.__wbg_ptr;return this.__wbg_ptr=0,r}free(){const r=this.__destroy_into_raw();Cs.__wbg_wgslcomposer_free(r)}constructor(){const r=Cs.wgslcomposer_new();return Wm.__wrap(r)}wgsl_compile(r){let t,n;try{const s=Cs.__wbindgen_add_to_stack_pointer(-16),l=zy(r,Cs.__wbindgen_malloc,Cs.__wbindgen_realloc),f=jm;Cs.wgslcomposer_wgsl_compile(s,this.__wbg_ptr,l,f);var i=y0()[s/4+0],a=y0()[s/4+1];return t=i,n=a,v0(i,a)}finally{Cs.__wbindgen_add_to_stack_pointer(16),Cs.__wbindgen_free(t,n,1)}}}function nD(e,r){return Ky(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=yield e.arrayBuffer();return yield WebAssembly.instantiate(t,r)}else{const t=yield WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}})}function iD(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(r,t){const n=v0(r,t);return Q5(n)},e.wbg.__wbindgen_object_drop_ref=function(r){eD(r)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(r){console.log(m0(r))},e.wbg.__wbg_log_576ca876af0d4a77=function(r,t){console.log(m0(r),m0(t))},e.wbg.__wbindgen_throw=function(r,t){throw new Error(v0(r,t))},e}function aD(e,r){return Cs=e.exports,fS.__wbindgen_wasm_module=r,Hm=null,Zm=null,Cs}function fS(e){return Ky(this,null,function*(){if(Cs!==void 0)return Cs;const r=iD();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=yield nD(yield e,r);return aD(t,n)})}var Ys;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(Ys||(Ys={}));var Zy;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(Zy||(Zy={}));function oD(e){var r=0;return e&Du.SAMPLED&&(r|=Ys.TEXTURE_BINDING|Ys.COPY_DST|Ys.COPY_SRC),e&Du.STORAGE&&(r|=Ys.TEXTURE_BINDING|Ys.STORAGE_BINDING|Ys.COPY_SRC|Ys.COPY_DST),e&Du.RENDER_TARGET&&(r|=Ys.RENDER_ATTACHMENT|Ys.TEXTURE_BINDING|Ys.COPY_SRC|Ys.COPY_DST),r}function Vy(e){if(e===Ot.U8_R_NORM)return"r8unorm";if(e===Ot.S8_R_NORM)return"r8snorm";if(e===Ot.U8_RG_NORM)return"rg8unorm";if(e===Ot.S8_RG_NORM)return"rg8snorm";if(e===Ot.U32_R)return"r32uint";if(e===Ot.S32_R)return"r32sint";if(e===Ot.F32_R)return"r32float";if(e===Ot.U16_RG)return"rg16uint";if(e===Ot.S16_RG)return"rg16sint";if(e===Ot.F16_RG)return"rg16float";if(e===Ot.U8_RGBA_RT)return"bgra8unorm";if(e===Ot.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===Ot.U8_RGBA_NORM)return"rgba8unorm";if(e===Ot.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===Ot.S8_RGBA_NORM)return"rgba8snorm";if(e===Ot.F32_RGB)return"rgb9e5ufloat";if(e===Ot.U32_RG)return"rg32uint";if(e===Ot.S32_RG)return"rg32sint";if(e===Ot.F32_RG)return"rg32float";if(e===Ot.U16_RGBA)return"rgba16uint";if(e===Ot.S16_RGBA)return"rgba16sint";if(e===Ot.F16_RGBA)return"rgba16float";if(e===Ot.F32_RGBA)return"rgba32float";if(e===Ot.U32_RGBA)return"rgba32uint";if(e===Ot.S32_RGBA)return"rgba32sint";if(e===Ot.D24)return"depth24plus";if(e===Ot.D24_S8)return"depth24plus-stencil8";if(e===Ot.D32F)return"depth32float";if(e===Ot.D32F_S8)return"depth32float-stencil8";if(e===Ot.BC1)return"bc1-rgba-unorm";if(e===Ot.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===Ot.BC2)return"bc2-rgba-unorm";if(e===Ot.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===Ot.BC3)return"bc3-rgba-unorm";if(e===Ot.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===Ot.BC4_SNORM)return"bc4-r-snorm";if(e===Ot.BC4_UNORM)return"bc4-r-unorm";if(e===Ot.BC5_SNORM)return"bc5-rg-snorm";if(e===Ot.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function sD(e){if(e===Yi.TEXTURE_2D)return"2d";if(e===Yi.TEXTURE_CUBE_MAP)return"2d";if(e===Yi.TEXTURE_2D_ARRAY)return"2d";if(e===Yi.TEXTURE_3D)return"3d";throw new Error("whoops")}function uD(e){if(e===Yi.TEXTURE_2D)return"2d";if(e===Yi.TEXTURE_CUBE_MAP)return"cube";if(e===Yi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Yi.TEXTURE_3D)return"3d";throw new Error("whoops")}function lD(e){var r=0;return e&to.INDEX&&(r|=GPUBufferUsage.INDEX),e&to.VERTEX&&(r|=GPUBufferUsage.VERTEX),e&to.UNIFORM&&(r|=GPUBufferUsage.UNIFORM),e&to.STORAGE&&(r|=GPUBufferUsage.STORAGE),e&to.COPY_SRC&&(r|=GPUBufferUsage.COPY_SRC),e&to.INDIRECT&&(r|=GPUBufferUsage.INDIRECT),r|=GPUBufferUsage.COPY_DST,r}function jy(e){if(e===El.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===El.REPEAT)return"repeat";if(e===El.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function hS(e){if(e===os.BILINEAR)return"linear";if(e===os.POINT)return"nearest";throw new Error("whoops")}function cD(e){if(e===$s.LINEAR)return"linear";if(e===$s.NEAREST)return"nearest";if(e===$s.NO_MIP)return"nearest";throw new Error("whoops")}function Dv(e){var r=e;return r.gpuBuffer}function fD(e){var r=e;return r.gpuSampler}function hD(e){var r=e;return r.querySet}function pD(e){if(e===a0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function dD(e){switch(e){case ws.TRIANGLES:return"triangle-list";case ws.POINTS:return"point-list";case ws.TRIANGLE_STRIP:return"triangle-strip";case ws.LINES:return"line-list";case ws.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function vD(e){if(e===Zl.NONE)return"none";if(e===Zl.FRONT)return"front";if(e===Zl.BACK)return"back";throw new Error("whoops")}function mD(e){if(e===Bm.CCW)return"ccw";if(e===Bm.CW)return"cw";throw new Error("whoops")}function gD(e,r){return{topology:dD(e),cullMode:vD(r.cullMode),frontFace:mD(r.frontFace)}}function pS(e){if(e===Ji.ZERO)return"zero";if(e===Ji.ONE)return"one";if(e===Ji.SRC)return"src";if(e===Ji.ONE_MINUS_SRC)return"one-minus-src";if(e===Ji.DST)return"dst";if(e===Ji.ONE_MINUS_DST)return"one-minus-dst";if(e===Ji.SRC_ALPHA)return"src-alpha";if(e===Ji.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Ji.DST_ALPHA)return"dst-alpha";if(e===Ji.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Ji.CONST)return"constant";if(e===Ji.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Ji.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function yD(e){if(e===nu.ADD)return"add";if(e===nu.SUBSTRACT)return"subtract";if(e===nu.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===nu.MIN)return"min";if(e===nu.MAX)return"max";throw new Error("whoops")}function dS(e){return{operation:yD(e.blendMode),srcFactor:pS(e.blendSrcFactor),dstFactor:pS(e.blendDstFactor)}}function vS(e){return e.blendMode===nu.ADD&&e.blendSrcFactor===Ji.ONE&&e.blendDstFactor===Ji.ZERO}function _D(e){if(!(vS(e.rgbBlendState)&&vS(e.alphaBlendState)))return{color:dS(e.rgbBlendState),alpha:dS(e.alphaBlendState)}}function bD(e,r){return{format:Vy(r),blend:_D(e),writeMask:e.channelWriteMask}}function xD(e,r){return r.attachmentsState.map(function(t,n){return bD(t,e[n])})}function _0(e){if(e===Hi.NEVER)return"never";if(e===Hi.LESS)return"less";if(e===Hi.EQUAL)return"equal";if(e===Hi.LEQUAL)return"less-equal";if(e===Hi.GREATER)return"greater";if(e===Hi.NOTEQUAL)return"not-equal";if(e===Hi.GEQUAL)return"greater-equal";if(e===Hi.ALWAYS)return"always";throw new Error("whoops")}function Lv(e){if(e===$o.KEEP)return"keep";if(e===$o.REPLACE)return"replace";if(e===$o.ZERO)return"zero";if(e===$o.DECREMENT_CLAMP)return"decrement-clamp";if(e===$o.DECREMENT_WRAP)return"decrement-wrap";if(e===$o.INCREMENT_CLAMP)return"increment-clamp";if(e===$o.INCREMENT_WRAP)return"increment-wrap";if(e===$o.INVERT)return"invert";throw new Error("whoops")}function ED(e,r){if(!(0,$c.Z)(e))return{format:Vy(e),depthWriteEnabled:!!r.depthWrite,depthCompare:_0(r.depthCompare),depthBias:r.polygonOffset?1:0,depthBiasSlopeScale:r.polygonOffset?1:0,stencilFront:{compare:_0(r.stencilFront.compare),passOp:Lv(r.stencilFront.passOp),failOp:Lv(r.stencilFront.failOp),depthFailOp:Lv(r.stencilFront.depthFailOp)},stencilBack:{compare:_0(r.stencilBack.compare),passOp:Lv(r.stencilBack.passOp),failOp:Lv(r.stencilBack.failOp),depthFailOp:Lv(r.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function SD(e){if(e!==null){if(e===Ot.U16_R)return"uint16";if(e===Ot.U32_R)return"uint32";throw new Error("whoops")}}function AD(e){if(e===Md.VERTEX)return"vertex";if(e===Md.INSTANCE)return"instance";throw new Error("whoops")}function TD(e){if(e===Ot.U8_R)return"uint8x2";if(e===Ot.U8_RG)return"uint8x2";if(e===Ot.U8_RGB)return"uint8x4";if(e===Ot.U8_RGBA)return"uint8x4";if(e===Ot.U8_RG_NORM)return"unorm8x2";if(e===Ot.U8_RGBA_NORM)return"unorm8x4";if(e===Ot.S8_RGB_NORM)return"snorm8x4";if(e===Ot.S8_RGBA_NORM)return"snorm8x4";if(e===Ot.U16_RG_NORM)return"unorm16x2";if(e===Ot.U16_RGBA_NORM)return"unorm16x4";if(e===Ot.S16_RG_NORM)return"snorm16x2";if(e===Ot.S16_RGBA_NORM)return"snorm16x4";if(e===Ot.S16_RG)return"uint16x2";if(e===Ot.F16_RG)return"float16x2";if(e===Ot.F16_RGBA)return"float16x4";if(e===Ot.F32_R)return"float32";if(e===Ot.F32_RG)return"float32x2";if(e===Ot.F32_RGB)return"float32x3";if(e===Ot.F32_RGBA)return"float32x4";throw"whoops"}function wD(e){var r=ch(e);switch(r){case Mr.BC1:case Mr.BC2:case Mr.BC3:case Mr.BC4_SNORM:case Mr.BC4_UNORM:case Mr.BC5_SNORM:case Mr.BC5_UNORM:return!0;default:return!1}}function CD(e){var r=ch(e);switch(r){case Mr.BC1:case Mr.BC2:case Mr.BC3:case Mr.BC4_SNORM:case Mr.BC4_UNORM:case Mr.BC5_SNORM:case Mr.BC5_UNORM:return 4;default:return 1}}function mS(e,r,t,n){switch(t===void 0&&(t=!1),e){case Ot.S8_R:case Ot.S8_R_NORM:case Ot.S8_RG_NORM:case Ot.S8_RGB_NORM:case Ot.S8_RGBA_NORM:{var i=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r);return n&&i.set(new Int8Array(n)),i}case Ot.U8_R:case Ot.U8_R_NORM:case Ot.U8_RG:case Ot.U8_RG_NORM:case Ot.U8_RGB:case Ot.U8_RGB_NORM:case Ot.U8_RGB_SRGB:case Ot.U8_RGBA:case Ot.U8_RGBA_NORM:case Ot.U8_RGBA_SRGB:{var a=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&a.set(new Uint8Array(n)),a}case Ot.S16_R:case Ot.S16_RG:case Ot.S16_RG_NORM:case Ot.S16_RGB_NORM:case Ot.S16_RGBA:case Ot.S16_RGBA_NORM:{var s=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(t?r/2:r);return n&&s.set(new Int16Array(n)),s}case Ot.U16_R:case Ot.U16_RGB:case Ot.U16_RGBA_5551:case Ot.U16_RGBA_NORM:case Ot.U16_RG_NORM:case Ot.U16_R_NORM:{var l=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(t?r/2:r);return n&&l.set(new Uint16Array(n)),l}case Ot.S32_R:{var f=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(t?r/4:r);return n&&f.set(new Int32Array(n)),f}case Ot.U32_R:case Ot.U32_RG:{var d=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(t?r/4:r);return n&&d.set(new Uint32Array(n)),d}case Ot.F32_R:case Ot.F32_RG:case Ot.F32_RGB:case Ot.F32_RGBA:{var _=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(t?r/4:r);return n&&_.set(new Float32Array(n)),_}}var x=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&x.set(new Uint8Array(n)),x}function RD(e){var r=(e&32768)>>15,t=(e&31744)>>10,n=e&1023;return t===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:(r?-1:1)*(1/0):(r?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}function gS(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var xf=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return r.prototype.destroy=function(){},r}(zE.Z),MD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Bindings;var d=a.pipeline;Oi(!!d);var _=a.uniformBufferBindings,x=a.storageBufferBindings,A=a.samplerBindings,C=a.storageTextureBindings;f.numUniformBuffers=(_==null?void 0:_.length)||0;var I=[[],[],[],[]],D=0;if(_&&_.length)for(var Z=0;Z<_.length;Z++){var J=a.uniformBufferBindings[Z],ce=J.binding,xe=J.size,Xe=J.offset,bt=J.buffer,pt={buffer:Dv(bt),offset:Xe!=null?Xe:0,size:xe};I[0].push({binding:ce!=null?ce:D++,resource:pt})}if(A&&A.length){D=0;for(var Z=0;Z<A.length;Z++){var et=(0,kn.pi)((0,kn.pi)({},A[Z]),KE),ce=a.samplerBindings[Z],Pt=ce.texture!==null?ce.texture:f.device.getFallbackTexture(et);et.dimension=Pt.dimension,et.formatKind=HE(Pt.format);var jt=Pt.gpuTextureView;if(I[1].push({binding:(s=ce.textureBinding)!==null&&s!==void 0?s:D++,resource:jt}),ce.samplerBinding!==-1){var Ar=ce.sampler!==null?ce.sampler:f.device.getFallbackSampler(et),gr=fD(Ar);I[1].push({binding:(l=ce.samplerBinding)!==null&&l!==void 0?l:D++,resource:gr})}}}if(x&&x.length){D=0;for(var Z=0;Z<x.length;Z++){var Xr=a.storageBufferBindings[Z],ce=Xr.binding,xe=Xr.size,Xe=Xr.offset,bt=Xr.buffer,pt={buffer:Dv(bt),offset:Xe!=null?Xe:0,size:xe};I[2].push({binding:ce!=null?ce:D++,resource:pt})}}if(C&&C.length){D=0;for(var Z=0;Z<C.length;Z++){var mn=a.storageTextureBindings[Z],ce=mn.binding,Pt=mn.texture,jt=Pt.gpuTextureView;I[3].push({binding:ce!=null?ce:D++,resource:jt})}}var qn=I.findLastIndex(function(ea){return!!ea.length});return f.gpuBindGroup=I.map(function(ea,Ma){return Ma<=qn&&f.device.device.createBindGroup({layout:d.getBindGroupLayout(Ma),entries:ea})}),f}return r}(xf),ID=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.Buffer;var l=a.usage,f=a.viewOrSize,d=!!(l&to.MAP_READ);s.usage=lD(l),d&&(s.usage=to.MAP_READ|to.COPY_DST);var _=!(0,Tv.Z)(f);if(s.view=(0,Tv.Z)(f)?null:f,s.size=(0,Tv.Z)(f)?l0(f,4):l0(f.byteLength,4),(0,Tv.Z)(f))s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:d?_:!1});else{s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:!0});var x=f&&f.constructor||Float32Array;new x(s.gpuBuffer.getMappedRange()).set(f),s.gpuBuffer.unmap()}return s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var s=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-t);var l=n.byteOffset+i,f=l+a,d=a+3&-4;if(d!==a){var _=new Uint8Array(n.buffer.slice(l,f));n=new Uint8Array(d),n.set(_),i=0,l=0,f=d,a=d}for(var x=1024*1024*15,A=0;f-(l+A)>x;)this.device.device.queue.writeBuffer(s,t+A,n.buffer,l+A,x),A+=x;this.device.device.queue.writeBuffer(s,t+A,n.buffer,l+A,a-A)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},r}(xf),yS=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(r,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(r,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(r,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(r.gpuBuffer,t)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(r){Oi(this.gpuComputePassEncoder===null),this.frameCommandEncoder=r,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(r){var t=r,n=Id(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(r){var t=this,n=r;n.gpuBindGroup.forEach(function(i,a){i&&t.gpuComputePassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.pushDebugGroup=function(r){this.gpuComputePassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuComputePassEncoder.insertDebugMarker(r)},e}(),PD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.ComputePipeline,s.gpuComputePipeline=null,s.descriptor=a;var l=a.program,f=l.computeStage;if(f===null)return s;var d={layout:"auto",compute:(0,kn.pi)({},f)};return s.gpuComputePipeline=s.device.device.createComputePipeline(d),s.name!==void 0&&(s.gpuComputePipeline.label=s.name),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},r}(xf),OD=function(e){(0,kn.ZT)(r,e);function r(t){var n,i,a,s,l=t.id,f=t.device,d=t.descriptor,_=e.call(this,{id:l,device:f})||this;_.type=ya.InputLayout;var x=[];try{for(var A=(0,kn.XA)(d.vertexBufferDescriptors),C=A.next();!C.done;C=A.next()){var I=C.value,D=I.arrayStride,Z=I.stepMode,J=I.attributes;x.push({arrayStride:D,stepMode:AD(Z),attributes:[]});try{for(var ce=(a=void 0,(0,kn.XA)(J)),xe=ce.next();!xe.done;xe=ce.next()){var Xe=xe.value,bt=Xe.shaderLocation,pt=Xe.format,et=Xe.offset;x[x.length-1].attributes.push({shaderLocation:bt,format:TD(pt),offset:et})}}catch(Pt){a={error:Pt}}finally{try{xe&&!xe.done&&(s=ce.return)&&s.call(ce)}finally{if(a)throw a.error}}}}catch(Pt){n={error:Pt}}finally{try{C&&!C.done&&(i=A.return)&&i.call(A)}finally{if(n)throw n.error}}return _.indexFormat=SD(d.indexBufferFormat),_.buffers=x,_}return r}(xf),_S=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.Program,s.vertexStage=null,s.fragmentStage=null,s.computeStage=null,s.descriptor=a,a.vertex&&(s.vertexStage=s.createShaderStage(a.vertex,"vertex")),a.fragment&&(s.fragmentStage=s.createShaderStage(a.fragment,"fragment")),a.compute&&(s.computeStage=s.createShaderStage(a.compute,"compute")),s}return r.prototype.setUniformsLegacy=function(t){},r.prototype.createShaderStage=function(t,n){var i,a,s=t.glsl,l=t.wgsl,f=t.entryPoint,d=t.postprocess,_=!1,x=l;if(!x)try{x=this.device.glsl_compile(s,n,_)}catch(J){throw console.error(J,s),new Error("whoops")}var A=function(J){if(!x.includes(J))return"continue";x=x.replace("var T_".concat(J,": texture_2d<f32>;"),"var T_".concat(J,": texture_depth_2d;")),x=x.replace(new RegExp("textureSample\\(T_".concat(J,"(.*)\\);$"),"gm"),function(ce,xe){return"vec4<f32>(textureSample(T_".concat(J).concat(xe,"), 0.0, 0.0, 0.0);")})};try{for(var C=(0,kn.XA)(["u_TextureFramebufferDepth"]),I=C.next();!I.done;I=C.next()){var D=I.value;A(D)}}catch(J){i={error:J}}finally{try{I&&!I.done&&(a=C.return)&&a.call(C)}finally{if(i)throw i.error}}d&&(x=d(x));var Z=this.device.device.createShaderModule({code:x});return{module:Z,entryPoint:f||"main"}},r}(xf),kD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ya.QueryPool;var l=a.elemCount,f=a.type;return s.querySet=s.device.device.createQuerySet({type:pD(f),count:l}),s.resolveBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),s.cpuBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s.results=null,s}return r.prototype.queryResultOcclusion=function(t){return this.results===null?null:this.results[t]!==BigInt(0)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},r}(xf),DD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ya.Readback,a}return r.prototype.readTexture=function(t,n,i,a,s,l,f,d){return f===void 0&&(f=0),(0,kn.mG)(this,void 0,void 0,function(){var _,x,A,C,I,D,Z,J;return(0,kn.Jh)(this,function(ce){return _=t,x=0,A=gS(_.gpuTextureformat),C=Math.ceil(a/A.width)*A.length,I=Math.ceil(C/256)*256,D=I*s,Z=this.device.createBuffer({usage:to.STORAGE|to.MAP_READ|to.COPY_DST,hint:bf.STATIC,viewOrSize:D}),J=this.device.device.createCommandEncoder(),J.copyTextureToBuffer({texture:_.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(x,0)}},{buffer:Z.gpuBuffer,offset:0,bytesPerRow:I},{width:a,height:s,depthOrArrayLayers:1}),this.device.device.queue.submit([J.finish()]),[2,this.readBuffer(Z,0,l.byteLength===D?l:null,f,D,_.format,!0,!1,C,I,s)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,f,d){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},r.prototype.readBuffer=function(t,n,i,a,s,l,f,d,_,x,A){var C=this;n===void 0&&(n=0),i===void 0&&(i=null),s===void 0&&(s=0),l===void 0&&(l=Ot.U8_RGB),f===void 0&&(f=!1),_===void 0&&(_=0),x===void 0&&(x=0),A===void 0&&(A=0);var I=t,D=s||I.size,Z=i||I.view,J=Z&&Z.constructor&&Z.constructor.BYTES_PER_ELEMENT||jE(l),ce=I;if(!(I.usage&to.MAP_READ&&I.usage&to.COPY_DST)){var xe=this.device.device.createCommandEncoder();ce=this.device.createBuffer({usage:to.STORAGE|to.MAP_READ|to.COPY_DST,hint:bf.STATIC,viewOrSize:D}),xe.copyBufferToBuffer(I.gpuBuffer,n,ce.gpuBuffer,0,D),this.device.device.queue.submit([xe.finish()])}return new Promise(function(Xe,bt){ce.gpuBuffer.mapAsync(Zy.READ,n,D).then(function(){var pt=ce.gpuBuffer.getMappedRange(n,D),et=Z;if(f)et===null?et=mS(l,D,!0,pt):et=mS(l,et.buffer,void 0,pt);else if(et===null)switch(J){case 1:et=new Uint8Array(D),et.set(new Uint8Array(pt));break;case 2:et=C.getHalfFloatAsFloatRGBAArrayBuffer(D/2,pt);break;case 4:et=new Float32Array(D/4),et.set(new Float32Array(pt));break}else switch(J){case 1:et=new Uint8Array(et.buffer),et.set(new Uint8Array(pt));break;case 2:et=C.getHalfFloatAsFloatRGBAArrayBuffer(D/2,pt,Z);break;case 4:var Pt=Z&&Z.constructor||Float32Array;et=new Pt(et.buffer),et.set(new Pt(pt));break}if(_!==x){J===1&&!f&&(_*=2,x*=2);for(var jt=new Uint8Array(et.buffer),Ar=_,gr=0,Xr=1;Xr<A;++Xr){gr=Xr*x;for(var mn=0;mn<_;++mn)jt[Ar++]=jt[gr++]}J!==0&&!f?et=new Float32Array(jt.buffer,0,Ar/4):et=new Uint8Array(jt.buffer,0,Ar)}ce.gpuBuffer.unmap(),Xe(et)},function(pt){return bt(pt)})})},r.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i){i||(i=new Float32Array(t));for(var a=new Uint16Array(n);t--;)i[t]=RD(a[t]);return i},r}(xf),bS=function(){function e(r){this.device=r,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var r;return((r=this.renderBundle)===null||r===void 0?void 0:r.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(r,t){return Oi(t<r.mipLevelCount),r.mipLevelCount===1?r.gpuTextureView:r.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(r){var t,n,i,a,s,l;this.descriptor=r,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var f=r.colorAttachment.length;this.gfxColorAttachment.length=f,this.gfxColorResolveTo.length=f;for(var d=0;d<r.colorAttachment.length;d++){var _=r.colorAttachment[d],x=r.colorResolveTo[d];if(_===null&&x!==null&&(_=x,x=null),this.gfxColorAttachment[d]=_,this.gfxColorResolveTo[d]=x,this.gfxColorAttachmentLevel[d]=((t=r.colorAttachmentLevel)===null||t===void 0?void 0:t[d])||0,this.gfxColorResolveToLevel[d]=((n=r.colorResolveToLevel)===null||n===void 0?void 0:n[d])||0,_!==null){this.gpuColorAttachments[d]===void 0&&(this.gpuColorAttachments[d]={});var A=this.gpuColorAttachments[d];A.view=this.getTextureView(_,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[d])||0);var C=(s=(a=r.colorClearColor)===null||a===void 0?void 0:a[d])!==null&&s!==void 0?s:"load";C==="load"?A.loadOp="load":(A.loadOp="clear",A.clearValue=C),A.storeOp=!((l=r.colorStore)===null||l===void 0)&&l[d]?"store":"discard",A.resolveTarget=void 0,x!==null&&(_.sampleCount>1?A.resolveTarget=this.getTextureView(x,this.gfxColorResolveToLevel[d]):A.storeOp="store")}else{this.gpuColorAttachments.length=d,this.gfxColorAttachment.length=d,this.gfxColorResolveTo.length=d;break}}if(this.gfxDepthStencilAttachment=r.depthStencilAttachment,this.gfxDepthStencilResolveTo=r.depthStencilResolveTo,r.depthStencilAttachment){var I=r.depthStencilAttachment,A=this.gpuDepthStencilAttachment;A.view=I.gpuTextureView;var D=!!(Cv(I.format)&wn.Depth);D?(r.depthClearValue==="load"?A.depthLoadOp="load":(A.depthLoadOp="clear",A.depthClearValue=r.depthClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.depthStoreOp="store":A.depthStoreOp="discard"):(A.depthLoadOp=void 0,A.depthStoreOp=void 0);var Z=!!(Cv(I.format)&wn.Stencil);Z?(r.stencilClearValue==="load"?A.stencilLoadOp="load":(A.stencilLoadOp="clear",A.stencilClearValue=r.stencilClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.stencilStoreOp="store":A.stencilStoreOp="discard"):(A.stencilLoadOp=void 0,A.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,$c.Z)(r.occlusionQueryPool)?void 0:hD(r.occlusionQueryPool)},e.prototype.beginRenderPass=function(r,t){Oi(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(t),this.frameCommandEncoder=r,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(r,t){var n=this.device.swapChainHeight;return n-r-t},e.prototype.setViewport=function(r,t,n,i,a,s){a===void 0&&(a=0),s===void 0&&(s=1),this.gpuRenderPassEncoder.setViewport(r,this.flipY(t,i),n,i,a,s)},e.prototype.setScissorRect=function(r,t,n,i){this.gpuRenderPassEncoder.setScissorRect(r,this.flipY(t,i),n,i)},e.prototype.setPipeline=function(r){var t=r,n=Id(t.gpuRenderPipeline);this.getEncoder().setPipeline(n)},e.prototype.setVertexInput=function(r,t,n){if(r!==null){var i=this.getEncoder(),a=r;n!==null&&i.setIndexBuffer(Dv(n.buffer),Id(a.indexFormat),n.offset);for(var s=0;s<t.length;s++){var l=t[s];l!==null&&i.setVertexBuffer(s,Dv(l.buffer),l.offset)}}},e.prototype.setBindings=function(r){var t=r,n=this.getEncoder();t.gpuBindGroup.forEach(function(i,a){i&&n.setBindGroup(a,t.gpuBindGroup[a])})},e.prototype.setStencilReference=function(r){this.gpuRenderPassEncoder.setStencilReference(r)},e.prototype.draw=function(r,t,n,i){this.getEncoder().draw(r,t,n,i)},e.prototype.drawIndexed=function(r,t,n,i,a){this.getEncoder().drawIndexed(r,t,n,i,a)},e.prototype.drawIndirect=function(r,t){this.getEncoder().drawIndirect(Dv(r),t)},e.prototype.drawIndexedIndirect=function(r,t){this.getEncoder().drawIndexedIndirect(Dv(r),t)},e.prototype.beginOcclusionQuery=function(r){this.gpuRenderPassEncoder.beginOcclusionQuery(r)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(r){this.gpuRenderPassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuRenderPassEncoder.insertDebugMarker(r)},e.prototype.beginBundle=function(r){this.renderBundle=r},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(r){this.gpuRenderPassEncoder.executeBundles(r.map(function(t){return t.renderBundle}))},e.prototype.finish=function(){var r;(r=this.gpuRenderPassEncoder)===null||r===void 0||r.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var n=this.gfxColorAttachment[t],i=this.gfxColorResolveTo[t];n!==null&&i!==null&&n.sampleCount===1&&this.copyAttachment(i,this.gfxColorAttachmentLevel[t],n,this.gfxColorResolveToLevel[t])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(r,t,n,i){Oi(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},s={texture:r.gpuTexture,mipLevel:t};Oi(n.width>>>i===r.width>>>t),Oi(n.height>>>i===r.height>>>t),Oi(!!(n.usage&Ys.COPY_SRC)),Oi(!!(r.usage&Ys.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(a,s,[r.width,r.height,1])},e}(),LD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ya.RenderPipeline,s.isCreatingAsync=!1,s.gpuRenderPipeline=null,s.descriptor=a,s.device.createRenderPipelineInternal(s,!1),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},r}(xf),BD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ya.Sampler;var d=a.lodMinClamp,_=a.mipmapFilter===$s.NO_MIP?a.lodMinClamp:a.lodMaxClamp,x=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;return x>1&&Oi(a.minFilter===os.BILINEAR&&a.magFilter===os.BILINEAR&&a.mipmapFilter===$s.LINEAR),f.gpuSampler=f.device.device.createSampler({addressModeU:jy(a.addressModeU),addressModeV:jy(a.addressModeV),addressModeW:jy((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:d,lodMaxClamp:_,minFilter:hS(a.minFilter),magFilter:hS(a.magFilter),mipmapFilter:cD(a.mipmapFilter),compare:a.compareFunction!==void 0?_0(a.compareFunction):void 0,maxAnisotropy:x}),f}return r}(xf),b0=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.skipCreate,l=t.sampleCount,f=e.call(this,{id:n,device:i})||this;f.type=ya.Texture,f.flipY=!1;var d=a.format,_=a.dimension,x=a.width,A=a.height,C=a.depthOrArrayLayers,I=a.mipLevelCount,D=a.usage,Z=a.pixelStore;return f.flipY=!!(Z!=null&&Z.unpackFlipY),f.device.createTextureShared({format:d,dimension:_!=null?_:Yi.TEXTURE_2D,width:x,height:A,depthOrArrayLayers:C!=null?C:1,mipLevelCount:I!=null?I:1,usage:D,sampleCount:l!=null?l:1},f,s),f}return r.prototype.textureFromImageBitmapOrCanvas=function(t,n,i){for(var a=n[0].width,s=n[0].height,l={size:{width:a,height:s,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},f=t.createTexture(l),d=0;d<n.length;d++)t.queue.copyExternalImageToTexture({source:n[d],flipY:this.flipY},{texture:f,origin:[0,0,d]},[a,s]);return[f,a,s]},r.prototype.isImageBitmapOrCanvases=function(t){var n=t[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},r.prototype.isVideo=function(t){var n=t[0];return n instanceof HTMLVideoElement},r.prototype.setImageData=function(t,n){var i,a=this,s=this.device.device,l,f,d;if(this.isImageBitmapOrCanvases(t))i=(0,kn.CR)(this.textureFromImageBitmapOrCanvas(s,t,this.depthOrArrayLayers),3),l=i[0],f=i[1],d=i[2];else if(this.isVideo(t))l=s.importExternalTexture({source:t[0]});else{var _=gS(this.gpuTextureformat),x=Math.ceil(this.width/_.width)*_.length;t.forEach(function(A){s.queue.writeTexture({texture:a.gpuTexture},A,{bytesPerRow:x},{width:a.width,height:a.height})})}this.width=f,this.height=d,l&&(this.gpuTexture=l),this.gpuTextureView=this.gpuTexture.createView({dimension:uD(this.dimension)})},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},r}(xf),FD=function(e){(0,kn.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ya.RenderBundle,a.renderBundleEncoder=a.device.device.createRenderBundleEncoder({colorFormats:[a.device.swapChainFormat]}),a}return r.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},r}(xf),ND=function(){function e(r,t,n,i,a,s){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Ys.RENDER_ATTACHMENT|Ys.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=lh.UPPER_LEFT,this.clipSpaceNearZ=wv.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=s,this.fallbackTexture2D=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Yi.TEXTURE_2D,Yo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Yi.TEXTURE_2D_ARRAY,Yo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Yi.TEXTURE_3D,Yo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Yi.TEXTURE_CUBE_MAP,Yo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:El.REPEAT,addressModeV:El.REPEAT,minFilter:os.POINT,magFilter:os.POINT,mipmapFilter:$s.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:El.REPEAT,addressModeV:El.REPEAT,minFilter:os.POINT,magFilter:os.POINT,mipmapFilter:$s.NEAREST,compareFunction:Hi.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(r,t){this.swapChainWidth===r&&this.swapChainHeight===t||(this.swapChainWidth=r,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var r=this.canvasContext.getCurrentTexture(),t=r.createView(),n=new b0({id:0,device:this,descriptor:{format:Ot.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Yi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=r,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){Oi(this.frameCommandEncoderPool.length===0)},e.prototype.endFrame=function(){Oi(this.frameCommandEncoderPool.every(function(r){return r!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(r){return r.finish()})),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(r){return new ID({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new b0({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new BD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){var t=new b0({id:this.getNextUniqueId(),device:this,descriptor:(0,kn.pi)((0,kn.pi)({},r),{dimension:Yi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Du.RENDER_TARGET}),sampleCount:r.sampleCount});return t.depthOrArrayLayers=1,t.type=ya.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.depthOrArrayLayers,l=t.sampleCount,f=t.mipLevelCount,d=t.gpuTexture,_=t.gpuTextureView,x=t.usage;Oi(!!(x&Ys.RENDER_ATTACHMENT));var A=new b0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:s,dimension:Yi.TEXTURE_2D,mipLevelCount:f,usage:x},skipCreate:!0});return A.depthOrArrayLayers=s,A.sampleCount=l,A.gpuTexture=d,A.gpuTextureView=_,A},e.prototype.createProgram=function(r){var t,n;return!((t=r.vertex)===null||t===void 0)&&t.glsl&&(r.vertex.glsl=jp(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((n=r.fragment)===null||n===void 0)&&n.glsl&&(r.fragment.glsl=jp(this.queryVendorInfo(),"frag",r.fragment.glsl)),new _S({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createProgramSimple=function(r){return new _S({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTextureShared=function(r,t,n){var i={width:r.width,height:r.height,depthOrArrayLayers:r.depthOrArrayLayers},a=r.mipLevelCount,s=Vy(r.format),l=sD(r.dimension),f=oD(r.usage);if(t.gpuTextureformat=s,t.dimension=r.dimension,t.format=r.format,t.width=r.width,t.height=r.height,t.depthOrArrayLayers=r.depthOrArrayLayers,t.mipLevelCount=a,t.usage=f,t.sampleCount=r.sampleCount,!n){var d=this.device.createTexture({size:i,mipLevelCount:a,format:s,dimension:l,sampleCount:r.sampleCount,usage:f}),_=d.createView();t.gpuTexture=d,t.gpuTextureView=_}},e.prototype.getFallbackSampler=function(r){var t=r.formatKind;return t===Yo.Depth&&r.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(r){var t=r.dimension,n=r.formatKind;if(t===Yi.TEXTURE_2D)return n===Yo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Yi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Yi.TEXTURE_3D)return this.fallbackTexture3D;if(t===Yi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(r,t){var n=r===Yi.TEXTURE_CUBE_MAP?6:1,i=t===Yo.Float?Ot.U8_RGBA_NORM:Ot.D24;return this.createTexture({dimension:r,format:i,usage:Du.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(r){return new MD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new OD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePipeline=function(r){return new PD({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new LD({id:this.getNextUniqueId(),device:this,descriptor:(0,kn.pi)({},r)})},e.prototype.createQueryPool=function(r,t){return new kD({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(r,t){var n;if(r.gpuRenderPipeline===null){var i=r.descriptor,a=i.program,s=a.vertexStage,l=a.fragmentStage;if(!(s===null||l===null)){var f=i.megaStateDescriptor||{},d=f.stencilBack,_=f.stencilFront,x=(0,kn._T)(f,["stencilBack","stencilFront"]),A=Iv(Pd);i.megaStateDescriptor=(0,kn.pi)((0,kn.pi)((0,kn.pi)({},A),{stencilBack:(0,kn.pi)((0,kn.pi)({},A.stencilBack),d),stencilFront:(0,kn.pi)((0,kn.pi)({},A.stencilFront),_)}),x);var C=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(Xe,bt){i.megaStateDescriptor.attachmentsState[bt]||(i.megaStateDescriptor.attachmentsState[bt]=YE(void 0,C))});var I=gD((n=i.topology)!==null&&n!==void 0?n:ws.TRIANGLES,i.megaStateDescriptor),D=xD(i.colorAttachmentFormats,i.megaStateDescriptor),Z=ED(i.depthStencilAttachmentFormat,i.megaStateDescriptor),J=void 0;i.inputLayout!==null&&(J=i.inputLayout.buffers);var ce=i.sampleCount,xe={layout:"auto",vertex:(0,kn.pi)((0,kn.pi)({},s),{buffers:J}),primitive:I,depthStencil:Z,multisample:{count:ce},fragment:(0,kn.pi)((0,kn.pi)({},l),{targets:D})};r.gpuRenderPipeline=this.device.createRenderPipeline(xe)}}},e.prototype.createReadback=function(){return new DD({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new FD({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(r){var t=this.renderPassPool.pop();t===void 0&&(t=new bS(this));var n=this.frameCommandEncoderPool.pop();return n===void 0&&(n=this.device.createCommandEncoder()),t.beginRenderPass(n,r),t},e.prototype.createComputePass=function(){var r=this.computePassPool.pop();r===void 0&&(r=new yS);var t=this.frameCommandEncoderPool.pop();return t===void 0&&(t=this.device.createCommandEncoder()),r.beginComputePass(t),r},e.prototype.submitPass=function(r){var t=r;t instanceof bS?(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.renderPassPool.push(t)):t instanceof yS&&(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.computePassPool.push(t))},e.prototype.copySubTexture2D=function(r,t,n,i,a,s,l){var f=this.device.createCommandEncoder(),d=r,_=i,x={texture:_.gpuTexture,origin:[a,s,0],mipLevel:0,aspect:"all"},A={texture:d.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};Oi(!!(_.usage&Ys.COPY_SRC)),Oi(!!(d.usage&Ys.COPY_DST)),f.copyTextureToTexture(x,A,[_.width,_.height,l||1]),this.device.queue.submit([f.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(r,t,n){if(wD(r)){if(!this.featureTextureCompressionBC)return!1;var i=CD(r);return t%i!==0||n%i!==0?!1:this.featureTextureCompressionBC}switch(r){case Ot.U16_RGBA_NORM:return!1;case Ot.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){var t=r;return t.descriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ya.Buffer){var n=r;n.gpuBuffer.label=t}else if(r.type===ya.Texture){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ya.RenderTarget){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ya.Sampler){var n=r;n.gpuSampler.label=t}else if(r.type===ya.RenderPipeline){var n=r;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(r,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(r){},e.prototype.pipelineQueryReady=function(r){var t=r;return t.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(r){var t=r;this.createRenderPipelineInternal(t,!1)},e}(),UD=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,kn.mG)(this,void 0,void 0,function(){var t,n,i,a,s,l,f,d;return(0,kn.Jh)(this,function(_){switch(_.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,_.label=1;case 1:return _.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=_.sent(),[3,4];case 3:return i=_.sent(),console.log(i),[3,4];case 4:return t===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc","float32-filterable"],s=a.filter(function(x){return t.features.has(x)}),[4,t.requestDevice({requiredFeatures:s})]);case 5:if(l=_.sent(),l&&(f=this.pluginOptions.onContextLost,l.lost.then(function(){f&&f()})),l===null)return[2,null];if(d=r.getContext("webgpu"),!d)return[2,null];_.label=6;case 6:return _.trys.push([6,8,,9]),[4,fS(this.pluginOptions.shaderCompilerPath)];case 7:return _.sent(),[3,9];case 8:return _.sent(),[3,9];case 9:return[2,new ND(t,l,r,d,rD,Wm&&new Wm)]}})})},e}(),zD=pi.isPlainObject,ZD=pi.isTypedArray,VD=function(){function e(r,t){(0,ne.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,s=t.uniforms,l=t.primitive,f=t.count,d=t.elements,_=t.depth,x=t.cull,A=t.instances,C={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:lh.LOWER_LEFT,clipSpaceNearZ:wv.NEGATIVE_ONE,supportMRT:!1},I={};this.options=t,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(xe){I[xe]=r.prop(xe)}));var D={};Object.keys(a).forEach(function(xe){D[xe]=a[xe].get()});var Z=bg(jp(C,"frag",i,null,!1)),J=bg(jp(C,"vert",n,null,!1)),ce={attributes:D,frag:Z,uniforms:I,vert:J,colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:O4[l===void 0?K.TRIANGLES:l]};A&&(ce.instances=A),f?ce.count=f:d&&(ce.elements=d.get()),this.initDepthDrawParams({depth:_},ce),this.initCullDrawParams({cull:x},ce),this.drawCommand=r(ce),this.drawParams=ce}return(0,W.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(a){i[a]=t[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(i){n[i]=t[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,j.Z)((0,j.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=(0,j.Z)((0,j.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(s){var l=(0,Hs.Z)(i[s]);l==="boolean"||l==="number"||Array.isArray(i[s])||i[s].BYTES_PER_ELEMENT?a[s]=i[s]:a[s]=i[s].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),a.stencil=this.getStencilDrawParams(t),a.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var t;(t=this.drawParams)===null||t===void 0||(t=t.elements)===null||t===void 0||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:B4[i.func||K.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:i0[s&&s.srcRGB||K.SRC_ALPHA],srcAlpha:i0[s&&s.srcAlpha||K.SRC_ALPHA],dstRGB:i0[s&&s.dstRGB||K.ONE_MINUS_SRC_ALPHA],dstAlpha:i0[s&&s.dstAlpha||K.ONE_MINUS_SRC_ALPHA]},equation:{rgb:UE[l&&l.rgb||K.FUNC_ADD],alpha:UE[l&&l.alpha||K.FUNC_ADD]},color:d}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,f=i.func,d=f===void 0?{cmp:K.ALWAYS,ref:0,mask:-1}:f,_=i.opFront,x=_===void 0?{fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP}:_,A=i.opBack,C=A===void 0?{fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP}:A;return{enable:!!a,mask:l,func:(0,j.Z)((0,j.Z)({},d),{},{cmp:F4[d.cmp]}),opFront:{fail:Av[x.fail],zfail:Av[x.zfail],zpass:Av[x.zpass]},opBack:{fail:Av[C.fail],zfail:Av[C.zfail],zpass:Av[C.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var i=t.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,s=i.face,l=s===void 0?K.BACK:s;n.cull={enable:!!a,face:N4[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||ZD(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}zD(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(t,"[").concat(f,"]"))})})}}]),e}(),jD=function(){function e(r,t){(0,ne.Z)(this,e),(0,F.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?K.UNSIGNED_BYTE:i,s=t.width,l=t.height,f=t.flipY,d=f===void 0?!1:f,_=t.format,x=_===void 0?K.RGBA:_,A=t.mipmap,C=A===void 0?!1:A,I=t.wrapS,D=I===void 0?K.CLAMP_TO_EDGE:I,Z=t.wrapT,J=Z===void 0?K.CLAMP_TO_EDGE:Z,ce=t.aniso,xe=ce===void 0?0:ce,Xe=t.alignment,bt=Xe===void 0?1:Xe,pt=t.premultiplyAlpha,et=pt===void 0?!1:pt,Pt=t.mag,jt=Pt===void 0?K.NEAREST:Pt,Ar=t.min,gr=Ar===void 0?K.NEAREST:Ar,Xr=t.colorSpace,mn=Xr===void 0?K.BROWSER_DEFAULT_WEBGL:Xr,qn=t.x,ea=qn===void 0?0:qn,Ma=t.y,Ko=Ma===void 0?0:Ma,Vo=t.copy,qs=Vo===void 0?!1:Vo;this.width=s,this.height=l;var Al={width:s,height:l,type:Dy[a],format:k4[x],wrapS:NE[D],wrapT:NE[J],mag:FE[jt],min:FE[gr],alignment:bt,flipY:d,colorSpace:L4[mn],premultiplyAlpha:et,aniso:xe,x:ea,y:Ko,copy:qs};n&&(Al.data=n),typeof C=="number"?Al.mipmap=D4[C]:typeof C=="boolean"&&(Al.mipmap=C),this.texture=r.texture(Al)}return(0,W.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),xS,ES,HD=(xS=(0,Zt.b2)(),xS(ES=function(){function e(){var r=this;(0,ne.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return"WebGL1"}),(0,F.Z)(this,"createModel",function(t){return new VD(r.gl,t)}),(0,F.Z)(this,"createAttribute",function(t){return new P4(r.gl,t)}),(0,F.Z)(this,"createBuffer",function(t){return new U4(r.gl,t)}),(0,F.Z)(this,"createElements",function(t){return new z4(r.gl,t)}),(0,F.Z)(this,"createTexture2D",function(t){return new jD(r.gl,t)}),(0,F.Z)(this,"createFramebuffer",function(t){return new Z4(r.gl,t)}),(0,F.Z)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),(0,F.Z)(this,"useFramebufferAsync",function(){var t=(0,Nt.Z)(ve().mark(function n(i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:r.gl({framebuffer:i?i.get():null})(a);case 1:case"end":return l.stop()}},n)}));return function(n,i){return t.apply(this,arguments)}}()),(0,F.Z)(this,"clear",function(t){var n,i=t.color,a=t.depth,s=t.stencil,l=t.framebuffer,f=l===void 0?null:l,d={color:i,depth:a,stencil:s};d.framebuffer=f===null?f:f.get(),(n=r.gl)===null||n===void 0||n.clear(d)}),(0,F.Z)(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,s=t.height;r.gl._gl.viewport(n,i,a,s),r.width=a,r.height=s,r.gl._refresh()}),(0,F.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,f={x:i,y:a,width:s,height:l};return n&&(f.framebuffer=n.get()),r.gl.read(f)}),(0,F.Z)(this,"readPixelsAsync",function(){var t=(0,Nt.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",r.readPixels(i));case 1:case"end":return s.stop()}},n)}));return function(n){return t.apply(this,arguments)}}()),(0,F.Z)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),(0,F.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,F.Z)(this,"getCanvas",function(){return r.canvas}),(0,F.Z)(this,"getGLContext",function(){return r.gl._gl}),(0,F.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.gl)===null||t===void 0||(t=t._gl)===null||t===void 0||(t=t.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),r.gl.destroy(),r.gl=null})}return(0,W.Z)(e,[{key:"init",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a,s){var l=this;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.canvas=i,!s){d.next=5;break}this.gl=s,d.next=8;break;case 5:return d.next=7,new Promise(function(_,x){I4()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(C,I){(C||!I)&&x(C),_(I)}})});case 7:this.gl=d.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return d.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||ES),WD=function(){function e(r,t){(0,ne.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,f=t.divisor,d=t.shaderLocation;this.buffer=n,this.attribute={shaderLocation:d,buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,W.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Wp,Qh,Bv,Gm,Xm,fh,x0,Od,Lu,hh,ph,E0=(Wp={},(0,F.Z)(Wp,K.FLOAT,Float32Array),(0,F.Z)(Wp,K.UNSIGNED_BYTE,Uint8Array),(0,F.Z)(Wp,K.SHORT,Int16Array),(0,F.Z)(Wp,K.UNSIGNED_SHORT,Uint16Array),(0,F.Z)(Wp,K.INT,Int32Array),(0,F.Z)(Wp,K.UNSIGNED_INT,Uint32Array),Wp),GD=(Qh={},(0,F.Z)(Qh,K.POINTS,ws.POINTS),(0,F.Z)(Qh,K.LINES,ws.LINES),(0,F.Z)(Qh,K.LINE_LOOP,ws.LINES),(0,F.Z)(Qh,K.LINE_STRIP,ws.LINE_STRIP),(0,F.Z)(Qh,K.TRIANGLES,ws.TRIANGLES),(0,F.Z)(Qh,K.TRIANGLE_FAN,ws.TRIANGLES),(0,F.Z)(Qh,K.TRIANGLE_STRIP,ws.TRIANGLE_STRIP),Qh),XD=(Bv={},(0,F.Z)(Bv,1,Ot.F32_R),(0,F.Z)(Bv,2,Ot.F32_RG),(0,F.Z)(Bv,3,Ot.F32_RGB),(0,F.Z)(Bv,4,Ot.F32_RGBA),Bv),$D=(Gm={},(0,F.Z)(Gm,K.STATIC_DRAW,bf.STATIC),(0,F.Z)(Gm,K.DYNAMIC_DRAW,bf.DYNAMIC),(0,F.Z)(Gm,K.STREAM_DRAW,bf.DYNAMIC),Gm),SS=(Xm={},(0,F.Z)(Xm,K.REPEAT,El.REPEAT),(0,F.Z)(Xm,K.CLAMP_TO_EDGE,El.CLAMP_TO_EDGE),(0,F.Z)(Xm,K.MIRRORED_REPEAT,El.MIRRORED_REPEAT),Xm),YD=(fh={},(0,F.Z)(fh,K.NEVER,Hi.NEVER),(0,F.Z)(fh,K.ALWAYS,Hi.ALWAYS),(0,F.Z)(fh,K.LESS,Hi.LESS),(0,F.Z)(fh,K.LEQUAL,Hi.LEQUAL),(0,F.Z)(fh,K.GREATER,Hi.GREATER),(0,F.Z)(fh,K.GEQUAL,Hi.GEQUAL),(0,F.Z)(fh,K.EQUAL,Hi.EQUAL),(0,F.Z)(fh,K.NOTEQUAL,Hi.NOTEQUAL),fh),qD=(x0={},(0,F.Z)(x0,K.FRONT,Zl.FRONT),(0,F.Z)(x0,K.BACK,Zl.BACK),x0),AS=(Od={},(0,F.Z)(Od,K.FUNC_ADD,nu.ADD),(0,F.Z)(Od,K.MIN_EXT,nu.MIN),(0,F.Z)(Od,K.MAX_EXT,nu.MAX),(0,F.Z)(Od,K.FUNC_SUBTRACT,nu.SUBSTRACT),(0,F.Z)(Od,K.FUNC_REVERSE_SUBTRACT,nu.REVERSE_SUBSTRACT),Od),S0=(Lu={},(0,F.Z)(Lu,K.ZERO,Ji.ZERO),(0,F.Z)(Lu,K.ONE,Ji.ONE),(0,F.Z)(Lu,K.SRC_COLOR,Ji.SRC),(0,F.Z)(Lu,K.ONE_MINUS_SRC_COLOR,Ji.ONE_MINUS_SRC),(0,F.Z)(Lu,K.SRC_ALPHA,Ji.SRC_ALPHA),(0,F.Z)(Lu,K.ONE_MINUS_SRC_ALPHA,Ji.ONE_MINUS_SRC_ALPHA),(0,F.Z)(Lu,K.DST_COLOR,Ji.DST),(0,F.Z)(Lu,K.ONE_MINUS_DST_COLOR,Ji.ONE_MINUS_DST),(0,F.Z)(Lu,K.DST_ALPHA,Ji.DST_ALPHA),(0,F.Z)(Lu,K.ONE_MINUS_DST_ALPHA,Ji.ONE_MINUS_DST_ALPHA),(0,F.Z)(Lu,K.CONSTANT_COLOR,Ji.CONST),(0,F.Z)(Lu,K.ONE_MINUS_CONSTANT_COLOR,Ji.ONE_MINUS_CONSTANT),(0,F.Z)(Lu,K.CONSTANT_ALPHA,Ji.CONST),(0,F.Z)(Lu,K.ONE_MINUS_CONSTANT_ALPHA,Ji.ONE_MINUS_CONSTANT),(0,F.Z)(Lu,K.SRC_ALPHA_SATURATE,Ji.SRC_ALPHA_SATURATE),Lu),Fv=(hh={},(0,F.Z)(hh,K.REPLACE,$o.REPLACE),(0,F.Z)(hh,K.KEEP,$o.KEEP),(0,F.Z)(hh,K.ZERO,$o.ZERO),(0,F.Z)(hh,K.INVERT,$o.INVERT),(0,F.Z)(hh,K.INCR,$o.INCREMENT_CLAMP),(0,F.Z)(hh,K.DECR,$o.DECREMENT_CLAMP),(0,F.Z)(hh,K.INCR_WRAP,$o.INCREMENT_WRAP),(0,F.Z)(hh,K.DECR_WRAP,$o.DECREMENT_WRAP),hh),KD=(ph={},(0,F.Z)(ph,K.ALWAYS,Hi.ALWAYS),(0,F.Z)(ph,K.EQUAL,Hi.EQUAL),(0,F.Z)(ph,K.GEQUAL,Hi.GEQUAL),(0,F.Z)(ph,K.GREATER,Hi.GREATER),(0,F.Z)(ph,K.LEQUAL,Hi.LEQUAL),(0,F.Z)(ph,K.LESS,Hi.LESS),(0,F.Z)(ph,K.NEVER,Hi.NEVER),(0,F.Z)(ph,K.NOTEQUAL,Hi.NOTEQUAL),ph),QD={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function A0(e){return Object.prototype.toString.call(e)in QD}function JD(e,r){for(var t=e.length,n=Math.ceil(t/3),i=t+n,a=new Float32Array(i),s=0;s<i;s+=4)a[s]=e[s/4*3],a[s+1]=e[s/4*3+1],a[s+2]=e[s/4*3+2],a[s+3]=r;return a}var eL=function(){function e(r,t){(0,ne.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type,s=t.isUBO,l=t.label,f;A0(n)?f=n:f=new E0[this.type||K.FLOAT](n),this.type=a,this.size=f.byteLength,this.buffer=r.createBuffer({viewOrSize:f,usage:s?to.UNIFORM:to.VERTEX,hint:$D[i||K.STATIC_DRAW]}),l&&r.setResourceName(this.buffer,l)}return(0,W.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset,a;A0(n)?a=n:a=new E0[this.type||K.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}();function TS(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=tL(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function tL(e,r){if(e){if(typeof e=="string")return wS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wS(e,r)}}function wS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Da(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e+=r,e+=e<<10,e+=e>>>6,e>>>0}function CS(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function RS(e){return 0}var rL=(0,W.Z)(function e(){(0,ne.Z)(this,e),(0,F.Z)(this,"keys",[]),(0,F.Z)(this,"values",[])}),T0=function(){function e(r,t){(0,ne.Z)(this,e),(0,F.Z)(this,"buckets",new Map),this.keyEqualFunc=r,this.keyHashFunc=t}return(0,W.Z)(e,[{key:"findBucketIndex",value:function(t,n){for(var i=0;i<t.keys.length;i++)if(this.keyEqualFunc(n,t.keys[i]))return i;return-1}},{key:"findBucket",value:function(t){var n=this.keyHashFunc(t);return this.buckets.get(n)}},{key:"get",value:function(t){var n=this.findBucket(t);if(n===void 0)return null;var i=this.findBucketIndex(n,t);return i<0?null:n.values[i]}},{key:"add",value:function(t,n){var i=this.keyHashFunc(t);this.buckets.get(i)===void 0&&this.buckets.set(i,new rL);var a=this.buckets.get(i);a.keys.push(t),a.values.push(n)}},{key:"delete",value:function(t){var n=this.findBucket(t);if(n!==void 0){var i=this.findBucketIndex(n,t);i!==-1&&(n.keys.splice(i,1),n.values.splice(i,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var t=0,n=TS(this.buckets.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;t+=a.values.length}}catch(s){n.e(s)}finally{n.f()}return t}},{key:"values",value:ve().mark(function r(){var t,n,i,a;return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t=TS(this.buckets.values()),l.prev=1,t.s();case 3:if((n=t.n()).done){l.next=14;break}i=n.value,a=i.values.length-1;case 6:if(!(a>=0)){l.next=12;break}return l.next=9,i.values[a];case 9:a--,l.next=6;break;case 12:l.next=3;break;case 14:l.next=19;break;case 16:l.prev=16,l.t0=l.catch(1),t.e(l.t0);case 19:return l.prev=19,t.f(),l.finish(19);case 22:case"end":return l.stop()}},r,this,[[1,16,19,22]])})}]),e}();function w0(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=nL(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function nL(e,r){if(e){if(typeof e=="string")return MS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return MS(e,r)}}function MS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function IS(e,r){return e=Da(e,r.blendMode),e=Da(e,r.blendSrcFactor),e=Da(e,r.blendDstFactor),e}function iL(e,r){return e=IS(e,r.rgbBlendState),e=IS(e,r.alphaBlendState),e=Da(e,r.channelWriteMask),e}function aL(e,r){return e=Da(e,r.r<<24|r.g<<16|r.b<<8|r.a),e}function oL(e,r){for(var t,n,i,a,s,l,f,d,_=0;_<r.attachmentsState.length;_++)e=iL(e,r.attachmentsState[_]);return e=aL(e,r.blendConstant||s0),e=Da(e,r.depthCompare),e=Da(e,r.depthWrite?1:0),e=Da(e,(t=r.stencilFront)===null||t===void 0?void 0:t.compare),e=Da(e,(n=r.stencilFront)===null||n===void 0?void 0:n.passOp),e=Da(e,(i=r.stencilFront)===null||i===void 0?void 0:i.failOp),e=Da(e,(a=r.stencilFront)===null||a===void 0?void 0:a.depthFailOp),e=Da(e,(s=r.stencilBack)===null||s===void 0?void 0:s.compare),e=Da(e,(l=r.stencilBack)===null||l===void 0?void 0:l.passOp),e=Da(e,(f=r.stencilBack)===null||f===void 0?void 0:f.failOp),e=Da(e,(d=r.stencilBack)===null||d===void 0?void 0:d.depthFailOp),e=Da(e,r.stencilWrite?1:0),e=Da(e,r.cullMode),e=Da(e,r.frontFace?1:0),e=Da(e,r.polygonOffset?1:0),e}function sL(e){var r=0;r=Da(r,e.program.id),e.inputLayout!==null&&(r=Da(r,e.inputLayout.id)),r=oL(r,e.megaStateDescriptor);for(var t=0;t<e.colorAttachmentFormats.length;t++)r=Da(r,e.colorAttachmentFormats[t]||0);return r=Da(r,e.depthStencilAttachmentFormat||0),CS(r)}function uL(e){var r=0;if(e.samplerBindings)for(var t=0;t<e.samplerBindings.length;t++){var n=e.samplerBindings[t];n!==null&&n.texture!==null&&(r=Da(r,n.texture.id))}if(e.uniformBufferBindings)for(var i=0;i<e.uniformBufferBindings.length;i++){var a=e.uniformBufferBindings[i];a!==null&&a.buffer!==null&&(r=Da(r,a.buffer.id),r=Da(r,a.binding),r=Da(r,a.offset),r=Da(r,a.size))}if(e.storageBufferBindings)for(var s=0;s<e.storageBufferBindings.length;s++){var l=e.storageBufferBindings[s];l!==null&&l.buffer!==null&&(r=Da(r,l.buffer.id),r=Da(r,l.binding),r=Da(r,l.offset),r=Da(r,l.size))}if(e.storageTextureBindings)for(var f=0;f<e.storageTextureBindings.length;f++){var d=e.storageTextureBindings[f];d!==null&&d.texture!==null&&(r=Da(r,d.texture.id),r=Da(r,d.binding))}return CS(r)}function lL(e,r){var t,n,i,a;return((t=e.vertex)===null||t===void 0?void 0:t.glsl)===((n=r.vertex)===null||n===void 0?void 0:n.glsl)&&((i=e.fragment)===null||i===void 0?void 0:i.glsl)===((a=r.fragment)===null||a===void 0?void 0:a.glsl)}function cL(e){var r,t;return{vertex:{glsl:(r=e.vertex)===null||r===void 0?void 0:r.glsl},fragment:{glsl:(t=e.fragment)===null||t===void 0?void 0:t.glsl}}}var fL=function(){function e(r){(0,ne.Z)(this,e),(0,F.Z)(this,"bindingsCache",new T0(r5,uL)),(0,F.Z)(this,"renderPipelinesCache",new T0(o5,sL)),(0,F.Z)(this,"inputLayoutsCache",new T0(l5,RS)),(0,F.Z)(this,"programCache",new T0(lL,RS)),this.device=r}return(0,W.Z)(e,[{key:"createBindings",value:function(t){var n=this.bindingsCache.get(t);if(n===null){var i,a=h5(t);a.uniformBufferBindings=(i=a.uniformBufferBindings)===null||i===void 0?void 0:i.filter(function(s){var l=s.size;return l&&l>0}),n=this.device.createBindings(a),this.bindingsCache.add(a,n)}return n}},{key:"createRenderPipeline",value:function(t){var n=this.renderPipelinesCache.get(t);if(n===null){var i=p5(t);i.colorAttachmentFormats=i.colorAttachmentFormats.filter(function(a){return a}),n=this.device.createRenderPipeline(i),this.renderPipelinesCache.add(i,n)}return n}},{key:"createInputLayout",value:function(t){t.vertexBufferDescriptors=t.vertexBufferDescriptors.filter(function(a){return!!a});var n=this.inputLayoutsCache.get(t);if(n===null){var i=m5(t);n=this.device.createInputLayout(i),this.inputLayoutsCache.add(i,n)}return n}},{key:"createProgram",value:function(t){var n=this.programCache.get(t);if(n===null){var i=cL(t);n=this.device.createProgram(t),this.programCache.add(i,n)}return n}},{key:"destroy",value:function(){var t=w0(this.bindingsCache.values()),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.destroy()}}catch(I){t.e(I)}finally{t.f()}var a=w0(this.renderPipelinesCache.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.destroy()}}catch(I){a.e(I)}finally{a.f()}var f=w0(this.inputLayoutsCache.values()),d;try{for(f.s();!(d=f.n()).done;){var _=d.value;_.destroy()}}catch(I){f.e(I)}finally{f.f()}var x=w0(this.programCache.values()),A;try{for(x.s();!(A=x.n()).done;){var C=A.value;C.destroy()}}catch(I){x.e(I)}finally{x.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}}]),e}(),hL=function(){function e(r,t){(0,ne.Z)(this,e);var n=t.data,i=t.type,a=t.count,s=a===void 0?0:a,l;A0(n)?l=n:l=new E0[this.type||K.UNSIGNED_INT](n),this.type=i,this.count=s,this.indexBuffer=r.createBuffer({viewOrSize:l,usage:to.INDEX})}return(0,W.Z)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var n=t.data,i;A0(n)?i=n:i=new E0[this.type||K.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function PS(e){return!!(e&&e.texture)}var OS=function(){function e(r,t){(0,ne.Z)(this,e),(0,F.Z)(this,"isDestroy",!1),this.device=r,this.options=t;var n=t.wrapS,i=n===void 0?K.CLAMP_TO_EDGE:n,a=t.wrapT,s=a===void 0?K.CLAMP_TO_EDGE:a,l=t.aniso,f=t.mipmap,d=f===void 0?!1:f,_=t.mag,x=_===void 0?K.NEAREST:_,A=t.min,C=A===void 0?K.NEAREST:A;this.createTexture(t),this.sampler=r.createSampler({addressModeU:SS[i],addressModeV:SS[s],minFilter:C===K.NEAREST?os.POINT:os.BILINEAR,magFilter:x===K.NEAREST?os.POINT:os.BILINEAR,mipmapFilter:$s.NO_MIP,maxAnisotropy:l})}return(0,W.Z)(e,[{key:"createTexture",value:function(t){var n=t.type,i=n===void 0?K.UNSIGNED_BYTE:n,a=t.width,s=t.height,l=t.flipY,f=l===void 0?!1:l,d=t.format,_=d===void 0?K.RGBA:d,x=t.aniso,A=t.alignment,C=A===void 0?1:A,I=t.usage,D=I===void 0?ot.SAMPLED:I,Z=t.unorm,J=Z===void 0?!1:Z,ce=t.label,xe=t.data;this.width=a,this.height=s;var Xe=Ot.U8_RGBA_RT;if(i===K.UNSIGNED_BYTE&&_===K.RGBA)Xe=J?Ot.U8_RGBA_NORM:Ot.U8_RGBA_RT;else if(i===K.UNSIGNED_BYTE&&_===K.LUMINANCE)Xe=Ot.U8_LUMINANCE;else if(i===K.FLOAT&&_===K.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(xe&&(xe=JD(xe,0)),Xe=Ot.F32_RGBA):Xe=Ot.F32_RGB;else if(i===K.FLOAT&&_===K.RGBA)Xe=Ot.F32_RGBA;else if(i===K.FLOAT&&_===K.RED)Xe=Ot.F32_R;else throw new Error("create texture error, type: ".concat(i,", format: ").concat(_));this.texture=this.device.createTexture({format:Xe,width:a,height:s,usage:D===ot.SAMPLED?Du.SAMPLED:Du.RENDER_TARGET,pixelStore:{unpackFlipY:f,packAlignment:C},mipLevelCount:1}),ce&&this.device.setResourceName(this.texture,ce),xe&&this.texture.setImageData([xe])}},{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var n=t.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&this.destroy(),this.options.width=n,this.options.height=i,this.createTexture(this.options),this.isDestroy=!1}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy&&!this.texture.destroyed){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),kS=function(){function e(r,t){(0,ne.Z)(this,e),this.device=r,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}return(0,W.Z)(e,[{key:"createColorRenderTarget",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.options,i=n.width,a=n.height,s=n.color;s&&(PS(s)?(t&&s.resize({width:i,height:a}),this.colorTexture=s.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=s.width,this.height=s.height):i&&a&&(this.colorTexture=this.device.createTexture({format:Ot.U8_RGBA_RT,usage:Du.RENDER_TARGET,width:i,height:a}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i,this.height=a))}},{key:"createDepthRenderTarget",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.options,i=n.width,a=n.height,s=n.depth;s&&(PS(s)?(t&&s.resize({width:i,height:a}),this.depthTexture=s.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=s.width,this.height=s.height):i&&a&&(this.depthTexture=this.device.createTexture({format:Ot.D24_S8,usage:Du.RENDER_TARGET,width:i,height:a}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i,this.height=a))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var t,n;(t=this.colorRenderTarget)===null||t===void 0||t.destroy(),(n=this.depthRenderTarget)===null||n===void 0||n.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=n,this.options.height=i,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}}]),e}(),pL=pi.isPlainObject,dL=pi.isTypedArray,vL=function(){function e(r,t,n){var i=this;(0,ne.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),(0,F.Z)(this,"vertexBuffers",[]),this.device=r,this.options=t,this.service=n;var a=t.vs,s=t.fs,l=t.attributes,f=t.uniforms,d=t.count,_=t.elements,x=t.diagnosticDerivativeUniformityEnabled;this.options=t;var A=x?"":this.service.viewportOrigin===lh.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=n.renderCache.createProgram({vertex:{glsl:a},fragment:{glsl:s,postprocess:function(J){return A+J}}}),f&&(this.uniforms=this.extractUniforms(f));var C=[],I=0;Object.keys(l).forEach(function(Z){var J=l[Z],ce=J.get();i.vertexBuffers.push(ce.get());var xe=J.attribute,Xe=xe.offset,bt=Xe===void 0?0:Xe,pt=xe.stride,et=pt===void 0?0:pt,Pt=xe.size,jt=Pt===void 0?1:Pt,Ar=xe.divisor,gr=Ar===void 0?0:Ar,Xr=xe.shaderLocation,mn=Xr===void 0?0:Xr;C.push({arrayStride:et||jt*4,stepMode:Md.VERTEX,attributes:[{format:XD[jt],shaderLocation:mn,offset:bt,divisor:gr}]}),I=ce.size/jt}),d||(this.options.count=I),_&&(this.indexBuffer=_.get());var D=n.renderCache.createInputLayout({vertexBufferDescriptors:C,indexBufferFormat:_?Ot.U32_R:null,program:this.program});this.inputLayout=D,this.pipeline=this.createPipeline(t)}return(0,W.Z)(e,[{key:"createPipeline",value:function(t,n){var i=t.primitive,a=i===void 0?K.TRIANGLES:i,s=t.depth,l=t.cull,f=t.blend,d=t.stencil,_=this.initDepthDrawParams({depth:s}),x=!!(_&&_.enable),A=this.initCullDrawParams({cull:l}),C=!!(A&&A.enable),I=this.getBlendDrawParams({blend:f}),D=!!(I&&I.enable),Z=this.getStencilDrawParams({stencil:d}),J=!!(Z&&Z.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:GD[a],colorAttachmentFormats:[Ot.U8_RGBA_RT],depthStencilAttachmentFormat:Ot.D24_S8,megaStateDescriptor:{attachmentsState:[n?{channelWriteMask:iu.ALL,rgbBlendState:{blendMode:nu.ADD,blendSrcFactor:Ji.ONE,blendDstFactor:Ji.ZERO},alphaBlendState:{blendMode:nu.ADD,blendSrcFactor:Ji.ONE,blendDstFactor:Ji.ZERO}}:{channelWriteMask:J&&Z.opFront.zpass===$o.REPLACE?iu.NONE:iu.ALL,rgbBlendState:{blendMode:D&&I.equation.rgb||nu.ADD,blendSrcFactor:D&&I.func.srcRGB||Ji.SRC_ALPHA,blendDstFactor:D&&I.func.dstRGB||Ji.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:D&&I.equation.alpha||nu.ADD,blendSrcFactor:D&&I.func.srcAlpha||Ji.ONE,blendDstFactor:D&&I.func.dstAlpha||Ji.ONE}}],blendConstant:D?s0:void 0,depthWrite:x,depthCompare:x&&_.func||Hi.LESS,cullMode:C&&A.face||Zl.NONE,stencilWrite:J,stencilFront:{compare:J?Z.func.cmp:Hi.ALWAYS,passOp:Z.opFront.zpass,failOp:Z.opFront.fail,depthFailOp:Z.opFront.zfail,mask:Z.opFront.mask},stencilBack:{compare:J?Z.func.cmp:Hi.ALWAYS,passOp:Z.opBack.zpass,failOp:Z.opBack.fail,depthFailOp:Z.opBack.zfail,mask:Z.opBack.mask}}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=(0,j.Z)((0,j.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){var i=this,a=(0,j.Z)((0,j.Z)({},this.options),t),s=a.count,l=s===void 0?0:s,f=a.instances,d=a.elements,_=a.uniforms,x=_===void 0?{}:_,A=a.uniformBuffers,C=a.textures;this.uniforms=(0,j.Z)((0,j.Z)({},this.uniforms),this.extractUniforms(x));var I=this.service,D=I.renderPass,Z=I.currentFramebuffer,J=I.width,ce=I.height,xe=I.renderCache;this.pipeline=this.createPipeline(a,n);var Xe=this.service.device,bt=Xe.swapChainHeight;if(Xe.swapChainHeight=(Z==null?void 0:Z.height)||ce,D.setViewport(0,0,(Z==null?void 0:Z.width)||J,(Z==null?void 0:Z.height)||ce),Xe.swapChainHeight=bt,D.setPipeline(this.pipeline),D.setStencilReference(1),D.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(et){return{buffer:et}}),d?{buffer:this.indexBuffer,offset:0}:null),A&&(this.bindings=xe.createBindings({pipeline:this.pipeline,uniformBufferBindings:A.map(function(et,Pt){var jt=et;return{binding:Pt,buffer:jt.get(),size:jt.size}}),samplerBindings:C==null?void 0:C.map(function(et){return{texture:et.texture,sampler:et.sampler}})})),this.bindings&&(D.setBindings(this.bindings),Object.keys(this.uniforms).forEach(function(et){var Pt=i.uniforms[et];Pt instanceof OS?i.uniforms[et]=Pt.get():Pt instanceof kS&&(i.uniforms[et]=Pt.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),d){var pt=d.count;pt===0?D.draw(l,f):D.drawIndexed(pt,f)}else D.draw(l,f)}},{key:"destroy",value:function(){var t,n,i;this.program.destroy(),(t=this.vertexBuffers)===null||t===void 0||t.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var n=t.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:YD[n.func||K.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:S0[s&&s.srcRGB||K.SRC_ALPHA],srcAlpha:S0[s&&s.srcAlpha||K.SRC_ALPHA],dstRGB:S0[s&&s.dstRGB||K.ONE_MINUS_SRC_ALPHA],dstAlpha:S0[s&&s.dstAlpha||K.ONE_MINUS_SRC_ALPHA]},equation:{rgb:AS[l&&l.rgb||K.FUNC_ADD],alpha:AS[l&&l.alpha||K.FUNC_ADD]},color:d}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?4294967295:s,f=i.func,d=f===void 0?{cmp:K.ALWAYS,ref:0,mask:4294967295}:f,_=i.opFront,x=_===void 0?{fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP}:_,A=i.opBack,C=A===void 0?{fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP}:A;return{enable:!!a,mask:l,func:(0,j.Z)((0,j.Z)({},d),{},{cmp:KD[d.cmp]}),opFront:{fail:Fv[x.fail],zfail:Fv[x.zfail],zpass:Fv[x.zpass],mask:d.mask},opBack:{fail:Fv[C.fail],zfail:Fv[C.zfail],zpass:Fv[C.zpass],mask:d.mask}}}},{key:"initCullDrawParams",value:function(t){var n=t.cull;if(n){var i=n.enable,a=n.face,s=a===void 0?K.BACK:a;return{enable:!!i,face:qD[s]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||dL(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}pL(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(t,"[").concat(f,"]"))})})}}]),e}();function mL(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var DS,LS,C0=pi.isUndefined,gL=(DS=(0,Zt.b2)(),DS(LS=function(){function e(){var r=this;(0,ne.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return r.device.queryVendorInfo().platformString}),(0,F.Z)(this,"createModel",function(t){return new vL(r.device,t,r)}),(0,F.Z)(this,"createAttribute",function(t){return new WD(r.device,t)}),(0,F.Z)(this,"createBuffer",function(t){return new eL(r.device,t)}),(0,F.Z)(this,"createElements",function(t){return new hL(r.device,t)}),(0,F.Z)(this,"createTexture2D",function(t){return new OS(r.device,t)}),(0,F.Z)(this,"createFramebuffer",function(t){return new kS(r.device,t)}),(0,F.Z)(this,"useFramebuffer",function(t,n){r.currentFramebuffer=t,r.beginFrame(),n(),r.endFrame(),r.currentFramebuffer=null}),(0,F.Z)(this,"useFramebufferAsync",function(){var t=(0,Nt.Z)(ve().mark(function n(i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return r.currentFramebuffer=i,r.preRenderPass=r.renderPass,r.beginFrame(),l.next=5,a();case 5:r.endFrame(),r.currentFramebuffer=null,r.renderPass=r.preRenderPass;case 8:case"end":return l.stop()}},n)}));return function(n,i){return t.apply(this,arguments)}}()),(0,F.Z)(this,"clear",function(t){var n=t.color,i=t.depth,a=t.stencil,s=t.framebuffer,l=s===void 0?null:s;if(l)l.clearOptions={color:n,depth:i,stencil:a};else{var f=r.queryVerdorInfo();if(f==="WebGL1"){var d=r.getGLContext();C0(a)?C0(i)||(d.clearDepth(i),d.clear(d.DEPTH_BUFFER_BIT)):(d.clearStencil(a),d.clear(d.STENCIL_BUFFER_BIT))}else if(f==="WebGL2"){var _=r.getGLContext();C0(a)?C0(i)||_.clearBufferfv(_.DEPTH,0,[i]):_.clearBufferiv(_.STENCIL,0,[a])}}}),(0,F.Z)(this,"viewport",function(t){var n=t.width,i=t.height;r.swapChain.configureSwapChain(n,i),r.createMainColorDepthRT(n,i),r.width=n,r.height=i}),(0,F.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,f=r.device.createReadback(),d=n.colorTexture,_=f.readTextureSync(d,i,r.viewportOrigin===lh.LOWER_LEFT?a:r.height-a,s,l,new Uint8Array(s*l*4));return f.destroy(),_}),(0,F.Z)(this,"readPixelsAsync",function(){var t=(0,Nt.Z)(ve().mark(function n(i){var a,s,l,f,d,_,x,A,C,I;return ve().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return a=i.framebuffer,s=i.x,l=i.y,f=i.width,d=i.height,_=r.device.createReadback(),x=a.colorTexture,Z.next=5,_.readTexture(x,s,r.viewportOrigin===lh.LOWER_LEFT?l:r.height-l,f,d,new Uint8Array(f*d*4));case 5:if(A=Z.sent,r.viewportOrigin!==lh.LOWER_LEFT)for(C=0;C<A.length;C+=4)I=A[C],A[C]=A[C+2],A[C+2]=I;return _.destroy(),Z.abrupt("return",A);case 9:case"end":return Z.stop()}},n)}));return function(n){return t.apply(this,arguments)}}()),(0,F.Z)(this,"getViewportSize",function(){return{width:r.width,height:r.height}}),(0,F.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,F.Z)(this,"getCanvas",function(){return r.canvas}),(0,F.Z)(this,"getGLContext",function(){return r.device.gl}),(0,F.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.uniformBuffers)===null||t===void 0||t.forEach(function(n){n.destroy()}),r.device.destroy(),r.renderCache.destroy()})}return(0,W.Z)(e,[{key:"init",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,f=s?new UD({shaderCompilerPath:l}):new K5({targets:["webgl2","webgl1"],onContextLost:function(I){console.warn("context lost",I)},onContextCreationError:function(I){console.warn("context creation error",I)},onContextRestored:function(I){console.warn("context restored",I)}}),A.next=5,f.createSwapChain(i);case 5:d=A.sent,d.configureSwapChain(i.width,i.height),this.device=d.getDevice(),this.swapChain=d,this.renderCache=new fL(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin,_=this.device.gl,this.extensionObject={OES_texture_float:!mL(_)&&this.device.OES_texture_float},this.createMainColorDepthRT(i.width,i.height);case 15:case"end":return A.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"createMainColorDepthRT",value:function(t,n){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Ot.U8_RGBA_RT,width:t,height:n,usage:Du.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Ot.D24_S8,width:t,height:n,usage:Du.RENDER_TARGET}))}},{key:"beginFrame",value:function(){this.device.beginFrame();var t=this.currentFramebuffer,n=this.swapChain,i=this.mainColorRT,a=this.mainDepthRT,s=t?t.colorRenderTarget:i,l=t?null:n.getOnscreenTexture(),f=t?t.depthRenderTarget:a,d=(t==null?void 0:t.clearOptions)||{},_=d.color,x=_===void 0?[0,0,0,0]:_,A=d.depth,C=A===void 0?1:A,I=d.stencil,D=I===void 0?0:I,Z=s?Fm(x[0]*255,x[1]*255,x[2]*255,x[3]):s0,J=f?C:void 0,ce=f?D:void 0,xe=this.device.createRenderPass({colorAttachment:[s],colorResolveTo:[l],colorClearColor:[Z],colorStore:[!0],depthStencilAttachment:f,depthClearValue:J,stencilClearValue:ce});this.renderPass=xe}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass),this.device.endFrame()}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||LS),yL=O(52388);function _L(e){var r=bL();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function bL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hy=["selectstart","selecting","selectend"],xL=function(e){(0,je.Z)(t,e);var r=_L(t);function t(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,ne.Z)(this,t),i=r.call(this),(0,F.Z)((0,Le.Z)(i),"isEnable",!1),(0,F.Z)((0,Le.Z)(i),"onDragStart",function(s){i.box.style.display="block",i.startEvent=i.endEvent=s,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Le.Z)(i),"onDragging",function(s){i.endEvent=s,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Le.Z)(i),"onDragEnd",function(s){i.endEvent=s,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return(0,W.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=ra("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,s=i.y,l=this.endEvent,f=l.x,d=l.y,_=Math.min(a,f),x=Math.min(s,d),A=Math.abs(a-f),C=Math.abs(s-d);this.box.style.top="".concat(x,"px"),this.box.style.left="".concat(_,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(C,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,s=i.lat,l=this.endEvent.lngLat,f=l.lng,d=l.lat;return Of([[a,s],[f,d]])}}]),t}(yL.EventEmitter),EL=function(){function e(r){(0,ne.Z)(this,e);var t=r.id,n=r.map,i=r.canvas,a=r.renderer,s=a===void 0?"regl":a,l=iT();this.container=l,n.setContainer(l,t,i),l.bind(Ct.IRendererService).to(s==="regl"?HD:gL).inSingletonScope(),this.sceneService=l.get(Ct.ISceneService),this.mapService=l.get(Ct.IMapService),this.iconService=l.get(Ct.IIconService),this.fontService=l.get(Ct.IFontService),this.controlService=l.get(Ct.IControlService),this.layerService=l.get(Ct.ILayerService),this.debugService=l.get(Ct.IDebugService),this.debugService.setEnable(r.debug),this.markerService=l.get(Ct.IMarkerService),this.interactionService=l.get(Ct.IInteractionService),this.popupService=l.get(Ct.IPopupService),this.boxSelect=new xL(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}return(0,W.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,i=vm(this.container);if(t.setContainer(i,this.container),this.sceneService.addLayer(t),t.inited){var a=this.initMask(t);this.addMask(a,t.id)}else t.on("inited",function(){var s=n.initMask(t);n.addMask(s,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),i=n.mask,a=n.maskfence,s=n.maskColor,l=s===void 0?"#000":s,f=n.maskOpacity,d=f===void 0?0:f;if(!(!i||!a)){var _=new db().source(a).shape("fill").style({color:l,opacity:d});return _}}},{key:"addMask",value:function(t,n){if(t){var i=this.getLayer(n);if(i){var a=vm(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var r=(0,Nt.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=(0,Rn.Z)(i,2),s=a[0],l=a[1];n.fontService.addIconFont(s,l)})}},{key:"addFontFace",value:function(t,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var r=(0,Nt.Z)(ve().mark(function n(i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(Hy.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.on(t,n)}else wg.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(Hy.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.once(t,n)}else wg.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){wg.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(Hy.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.off(t,n)}else wg.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,s=i.animate;this.mapService.fitBounds(t,n||(0,j.Z)((0,j.Z)({},a),{},{animate:s}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Ct.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return Qr.REGISTERED_PROTOCOLS[t]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:Ns(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new h1({position:i}))}}],[{key:"addProtocol",value:function(t,n){Qr.REGISTERED_PROTOCOLS[t]=n}},{key:"removeProtocol",value:function(t){delete Qr.REGISTERED_PROTOCOLS[t]}}]),e}(),$6="2.20.15";function $m(e){"@babel/helpers - typeof";return $m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},$m(e)}function BS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Y6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?BS(Object(t),!0).forEach(function(n){SL(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):BS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function SL(e,r,t){return r=AL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function AL(e){var r=TL(e,"string");return $m(r)==="symbol"?r:String(r)}function TL(e,r){if($m(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if($m(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function q6(e,r){return ML(e)||RL(e,r)||CL(e,r)||wL()}function wL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CL(e,r){if(e){if(typeof e=="string")return FS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return FS(e,r)}}function FS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function RL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function ML(e){if(Array.isArray(e))return e}var K6=null,Q6=null,NS,Wy,US,IL=(NS=Z0(Ct.IGlobalConfigService),Wy=function(){function e(r){(0,ne.Z)(this,e),Ui(this,"configService",US,this),this.config=r}return(0,W.Z)(e,[{key:"setContainer",value:function(t,n,i){t.bind(Ct.MapConfig).toConstantValue((0,j.Z)((0,j.Z)({},this.config),{},{id:n,canvas:i})),t.bind(Ct.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),US=Bi(Wy.prototype,"configService",[NS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wy),PL=O(6158),Ym=O.n(PL),OL=function(){function e(r){(0,ne.Z)(this,e),(0,F.Z)(this,"size",1e4),this.size=r||1e4}return(0,W.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[n,i]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[n,i]}}]),e}(),kL={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},zS,ZS,VS,jS,HS,WS,Nv,GS,XS,$S,YS,qS={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},DL=12,LL=(zS=(0,Zt.b2)(),ZS=(0,Zt.f3)(Ct.MapConfig),VS=(0,Zt.f3)(Ct.IGlobalConfigService),jS=(0,Zt.f3)(Ct.ICoordinateSystemService),HS=(0,Zt.f3)(Ct.IEventEmitter),zS(WS=(Nv=function(){function e(){var r=this;(0,ne.Z)(this,e),(0,F.Z)(this,"version","DEFAUlTMAP"),(0,F.Z)(this,"simpleMapCoord",new OL),(0,F.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Ui(this,"config",GS,this),Ui(this,"configService",XS,this),Ui(this,"coordinateSystemService",$S,this),Ui(this,"eventEmitter",YS,this),(0,F.Z)(this,"handleCameraChanged",function(t){var n=r.map.getCenter(),i=n.lat,a=n.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[a,i],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.updateCoordinateSystemService(),r.cameraChangedCallback(r.viewport)})}return(0,W.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=ra("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){mT.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(qS[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(qS[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(i){return""}}},{key:"getMapStyleConfig",value:function(){return kL}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>DL&&n?this.coordinateSystemService.setCoordinateSystem(Ku.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Ku.LNGLAT)}}]),e}(),GS=Bi(Nv.prototype,"config",[ZS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XS=Bi(Nv.prototype,"configService",[VS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$S=Bi(Nv.prototype,"coordinateSystemService",[jS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YS=Bi(Nv.prototype,"eventEmitter",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv))||WS);function qm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function R0(e,r){var t=Fl.fF([],r,e);return Fl.bA(t,t,1/t[3]),t}function J6(e,r){var t=e%r;return t<0?r+t:t}function e8(e,r,t){return t*r+(1-t)*e}function kd(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var Ef=Math.PI,KS=Ef/4,Jh=Ef/180,QS=180/Ef,Gy=512,Xy=4003e4,BL=1.5;function JS(e){return Math.pow(2,e)}function FL(e){return Math.log2(e)}function M0(e,r){var t=(0,Rn.Z)(e,2),n=t[0],i=t[1];kd(Number.isFinite(n)&&Number.isFinite(r)),kd(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=Gy;var a=n*Jh,s=i*Jh,l=r*(a+Ef)/(2*Ef),f=r*(Ef-Math.log(Math.tan(KS+s*.5)))/(2*Ef);return[l,f]}function $y(e,r){var t=(0,Rn.Z)(e,2),n=t[0],i=t[1];r*=Gy;var a=n/r*(2*Ef)-Ef,s=2*(Math.atan(Math.exp(Ef-i/r*(2*Ef)))-KS);return[a*QS,s*QS]}function t8(e){var r=e.latitude;assert(Number.isFinite(r));var t=Math.cos(r*Jh);return FL(Xy*t)-9}function e2(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,s=a===void 0?!1:a;i=i!==void 0?i:JS(n),kd(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},f=Gy*i,d=Math.cos(r*Jh),_=f/360,x=_/d,A=f/Xy/d;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[_,-x,A],l.degreesPerPixel=[1/_,-1/x,1/A],s){var C=Jh*Math.tan(r*Jh)/d,I=_*C/2,D=f/Xy*C,Z=D/x*A;l.pixelsPerDegree2=[0,-I,D],l.pixelsPerMeter2=[Z,0,Z]}return l}function r8(e,r){var t=_slicedToArray(e,3),n=t[0],i=t[1],a=t[2],s=_slicedToArray(r,3),l=s[0],f=s[1],d=s[2],_=1,x=e2({longitude:n,latitude:i,scale:_,highPrecision:!0}),A=x.pixelsPerMeter,C=x.pixelsPerMeter2,I=M0(e,_);I[0]+=l*(A[0]+C[0]*f),I[1]+=f*(A[1]+C[1]*f);var D=$y(I,_),Z=(a||0)+(d||0);return Number.isFinite(a)||Number.isFinite(d)?[D[0],D[1],Z]:D}function NL(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,a=e.center,s=a===void 0?null:a,l=e.flipY,f=l===void 0?!1:l,d=qm();return sr.translate(d,d,[0,0,-i]),sr.scale(d,d,[1,1,1/r]),sr.rotateX(d,d,-t*Jh),sr.rotateZ(d,d,n*Jh),f&&sr.scale(d,d,[1,-1,1]),s&&sr.translate(d,d,Na.negate([],s)),d}function UL(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?BL:n,a=e.pitch,s=a===void 0?0:a,l=e.nearZMultiplier,f=l===void 0?1:l,d=e.farZMultiplier,_=d===void 0?1:d,x=s*Jh,A=Math.atan(.5/i),C=Math.sin(A)*i/Math.sin(Math.PI/2-x-A),I=Math.cos(Math.PI/2-x)*C+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:f,far:I*_}}function zL(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,s=e.farZMultiplier,l=UL({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:s}),f=l.fov,d=l.aspect,_=l.near,x=l.far,A=sr.perspective([],f,d,_,x);return A}function ZL(e,r){var t=(0,Rn.Z)(e,3),n=t[0],i=t[1],a=t[2],s=a===void 0?0:a;return kd(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),R0(r,[n,i,s,1])}function t2(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Rn.Z)(e,3),i=n[0],a=n[1],s=n[2];if(kd(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(s)){var l=R0(r,[i,a,s,1]);return l}var f=R0(r,[i,a,0,1]),d=R0(r,[i,a,1,1]),_=f[2],x=d[2],A=_===x?0:((t||0)-_)/(x-_);return Br.t7([],f,d,A)}var r2=qm(),VL=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,a=i===void 0?r2:i,s=r.projectionMatrix,l=s===void 0?r2:s;(0,ne.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var f=qm();sr.multiply(f,f,this.projectionMatrix),sr.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f;var d=qm();sr.scale(d,d,[this.width/2,-this.height/2,1]),sr.translate(d,d,[1,-1,0]),sr.multiply(d,d,this.viewProjectionMatrix);var _=sr.invert(qm(),d);if(!_)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=_,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,W.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&sr.equals(t.projectionMatrix,this.projectionMatrix)&&sr.equals(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=this.projectPosition(t),l=ZL(s,this.pixelProjectionMatrix),f=(0,Rn.Z)(l,2),d=f[0],_=f[1],x=a?_:this.height-_;return t.length===2?[d,x]:[d,x,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=n.targetZ,l=(0,Rn.Z)(t,3),f=l[0],d=l[1],_=l[2],x=a?d:this.height-d,A=s&&s*this.pixelsPerMeter,C=t2([f,x,_],this.pixelUnprojectionMatrix,A),I=this.unprojectPosition(C),D=(0,Rn.Z)(I,3),Z=D[0],J=D[1],ce=D[2];return Number.isFinite(_)?[Z,J,ce]:Number.isFinite(s)?[Z,J,s]:[Z,J]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=(0,Rn.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[a,s,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=(0,Rn.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[a,s,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function jL(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,s=e.maxZoom,l=s===void 0?24:s,f=e.padding,d=f===void 0?0:f,_=e.offset,x=_===void 0?[0,0]:_,A=(0,Rn.Z)(n,2),C=(0,Rn.Z)(A[0],2),I=C[0],D=C[1],Z=(0,Rn.Z)(A[1],2),J=Z[0],ce=Z[1];if(Number.isFinite(d)){var xe=d;d={top:xe,bottom:xe,left:xe,right:xe}}else kd(Number.isFinite(d.top)&&Number.isFinite(d.bottom)&&Number.isFinite(d.left)&&Number.isFinite(d.right));var Xe=new n2({width:r,height:t,longitude:0,latitude:0,zoom:0}),bt=Xe.project([I,ce]),pt=Xe.project([J,D]),et=[Math.max(Math.abs(pt[0]-bt[0]),a),Math.max(Math.abs(pt[1]-bt[1]),a)],Pt=[r-d.left-d.right-Math.abs(x[0])*2,t-d.top-d.bottom-Math.abs(x[1])*2];kd(Pt[0]>0&&Pt[1]>0);var jt=Pt[0]/et[0],Ar=Pt[1]/et[1],gr=(d.right-d.left)/2/jt,Xr=(d.bottom-d.top)/2/Ar,mn=[(pt[0]+bt[0])/2+gr,(pt[1]+bt[1])/2+Xr],qn=Xe.unproject(mn),ea=Xe.zoom+Math.log2(Math.abs(Math.min(jt,Ar)));return{longitude:qn[0],latitude:qn[1],zoom:Math.min(ea,l)}}var n2=function(e){(0,je.Z)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,s=n.latitude,l=s===void 0?0:s,f=n.longitude,d=f===void 0?0:f,_=n.zoom,x=_===void 0?0:_,A=n.pitch,C=A===void 0?0:A,I=n.bearing,D=I===void 0?0:I,Z=n.altitude,J=Z===void 0?1.5:Z,ce=n.nearZMultiplier,xe=n.farZMultiplier;(0,ne.Z)(this,r),i=i||1,a=a||1;var Xe=JS(x);J=Math.max(.75,J);var bt=M0([d,l],Xe);bt[2]=0;var pt=zL({width:i,height:a,pitch:C,bearing:D,altitude:J,nearZMultiplier:ce||1/a,farZMultiplier:xe||1.01}),et=NL({height:a,center:bt,pitch:C,bearing:D,altitude:J,flipY:!0});return t=(0,lt.Z)(this,(0,Ie.Z)(r).call(this,{width:i,height:a,viewMatrix:et,projectionMatrix:pt})),t.latitude=l,t.longitude=d,t.zoom=x,t.pitch=C,t.bearing=D,t.altitude=J,t.scale=Xe,t.center=bt,t.pixelsPerMeter=e2((0,Le.Z)((0,Le.Z)(t))).pixelsPerMeter[2],Object.freeze((0,Le.Z)((0,Le.Z)(t))),t}return(0,W.Z)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return M0(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return $y(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,s=t2(a,this.pixelUnprojectionMatrix),l=M0(i,this.scale),f=Br.IH([],l,Br.tk([],s)),d=Br.IH([],this.center,f);return $y(d,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,s=this.height,l=jL(Object.assign({width:a,height:s,bounds:n},i)),f=l.longitude,d=l.latitude,_=l.zoom;return new r({width:a,height:s,longitude:f,latitude:d,zoom:_})}}]),r}(VL),HL=function(){function e(){(0,ne.Z)(this,e)}return(0,W.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,s=t.bearing,l=t.viewportHeight,f=t.viewportWidth;this.viewport=new n2({width:f,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),WL=["id","attributionControl","style","token","rotation","mapInstance"],i2,a2;function GL(e){var r=XL();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function XL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function $L(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}$L(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Ym();var YL=0,o2="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",qL=(i2=(0,Zt.b2)(),i2(a2=function(e){(0,je.Z)(t,e);var r=GL(t);function t(){var n;(0,ne.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Le.Z)(n),"version","MAPBOX"),n}return(0,W.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},s=this.lngLatToMercator(i,0),l=s.x,f=s.y;return[l-a.x,f-a.y]}},{key:"lngLatToMercator",value:function(i,a){var s=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),l=s.x,f=l===void 0?0:l,d=s.y,_=d===void 0?0:d,x=s.z,A=x===void 0?0:x;return{x:f,y:_,z:A}}},{key:"getModelMatrix",value:function(i,a,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},d=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),_=d.meterInMercatorCoordinateUnits(),x=sr.create();return sr.translate(x,x,Na.fromValues(d.x-f.x,d.y-f.y,d.z||0-f.z)),sr.scale(x,x,Na.fromValues(_*l[0],-_*l[1],_*l[2])),sr.rotateX(x,x,s[0]),sr.rotateY(x,x,s[1]),sr.rotateZ(x,x,s[2]),x}},{key:"init",value:function(){var n=(0,Nt.Z)(ve().mark(function a(){var s=this,l,f,d,_,x,A,C,I,D,Z,J,ce,xe;return ve().wrap(function(bt){for(;;)switch(bt.prev=bt.next){case 0:l=this.config,f=l.id,d=f===void 0?"map":f,_=l.attributionControl,x=_===void 0?!1:_,A=l.style,C=A===void 0?"light":A,I=l.token,D=I===void 0?o2:I,Z=l.rotation,J=Z===void 0?0:Z,ce=l.mapInstance,xe=(0,xi.Z)(l,WL),this.viewport=new HL,!ce&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),D===o2&&C!=="blank"&&!window.mapboxgl.accessToken&&!ce&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ce&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=D),ce?(this.map=ce,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(d),this.map=new window.mapboxgl.Map((0,j.Z)({container:this.$mapContainer,style:this.getMapStyleValue(C),attributionControl:x,bearing:J},xe))),this.map.on("load",function(){s.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return bt.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i;(i=this.$mapContainer)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).emit.apply(a,[i].concat(l))}},{key:"once",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).once.apply(a,[i].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,a){var s=new(Ym()).LngLat(i[0],i[1]),l=new(Ym()).LngLat(a[0],a[1]),f=s.distanceTo(l),d=Ym().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),_=Ym().MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]}),x=d.x,A=d.y,C=_.x,I=_.y,D=Math.sqrt(Math.pow(x-C,2)+Math.pow(A-I,2))*4194304*2;return D/f}},{key:"exportMap",value:function(i){var a=this.map.getCanvas(),s=i==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png");return s}},{key:"creatMapContainer",value:function(i){var a=i;typeof i=="string"&&(a=document.getElementById(i));var s=document.createElement("div");return s.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,s.id="l7_mapbox_div"+YL++,a.appendChild(s),s}}]),t}(LL))||a2);function KL(e){var r=QL();return function(){var n=(0,Ie.Z)(e),i;if(r){var a=(0,Ie.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,lt.Z)(this,i)}}function QL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function JL(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}JL(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var eB=function(e){(0,je.Z)(t,e);var r=KL(t);function t(){return(0,ne.Z)(this,t),r.apply(this,arguments)}return(0,W.Z)(t,[{key:"getServiceConstructor",value:function(){return qL}}]),t}(IL);function Km(e){"@babel/helpers - typeof";return Km=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Km(e)}function s2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function u2(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?s2(Object(t),!0).forEach(function(n){tB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function tB(e,r,t){return r=rB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function rB(e){var r=nB(e,"string");return Km(r)==="symbol"?r:String(r)}function nB(e,r){if(Km(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Km(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function iB(e,r){return uB(e)||sB(e,r)||oB(e,r)||aB()}function aB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oB(e,r){if(e){if(typeof e=="string")return l2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l2(e,r)}}function l2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function sB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function uB(e){if(Array.isArray(e))return e}var lB=te.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,s=(0,te.createRef)(),l=(0,te.useState)(),f=iB(l,2),d=f[0],_=f[1];return(0,te.useEffect)(function(){var x=new EL(u2(u2({id:s.current},i),{},{map:new eB(n)}));return x.on("loaded",function(){_(x),a&&a(x)}),function(){x.destroy()}},[]),(0,te.useEffect)(function(){d&&n.style&&d.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,te.useEffect)(function(){d&&n.zoom&&d.setZoom(n.zoom)},[n.zoom]),(0,te.useEffect)(function(){d&&n.center&&d.setCenter(n.center)},[JSON.stringify(n.center)]),(0,te.useEffect)(function(){d&&n.pitch!==void 0&&d.setPitch(n.pitch||0)},[n.pitch]),(0,te.useEffect)(function(){d&&n.rotation&&d.setRotation(n.rotation)},[n.rotation]),te.createElement(de.Provider,{value:d},(0,te.createElement)("div",{ref:s,style:r,className:t},d&&e.children))}),cB=lB;function Qm(e){"@babel/helpers - typeof";return Qm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Qm(e)}function c2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function n8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?c2(Object(t),!0).forEach(function(n){fB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function fB(e,r,t){return r=hB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function hB(e){var r=pB(e,"string");return Qm(r)==="symbol"?r:String(r)}function pB(e,r){if(Qm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Qm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function i8(e,r){return gB(e)||mB(e,r)||vB(e,r)||dB()}function dB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vB(e,r){if(e){if(typeof e=="string")return f2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f2(e,r)}}function f2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function mB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function gB(e){if(Array.isArray(e))return e}var a8=null,o8=null;function Jm(e){"@babel/helpers - typeof";return Jm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Jm(e)}function h2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function s8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?h2(Object(t),!0).forEach(function(n){yB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function yB(e,r,t){return r=_B(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _B(e){var r=bB(e,"string");return Jm(r)==="symbol"?r:String(r)}function bB(e,r){if(Jm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Jm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function u8(e,r){return AB(e)||SB(e,r)||EB(e,r)||xB()}function xB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EB(e,r){if(e){if(typeof e=="string")return p2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return p2(e,r)}}function p2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function SB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function AB(e){if(Array.isArray(e))return e}var l8=null,c8=null;function eg(e){"@babel/helpers - typeof";return eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},eg(e)}function d2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function f8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?d2(Object(t),!0).forEach(function(n){TB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function TB(e,r,t){return r=wB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function wB(e){var r=CB(e,"string");return eg(r)==="symbol"?r:String(r)}function CB(e,r){if(eg(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(eg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function h8(e,r){return PB(e)||IB(e,r)||MB(e,r)||RB()}function RB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MB(e,r){if(e){if(typeof e=="string")return v2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return v2(e,r)}}function v2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function IB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function PB(e){if(Array.isArray(e))return e}var p8=null,d8=null;function v8(e,r){return LB(e)||DB(e,r)||kB(e,r)||OB()}function OB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kB(e,r){if(e){if(typeof e=="string")return m2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return m2(e,r)}}function m2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function DB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function LB(e){if(Array.isArray(e))return e}var m8=null;function tg(e){"@babel/helpers - typeof";return tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},tg(e)}var g8=null;function g2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function y8(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?g2(Object(t),!0).forEach(function(n){BB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function BB(e,r,t){return r=FB(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function FB(e){var r=NB(e,"string");return tg(r)==="symbol"?r:String(r)}function NB(e,r){if(tg(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(tg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function _8(e,r){if(e==null)return{};var t=UB(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function UB(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var b8={exportImage:Ow,fullscreen:Fw,geoLocate:zw,layer:f1,layerSwitch:f1,logo:h1,mapTheme:Yw,mouseLocation:Qw,zoom:A4,scale:tC},x8=null,y2=O(73935);function _2(e,r){return jB(e)||VB(e,r)||ZB(e,r)||zB()}function zB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZB(e,r){if(e){if(typeof e=="string")return b2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b2(e,r)}}function b2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function VB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function jB(e){if(Array.isArray(e))return e}var x2=te.useEffect,E2=te.useState,HB=/\B([A-Z])/g,WB=function(r){return r.replace(HB,"-$1").toLowerCase()};function E8(e){var r=e.className,t=e.style,n=e.children,i=e.position,a=E2(),s=_2(a,2),l=s[0],f=s[1],d=useSceneValue(),_=E2(function(){return document.createElement("div")}),x=_2(_,1),A=x[0];return x2(function(){var C=new Control({position:i});return C.onAdd=function(){if(r&&(A.className=r),t){var I=Object.keys(t).map(function(D){return"".concat(WB(D),":").concat(t[D])}).join(";");A.style.cssText=I}return A},C.onRemove=function(){},f(C),d.addControl(C),function(){d.removeControl(C)}},[]),x2(function(){l&&l.setPosition(i||"bottomleft")},[i]),createPortal(n,A)}var S2=(0,te.createContext)({});function S8(){return useContext(S2)}var GB=te.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},Rs()),XB=te.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},Rs()),$B=te.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},Rs()),YB=te.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},Rs()),qB=te.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},Rs()),KB=te.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},Rs()),QB=te.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},Rs()),JB=te.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},Rs()),eF=["data"];function tF(e,r){if(e==null)return{};var t=rF(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function rF(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var nF=te.memo(function(r){var t=r.layer,n=r.source,i=n.data,a=tF(n,eF);return t.inited?t.setData(i,a):t.source(i,a),a.autoFit&&t.fitBounds(a&&a.fitBoundsOptions),null},Rs()),A8=te.useEffect,iF=te.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},Rs());function aF(e,r){return lF(e)||uF(e,r)||sF(e,r)||oF()}function oF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sF(e,r){if(e){if(typeof e=="string")return A2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A2(e,r)}}function A2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function uF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function lF(e){if(Array.isArray(e))return e}var rg=te.useEffect,cF=te.useState;function T2(e,r){var t=r.source,n=r.color,i=r.shape,a=r.style,s=r.size,l=r.scale,f=r.active,d=r.select,_=r.filter,x=r.animate,A=r.options,C=r.onLayerLoaded,I=y(),D=cF(function(){var ce;switch(e){case"polygonLayer":ce=new Bg(A);break;case"lineLayer":ce=new ny(A);break;case"pointLayer":ce=new Lg(A);break;case"heatmapLayer":ce=new h3(A);break;case"rasterLayer":ce=new Fg(A);break;case"imageLayer":ce=new V1(A);break;case"citybuildingLayer":ce=new BC(A);break;default:ce=new Bg(A)}return ce.on("inited",function(){C&&C(ce,I)}),ce}),Z=aF(D,1),J=Z[0];return rg(function(){return I.addLayer(J),function(){I.removeLayer(J)}},[]),rg(function(){J.inited&&A&&J.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),rg(function(){J.inited&&(A!=null&&A.zIndex)&&J.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),rg(function(){J.inited&&(A!=null&&A.blend)&&J.setBlend(A.blend)},[A==null?void 0:A.blend]),rg(function(){I.render()}),te.createElement(S2.Provider,{value:J},te.createElement(nF,{layer:J,source:t}),l&&te.createElement(qB,{layer:J,scale:l}),n&&te.createElement($B,{layer:J,color:n}),s&&te.createElement(JB,{layer:J,size:s}),i&&te.createElement(QB,{layer:J,shape:i}),a&&te.createElement(iF,{layer:J,style:a}),f&&te.createElement(GB,{layer:J,active:f}),d&&te.createElement(KB,{layer:J,select:d}),_&&te.createElement(YB,{layer:J,filter:_}),x&&te.createElement(XB,{layer:J,animate:x}),r.children)}var T8=null,w8=null,fF=te.memo(function(r){return T2("pointLayer",r)}),hF=te.memo(function(r){return T2("heatmapLayer",r)}),C8=null,R8=null,M8=null,I8=te.useEffect,P8=null,O8=null;function Uv(e){"@babel/helpers - typeof";return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Uv(e)}function w2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function I0(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?w2(Object(t),!0).forEach(function(n){pF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function pF(e,r,t){return r=R2(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function dF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function C2(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,R2(n.key),n)}}function vF(e,r,t){return r&&C2(e.prototype,r),t&&C2(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function R2(e){var r=mF(e,"string");return Uv(r)==="symbol"?r:String(r)}function mF(e,r){if(Uv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Uv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function gF(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Yy(e,r)}function Yy(e,r){return Yy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Yy(e,r)}function yF(e){var r=xF();return function(){var n=P0(e),i;if(r){var a=P0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _F(this,i)}}function _F(e,r){if(r&&(Uv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bF(e)}function bF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function P0(e){return P0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},P0(e)}var k8=function(e){gF(t,e);var r=yF(t);function t(n){var i;return dF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return vF(t,[{key:"componentDidMount",value:function(){var i,a=this.props,s=a.lnglat,l=a.children,f=a.option,d=a.lngLat,_=new LE(I0(I0({},f),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));s&&_.setLnglat(s),d&&_.setLnglat(d),l&&_.setHTML(this.el),this.popup=_,this.scene.addPopup(_)}},{key:"componentDidUpdate",value:function(i){var a,s,l,f,d,_,x=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(f=l.lnglat)===null||f===void 0?void 0:f.lng,(d=this.props)===null||d===void 0||(_=d.lnglat)===null||_===void 0?void 0:_.lat],C=x.toString()!==A.toString();if(C){var I;this.popup.remove(),this.popup=new LE(I0(I0({},this.props.option),{},{stopPropagation:(I=this.props.option)===null||I===void 0?void 0:I.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return te.createElement(de.Consumer,{},function(a){return a&&(i.scene=a),(0,y2.createPortal)(i.props.children,i.el)})}}]),t}(te.PureComponent);function zv(e){"@babel/helpers - typeof";return zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},zv(e)}function EF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function M2(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,AF(n.key),n)}}function SF(e,r,t){return r&&M2(e.prototype,r),t&&M2(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function AF(e){var r=TF(e,"string");return zv(r)==="symbol"?r:String(r)}function TF(e,r){if(zv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(zv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function wF(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&qy(e,r)}function qy(e,r){return qy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},qy(e,r)}function CF(e){var r=IF();return function(){var n=O0(e),i;if(r){var a=O0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return RF(this,i)}}function RF(e,r){if(r&&(zv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MF(e)}function MF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function IF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function O0(e){return O0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},O0(e)}var D8=function(e){wF(t,e);var r=CF(t);function t(n){var i;return EF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return SF(t,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,s=i.children,l=i.option,f=i.onMarkerLoaded,d=new mw(l);a&&d.setLnglat(a),s&&d.setElement(this.el),this.marker=d,f&&f(d),this.scene.addMarker(d)}},{key:"componentDidUpdate",value:function(i){var a,s=JSON.stringify(i==null?void 0:i.lnglat)!==JSON.stringify((a=this.props)===null||a===void 0?void 0:a.lnglat);s&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return te.createElement(de.Consumer,{},function(a){return a&&(i.scene=a),(0,y2.createPortal)(i.props.children,i.el)})}}]),t}(te.PureComponent),L8=te.useEffect,B8=null,F8=null,N8=te.useEffect,U8=null},52388:function(Ut){"use strict";var ae=Object.prototype.hasOwnProperty,O="~";function te(){}Object.create&&(te.prototype=Object.create(null),new te().__proto__||(O=!1));function de(Y,V,ue){this.fn=Y,this.context=V,this.once=ue||!1}function y(Y,V,ue,H,Ae){if(typeof ue!="function")throw new TypeError("The listener must be a function");var Ce=new de(ue,H||Y,Ae),ge=O?O+V:V;return Y._events[ge]?Y._events[ge].fn?Y._events[ge]=[Y._events[ge],Ce]:Y._events[ge].push(Ce):(Y._events[ge]=Ce,Y._eventsCount++),Y}function le(Y,V){--Y._eventsCount===0?Y._events=new te:delete Y._events[V]}function P(){this._events=new te,this._eventsCount=0}P.prototype.eventNames=function(){var V=[],ue,H;if(this._eventsCount===0)return V;for(H in ue=this._events)ae.call(ue,H)&&V.push(O?H.slice(1):H);return Object.getOwnPropertySymbols?V.concat(Object.getOwnPropertySymbols(ue)):V},P.prototype.listeners=function(V){var ue=O?O+V:V,H=this._events[ue];if(!H)return[];if(H.fn)return[H.fn];for(var Ae=0,Ce=H.length,ge=new Array(Ce);Ae<Ce;Ae++)ge[Ae]=H[Ae].fn;return ge},P.prototype.listenerCount=function(V){var ue=O?O+V:V,H=this._events[ue];return H?H.fn?1:H.length:0},P.prototype.emit=function(V,ue,H,Ae,Ce,ge){var ct=O?O+V:V;if(!this._events[ct])return!1;var ye=this._events[ct],St=arguments.length,mt,Ze;if(ye.fn){switch(ye.once&&this.removeListener(V,ye.fn,void 0,!0),St){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,ue),!0;case 3:return ye.fn.call(ye.context,ue,H),!0;case 4:return ye.fn.call(ye.context,ue,H,Ae),!0;case 5:return ye.fn.call(ye.context,ue,H,Ae,Ce),!0;case 6:return ye.fn.call(ye.context,ue,H,Ae,Ce,ge),!0}for(Ze=1,mt=new Array(St-1);Ze<St;Ze++)mt[Ze-1]=arguments[Ze];ye.fn.apply(ye.context,mt)}else{var ht=ye.length,it;for(Ze=0;Ze<ht;Ze++)switch(ye[Ze].once&&this.removeListener(V,ye[Ze].fn,void 0,!0),St){case 1:ye[Ze].fn.call(ye[Ze].context);break;case 2:ye[Ze].fn.call(ye[Ze].context,ue);break;case 3:ye[Ze].fn.call(ye[Ze].context,ue,H);break;case 4:ye[Ze].fn.call(ye[Ze].context,ue,H,Ae);break;default:if(!mt)for(it=1,mt=new Array(St-1);it<St;it++)mt[it-1]=arguments[it];ye[Ze].fn.apply(ye[Ze].context,mt)}}return!0},P.prototype.on=function(V,ue,H){return y(this,V,ue,H,!1)},P.prototype.once=function(V,ue,H){return y(this,V,ue,H,!0)},P.prototype.removeListener=function(V,ue,H,Ae){var Ce=O?O+V:V;if(!this._events[Ce])return this;if(!ue)return le(this,Ce),this;var ge=this._events[Ce];if(ge.fn)ge.fn===ue&&(!Ae||ge.once)&&(!H||ge.context===H)&&le(this,Ce);else{for(var ct=0,ye=[],St=ge.length;ct<St;ct++)(ge[ct].fn!==ue||Ae&&!ge[ct].once||H&&ge[ct].context!==H)&&ye.push(ge[ct]);ye.length?this._events[Ce]=ye.length===1?ye[0]:ye:le(this,Ce)}return this},P.prototype.removeAllListeners=function(V){var ue;return V?(ue=O?O+V:V,this._events[ue]&&le(this,ue)):(this._events=new te,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=O,P.EventEmitter=P,Ut.exports=P},72571:function(Ut){"use strict";var ae=Object.prototype.hasOwnProperty,O="~";function te(){}Object.create&&(te.prototype=Object.create(null),new te().__proto__||(O=!1));function de(Y,V,ue){this.fn=Y,this.context=V,this.once=ue||!1}function y(Y,V,ue,H,Ae){if(typeof ue!="function")throw new TypeError("The listener must be a function");var Ce=new de(ue,H||Y,Ae),ge=O?O+V:V;return Y._events[ge]?Y._events[ge].fn?Y._events[ge]=[Y._events[ge],Ce]:Y._events[ge].push(Ce):(Y._events[ge]=Ce,Y._eventsCount++),Y}function le(Y,V){--Y._eventsCount===0?Y._events=new te:delete Y._events[V]}function P(){this._events=new te,this._eventsCount=0}P.prototype.eventNames=function(){var V=[],ue,H;if(this._eventsCount===0)return V;for(H in ue=this._events)ae.call(ue,H)&&V.push(O?H.slice(1):H);return Object.getOwnPropertySymbols?V.concat(Object.getOwnPropertySymbols(ue)):V},P.prototype.listeners=function(V){var ue=O?O+V:V,H=this._events[ue];if(!H)return[];if(H.fn)return[H.fn];for(var Ae=0,Ce=H.length,ge=new Array(Ce);Ae<Ce;Ae++)ge[Ae]=H[Ae].fn;return ge},P.prototype.listenerCount=function(V){var ue=O?O+V:V,H=this._events[ue];return H?H.fn?1:H.length:0},P.prototype.emit=function(V,ue,H,Ae,Ce,ge){var ct=O?O+V:V;if(!this._events[ct])return!1;var ye=this._events[ct],St=arguments.length,mt,Ze;if(ye.fn){switch(ye.once&&this.removeListener(V,ye.fn,void 0,!0),St){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,ue),!0;case 3:return ye.fn.call(ye.context,ue,H),!0;case 4:return ye.fn.call(ye.context,ue,H,Ae),!0;case 5:return ye.fn.call(ye.context,ue,H,Ae,Ce),!0;case 6:return ye.fn.call(ye.context,ue,H,Ae,Ce,ge),!0}for(Ze=1,mt=new Array(St-1);Ze<St;Ze++)mt[Ze-1]=arguments[Ze];ye.fn.apply(ye.context,mt)}else{var ht=ye.length,it;for(Ze=0;Ze<ht;Ze++)switch(ye[Ze].once&&this.removeListener(V,ye[Ze].fn,void 0,!0),St){case 1:ye[Ze].fn.call(ye[Ze].context);break;case 2:ye[Ze].fn.call(ye[Ze].context,ue);break;case 3:ye[Ze].fn.call(ye[Ze].context,ue,H);break;case 4:ye[Ze].fn.call(ye[Ze].context,ue,H,Ae);break;default:if(!mt)for(it=1,mt=new Array(St-1);it<St;it++)mt[it-1]=arguments[it];ye[Ze].fn.apply(ye[Ze].context,mt)}}return!0},P.prototype.on=function(V,ue,H){return y(this,V,ue,H,!1)},P.prototype.once=function(V,ue,H){return y(this,V,ue,H,!0)},P.prototype.removeListener=function(V,ue,H,Ae){var Ce=O?O+V:V;if(!this._events[Ce])return this;if(!ue)return le(this,Ce),this;var ge=this._events[Ce];if(ge.fn)ge.fn===ue&&(!Ae||ge.once)&&(!H||ge.context===H)&&le(this,Ce);else{for(var ct=0,ye=[],St=ge.length;ct<St;ct++)(ge[ct].fn!==ue||Ae&&!ge[ct].once||H&&ge[ct].context!==H)&&ye.push(ge[ct]);ye.length?this._events[Ce]=ye.length===1?ye[0]:ye:le(this,Ce)}return this},P.prototype.removeAllListeners=function(V){var ue;return V?(ue=O?O+V:V,this._events[ue]&&le(this,ue)):(this._events=new te,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=O,P.EventEmitter=P,Ut.exports=P},72895:function(Ut){"use strict";var ae=Object.prototype.hasOwnProperty,O="~";function te(){}Object.create&&(te.prototype=Object.create(null),new te().__proto__||(O=!1));function de(Y,V,ue){this.fn=Y,this.context=V,this.once=ue||!1}function y(Y,V,ue,H,Ae){if(typeof ue!="function")throw new TypeError("The listener must be a function");var Ce=new de(ue,H||Y,Ae),ge=O?O+V:V;return Y._events[ge]?Y._events[ge].fn?Y._events[ge]=[Y._events[ge],Ce]:Y._events[ge].push(Ce):(Y._events[ge]=Ce,Y._eventsCount++),Y}function le(Y,V){--Y._eventsCount===0?Y._events=new te:delete Y._events[V]}function P(){this._events=new te,this._eventsCount=0}P.prototype.eventNames=function(){var V=[],ue,H;if(this._eventsCount===0)return V;for(H in ue=this._events)ae.call(ue,H)&&V.push(O?H.slice(1):H);return Object.getOwnPropertySymbols?V.concat(Object.getOwnPropertySymbols(ue)):V},P.prototype.listeners=function(V){var ue=O?O+V:V,H=this._events[ue];if(!H)return[];if(H.fn)return[H.fn];for(var Ae=0,Ce=H.length,ge=new Array(Ce);Ae<Ce;Ae++)ge[Ae]=H[Ae].fn;return ge},P.prototype.listenerCount=function(V){var ue=O?O+V:V,H=this._events[ue];return H?H.fn?1:H.length:0},P.prototype.emit=function(V,ue,H,Ae,Ce,ge){var ct=O?O+V:V;if(!this._events[ct])return!1;var ye=this._events[ct],St=arguments.length,mt,Ze;if(ye.fn){switch(ye.once&&this.removeListener(V,ye.fn,void 0,!0),St){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,ue),!0;case 3:return ye.fn.call(ye.context,ue,H),!0;case 4:return ye.fn.call(ye.context,ue,H,Ae),!0;case 5:return ye.fn.call(ye.context,ue,H,Ae,Ce),!0;case 6:return ye.fn.call(ye.context,ue,H,Ae,Ce,ge),!0}for(Ze=1,mt=new Array(St-1);Ze<St;Ze++)mt[Ze-1]=arguments[Ze];ye.fn.apply(ye.context,mt)}else{var ht=ye.length,it;for(Ze=0;Ze<ht;Ze++)switch(ye[Ze].once&&this.removeListener(V,ye[Ze].fn,void 0,!0),St){case 1:ye[Ze].fn.call(ye[Ze].context);break;case 2:ye[Ze].fn.call(ye[Ze].context,ue);break;case 3:ye[Ze].fn.call(ye[Ze].context,ue,H);break;case 4:ye[Ze].fn.call(ye[Ze].context,ue,H,Ae);break;default:if(!mt)for(it=1,mt=new Array(St-1);it<St;it++)mt[it-1]=arguments[it];ye[Ze].fn.apply(ye[Ze].context,mt)}}return!0},P.prototype.on=function(V,ue,H){return y(this,V,ue,H,!1)},P.prototype.once=function(V,ue,H){return y(this,V,ue,H,!0)},P.prototype.removeListener=function(V,ue,H,Ae){var Ce=O?O+V:V;if(!this._events[Ce])return this;if(!ue)return le(this,Ce),this;var ge=this._events[Ce];if(ge.fn)ge.fn===ue&&(!Ae||ge.once)&&(!H||ge.context===H)&&le(this,Ce);else{for(var ct=0,ye=[],St=ge.length;ct<St;ct++)(ge[ct].fn!==ue||Ae&&!ge[ct].once||H&&ge[ct].context!==H)&&ye.push(ge[ct]);ye.length?this._events[Ce]=ye.length===1?ye[0]:ye:le(this,Ce)}return this},P.prototype.removeAllListeners=function(V){var ue;return V?(ue=O?O+V:V,this._events[ue]&&le(this,ue)):(this._events=new te,this._eventsCount=0),this},P.prototype.off=P.prototype.removeListener,P.prototype.addListener=P.prototype.on,P.prefixed=O,P.EventEmitter=P,Ut.exports=P},38163:function(Ut){Ut.exports=ae;function ae(de,y){var le=de&&de.type,P;if(le==="FeatureCollection")for(P=0;P<de.features.length;P++)ae(de.features[P],y);else if(le==="GeometryCollection")for(P=0;P<de.geometries.length;P++)ae(de.geometries[P],y);else if(le==="Feature")ae(de.geometry,y);else if(le==="Polygon")O(de.coordinates,y);else if(le==="MultiPolygon")for(P=0;P<de.coordinates.length;P++)O(de.coordinates[P],y);return de}function O(de,y){if(de.length!==0){te(de[0],y);for(var le=1;le<de.length;le++)te(de[le],!y)}}function te(de,y){for(var le=0,P=0,Y=0,V=de.length,ue=V-1;Y<V;ue=Y++){var H=(de[Y][0]-de[ue][0])*(de[ue][1]+de[Y][1]),Ae=le+H;P+=Math.abs(le)>=Math.abs(H)?le-Ae+H:H-Ae+le,le=Ae}le+P>=0!=!!y&&de.reverse()}},75550:function(Ut){"use strict";Ut.exports=ae;function ae(O,te){this.x=O,this.y=te}ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(O){return this.clone()._add(O)},sub:function(O){return this.clone()._sub(O)},multByPoint:function(O){return this.clone()._multByPoint(O)},divByPoint:function(O){return this.clone()._divByPoint(O)},mult:function(O){return this.clone()._mult(O)},div:function(O){return this.clone()._div(O)},rotate:function(O){return this.clone()._rotate(O)},rotateAround:function(O,te){return this.clone()._rotateAround(O,te)},matMult:function(O){return this.clone()._matMult(O)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(O){return this.x===O.x&&this.y===O.y},dist:function(O){return Math.sqrt(this.distSqr(O))},distSqr:function(O){var te=O.x-this.x,de=O.y-this.y;return te*te+de*de},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(O){return Math.atan2(this.y-O.y,this.x-O.x)},angleWith:function(O){return this.angleWithSep(O.x,O.y)},angleWithSep:function(O,te){return Math.atan2(this.x*te-this.y*O,this.x*O+this.y*te)},_matMult:function(O){var te=O[0]*this.x+O[1]*this.y,de=O[2]*this.x+O[3]*this.y;return this.x=te,this.y=de,this},_add:function(O){return this.x+=O.x,this.y+=O.y,this},_sub:function(O){return this.x-=O.x,this.y-=O.y,this},_mult:function(O){return this.x*=O,this.y*=O,this},_div:function(O){return this.x/=O,this.y/=O,this},_multByPoint:function(O){return this.x*=O.x,this.y*=O.y,this},_divByPoint:function(O){return this.x/=O.x,this.y/=O.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var O=this.y;return this.y=this.x,this.x=-O,this},_rotate:function(O){var te=Math.cos(O),de=Math.sin(O),y=te*this.x-de*this.y,le=de*this.x+te*this.y;return this.x=y,this.y=le,this},_rotateAround:function(O,te){var de=Math.cos(O),y=Math.sin(O),le=te.x+de*(this.x-te.x)-y*(this.y-te.y),P=te.y+y*(this.x-te.x)+de*(this.y-te.y);return this.x=le,this.y=P,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ae.convert=function(O){return O instanceof ae?O:Array.isArray(O)?new ae(O[0],O[1]):O}},49296:function(Ut){"use strict";Ut.exports=O,Ut.exports.default=O;var ae=1e20;function O(P,Y,V,ue,H,Ae){this.fontSize=P||24,this.buffer=Y===void 0?3:Y,this.cutoff=ue||.25,this.fontFamily=H||"sans-serif",this.fontWeight=Ae||"normal",this.radius=V||8;var Ce=this.size=this.fontSize+this.buffer*2,ge=Ce+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ce,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ge*ge),this.gridInner=new Float64Array(ge*ge),this.f=new Float64Array(ge),this.z=new Float64Array(ge+1),this.v=new Uint16Array(ge),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ce/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function te(P,Y,V,ue,H,Ae,Ce){Ae.fill(ae,0,Y*V),Ce.fill(0,0,Y*V);for(var ge=(Y-ue)/2,ct=0;ct<H;ct++)for(var ye=0;ye<ue;ye++){var St=(ct+ge)*Y+ye+ge,mt=P.data[4*(ct*ue+ye)+3]/255;if(mt===1)Ae[St]=0,Ce[St]=ae;else if(mt===0)Ae[St]=ae,Ce[St]=0;else{var Ze=Math.max(0,.5-mt),ht=Math.max(0,mt-.5);Ae[St]=Ze*Ze,Ce[St]=ht*ht}}}function de(P,Y,V,ue,H,Ae,Ce){for(var ge=0;ge<Y*V;ge++){var ct=Math.sqrt(ue[ge])-Math.sqrt(H[ge]);P[ge]=Math.round(255-255*(ct/Ae+Ce))}}O.prototype._draw=function(P,Y){var V=this.ctx.measureText(P),ue=V.width,H=2*this.buffer,Ae,Ce,ge,ct,ye,St,mt,Ze;Y&&this.useMetrics?(ye=Math.floor(V.actualBoundingBoxAscent),Ze=this.buffer+Math.ceil(V.actualBoundingBoxAscent),St=this.buffer,mt=this.buffer,Ce=Math.min(this.size,Math.ceil(V.actualBoundingBoxRight-V.actualBoundingBoxLeft)),ct=Math.min(this.size-St,Math.ceil(V.actualBoundingBoxAscent+V.actualBoundingBoxDescent)),Ae=Ce+H,ge=ct+H,this.ctx.textBaseline="alphabetic"):(Ae=Ce=this.size,ge=ct=this.size,ye=19*this.fontSize/24,St=mt=0,Ze=this.middle,this.ctx.textBaseline="middle");var ht;Ce&&ct&&(this.ctx.clearRect(mt,St,Ce,ct),this.ctx.fillText(P,this.buffer,Ze),ht=this.ctx.getImageData(mt,St,Ce,ct));var it=new Uint8ClampedArray(Ae*ge);return te(ht,Ae,ge,Ce,ct,this.gridOuter,this.gridInner),y(this.gridOuter,Ae,ge,this.f,this.v,this.z),y(this.gridInner,Ae,ge,this.f,this.v,this.z),de(it,Ae,ge,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:it,metrics:{width:Ce,height:ct,sdfWidth:Ae,sdfHeight:ge,top:ye,left:0,advance:ue}}},O.prototype.draw=function(P){return this._draw(P,!1).data},O.prototype.drawWithMetrics=function(P){return this._draw(P,!0)};function y(P,Y,V,ue,H,Ae){for(var Ce=0;Ce<Y;Ce++)le(P,Ce,Y,V,ue,H,Ae);for(var ge=0;ge<V;ge++)le(P,ge*Y,1,Y,ue,H,Ae)}function le(P,Y,V,ue,H,Ae,Ce){var ge,ct,ye,St;for(Ae[0]=0,Ce[0]=-ae,Ce[1]=ae,ge=0;ge<ue;ge++)H[ge]=P[Y+ge*V];for(ge=1,ct=0,ye=0;ge<ue;ge++){do St=Ae[ct],ye=(H[ge]-H[St]+ge*ge-St*St)/(ge-St)/2;while(ye<=Ce[ct]&&--ct>-1);ct++,Ae[ct]=ge,Ce[ct]=ye,Ce[ct+1]=ae}for(ge=0,ct=0;ge<ue;ge++){for(;Ce[ct+1]<ge;)ct++;St=Ae[ct],P[Y+ge*V]=H[St]+(ge-St)*(ge-St)}}},38929:function(Ut,ae,O){Ut.exports.VectorTile=O(22779),O(66024),O(59701)},22779:function(Ut,ae,O){"use strict";var te=O(59701);Ut.exports=de;function de(le,P){this.layers=le.readFields(y,{},P)}function y(le,P,Y){if(le===3){var V=new te(Y,Y.readVarint()+Y.pos);V.length&&(P[V.name]=V)}}},66024:function(Ut,ae,O){"use strict";var te=O(75550);Ut.exports=de;function de(V,ue,H,Ae,Ce){this.properties={},this.extent=H,this.type=0,this._pbf=V,this._geometry=-1,this._keys=Ae,this._values=Ce,V.readFields(y,this,ue)}function y(V,ue,H){V==1?ue.id=H.readVarint():V==2?le(H,ue):V==3?ue.type=H.readVarint():V==4&&(ue._geometry=H.pos)}function le(V,ue){for(var H=V.readVarint()+V.pos;V.pos<H;){var Ae=ue._keys[V.readVarint()],Ce=ue._values[V.readVarint()];ue.properties[Ae]=Ce}}de.types=["Unknown","Point","LineString","Polygon"],de.prototype.loadGeometry=function(){var V=this._pbf;V.pos=this._geometry;for(var ue=V.readVarint()+V.pos,H=1,Ae=0,Ce=0,ge=0,ct=[],ye;V.pos<ue;){if(Ae<=0){var St=V.readVarint();H=St&7,Ae=St>>3}if(Ae--,H===1||H===2)Ce+=V.readSVarint(),ge+=V.readSVarint(),H===1&&(ye&&ct.push(ye),ye=[]),ye.push(new te(Ce,ge));else if(H===7)ye&&ye.push(ye[0].clone());else throw new Error("unknown command "+H)}return ye&&ct.push(ye),ct},de.prototype.bbox=function(){var V=this._pbf;V.pos=this._geometry;for(var ue=V.readVarint()+V.pos,H=1,Ae=0,Ce=0,ge=0,ct=1/0,ye=-1/0,St=1/0,mt=-1/0;V.pos<ue;){if(Ae<=0){var Ze=V.readVarint();H=Ze&7,Ae=Ze>>3}if(Ae--,H===1||H===2)Ce+=V.readSVarint(),ge+=V.readSVarint(),Ce<ct&&(ct=Ce),Ce>ye&&(ye=Ce),ge<St&&(St=ge),ge>mt&&(mt=ge);else if(H!==7)throw new Error("unknown command "+H)}return[ct,St,ye,mt]},de.prototype.toGeoJSON=function(V,ue,H){var Ae=this.extent*Math.pow(2,H),Ce=this.extent*V,ge=this.extent*ue,ct=this.loadGeometry(),ye=de.types[this.type],St,mt;function Ze(dr){for(var yr=0;yr<dr.length;yr++){var cr=dr[yr],ft=180-(cr.y+ge)*360/Ae;dr[yr]=[(cr.x+Ce)*360/Ae-180,360/Math.PI*Math.atan(Math.exp(ft*Math.PI/180))-90]}}switch(this.type){case 1:var ht=[];for(St=0;St<ct.length;St++)ht[St]=ct[St][0];ct=ht,Ze(ct);break;case 2:for(St=0;St<ct.length;St++)Ze(ct[St]);break;case 3:for(ct=P(ct),St=0;St<ct.length;St++)for(mt=0;mt<ct[St].length;mt++)Ze(ct[St][mt]);break}ct.length===1?ct=ct[0]:ye="Multi"+ye;var it={type:"Feature",geometry:{type:ye,coordinates:ct},properties:this.properties};return"id"in this&&(it.id=this.id),it};function P(V){var ue=V.length;if(ue<=1)return[V];for(var H=[],Ae,Ce,ge=0;ge<ue;ge++){var ct=Y(V[ge]);ct!==0&&(Ce===void 0&&(Ce=ct<0),Ce===ct<0?(Ae&&H.push(Ae),Ae=[V[ge]]):Ae.push(V[ge]))}return Ae&&H.push(Ae),H}function Y(V){for(var ue=0,H=0,Ae=V.length,Ce=Ae-1,ge,ct;H<Ae;Ce=H++)ge=V[H],ct=V[Ce],ue+=(ct.x-ge.x)*(ge.y+ct.y);return ue}},59701:function(Ut,ae,O){"use strict";var te=O(66024);Ut.exports=de;function de(P,Y){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=P,this._keys=[],this._values=[],this._features=[],P.readFields(y,this,Y),this.length=this._features.length}function y(P,Y,V){P===15?Y.version=V.readVarint():P===1?Y.name=V.readString():P===5?Y.extent=V.readVarint():P===2?Y._features.push(V.pos):P===3?Y._keys.push(V.readString()):P===4&&Y._values.push(le(V))}function le(P){for(var Y=null,V=P.readVarint()+P.pos;P.pos<V;){var ue=P.readVarint()>>3;Y=ue===1?P.readString():ue===2?P.readFloat():ue===3?P.readDouble():ue===4?P.readVarint64():ue===5?P.readVarint():ue===6?P.readSVarint():ue===7?P.readBoolean():null}return Y}de.prototype.feature=function(P){if(P<0||P>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[P];var Y=this._pbf.readVarint()+this._pbf.pos;return new te(this._pbf,Y,this.extent,this._keys,this._values)}},55054:function(Ut,ae,O){"use strict";O.d(ae,{Z:function(){return mr}});var te=O(67294),de=O(57838),y=O(96159),le=O(93967),P=O.n(le),Y=O(64217),V=O(53124),ue=O(99559),Ae=ie=>{const{value:j,formatter:re,precision:ke,decimalSeparator:Te,groupSeparator:st="",prefixCls:ze}=ie;let Qe;if(typeof re=="function")Qe=re(j);else{const at=String(j),Mt=at.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Mt||at==="-")Qe=at;else{const vr=Mt[1];let kt=Mt[2]||"0",Vr=Mt[4]||"";kt=kt.replace(/\B(?=(\d{3})+(?!\d))/g,st),typeof ke=="number"&&(Vr=Vr.padEnd(ke,"0").slice(0,ke>0?ke:0)),Vr&&(Vr=`${Te}${Vr}`),Qe=[te.createElement("span",{key:"int",className:`${ze}-content-value-int`},vr,kt),Vr&&te.createElement("span",{key:"decimal",className:`${ze}-content-value-decimal`},Vr)]}}return te.createElement("span",{className:`${ze}-content-value`},Qe)},Ce=O(14747),ge=O(91945),ct=O(45503);const ye=ie=>{const{componentCls:j,marginXXS:re,padding:ke,colorTextDescription:Te,titleFontSize:st,colorTextHeading:ze,contentFontSize:Qe,fontFamily:at}=ie;return{[`${j}`]:Object.assign(Object.assign({},(0,Ce.Wf)(ie)),{[`${j}-title`]:{marginBottom:re,color:Te,fontSize:st},[`${j}-skeleton`]:{paddingTop:ke},[`${j}-content`]:{color:ze,fontSize:Qe,fontFamily:at,[`${j}-content-value`]:{display:"inline-block",direction:"ltr"},[`${j}-content-prefix, ${j}-content-suffix`]:{display:"inline-block"},[`${j}-content-prefix`]:{marginInlineEnd:re},[`${j}-content-suffix`]:{marginInlineStart:re}}})}},St=ie=>{const{fontSizeHeading3:j,fontSize:re}=ie;return{titleFontSize:re,contentFontSize:j}};var mt=(0,ge.I$)("Statistic",ie=>{const j=(0,ct.TS)(ie,{});return[ye(j)]},St),Ze=function(ie,j){var re={};for(var ke in ie)Object.prototype.hasOwnProperty.call(ie,ke)&&j.indexOf(ke)<0&&(re[ke]=ie[ke]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Te=0,ke=Object.getOwnPropertySymbols(ie);Te<ke.length;Te++)j.indexOf(ke[Te])<0&&Object.prototype.propertyIsEnumerable.call(ie,ke[Te])&&(re[ke[Te]]=ie[ke[Te]]);return re},it=ie=>{const{prefixCls:j,className:re,rootClassName:ke,style:Te,valueStyle:st,value:ze=0,title:Qe,valueRender:at,prefix:Mt,suffix:vr,loading:kt=!1,formatter:Vr,precision:Kr,decimalSeparator:Ir=".",groupSeparator:In=",",onMouseEnter:gn,onMouseLeave:nn}=ie,hi=Ze(ie,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:Lr,direction:jn,statistic:jr}=te.useContext(V.E_),hn=Lr("statistic",j),[qi,Ei,ia]=mt(hn),ta=te.createElement(Ae,{decimalSeparator:Ir,groupSeparator:In,prefixCls:hn,formatter:Vr,precision:Kr,value:ze}),Se=P()(hn,{[`${hn}-rtl`]:jn==="rtl"},jr==null?void 0:jr.className,re,ke,Ei,ia),Ni=(0,Y.Z)(hi,{aria:!0,data:!0});return qi(te.createElement("div",Object.assign({},Ni,{className:Se,style:Object.assign(Object.assign({},jr==null?void 0:jr.style),Te),onMouseEnter:gn,onMouseLeave:nn}),Qe&&te.createElement("div",{className:`${hn}-title`},Qe),te.createElement(ue.Z,{paragraph:!1,loading:kt,className:`${hn}-skeleton`},te.createElement("div",{style:st,className:`${hn}-content`},Mt&&te.createElement("span",{className:`${hn}-content-prefix`},Mt),at?at(ta):ta,vr&&te.createElement("span",{className:`${hn}-content-suffix`},vr)))))};const dr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function yr(ie,j){let re=ie;const ke=/\[[^\]]*]/g,Te=(j.match(ke)||[]).map(at=>at.slice(1,-1)),st=j.replace(ke,"[]"),ze=dr.reduce((at,Mt)=>{let[vr,kt]=Mt;if(at.includes(vr)){const Vr=Math.floor(re/kt);return re-=Vr*kt,at.replace(new RegExp(`${vr}+`,"g"),Kr=>{const Ir=Kr.length;return Vr.toString().padStart(Ir,"0")})}return at},st);let Qe=0;return ze.replace(ke,()=>{const at=Te[Qe];return Qe+=1,at})}function cr(ie,j){const{format:re=""}=j,ke=new Date(ie).getTime(),Te=Date.now(),st=Math.max(ke-Te,0);return yr(st,re)}var ft=function(ie,j){var re={};for(var ke in ie)Object.prototype.hasOwnProperty.call(ie,ke)&&j.indexOf(ke)<0&&(re[ke]=ie[ke]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Te=0,ke=Object.getOwnPropertySymbols(ie);Te<ke.length;Te++)j.indexOf(ke[Te])<0&&Object.prototype.propertyIsEnumerable.call(ie,ke[Te])&&(re[ke[Te]]=ie[ke[Te]]);return re};const Pe=1e3/30;function Rt(ie){return new Date(ie).getTime()}const Ve=ie=>{const{value:j,format:re="HH:mm:ss",onChange:ke,onFinish:Te}=ie,st=ft(ie,["value","format","onChange","onFinish"]),ze=(0,de.Z)(),Qe=te.useRef(null),at=()=>{Te==null||Te(),Qe.current&&(clearInterval(Qe.current),Qe.current=null)},Mt=()=>{const Vr=Rt(j);Vr>=Date.now()&&(Qe.current=setInterval(()=>{ze(),ke==null||ke(Vr-Date.now()),Vr<Date.now()&&at()},Pe))};te.useEffect(()=>(Mt(),()=>{Qe.current&&(clearInterval(Qe.current),Qe.current=null)}),[j]);const vr=(Vr,Kr)=>cr(Vr,Object.assign(Object.assign({},Kr),{format:re})),kt=Vr=>(0,y.Tm)(Vr,{title:void 0});return te.createElement(it,Object.assign({},st,{value:j,valueRender:kt,formatter:vr}))};var Vt=te.memo(Ve);it.Countdown=Vt;var mr=it},98129:function(Ut,ae,O){"use strict";var te=O(60690);Ut.exports=function(le){le=le||{};var P=le.reporter,Y=te.getOption(le,"async",!0),V=te.getOption(le,"auto",!0);V&&!Y&&(P&&P.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),Y=!0);var ue=de(),H,Ae=!1;function Ce(ht,it){!Ae&&V&&Y&&ue.size()===0&&ye(),ue.add(ht,it)}function ge(){for(Ae=!0;ue.size();){var ht=ue;ue=de(),ht.process()}Ae=!1}function ct(ht){Ae||(ht===void 0&&(ht=Y),H&&(mt(H),H=null),ht?ye():ge())}function ye(){H=Ze(ge)}function St(){ue={},batchSize=0,topLevel=0,bottomLevel=0}function mt(ht){var it=clearTimeout;return it(ht)}function Ze(ht){var it=function(dr){return setTimeout(dr,0)};return it(ht)}return{add:Ce,force:ct}};function de(){var y={},le=0,P=0,Y=0;function V(Ae,Ce){Ce||(Ce=Ae,Ae=0),Ae>P?P=Ae:Ae<Y&&(Y=Ae),y[Ae]||(y[Ae]=[]),y[Ae].push(Ce),le++}function ue(){for(var Ae=Y;Ae<=P;Ae++)for(var Ce=y[Ae],ge=0;ge<Ce.length;ge++){var ct=Ce[ge];ct()}}function H(){return le}return{add:V,process:ue,size:H}}},60690:function(Ut){"use strict";var ae=Ut.exports={};ae.getOption=O;function O(te,de,y){var le=te[de];return le==null&&y!==void 0?y:le}},9187:function(Ut){"use strict";Ut.exports=ae,Ut.exports.default=ae;function ae(re,ke,Te){Te=Te||2;var st=ke&&ke.length,ze=st?ke[0]*Te:re.length,Qe=O(re,0,ze,Te,!0),at=[];if(!Qe||Qe.next===Qe.prev)return at;var Mt,vr,kt,Vr,Kr,Ir,In;if(st&&(Qe=V(re,ke,Qe,Te)),re.length>80*Te){Mt=kt=re[0],vr=Vr=re[1];for(var gn=Te;gn<ze;gn+=Te)Kr=re[gn],Ir=re[gn+1],Kr<Mt&&(Mt=Kr),Ir<vr&&(vr=Ir),Kr>kt&&(kt=Kr),Ir>Vr&&(Vr=Ir);In=Math.max(kt-Mt,Vr-vr),In=In!==0?32767/In:0}return de(Qe,at,Te,Mt,vr,In,0),at}function O(re,ke,Te,st,ze){var Qe,at;if(ze===j(re,ke,Te,st)>0)for(Qe=ke;Qe<Te;Qe+=st)at=Vt(Qe,re[Qe],re[Qe+1],at);else for(Qe=Te-st;Qe>=ke;Qe-=st)at=Vt(Qe,re[Qe],re[Qe+1],at);return at&&it(at,at.next)&&(mr(at),at=at.next),at}function te(re,ke){if(!re)return re;ke||(ke=re);var Te=re,st;do if(st=!1,!Te.steiner&&(it(Te,Te.next)||ht(Te.prev,Te,Te.next)===0)){if(mr(Te),Te=ke=Te.prev,Te===Te.next)break;st=!0}else Te=Te.next;while(st||Te!==ke);return ke}function de(re,ke,Te,st,ze,Qe,at){if(re){!at&&Qe&&ge(re,st,ze,Qe);for(var Mt=re,vr,kt;re.prev!==re.next;){if(vr=re.prev,kt=re.next,Qe?le(re,st,ze,Qe):y(re)){ke.push(vr.i/Te|0),ke.push(re.i/Te|0),ke.push(kt.i/Te|0),mr(re),re=kt.next,Mt=kt.next;continue}if(re=kt,re===Mt){at?at===1?(re=P(te(re),ke,Te),de(re,ke,Te,st,ze,Qe,2)):at===2&&Y(re,ke,Te,st,ze,Qe):de(te(re),ke,Te,st,ze,Qe,1);break}}}}function y(re){var ke=re.prev,Te=re,st=re.next;if(ht(ke,Te,st)>=0)return!1;for(var ze=ke.x,Qe=Te.x,at=st.x,Mt=ke.y,vr=Te.y,kt=st.y,Vr=ze<Qe?ze<at?ze:at:Qe<at?Qe:at,Kr=Mt<vr?Mt<kt?Mt:kt:vr<kt?vr:kt,Ir=ze>Qe?ze>at?ze:at:Qe>at?Qe:at,In=Mt>vr?Mt>kt?Mt:kt:vr>kt?vr:kt,gn=st.next;gn!==ke;){if(gn.x>=Vr&&gn.x<=Ir&&gn.y>=Kr&&gn.y<=In&&mt(ze,Mt,Qe,vr,at,kt,gn.x,gn.y)&&ht(gn.prev,gn,gn.next)>=0)return!1;gn=gn.next}return!0}function le(re,ke,Te,st){var ze=re.prev,Qe=re,at=re.next;if(ht(ze,Qe,at)>=0)return!1;for(var Mt=ze.x,vr=Qe.x,kt=at.x,Vr=ze.y,Kr=Qe.y,Ir=at.y,In=Mt<vr?Mt<kt?Mt:kt:vr<kt?vr:kt,gn=Vr<Kr?Vr<Ir?Vr:Ir:Kr<Ir?Kr:Ir,nn=Mt>vr?Mt>kt?Mt:kt:vr>kt?vr:kt,hi=Vr>Kr?Vr>Ir?Vr:Ir:Kr>Ir?Kr:Ir,Lr=ye(In,gn,ke,Te,st),jn=ye(nn,hi,ke,Te,st),jr=re.prevZ,hn=re.nextZ;jr&&jr.z>=Lr&&hn&&hn.z<=jn;){if(jr.x>=In&&jr.x<=nn&&jr.y>=gn&&jr.y<=hi&&jr!==ze&&jr!==at&&mt(Mt,Vr,vr,Kr,kt,Ir,jr.x,jr.y)&&ht(jr.prev,jr,jr.next)>=0||(jr=jr.prevZ,hn.x>=In&&hn.x<=nn&&hn.y>=gn&&hn.y<=hi&&hn!==ze&&hn!==at&&mt(Mt,Vr,vr,Kr,kt,Ir,hn.x,hn.y)&&ht(hn.prev,hn,hn.next)>=0))return!1;hn=hn.nextZ}for(;jr&&jr.z>=Lr;){if(jr.x>=In&&jr.x<=nn&&jr.y>=gn&&jr.y<=hi&&jr!==ze&&jr!==at&&mt(Mt,Vr,vr,Kr,kt,Ir,jr.x,jr.y)&&ht(jr.prev,jr,jr.next)>=0)return!1;jr=jr.prevZ}for(;hn&&hn.z<=jn;){if(hn.x>=In&&hn.x<=nn&&hn.y>=gn&&hn.y<=hi&&hn!==ze&&hn!==at&&mt(Mt,Vr,vr,Kr,kt,Ir,hn.x,hn.y)&&ht(hn.prev,hn,hn.next)>=0)return!1;hn=hn.nextZ}return!0}function P(re,ke,Te){var st=re;do{var ze=st.prev,Qe=st.next.next;!it(ze,Qe)&&dr(ze,st,st.next,Qe)&&Pe(ze,Qe)&&Pe(Qe,ze)&&(ke.push(ze.i/Te|0),ke.push(st.i/Te|0),ke.push(Qe.i/Te|0),mr(st),mr(st.next),st=re=Qe),st=st.next}while(st!==re);return te(st)}function Y(re,ke,Te,st,ze,Qe){var at=re;do{for(var Mt=at.next.next;Mt!==at.prev;){if(at.i!==Mt.i&&Ze(at,Mt)){var vr=Ve(at,Mt);at=te(at,at.next),vr=te(vr,vr.next),de(at,ke,Te,st,ze,Qe,0),de(vr,ke,Te,st,ze,Qe,0);return}Mt=Mt.next}at=at.next}while(at!==re)}function V(re,ke,Te,st){var ze=[],Qe,at,Mt,vr,kt;for(Qe=0,at=ke.length;Qe<at;Qe++)Mt=ke[Qe]*st,vr=Qe<at-1?ke[Qe+1]*st:re.length,kt=O(re,Mt,vr,st,!1),kt===kt.next&&(kt.steiner=!0),ze.push(St(kt));for(ze.sort(ue),Qe=0;Qe<ze.length;Qe++)Te=H(ze[Qe],Te);return Te}function ue(re,ke){return re.x-ke.x}function H(re,ke){var Te=Ae(re,ke);if(!Te)return ke;var st=Ve(Te,re);return te(st,st.next),te(Te,Te.next)}function Ae(re,ke){var Te=ke,st=re.x,ze=re.y,Qe=-1/0,at;do{if(ze<=Te.y&&ze>=Te.next.y&&Te.next.y!==Te.y){var Mt=Te.x+(ze-Te.y)*(Te.next.x-Te.x)/(Te.next.y-Te.y);if(Mt<=st&&Mt>Qe&&(Qe=Mt,at=Te.x<Te.next.x?Te:Te.next,Mt===st))return at}Te=Te.next}while(Te!==ke);if(!at)return null;var vr=at,kt=at.x,Vr=at.y,Kr=1/0,Ir;Te=at;do st>=Te.x&&Te.x>=kt&&st!==Te.x&&mt(ze<Vr?st:Qe,ze,kt,Vr,ze<Vr?Qe:st,ze,Te.x,Te.y)&&(Ir=Math.abs(ze-Te.y)/(st-Te.x),Pe(Te,re)&&(Ir<Kr||Ir===Kr&&(Te.x>at.x||Te.x===at.x&&Ce(at,Te)))&&(at=Te,Kr=Ir)),Te=Te.next;while(Te!==vr);return at}function Ce(re,ke){return ht(re.prev,re,ke.prev)<0&&ht(ke.next,re,re.next)<0}function ge(re,ke,Te,st){var ze=re;do ze.z===0&&(ze.z=ye(ze.x,ze.y,ke,Te,st)),ze.prevZ=ze.prev,ze.nextZ=ze.next,ze=ze.next;while(ze!==re);ze.prevZ.nextZ=null,ze.prevZ=null,ct(ze)}function ct(re){var ke,Te,st,ze,Qe,at,Mt,vr,kt=1;do{for(Te=re,re=null,Qe=null,at=0;Te;){for(at++,st=Te,Mt=0,ke=0;ke<kt&&(Mt++,st=st.nextZ,!!st);ke++);for(vr=kt;Mt>0||vr>0&&st;)Mt!==0&&(vr===0||!st||Te.z<=st.z)?(ze=Te,Te=Te.nextZ,Mt--):(ze=st,st=st.nextZ,vr--),Qe?Qe.nextZ=ze:re=ze,ze.prevZ=Qe,Qe=ze;Te=st}Qe.nextZ=null,kt*=2}while(at>1);return re}function ye(re,ke,Te,st,ze){return re=(re-Te)*ze|0,ke=(ke-st)*ze|0,re=(re|re<<8)&16711935,re=(re|re<<4)&252645135,re=(re|re<<2)&858993459,re=(re|re<<1)&1431655765,ke=(ke|ke<<8)&16711935,ke=(ke|ke<<4)&252645135,ke=(ke|ke<<2)&858993459,ke=(ke|ke<<1)&1431655765,re|ke<<1}function St(re){var ke=re,Te=re;do(ke.x<Te.x||ke.x===Te.x&&ke.y<Te.y)&&(Te=ke),ke=ke.next;while(ke!==re);return Te}function mt(re,ke,Te,st,ze,Qe,at,Mt){return(ze-at)*(ke-Mt)>=(re-at)*(Qe-Mt)&&(re-at)*(st-Mt)>=(Te-at)*(ke-Mt)&&(Te-at)*(Qe-Mt)>=(ze-at)*(st-Mt)}function Ze(re,ke){return re.next.i!==ke.i&&re.prev.i!==ke.i&&!ft(re,ke)&&(Pe(re,ke)&&Pe(ke,re)&&Rt(re,ke)&&(ht(re.prev,re,ke.prev)||ht(re,ke.prev,ke))||it(re,ke)&&ht(re.prev,re,re.next)>0&&ht(ke.prev,ke,ke.next)>0)}function ht(re,ke,Te){return(ke.y-re.y)*(Te.x-ke.x)-(ke.x-re.x)*(Te.y-ke.y)}function it(re,ke){return re.x===ke.x&&re.y===ke.y}function dr(re,ke,Te,st){var ze=cr(ht(re,ke,Te)),Qe=cr(ht(re,ke,st)),at=cr(ht(Te,st,re)),Mt=cr(ht(Te,st,ke));return!!(ze!==Qe&&at!==Mt||ze===0&&yr(re,Te,ke)||Qe===0&&yr(re,st,ke)||at===0&&yr(Te,re,st)||Mt===0&&yr(Te,ke,st))}function yr(re,ke,Te){return ke.x<=Math.max(re.x,Te.x)&&ke.x>=Math.min(re.x,Te.x)&&ke.y<=Math.max(re.y,Te.y)&&ke.y>=Math.min(re.y,Te.y)}function cr(re){return re>0?1:re<0?-1:0}function ft(re,ke){var Te=re;do{if(Te.i!==re.i&&Te.next.i!==re.i&&Te.i!==ke.i&&Te.next.i!==ke.i&&dr(Te,Te.next,re,ke))return!0;Te=Te.next}while(Te!==re);return!1}function Pe(re,ke){return ht(re.prev,re,re.next)<0?ht(re,ke,re.next)>=0&&ht(re,re.prev,ke)>=0:ht(re,ke,re.prev)<0||ht(re,re.next,ke)<0}function Rt(re,ke){var Te=re,st=!1,ze=(re.x+ke.x)/2,Qe=(re.y+ke.y)/2;do Te.y>Qe!=Te.next.y>Qe&&Te.next.y!==Te.y&&ze<(Te.next.x-Te.x)*(Qe-Te.y)/(Te.next.y-Te.y)+Te.x&&(st=!st),Te=Te.next;while(Te!==re);return st}function Ve(re,ke){var Te=new ie(re.i,re.x,re.y),st=new ie(ke.i,ke.x,ke.y),ze=re.next,Qe=ke.prev;return re.next=ke,ke.prev=re,Te.next=ze,ze.prev=Te,st.next=Te,Te.prev=st,Qe.next=st,st.prev=Qe,st}function Vt(re,ke,Te,st){var ze=new ie(re,ke,Te);return st?(ze.next=st.next,ze.prev=st,st.next.prev=ze,st.next=ze):(ze.prev=ze,ze.next=ze),ze}function mr(re){re.next.prev=re.prev,re.prev.next=re.next,re.prevZ&&(re.prevZ.nextZ=re.nextZ),re.nextZ&&(re.nextZ.prevZ=re.prevZ)}function ie(re,ke,Te){this.i=re,this.x=ke,this.y=Te,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ae.deviation=function(re,ke,Te,st){var ze=ke&&ke.length,Qe=ze?ke[0]*Te:re.length,at=Math.abs(j(re,0,Qe,Te));if(ze)for(var Mt=0,vr=ke.length;Mt<vr;Mt++){var kt=ke[Mt]*Te,Vr=Mt<vr-1?ke[Mt+1]*Te:re.length;at-=Math.abs(j(re,kt,Vr,Te))}var Kr=0;for(Mt=0;Mt<st.length;Mt+=3){var Ir=st[Mt]*Te,In=st[Mt+1]*Te,gn=st[Mt+2]*Te;Kr+=Math.abs((re[Ir]-re[gn])*(re[In+1]-re[Ir+1])-(re[Ir]-re[In])*(re[gn+1]-re[Ir+1]))}return at===0&&Kr===0?0:Math.abs((Kr-at)/at)};function j(re,ke,Te,st){for(var ze=0,Qe=ke,at=Te-st;Qe<Te;Qe+=st)ze+=(re[at]-re[Qe])*(re[Qe+1]+re[at+1]),at=Qe;return ze}ae.flatten=function(re){for(var ke=re[0][0].length,Te={vertices:[],holes:[],dimensions:ke},st=0,ze=0;ze<re.length;ze++){for(var Qe=0;Qe<re[ze].length;Qe++)for(var at=0;at<ke;at++)Te.vertices.push(re[ze][Qe][at]);ze>0&&(st+=re[ze-1].length,Te.holes.push(st))}return Te}},2268:function(Ut){"use strict";var ae=Ut.exports={};ae.isIE=function(O){function te(){var y=navigator.userAgent.toLowerCase();return y.indexOf("msie")!==-1||y.indexOf("trident")!==-1||y.indexOf(" edge/")!==-1}if(!te())return!1;if(!O)return!0;var de=function(){var y,le=3,P=document.createElement("div"),Y=P.getElementsByTagName("i");do P.innerHTML="<!--[if gt IE "+ ++le+"]><i></i><![endif]-->";while(Y[0]);return le>4?le:y}();return O===de},ae.isLegacyOpera=function(){return!!window.opera}},17900:function(Ut){"use strict";var ae=Ut.exports={};ae.forEach=function(O,te){for(var de=0;de<O.length;de++){var y=te(O[de]);if(y)return y}}},58229:function(Ut,ae,O){"use strict";var te=O(2268);Ut.exports=function(de){de=de||{};var y=de.reporter,le=de.batchProcessor,P=de.stateHandler.getState;if(!y)throw new Error("Missing required dependency: reporter.");function Y(Ce,ge){function ct(){ge(Ce)}if(te.isIE(8))P(Ce).object={proxy:ct},Ce.attachEvent("onresize",ct);else{var ye=H(Ce);if(!ye)throw new Error("Element is not detectable by this strategy.");ye.contentDocument.defaultView.addEventListener("resize",ct)}}function V(Ce){var ge=de.important?" !important; ":"; ";return(Ce.join(ge)+ge).trim()}function ue(Ce,ge,ct){ct||(ct=ge,ge=Ce,Ce=null),Ce=Ce||{};var ye=Ce.debug;function St(mt,Ze){var ht=V(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),it=!1,dr=window.getComputedStyle(mt),yr=mt.offsetWidth,cr=mt.offsetHeight;P(mt).startSize={width:yr,height:cr};function ft(){function Pe(){if(dr.position==="static"){mt.style.setProperty("position","relative",Ce.important?"important":"");var Vt=function(mr,ie,j,re){function ke(st){return st.replace(/[^-\d\.]/g,"")}var Te=j[re];Te!=="auto"&&ke(Te)!=="0"&&(mr.warn("An element that is positioned static has style."+re+"="+Te+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+re+" will be set to 0. Element: ",ie),ie.style.setProperty(re,"0",Ce.important?"important":""))};Vt(y,mt,dr,"top"),Vt(y,mt,dr,"right"),Vt(y,mt,dr,"bottom"),Vt(y,mt,dr,"left")}}function Rt(){it||Pe();function Vt(ie,j){if(!ie.contentDocument){var re=P(ie);re.checkForObjectDocumentTimeoutId&&window.clearTimeout(re.checkForObjectDocumentTimeoutId),re.checkForObjectDocumentTimeoutId=setTimeout(function(){re.checkForObjectDocumentTimeoutId=0,Vt(ie,j)},100);return}j(ie.contentDocument)}var mr=this;Vt(mr,function(j){Ze(mt)})}dr.position!==""&&(Pe(dr),it=!0);var Ve=document.createElement("object");Ve.style.cssText=ht,Ve.tabIndex=-1,Ve.type="text/html",Ve.setAttribute("aria-hidden","true"),Ve.onload=Rt,te.isIE()||(Ve.data="about:blank"),P(mt)&&(mt.appendChild(Ve),P(mt).object=Ve,te.isIE()&&(Ve.data="about:blank"))}le?le.add(ft):ft()}te.isIE(8)?ct(ge):St(ge,ct)}function H(Ce){return P(Ce).object}function Ae(Ce){if(P(Ce)){var ge=H(Ce);ge&&(te.isIE(8)?Ce.detachEvent("onresize",ge.proxy):Ce.removeChild(ge),P(Ce).checkForObjectDocumentTimeoutId&&window.clearTimeout(P(Ce).checkForObjectDocumentTimeoutId),delete P(Ce).object)}}return{makeDetectable:ue,addListener:Y,uninstall:Ae}}},60787:function(Ut,ae,O){"use strict";var te=O(17900).forEach;Ut.exports=function(de){de=de||{};var y=de.reporter,le=de.batchProcessor,P=de.stateHandler.getState,Y=de.stateHandler.hasState,V=de.idHandler;if(!le)throw new Error("Missing required dependency: batchProcessor");if(!y)throw new Error("Missing required dependency: reporter.");var ue=ct(),H="erd_scroll_detection_scrollbar_style",Ae="erd_scroll_detection_container";function Ce(ft){ye(ft,H,Ae)}Ce(window.document);function ge(ft){var Pe=de.important?" !important; ":"; ";return(ft.join(Pe)+Pe).trim()}function ct(){var ft=500,Pe=500,Rt=document.createElement("div");Rt.style.cssText=ge(["position: absolute","width: "+ft*2+"px","height: "+Pe*2+"px","visibility: hidden","margin: 0","padding: 0"]);var Ve=document.createElement("div");Ve.style.cssText=ge(["position: absolute","width: "+ft+"px","height: "+Pe+"px","overflow: scroll","visibility: none","top: "+-ft*3+"px","left: "+-Pe*3+"px","visibility: hidden","margin: 0","padding: 0"]),Ve.appendChild(Rt),document.body.insertBefore(Ve,document.body.firstChild);var Vt=ft-Ve.clientWidth,mr=Pe-Ve.clientHeight;return document.body.removeChild(Ve),{width:Vt,height:mr}}function ye(ft,Pe,Rt){function Ve(j,re){re=re||function(Te){ft.head.appendChild(Te)};var ke=ft.createElement("style");return ke.innerHTML=j,ke.id=Pe,re(ke),ke}if(!ft.getElementById(Pe)){var Vt=Rt+"_animation",mr=Rt+"_animation_active",ie=`/* Created by the element-resize-detector library. */
`;ie+="."+Rt+" > div::-webkit-scrollbar { "+ge(["display: none"])+` }

`,ie+="."+mr+" { "+ge(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+Vt,"animation-name: "+Vt])+` }
`,ie+="@-webkit-keyframes "+Vt+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,ie+="@keyframes "+Vt+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",Ve(ie)}}function St(ft){ft.className+=" "+Ae+"_animation_active"}function mt(ft,Pe,Rt){if(ft.addEventListener)ft.addEventListener(Pe,Rt);else if(ft.attachEvent)ft.attachEvent("on"+Pe,Rt);else return y.error("[scroll] Don't know how to add event listeners.")}function Ze(ft,Pe,Rt){if(ft.removeEventListener)ft.removeEventListener(Pe,Rt);else if(ft.detachEvent)ft.detachEvent("on"+Pe,Rt);else return y.error("[scroll] Don't know how to remove event listeners.")}function ht(ft){return P(ft).container.childNodes[0].childNodes[0].childNodes[0]}function it(ft){return P(ft).container.childNodes[0].childNodes[0].childNodes[1]}function dr(ft,Pe){var Rt=P(ft).listeners;if(!Rt.push)throw new Error("Cannot add listener to an element that is not detectable.");P(ft).listeners.push(Pe)}function yr(ft,Pe,Rt){Rt||(Rt=Pe,Pe=ft,ft=null),ft=ft||{};function Ve(){if(ft.debug){var Lr=Array.prototype.slice.call(arguments);if(Lr.unshift(V.get(Pe),"Scroll: "),y.log.apply)y.log.apply(null,Lr);else for(var jn=0;jn<Lr.length;jn++)y.log(Lr[jn])}}function Vt(Lr){function jn(jr){var hn=jr.getRootNode&&jr.getRootNode().contains(jr);return jr===jr.ownerDocument.body||jr.ownerDocument.body.contains(jr)||hn}return!jn(Lr)||window.getComputedStyle(Lr)===null}function mr(Lr){var jn=P(Lr).container.childNodes[0],jr=window.getComputedStyle(jn);return!jr.width||jr.width.indexOf("px")===-1}function ie(){var Lr=window.getComputedStyle(Pe),jn={};return jn.position=Lr.position,jn.width=Pe.offsetWidth,jn.height=Pe.offsetHeight,jn.top=Lr.top,jn.right=Lr.right,jn.bottom=Lr.bottom,jn.left=Lr.left,jn.widthCSS=Lr.width,jn.heightCSS=Lr.height,jn}function j(){var Lr=ie();P(Pe).startSize={width:Lr.width,height:Lr.height},Ve("Element start size",P(Pe).startSize)}function re(){P(Pe).listeners=[]}function ke(){if(Ve("storeStyle invoked."),!P(Pe)){Ve("Aborting because element has been uninstalled");return}var Lr=ie();P(Pe).style=Lr}function Te(Lr,jn,jr){P(Lr).lastWidth=jn,P(Lr).lastHeight=jr}function st(Lr){return ht(Lr).childNodes[0]}function ze(){return 2*ue.width+1}function Qe(){return 2*ue.height+1}function at(Lr){return Lr+10+ze()}function Mt(Lr){return Lr+10+Qe()}function vr(Lr){return Lr*2+ze()}function kt(Lr){return Lr*2+Qe()}function Vr(Lr,jn,jr){var hn=ht(Lr),qi=it(Lr),Ei=at(jn),ia=Mt(jr),ta=vr(jn),Se=kt(jr);hn.scrollLeft=Ei,hn.scrollTop=ia,qi.scrollLeft=ta,qi.scrollTop=Se}function Kr(){var Lr=P(Pe).container;if(!Lr){Lr=document.createElement("div"),Lr.className=Ae,Lr.style.cssText=ge(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),P(Pe).container=Lr,St(Lr),Pe.appendChild(Lr);var jn=function(){P(Pe).onRendered&&P(Pe).onRendered()};mt(Lr,"animationstart",jn),P(Pe).onAnimationStart=jn}return Lr}function Ir(){function Lr(){var yn=P(Pe).style;if(yn.position==="static"){Pe.style.setProperty("position","relative",ft.important?"important":"");var Ci=function(he,L,z,fe){function Re($t){return $t.replace(/[^-\d\.]/g,"")}var Ue=z[fe];Ue!=="auto"&&Re(Ue)!=="0"&&(he.warn("An element that is positioned static has style."+fe+"="+Ue+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+fe+" will be set to 0. Element: ",L),L.style[fe]=0)};Ci(y,Pe,yn,"top"),Ci(y,Pe,yn,"right"),Ci(y,Pe,yn,"bottom"),Ci(y,Pe,yn,"left")}}function jn(yn,Ci,he,L){return yn=yn?yn+"px":"0",Ci=Ci?Ci+"px":"0",he=he?he+"px":"0",L=L?L+"px":"0",["left: "+yn,"top: "+Ci,"right: "+L,"bottom: "+he]}if(Ve("Injecting elements"),!P(Pe)){Ve("Aborting because element has been uninstalled");return}Lr();var jr=P(Pe).container;jr||(jr=Kr());var hn=ue.width,qi=ue.height,Ei=ge(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),ia=ge(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(jn(-(1+hn),-(1+qi),-qi,-hn))),ta=ge(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),Se=ge(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),Ni=ge(["position: absolute","left: 0","top: 0"]),aa=ge(["position: absolute","width: 200%","height: 200%"]),da=document.createElement("div"),so=document.createElement("div"),po=document.createElement("div"),To=document.createElement("div"),Gt=document.createElement("div"),br=document.createElement("div");da.dir="ltr",da.style.cssText=Ei,da.className=Ae,so.className=Ae,so.style.cssText=ia,po.style.cssText=ta,To.style.cssText=Ni,Gt.style.cssText=Se,br.style.cssText=aa,po.appendChild(To),Gt.appendChild(br),so.appendChild(po),so.appendChild(Gt),da.appendChild(so),jr.appendChild(da);function Gr(){var yn=P(Pe);yn&&yn.onExpand?yn.onExpand():Ve("Aborting expand scroll handler: element has been uninstalled")}function rn(){var yn=P(Pe);yn&&yn.onShrink?yn.onShrink():Ve("Aborting shrink scroll handler: element has been uninstalled")}mt(po,"scroll",Gr),mt(Gt,"scroll",rn),P(Pe).onExpandScroll=Gr,P(Pe).onShrinkScroll=rn}function In(){function Lr(ta,Se,Ni){var aa=st(ta),da=at(Se),so=Mt(Ni);aa.style.setProperty("width",da+"px",ft.important?"important":""),aa.style.setProperty("height",so+"px",ft.important?"important":"")}function jn(ta){var Se=Pe.offsetWidth,Ni=Pe.offsetHeight,aa=Se!==P(Pe).lastWidth||Ni!==P(Pe).lastHeight;Ve("Storing current size",Se,Ni),Te(Pe,Se,Ni),le.add(0,function(){if(aa){if(!P(Pe)){Ve("Aborting because element has been uninstalled");return}if(!jr()){Ve("Aborting because element container has not been initialized");return}if(ft.debug){var so=Pe.offsetWidth,po=Pe.offsetHeight;(so!==Se||po!==Ni)&&y.warn(V.get(Pe),"Scroll: Size changed before updating detector elements.")}Lr(Pe,Se,Ni)}}),le.add(1,function(){if(!P(Pe)){Ve("Aborting because element has been uninstalled");return}if(!jr()){Ve("Aborting because element container has not been initialized");return}Vr(Pe,Se,Ni)}),aa&&ta&&le.add(2,function(){if(!P(Pe)){Ve("Aborting because element has been uninstalled");return}if(!jr()){Ve("Aborting because element container has not been initialized");return}ta()})}function jr(){return!!P(Pe).container}function hn(){function ta(){return P(Pe).lastNotifiedWidth===void 0}Ve("notifyListenersIfNeeded invoked");var Se=P(Pe);if(ta()&&Se.lastWidth===Se.startSize.width&&Se.lastHeight===Se.startSize.height)return Ve("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(Se.lastWidth===Se.lastNotifiedWidth&&Se.lastHeight===Se.lastNotifiedHeight)return Ve("Not notifying: Size already notified");Ve("Current size not notified, notifying..."),Se.lastNotifiedWidth=Se.lastWidth,Se.lastNotifiedHeight=Se.lastHeight,te(P(Pe).listeners,function(Ni){Ni(Pe)})}function qi(){if(Ve("startanimation triggered."),mr(Pe)){Ve("Ignoring since element is still unrendered...");return}Ve("Element rendered.");var ta=ht(Pe),Se=it(Pe);(ta.scrollLeft===0||ta.scrollTop===0||Se.scrollLeft===0||Se.scrollTop===0)&&(Ve("Scrollbars out of sync. Updating detector elements..."),jn(hn))}function Ei(){if(Ve("Scroll detected."),mr(Pe)){Ve("Scroll event fired while unrendered. Ignoring...");return}jn(hn)}if(Ve("registerListenersAndPositionElements invoked."),!P(Pe)){Ve("Aborting because element has been uninstalled");return}P(Pe).onRendered=qi,P(Pe).onExpand=Ei,P(Pe).onShrink=Ei;var ia=P(Pe).style;Lr(Pe,ia.width,ia.height)}function gn(){if(Ve("finalizeDomMutation invoked."),!P(Pe)){Ve("Aborting because element has been uninstalled");return}var Lr=P(Pe).style;Te(Pe,Lr.width,Lr.height),Vr(Pe,Lr.width,Lr.height)}function nn(){Rt(Pe)}function hi(){Ve("Installing..."),re(),j(),le.add(0,ke),le.add(1,Ir),le.add(2,In),le.add(3,gn),le.add(4,nn)}Ve("Making detectable..."),Vt(Pe)?(Ve("Element is detached"),Kr(),Ve("Waiting until element is attached..."),P(Pe).onRendered=function(){Ve("Element is now attached"),hi()}):hi()}function cr(ft){var Pe=P(ft);Pe&&(Pe.onExpandScroll&&Ze(ht(ft),"scroll",Pe.onExpandScroll),Pe.onShrinkScroll&&Ze(it(ft),"scroll",Pe.onShrinkScroll),Pe.onAnimationStart&&Ze(Pe.container,"animationstart",Pe.onAnimationStart),Pe.container&&ft.removeChild(Pe.container))}return{makeDetectable:yr,addListener:dr,uninstall:cr,initDocument:Ce}}},63844:function(Ut,ae,O){"use strict";var te=O(17900).forEach,de=O(68452),y=O(96199),le=O(75805),P=O(79799),Y=O(71724),V=O(2268),ue=O(98129),H=O(21931),Ae=O(58229),Ce=O(60787);function ge(mt){return Array.isArray(mt)||mt.length!==void 0}function ct(mt){if(Array.isArray(mt))return mt;var Ze=[];return te(mt,function(ht){Ze.push(ht)}),Ze}function ye(mt){return mt&&mt.nodeType===1}Ut.exports=function(mt){mt=mt||{};var Ze;if(mt.idHandler)Ze={get:function(st){return mt.idHandler.get(st,!0)},set:mt.idHandler.set};else{var ht=le(),it=P({idGenerator:ht,stateHandler:H});Ze=it}var dr=mt.reporter;if(!dr){var yr=dr===!1;dr=Y(yr)}var cr=St(mt,"batchProcessor",ue({reporter:dr})),ft={};ft.callOnAdd=!!St(mt,"callOnAdd",!0),ft.debug=!!St(mt,"debug",!1);var Pe=y(Ze),Rt=de({stateHandler:H}),Ve,Vt=St(mt,"strategy","object"),mr=St(mt,"important",!1),ie={reporter:dr,batchProcessor:cr,stateHandler:H,idHandler:Ze,important:mr};if(Vt==="scroll"&&(V.isLegacyOpera()?(dr.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),Vt="object"):V.isIE(9)&&(dr.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),Vt="object")),Vt==="scroll")Ve=Ce(ie);else if(Vt==="object")Ve=Ae(ie);else throw new Error("Invalid strategy name: "+Vt);var j={};function re(st,ze,Qe){function at(Ir){var In=Pe.get(Ir);te(In,function(nn){nn(Ir)})}function Mt(Ir,In,gn){Pe.add(In,gn),Ir&&gn(In)}if(Qe||(Qe=ze,ze=st,st={}),!ze)throw new Error("At least one element required.");if(!Qe)throw new Error("Listener required.");if(ye(ze))ze=[ze];else if(ge(ze))ze=ct(ze);else return dr.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var vr=0,kt=St(st,"callOnAdd",ft.callOnAdd),Vr=St(st,"onReady",function(){}),Kr=St(st,"debug",ft.debug);te(ze,function(In){H.getState(In)||(H.initState(In),Ze.set(In));var gn=Ze.get(In);if(Kr&&dr.log("Attaching listener to element",gn,In),!Rt.isDetectable(In)){if(Kr&&dr.log(gn,"Not detectable."),Rt.isBusy(In)){Kr&&dr.log(gn,"System busy making it detectable"),Mt(kt,In,Qe),j[gn]=j[gn]||[],j[gn].push(function(){vr++,vr===ze.length&&Vr()});return}return Kr&&dr.log(gn,"Making detectable..."),Rt.markBusy(In,!0),Ve.makeDetectable({debug:Kr,important:mr},In,function(hi){if(Kr&&dr.log(gn,"onElementDetectable"),H.getState(hi)){Rt.markAsDetectable(hi),Rt.markBusy(hi,!1),Ve.addListener(hi,at),Mt(kt,hi,Qe);var Lr=H.getState(hi);if(Lr&&Lr.startSize){var jn=hi.offsetWidth,jr=hi.offsetHeight;(Lr.startSize.width!==jn||Lr.startSize.height!==jr)&&at(hi)}j[gn]&&te(j[gn],function(hn){hn()})}else Kr&&dr.log(gn,"Element uninstalled before being detectable.");delete j[gn],vr++,vr===ze.length&&Vr()})}Kr&&dr.log(gn,"Already detecable, adding listener."),Mt(kt,In,Qe),vr++}),vr===ze.length&&Vr()}function ke(st){if(!st)return dr.error("At least one element is required.");if(ye(st))st=[st];else if(ge(st))st=ct(st);else return dr.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");te(st,function(ze){Pe.removeAllListeners(ze),Ve.uninstall(ze),H.cleanState(ze)})}function Te(st){Ve.initDocument&&Ve.initDocument(st)}return{listenTo:re,removeListener:Pe.removeListener,removeAllListeners:Pe.removeAllListeners,uninstall:ke,initDocument:Te}};function St(mt,Ze,ht){var it=mt[Ze];return it==null&&ht!==void 0?ht:it}},68452:function(Ut){"use strict";Ut.exports=function(ae){var O=ae.stateHandler.getState;function te(P){var Y=O(P);return Y&&!!Y.isDetectable}function de(P){O(P).isDetectable=!0}function y(P){return!!O(P).busy}function le(P,Y){O(P).busy=!!Y}return{isDetectable:te,markAsDetectable:de,isBusy:y,markBusy:le}}},75805:function(Ut){"use strict";Ut.exports=function(){var ae=1;function O(){return ae++}return{generate:O}}},79799:function(Ut){"use strict";Ut.exports=function(ae){var O=ae.idGenerator,te=ae.stateHandler.getState;function de(le){var P=te(le);return P&&P.id!==void 0?P.id:null}function y(le){var P=te(le);if(!P)throw new Error("setId required the element to have a resize detection state.");var Y=O.generate();return P.id=Y,Y}return{get:de,set:y}}},96199:function(Ut){"use strict";Ut.exports=function(ae){var O={};function te(P){var Y=ae.get(P);return Y===void 0?[]:O[Y]||[]}function de(P,Y){var V=ae.get(P);O[V]||(O[V]=[]),O[V].push(Y)}function y(P,Y){for(var V=te(P),ue=0,H=V.length;ue<H;++ue)if(V[ue]===Y){V.splice(ue,1);break}}function le(P){var Y=te(P);Y&&(Y.length=0)}return{get:te,add:de,removeListener:y,removeAllListeners:le}}},71724:function(Ut){"use strict";Ut.exports=function(ae){function O(){}var te={log:O,warn:O,error:O};if(!ae&&window.console){var de=function(y,le){y[le]=function(){var Y=console[le];if(Y.apply)Y.apply(console,arguments);else for(var V=0;V<arguments.length;V++)Y(arguments[V])}};de(te,"log"),de(te,"warn"),de(te,"error")}return te}},21931:function(Ut){"use strict";var ae="_erd";function O(y){return y[ae]={},te(y)}function te(y){return y[ae]}function de(y){delete y[ae]}Ut.exports={initState:O,getState:te,cleanState:de}},50840:function(Ut,ae,O){var te;(function(de,y,le,P){"use strict";var Y=["","webkit","Moz","MS","ms","o"],V=y.createElement("div"),ue="function",H=Math.round,Ae=Math.abs,Ce=Date.now;function ge(Ee,Ne,Tt){return setTimeout(dr(Ee,Tt),Ne)}function ct(Ee,Ne,Tt){return Array.isArray(Ee)?(ye(Ee,Tt[Ne],Tt),!0):!1}function ye(Ee,Ne,Tt){var fr;if(Ee)if(Ee.forEach)Ee.forEach(Ne,Tt);else if(Ee.length!==P)for(fr=0;fr<Ee.length;)Ne.call(Tt,Ee[fr],fr,Ee),fr++;else for(fr in Ee)Ee.hasOwnProperty(fr)&&Ne.call(Tt,Ee[fr],fr,Ee)}function St(Ee,Ne,Tt){var fr="DEPRECATED METHOD: "+Ne+`
`+Tt+` AT 
`;return function(){var tn=new Error("get-stack-trace"),Bn=tn&&tn.stack?tn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Xi=de.console&&(de.console.warn||de.console.log);return Xi&&Xi.call(de.console,fr,Bn),Ee.apply(this,arguments)}}var mt;typeof Object.assign!="function"?mt=function(Ne){if(Ne===P||Ne===null)throw new TypeError("Cannot convert undefined or null to object");for(var Tt=Object(Ne),fr=1;fr<arguments.length;fr++){var tn=arguments[fr];if(tn!==P&&tn!==null)for(var Bn in tn)tn.hasOwnProperty(Bn)&&(Tt[Bn]=tn[Bn])}return Tt}:mt=Object.assign;var Ze=St(function(Ne,Tt,fr){for(var tn=Object.keys(Tt),Bn=0;Bn<tn.length;)(!fr||fr&&Ne[tn[Bn]]===P)&&(Ne[tn[Bn]]=Tt[tn[Bn]]),Bn++;return Ne},"extend","Use `assign`."),ht=St(function(Ne,Tt){return Ze(Ne,Tt,!0)},"merge","Use `assign`.");function it(Ee,Ne,Tt){var fr=Ne.prototype,tn;tn=Ee.prototype=Object.create(fr),tn.constructor=Ee,tn._super=fr,Tt&&mt(tn,Tt)}function dr(Ee,Ne){return function(){return Ee.apply(Ne,arguments)}}function yr(Ee,Ne){return typeof Ee==ue?Ee.apply(Ne&&Ne[0]||P,Ne):Ee}function cr(Ee,Ne){return Ee===P?Ne:Ee}function ft(Ee,Ne,Tt){ye(Vt(Ne),function(fr){Ee.addEventListener(fr,Tt,!1)})}function Pe(Ee,Ne,Tt){ye(Vt(Ne),function(fr){Ee.removeEventListener(fr,Tt,!1)})}function Rt(Ee,Ne){for(;Ee;){if(Ee==Ne)return!0;Ee=Ee.parentNode}return!1}function Ve(Ee,Ne){return Ee.indexOf(Ne)>-1}function Vt(Ee){return Ee.trim().split(/\s+/g)}function mr(Ee,Ne,Tt){if(Ee.indexOf&&!Tt)return Ee.indexOf(Ne);for(var fr=0;fr<Ee.length;){if(Tt&&Ee[fr][Tt]==Ne||!Tt&&Ee[fr]===Ne)return fr;fr++}return-1}function ie(Ee){return Array.prototype.slice.call(Ee,0)}function j(Ee,Ne,Tt){for(var fr=[],tn=[],Bn=0;Bn<Ee.length;){var Xi=Ne?Ee[Bn][Ne]:Ee[Bn];mr(tn,Xi)<0&&fr.push(Ee[Bn]),tn[Bn]=Xi,Bn++}return Tt&&(Ne?fr=fr.sort(function(wo,vo){return wo[Ne]>vo[Ne]}):fr=fr.sort()),fr}function re(Ee,Ne){for(var Tt,fr,tn=Ne[0].toUpperCase()+Ne.slice(1),Bn=0;Bn<Y.length;){if(Tt=Y[Bn],fr=Tt?Tt+tn:Ne,fr in Ee)return fr;Bn++}return P}var ke=1;function Te(){return ke++}function st(Ee){var Ne=Ee.ownerDocument||Ee;return Ne.defaultView||Ne.parentWindow||de}var ze=/mobile|tablet|ip(ad|hone|od)|android/i,Qe="ontouchstart"in de,at=re(de,"PointerEvent")!==P,Mt=Qe&&ze.test(navigator.userAgent),vr="touch",kt="pen",Vr="mouse",Kr="kinect",Ir=25,In=1,gn=2,nn=4,hi=8,Lr=1,jn=2,jr=4,hn=8,qi=16,Ei=jn|jr,ia=hn|qi,ta=Ei|ia,Se=["x","y"],Ni=["clientX","clientY"];function aa(Ee,Ne){var Tt=this;this.manager=Ee,this.callback=Ne,this.element=Ee.element,this.target=Ee.options.inputTarget,this.domHandler=function(fr){yr(Ee.options.enable,[Ee])&&Tt.handler(fr)},this.init()}aa.prototype={handler:function(){},init:function(){this.evEl&&ft(this.element,this.evEl,this.domHandler),this.evTarget&&ft(this.target,this.evTarget,this.domHandler),this.evWin&&ft(st(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Pe(this.element,this.evEl,this.domHandler),this.evTarget&&Pe(this.target,this.evTarget,this.domHandler),this.evWin&&Pe(st(this.element),this.evWin,this.domHandler)}};function da(Ee){var Ne,Tt=Ee.options.inputClass;return Tt?Ne=Tt:at?Ne=N:Mt?Ne=je:Qe?Ne=Er:Ne=$t,new Ne(Ee,so)}function so(Ee,Ne,Tt){var fr=Tt.pointers.length,tn=Tt.changedPointers.length,Bn=Ne&In&&fr-tn===0,Xi=Ne&(nn|hi)&&fr-tn===0;Tt.isFirst=!!Bn,Tt.isFinal=!!Xi,Bn&&(Ee.session={}),Tt.eventType=Ne,po(Ee,Tt),Ee.emit("hammer.input",Tt),Ee.recognize(Tt),Ee.session.prevInput=Tt}function po(Ee,Ne){var Tt=Ee.session,fr=Ne.pointers,tn=fr.length;Tt.firstInput||(Tt.firstInput=br(Ne)),tn>1&&!Tt.firstMultiple?Tt.firstMultiple=br(Ne):tn===1&&(Tt.firstMultiple=!1);var Bn=Tt.firstInput,Xi=Tt.firstMultiple,yo=Xi?Xi.center:Bn.center,wo=Ne.center=Gr(fr);Ne.timeStamp=Ce(),Ne.deltaTime=Ne.timeStamp-Bn.timeStamp,Ne.angle=he(yo,wo),Ne.distance=Ci(yo,wo),To(Tt,Ne),Ne.offsetDirection=yn(Ne.deltaX,Ne.deltaY);var vo=rn(Ne.deltaTime,Ne.deltaX,Ne.deltaY);Ne.overallVelocityX=vo.x,Ne.overallVelocityY=vo.y,Ne.overallVelocity=Ae(vo.x)>Ae(vo.y)?vo.x:vo.y,Ne.scale=Xi?z(Xi.pointers,fr):1,Ne.rotation=Xi?L(Xi.pointers,fr):0,Ne.maxPointers=Tt.prevInput?Ne.pointers.length>Tt.prevInput.maxPointers?Ne.pointers.length:Tt.prevInput.maxPointers:Ne.pointers.length,Gt(Tt,Ne);var Bs=Ee.element;Rt(Ne.srcEvent.target,Bs)&&(Bs=Ne.srcEvent.target),Ne.target=Bs}function To(Ee,Ne){var Tt=Ne.center,fr=Ee.offsetDelta||{},tn=Ee.prevDelta||{},Bn=Ee.prevInput||{};(Ne.eventType===In||Bn.eventType===nn)&&(tn=Ee.prevDelta={x:Bn.deltaX||0,y:Bn.deltaY||0},fr=Ee.offsetDelta={x:Tt.x,y:Tt.y}),Ne.deltaX=tn.x+(Tt.x-fr.x),Ne.deltaY=tn.y+(Tt.y-fr.y)}function Gt(Ee,Ne){var Tt=Ee.lastInterval||Ne,fr=Ne.timeStamp-Tt.timeStamp,tn,Bn,Xi,yo;if(Ne.eventType!=hi&&(fr>Ir||Tt.velocity===P)){var wo=Ne.deltaX-Tt.deltaX,vo=Ne.deltaY-Tt.deltaY,Bs=rn(fr,wo,vo);Bn=Bs.x,Xi=Bs.y,tn=Ae(Bs.x)>Ae(Bs.y)?Bs.x:Bs.y,yo=yn(wo,vo),Ee.lastInterval=Ne}else tn=Tt.velocity,Bn=Tt.velocityX,Xi=Tt.velocityY,yo=Tt.direction;Ne.velocity=tn,Ne.velocityX=Bn,Ne.velocityY=Xi,Ne.direction=yo}function br(Ee){for(var Ne=[],Tt=0;Tt<Ee.pointers.length;)Ne[Tt]={clientX:H(Ee.pointers[Tt].clientX),clientY:H(Ee.pointers[Tt].clientY)},Tt++;return{timeStamp:Ce(),pointers:Ne,center:Gr(Ne),deltaX:Ee.deltaX,deltaY:Ee.deltaY}}function Gr(Ee){var Ne=Ee.length;if(Ne===1)return{x:H(Ee[0].clientX),y:H(Ee[0].clientY)};for(var Tt=0,fr=0,tn=0;tn<Ne;)Tt+=Ee[tn].clientX,fr+=Ee[tn].clientY,tn++;return{x:H(Tt/Ne),y:H(fr/Ne)}}function rn(Ee,Ne,Tt){return{x:Ne/Ee||0,y:Tt/Ee||0}}function yn(Ee,Ne){return Ee===Ne?Lr:Ae(Ee)>=Ae(Ne)?Ee<0?jn:jr:Ne<0?hn:qi}function Ci(Ee,Ne,Tt){Tt||(Tt=Se);var fr=Ne[Tt[0]]-Ee[Tt[0]],tn=Ne[Tt[1]]-Ee[Tt[1]];return Math.sqrt(fr*fr+tn*tn)}function he(Ee,Ne,Tt){Tt||(Tt=Se);var fr=Ne[Tt[0]]-Ee[Tt[0]],tn=Ne[Tt[1]]-Ee[Tt[1]];return Math.atan2(tn,fr)*180/Math.PI}function L(Ee,Ne){return he(Ne[1],Ne[0],Ni)+he(Ee[1],Ee[0],Ni)}function z(Ee,Ne){return Ci(Ne[0],Ne[1],Ni)/Ci(Ee[0],Ee[1],Ni)}var fe={mousedown:In,mousemove:gn,mouseup:nn},Re="mousedown",Ue="mousemove mouseup";function $t(){this.evEl=Re,this.evWin=Ue,this.pressed=!1,aa.apply(this,arguments)}it($t,aa,{handler:function(Ne){var Tt=fe[Ne.type];Tt&In&&Ne.button===0&&(this.pressed=!0),Tt&gn&&Ne.which!==1&&(Tt=nn),this.pressed&&(Tt&nn&&(this.pressed=!1),this.callback(this.manager,Tt,{pointers:[Ne],changedPointers:[Ne],pointerType:Vr,srcEvent:Ne}))}});var Lt={pointerdown:In,pointermove:gn,pointerup:nn,pointercancel:hi,pointerout:hi},Bt={2:vr,3:kt,4:Vr,5:Kr},xt="pointerdown",U="pointermove pointerup pointercancel";de.MSPointerEvent&&!de.PointerEvent&&(xt="MSPointerDown",U="MSPointerMove MSPointerUp MSPointerCancel");function N(){this.evEl=xt,this.evWin=U,aa.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}it(N,aa,{handler:function(Ne){var Tt=this.store,fr=!1,tn=Ne.type.toLowerCase().replace("ms",""),Bn=Lt[tn],Xi=Bt[Ne.pointerType]||Ne.pointerType,yo=Xi==vr,wo=mr(Tt,Ne.pointerId,"pointerId");Bn&In&&(Ne.button===0||yo)?wo<0&&(Tt.push(Ne),wo=Tt.length-1):Bn&(nn|hi)&&(fr=!0),!(wo<0)&&(Tt[wo]=Ne,this.callback(this.manager,Bn,{pointers:Tt,changedPointers:[Ne],pointerType:Xi,srcEvent:Ne}),fr&&Tt.splice(wo,1))}});var q={touchstart:In,touchmove:gn,touchend:nn,touchcancel:hi},se="touchstart",Me="touchstart touchmove touchend touchcancel";function We(){this.evTarget=se,this.evWin=Me,this.started=!1,aa.apply(this,arguments)}it(We,aa,{handler:function(Ne){var Tt=q[Ne.type];if(Tt===In&&(this.started=!0),!!this.started){var fr=ut.call(this,Ne,Tt);Tt&(nn|hi)&&fr[0].length-fr[1].length===0&&(this.started=!1),this.callback(this.manager,Tt,{pointers:fr[0],changedPointers:fr[1],pointerType:vr,srcEvent:Ne})}}});function ut(Ee,Ne){var Tt=ie(Ee.touches),fr=ie(Ee.changedTouches);return Ne&(nn|hi)&&(Tt=j(Tt.concat(fr),"identifier",!0)),[Tt,fr]}var W={touchstart:In,touchmove:gn,touchend:nn,touchcancel:hi},ne="touchstart touchmove touchend touchcancel";function je(){this.evTarget=ne,this.targetIds={},aa.apply(this,arguments)}it(je,aa,{handler:function(Ne){var Tt=W[Ne.type],fr=lt.call(this,Ne,Tt);fr&&this.callback(this.manager,Tt,{pointers:fr[0],changedPointers:fr[1],pointerType:vr,srcEvent:Ne})}});function lt(Ee,Ne){var Tt=ie(Ee.touches),fr=this.targetIds;if(Ne&(In|gn)&&Tt.length===1)return fr[Tt[0].identifier]=!0,[Tt,Tt];var tn,Bn,Xi=ie(Ee.changedTouches),yo=[],wo=this.target;if(Bn=Tt.filter(function(vo){return Rt(vo.target,wo)}),Ne===In)for(tn=0;tn<Bn.length;)fr[Bn[tn].identifier]=!0,tn++;for(tn=0;tn<Xi.length;)fr[Xi[tn].identifier]&&yo.push(Xi[tn]),Ne&(nn|hi)&&delete fr[Xi[tn].identifier],tn++;if(yo.length)return[j(Bn.concat(yo),"identifier",!0),yo]}var Ie=2500,Kt=25;function Er(){aa.apply(this,arguments);var Ee=dr(this.handler,this);this.touch=new je(this.manager,Ee),this.mouse=new $t(this.manager,Ee),this.primaryTouch=null,this.lastTouches=[]}it(Er,aa,{handler:function(Ne,Tt,fr){var tn=fr.pointerType==vr,Bn=fr.pointerType==Vr;if(!(Bn&&fr.sourceCapabilities&&fr.sourceCapabilities.firesTouchEvents)){if(tn)sn.call(this,Tt,fr);else if(Bn&&nr.call(this,fr))return;this.callback(Ne,Tt,fr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function sn(Ee,Ne){Ee&In?(this.primaryTouch=Ne.changedPointers[0].identifier,un.call(this,Ne)):Ee&(nn|hi)&&un.call(this,Ne)}function un(Ee){var Ne=Ee.changedPointers[0];if(Ne.identifier===this.primaryTouch){var Tt={x:Ne.clientX,y:Ne.clientY};this.lastTouches.push(Tt);var fr=this.lastTouches,tn=function(){var Bn=fr.indexOf(Tt);Bn>-1&&fr.splice(Bn,1)};setTimeout(tn,Ie)}}function nr(Ee){for(var Ne=Ee.srcEvent.clientX,Tt=Ee.srcEvent.clientY,fr=0;fr<this.lastTouches.length;fr++){var tn=this.lastTouches[fr],Bn=Math.abs(Ne-tn.x),Xi=Math.abs(Tt-tn.y);if(Bn<=Kt&&Xi<=Kt)return!0}return!1}var Qr=re(V.style,"touchAction"),Hr=Qr!==P,$r="compute",oi="auto",pn="manipulation",mi="none",Gi="pan-x",di="pan-y",zi=oa();function Ri(Ee,Ne){this.manager=Ee,this.set(Ne)}Ri.prototype={set:function(Ee){Ee==$r&&(Ee=this.compute()),Hr&&this.manager.element.style&&zi[Ee]&&(this.manager.element.style[Qr]=Ee),this.actions=Ee.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Ee=[];return ye(this.manager.recognizers,function(Ne){yr(Ne.options.enable,[Ne])&&(Ee=Ee.concat(Ne.getTouchAction()))}),ss(Ee.join(" "))},preventDefaults:function(Ee){var Ne=Ee.srcEvent,Tt=Ee.offsetDirection;if(this.manager.session.prevented){Ne.preventDefault();return}var fr=this.actions,tn=Ve(fr,mi)&&!zi[mi],Bn=Ve(fr,di)&&!zi[di],Xi=Ve(fr,Gi)&&!zi[Gi];if(tn){var yo=Ee.pointers.length===1,wo=Ee.distance<2,vo=Ee.deltaTime<250;if(yo&&wo&&vo)return}if(!(Xi&&Bn)&&(tn||Bn&&Tt&Ei||Xi&&Tt&ia))return this.preventSrc(Ne)},preventSrc:function(Ee){this.manager.session.prevented=!0,Ee.preventDefault()}};function ss(Ee){if(Ve(Ee,mi))return mi;var Ne=Ve(Ee,Gi),Tt=Ve(Ee,di);return Ne&&Tt?mi:Ne||Tt?Ne?Gi:di:Ve(Ee,pn)?pn:oi}function oa(){if(!Hr)return!1;var Ee={},Ne=de.CSS&&de.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Tt){Ee[Tt]=Ne?de.CSS.supports("touch-action",Tt):!0}),Ee}var La=1,Mi=2,yi=4,Ii=8,Ba=Ii,vu=16,_a=32;function Ia(Ee){this.options=mt({},this.defaults,Ee||{}),this.id=Te(),this.manager=null,this.options.enable=cr(this.options.enable,!0),this.state=La,this.simultaneous={},this.requireFail=[]}Ia.prototype={defaults:{},set:function(Ee){return mt(this.options,Ee),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Ee){if(ct(Ee,"recognizeWith",this))return this;var Ne=this.simultaneous;return Ee=Pa(Ee,this),Ne[Ee.id]||(Ne[Ee.id]=Ee,Ee.recognizeWith(this)),this},dropRecognizeWith:function(Ee){return ct(Ee,"dropRecognizeWith",this)?this:(Ee=Pa(Ee,this),delete this.simultaneous[Ee.id],this)},requireFailure:function(Ee){if(ct(Ee,"requireFailure",this))return this;var Ne=this.requireFail;return Ee=Pa(Ee,this),mr(Ne,Ee)===-1&&(Ne.push(Ee),Ee.requireFailure(this)),this},dropRequireFailure:function(Ee){if(ct(Ee,"dropRequireFailure",this))return this;Ee=Pa(Ee,this);var Ne=mr(this.requireFail,Ee);return Ne>-1&&this.requireFail.splice(Ne,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Ee){return!!this.simultaneous[Ee.id]},emit:function(Ee){var Ne=this,Tt=this.state;function fr(tn){Ne.manager.emit(tn,Ee)}Tt<Ii&&fr(Ne.options.event+Hl(Tt)),fr(Ne.options.event),Ee.additionalEvent&&fr(Ee.additionalEvent),Tt>=Ii&&fr(Ne.options.event+Hl(Tt))},tryEmit:function(Ee){if(this.canEmit())return this.emit(Ee);this.state=_a},canEmit:function(){for(var Ee=0;Ee<this.requireFail.length;){if(!(this.requireFail[Ee].state&(_a|La)))return!1;Ee++}return!0},recognize:function(Ee){var Ne=mt({},Ee);if(!yr(this.options.enable,[this,Ne])){this.reset(),this.state=_a;return}this.state&(Ba|vu|_a)&&(this.state=La),this.state=this.process(Ne),this.state&(Mi|yi|Ii|vu)&&this.tryEmit(Ne)},process:function(Ee){},getTouchAction:function(){},reset:function(){}};function Hl(Ee){return Ee&vu?"cancel":Ee&Ii?"end":Ee&yi?"move":Ee&Mi?"start":""}function Ho(Ee){return Ee==qi?"down":Ee==hn?"up":Ee==jn?"left":Ee==jr?"right":""}function Pa(Ee,Ne){var Tt=Ne.manager;return Tt?Tt.get(Ee):Ee}function bi(){Ia.apply(this,arguments)}it(bi,Ia,{defaults:{pointers:1},attrTest:function(Ee){var Ne=this.options.pointers;return Ne===0||Ee.pointers.length===Ne},process:function(Ee){var Ne=this.state,Tt=Ee.eventType,fr=Ne&(Mi|yi),tn=this.attrTest(Ee);return fr&&(Tt&hi||!tn)?Ne|vu:fr||tn?Tt&nn?Ne|Ii:Ne&Mi?Ne|yi:Mi:_a}});function Fa(){bi.apply(this,arguments),this.pX=null,this.pY=null}it(Fa,bi,{defaults:{event:"pan",threshold:10,pointers:1,direction:ta},getTouchAction:function(){var Ee=this.options.direction,Ne=[];return Ee&Ei&&Ne.push(di),Ee&ia&&Ne.push(Gi),Ne},directionTest:function(Ee){var Ne=this.options,Tt=!0,fr=Ee.distance,tn=Ee.direction,Bn=Ee.deltaX,Xi=Ee.deltaY;return tn&Ne.direction||(Ne.direction&Ei?(tn=Bn===0?Lr:Bn<0?jn:jr,Tt=Bn!=this.pX,fr=Math.abs(Ee.deltaX)):(tn=Xi===0?Lr:Xi<0?hn:qi,Tt=Xi!=this.pY,fr=Math.abs(Ee.deltaY))),Ee.direction=tn,Tt&&fr>Ne.threshold&&tn&Ne.direction},attrTest:function(Ee){return bi.prototype.attrTest.call(this,Ee)&&(this.state&Mi||!(this.state&Mi)&&this.directionTest(Ee))},emit:function(Ee){this.pX=Ee.deltaX,this.pY=Ee.deltaY;var Ne=Ho(Ee.direction);Ne&&(Ee.additionalEvent=this.options.event+Ne),this._super.emit.call(this,Ee)}});function ca(){bi.apply(this,arguments)}it(ca,bi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[mi]},attrTest:function(Ee){return this._super.attrTest.call(this,Ee)&&(Math.abs(Ee.scale-1)>this.options.threshold||this.state&Mi)},emit:function(Ee){if(Ee.scale!==1){var Ne=Ee.scale<1?"in":"out";Ee.additionalEvent=this.options.event+Ne}this._super.emit.call(this,Ee)}});function Wo(){Ia.apply(this,arguments),this._timer=null,this._input=null}it(Wo,Ia,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[oi]},process:function(Ee){var Ne=this.options,Tt=Ee.pointers.length===Ne.pointers,fr=Ee.distance<Ne.threshold,tn=Ee.deltaTime>Ne.time;if(this._input=Ee,!fr||!Tt||Ee.eventType&(nn|hi)&&!tn)this.reset();else if(Ee.eventType&In)this.reset(),this._timer=ge(function(){this.state=Ba,this.tryEmit()},Ne.time,this);else if(Ee.eventType&nn)return Ba;return _a},reset:function(){clearTimeout(this._timer)},emit:function(Ee){this.state===Ba&&(Ee&&Ee.eventType&nn?this.manager.emit(this.options.event+"up",Ee):(this._input.timeStamp=Ce(),this.manager.emit(this.options.event,this._input)))}});function ma(){bi.apply(this,arguments)}it(ma,bi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[mi]},attrTest:function(Ee){return this._super.attrTest.call(this,Ee)&&(Math.abs(Ee.rotation)>this.options.threshold||this.state&Mi)}});function us(){bi.apply(this,arguments)}it(us,bi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ei|ia,pointers:1},getTouchAction:function(){return Fa.prototype.getTouchAction.call(this)},attrTest:function(Ee){var Ne=this.options.direction,Tt;return Ne&(Ei|ia)?Tt=Ee.overallVelocity:Ne&Ei?Tt=Ee.overallVelocityX:Ne&ia&&(Tt=Ee.overallVelocityY),this._super.attrTest.call(this,Ee)&&Ne&Ee.offsetDirection&&Ee.distance>this.options.threshold&&Ee.maxPointers==this.options.pointers&&Ae(Tt)>this.options.velocity&&Ee.eventType&nn},emit:function(Ee){var Ne=Ho(Ee.offsetDirection);Ne&&this.manager.emit(this.options.event+Ne,Ee),this.manager.emit(this.options.event,Ee)}});function Qo(){Ia.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}it(Qo,Ia,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pn]},process:function(Ee){var Ne=this.options,Tt=Ee.pointers.length===Ne.pointers,fr=Ee.distance<Ne.threshold,tn=Ee.deltaTime<Ne.time;if(this.reset(),Ee.eventType&In&&this.count===0)return this.failTimeout();if(fr&&tn&&Tt){if(Ee.eventType!=nn)return this.failTimeout();var Bn=this.pTime?Ee.timeStamp-this.pTime<Ne.interval:!0,Xi=!this.pCenter||Ci(this.pCenter,Ee.center)<Ne.posThreshold;this.pTime=Ee.timeStamp,this.pCenter=Ee.center,!Xi||!Bn?this.count=1:this.count+=1,this._input=Ee;var yo=this.count%Ne.taps;if(yo===0)return this.hasRequireFailures()?(this._timer=ge(function(){this.state=Ba,this.tryEmit()},Ne.interval,this),Mi):Ba}return _a},failTimeout:function(){return this._timer=ge(function(){this.state=_a},this.options.interval,this),_a},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ba&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Bu(Ee,Ne){return Ne=Ne||{},Ne.recognizers=cr(Ne.recognizers,Bu.defaults.preset),new Ra(Ee,Ne)}Bu.VERSION="2.0.7",Bu.defaults={domEvents:!1,touchAction:$r,enable:!0,inputTarget:null,inputClass:null,preset:[[ma,{enable:!1}],[ca,{enable:!1},["rotate"]],[us,{direction:Ei}],[Fa,{direction:Ei},["swipe"]],[Qo],[Qo,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var gs=1,xc=2;function Ra(Ee,Ne){this.options=mt({},Bu.defaults,Ne||{}),this.options.inputTarget=this.options.inputTarget||Ee,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Ee,this.input=da(this),this.touchAction=new Ri(this,this.options.touchAction),sa(this,!0),ye(this.options.recognizers,function(Tt){var fr=this.add(new Tt[0](Tt[1]));Tt[2]&&fr.recognizeWith(Tt[2]),Tt[3]&&fr.requireFailure(Tt[3])},this)}Ra.prototype={set:function(Ee){return mt(this.options,Ee),Ee.touchAction&&this.touchAction.update(),Ee.inputTarget&&(this.input.destroy(),this.input.target=Ee.inputTarget,this.input.init()),this},stop:function(Ee){this.session.stopped=Ee?xc:gs},recognize:function(Ee){var Ne=this.session;if(!Ne.stopped){this.touchAction.preventDefaults(Ee);var Tt,fr=this.recognizers,tn=Ne.curRecognizer;(!tn||tn&&tn.state&Ba)&&(tn=Ne.curRecognizer=null);for(var Bn=0;Bn<fr.length;)Tt=fr[Bn],Ne.stopped!==xc&&(!tn||Tt==tn||Tt.canRecognizeWith(tn))?Tt.recognize(Ee):Tt.reset(),!tn&&Tt.state&(Mi|yi|Ii)&&(tn=Ne.curRecognizer=Tt),Bn++}},get:function(Ee){if(Ee instanceof Ia)return Ee;for(var Ne=this.recognizers,Tt=0;Tt<Ne.length;Tt++)if(Ne[Tt].options.event==Ee)return Ne[Tt];return null},add:function(Ee){if(ct(Ee,"add",this))return this;var Ne=this.get(Ee.options.event);return Ne&&this.remove(Ne),this.recognizers.push(Ee),Ee.manager=this,this.touchAction.update(),Ee},remove:function(Ee){if(ct(Ee,"remove",this))return this;if(Ee=this.get(Ee),Ee){var Ne=this.recognizers,Tt=mr(Ne,Ee);Tt!==-1&&(Ne.splice(Tt,1),this.touchAction.update())}return this},on:function(Ee,Ne){if(Ee!==P&&Ne!==P){var Tt=this.handlers;return ye(Vt(Ee),function(fr){Tt[fr]=Tt[fr]||[],Tt[fr].push(Ne)}),this}},off:function(Ee,Ne){if(Ee!==P){var Tt=this.handlers;return ye(Vt(Ee),function(fr){Ne?Tt[fr]&&Tt[fr].splice(mr(Tt[fr],Ne),1):delete Tt[fr]}),this}},emit:function(Ee,Ne){this.options.domEvents&&er(Ee,Ne);var Tt=this.handlers[Ee]&&this.handlers[Ee].slice();if(!(!Tt||!Tt.length)){Ne.type=Ee,Ne.preventDefault=function(){Ne.srcEvent.preventDefault()};for(var fr=0;fr<Tt.length;)Tt[fr](Ne),fr++}},destroy:function(){this.element&&sa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function sa(Ee,Ne){var Tt=Ee.element;if(Tt.style){var fr;ye(Ee.options.cssProps,function(tn,Bn){fr=re(Tt.style,Bn),Ne?(Ee.oldCssProps[fr]=Tt.style[fr],Tt.style[fr]=tn):Tt.style[fr]=Ee.oldCssProps[fr]||""}),Ne||(Ee.oldCssProps={})}}function er(Ee,Ne){var Tt=y.createEvent("Event");Tt.initEvent(Ee,!0,!0),Tt.gesture=Ne,Ne.target.dispatchEvent(Tt)}mt(Bu,{INPUT_START:In,INPUT_MOVE:gn,INPUT_END:nn,INPUT_CANCEL:hi,STATE_POSSIBLE:La,STATE_BEGAN:Mi,STATE_CHANGED:yi,STATE_ENDED:Ii,STATE_RECOGNIZED:Ba,STATE_CANCELLED:vu,STATE_FAILED:_a,DIRECTION_NONE:Lr,DIRECTION_LEFT:jn,DIRECTION_RIGHT:jr,DIRECTION_UP:hn,DIRECTION_DOWN:qi,DIRECTION_HORIZONTAL:Ei,DIRECTION_VERTICAL:ia,DIRECTION_ALL:ta,Manager:Ra,Input:aa,TouchAction:Ri,TouchInput:je,MouseInput:$t,PointerEventInput:N,TouchMouseInput:Er,SingleTouchInput:We,Recognizer:Ia,AttrRecognizer:bi,Tap:Qo,Pan:Fa,Swipe:us,Pinch:ca,Rotate:ma,Press:Wo,on:ft,off:Pe,each:ye,merge:ht,extend:Ze,assign:mt,inherit:it,bindFn:dr,prefixed:re});var Rn=typeof de!="undefined"?de:typeof self!="undefined"?self:{};Rn.Hammer=Bu,te=function(){return Bu}.call(ae,O,ae,Ut),te!==P&&(Ut.exports=te)})(window,document,"Hammer")},7375:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0});var O=Symbol.for("INJECTION");function te(Y,V,ue,H){function Ae(){return H&&!Reflect.hasMetadata(O,this,V)&&Reflect.defineMetadata(O,ue(),this,V),Reflect.hasMetadata(O,this,V)?Reflect.getMetadata(O,this,V):ue()}function Ce(ge){Reflect.defineMetadata(O,ge,this,V)}Object.defineProperty(Y,V,{configurable:!0,enumerable:!0,get:Ae,set:Ce})}function de(Y,V){return function(ue){return function(H,Ae){var Ce=function(){return Y.get(ue)};te(H,Ae,Ce,V)}}}ae.makePropertyInjectDecorator=de;function y(Y,V){return function(ue,H){return function(Ae,Ce){var ge=function(){return Y.getNamed(ue,H)};te(Ae,Ce,ge,V)}}}ae.makePropertyInjectNamedDecorator=y;function le(Y,V){return function(ue,H,Ae){return function(Ce,ge){var ct=function(){return Y.getTagged(ue,H,Ae)};te(Ce,ge,ct,V)}}}ae.makePropertyInjectTaggedDecorator=le;function P(Y,V){return function(ue){return function(H,Ae){var Ce=function(){return Y.getAll(ue)};te(H,Ae,Ce,V)}}}ae.makePropertyMultiInjectDecorator=P},84879:function(Ut,ae,O){"use strict";var te;te={value:!0};var de=O(7375);function y(le,P){P===void 0&&(P=!0);var Y=de.makePropertyInjectDecorator(le,P),V=de.makePropertyInjectNamedDecorator(le,P),ue=de.makePropertyInjectTaggedDecorator(le,P),H=de.makePropertyMultiInjectDecorator(le,P);return{lazyInject:Y,lazyInjectNamed:V,lazyInjectTagged:ue,lazyMultiInject:H}}ae.Z=y},99934:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.tagProperty=ae.tagParameter=ae.decorate=void 0;var te=O(16674),de=O(6867);function y(H,Ae,Ce,ge){var ct=de.TAGGED;P(ct,H,Ae,ge,Ce)}ae.tagParameter=y;function le(H,Ae,Ce){var ge=de.TAGGED_PROP;P(ge,H.constructor,Ae,Ce)}ae.tagProperty=le;function P(H,Ae,Ce,ge,ct){var ye={},St=typeof ct=="number",mt=ct!==void 0&&St?ct.toString():Ce;if(St&&Ce!==void 0)throw new Error(te.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(H,Ae)&&(ye=Reflect.getMetadata(H,Ae));var Ze=ye[mt];if(!Array.isArray(Ze))Ze=[];else for(var ht=0,it=Ze;ht<it.length;ht++){var dr=it[ht];if(dr.key===ge.key)throw new Error(te.DUPLICATED_METADATA+" "+dr.key.toString())}Ze.push(ge),ye[mt]=Ze,Reflect.defineMetadata(H,ye,Ae)}function Y(H,Ae){Reflect.decorate(H,Ae)}function V(H,Ae){return function(Ce,ge){Ae(Ce,ge,H)}}function ue(H,Ae,Ce){typeof Ce=="number"?Y([V(Ce,H)],Ae):typeof Ce=="string"?Reflect.decorate([H],Ae,Ce):Y([H],Ae)}ae.decorate=ue},5744:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.inject=ae.LazyServiceIdentifer=void 0;var te=O(16674),de=O(6867),y=O(47738),le=O(99934),P=function(){function V(ue){this._cb=ue}return V.prototype.unwrap=function(){return this._cb()},V}();ae.LazyServiceIdentifer=P;function Y(V){return function(ue,H,Ae){if(V===void 0)throw new Error(te.UNDEFINED_INJECT_ANNOTATION(ue.name));var Ce=new y.Metadata(de.INJECT_TAG,V);typeof Ae=="number"?le.tagParameter(ue,H,Ae,Ce):le.tagProperty(ue,H,Ce)}}ae.inject=Y},64315:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.injectable=void 0;var te=O(16674),de=O(6867);function y(){return function(le){if(Reflect.hasOwnMetadata(de.PARAM_TYPES,le))throw new Error(te.DUPLICATED_INJECTABLE_DECORATOR);var P=Reflect.getMetadata(de.DESIGN_PARAM_TYPES,le)||[];return Reflect.defineMetadata(de.PARAM_TYPES,P,le),le}}ae.injectable=y},71693:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.multiInject=void 0;var te=O(6867),de=O(47738),y=O(99934);function le(P){return function(Y,V,ue){var H=new de.Metadata(te.MULTI_INJECT_TAG,P);typeof ue=="number"?y.tagParameter(Y,V,ue,H):y.tagProperty(Y,V,H)}}ae.multiInject=le},38085:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.named=void 0;var te=O(6867),de=O(47738),y=O(99934);function le(P){return function(Y,V,ue){var H=new de.Metadata(te.NAMED_TAG,P);typeof ue=="number"?y.tagParameter(Y,V,ue,H):y.tagProperty(Y,V,H)}}ae.named=le},6515:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.optional=void 0;var te=O(6867),de=O(47738),y=O(99934);function le(){return function(P,Y,V){var ue=new de.Metadata(te.OPTIONAL_TAG,!0);typeof V=="number"?y.tagParameter(P,Y,V,ue):y.tagProperty(P,Y,ue)}}ae.optional=le},7014:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.postConstruct=void 0;var te=O(16674),de=O(6867),y=O(47738);function le(){return function(P,Y,V){var ue=new y.Metadata(de.POST_CONSTRUCT,Y);if(Reflect.hasOwnMetadata(de.POST_CONSTRUCT,P.constructor))throw new Error(te.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(de.POST_CONSTRUCT,ue,P.constructor)}}ae.postConstruct=le},32052:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.tagged=void 0;var te=O(47738),de=O(99934);function y(le,P){return function(Y,V,ue){var H=new te.Metadata(le,P);typeof ue=="number"?de.tagParameter(Y,V,ue,H):de.tagProperty(Y,V,H)}}ae.tagged=y},55638:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.targetName=void 0;var te=O(6867),de=O(47738),y=O(99934);function le(P){return function(Y,V,ue){var H=new de.Metadata(te.NAME_TAG,P);y.tagParameter(Y,V,ue,H)}}ae.targetName=le},86757:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.unmanaged=void 0;var te=O(6867),de=O(47738),y=O(99934);function le(){return function(P,Y,V){var ue=new de.Metadata(te.UNMANAGED_TAG,!0);y.tagParameter(P,Y,V,ue)}}ae.unmanaged=le},44290:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Binding=void 0;var te=O(28421),de=O(37791),y=function(){function le(P,Y){this.id=de.id(),this.activated=!1,this.serviceIdentifier=P,this.scope=Y,this.type=te.BindingTypeEnum.Invalid,this.constraint=function(V){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return le.prototype.clone=function(){var P=new le(this.serviceIdentifier,this.scope);return P.activated=P.scope===te.BindingScopeEnum.Singleton?this.activated:!1,P.implementationType=this.implementationType,P.dynamicValue=this.dynamicValue,P.scope=this.scope,P.type=this.type,P.factory=this.factory,P.provider=this.provider,P.constraint=this.constraint,P.onActivation=this.onActivation,P.cache=this.cache,P},le}();ae.Binding=y},23184:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingCount=void 0;var O={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ae.BindingCount=O},16674:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.STACK_OVERFLOW=ae.CIRCULAR_DEPENDENCY_IN_FACTORY=ae.POST_CONSTRUCT_ERROR=ae.MULTIPLE_POST_CONSTRUCT_METHODS=ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ae.ARGUMENTS_LENGTH_MISMATCH=ae.INVALID_DECORATOR_OPERATION=ae.INVALID_TO_SELF_VALUE=ae.INVALID_FUNCTION_BINDING=ae.INVALID_MIDDLEWARE_RETURN=ae.NO_MORE_SNAPSHOTS_AVAILABLE=ae.INVALID_BINDING_TYPE=ae.NOT_IMPLEMENTED=ae.CIRCULAR_DEPENDENCY=ae.UNDEFINED_INJECT_ANNOTATION=ae.MISSING_INJECT_ANNOTATION=ae.MISSING_INJECTABLE_ANNOTATION=ae.NOT_REGISTERED=ae.CANNOT_UNBIND=ae.AMBIGUOUS_MATCH=ae.KEY_NOT_FOUND=ae.NULL_ARGUMENT=ae.DUPLICATED_METADATA=ae.DUPLICATED_INJECTABLE_DECORATOR=void 0,ae.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ae.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ae.NULL_ARGUMENT="NULL argument",ae.KEY_NOT_FOUND="Key Not Found",ae.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ae.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ae.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ae.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ae.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var O=function(le){return"@inject called with undefined this could mean that the class "+le+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ae.UNDEFINED_INJECT_ANNOTATION=O,ae.CIRCULAR_DEPENDENCY="Circular dependency found:",ae.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ae.INVALID_BINDING_TYPE="Invalid binding type:",ae.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ae.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ae.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ae.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ae.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var te=function(){for(var le=[],P=0;P<arguments.length;P++)le[P]=arguments[P];return"The number of constructor arguments in the derived class "+(le[0]+" must be >= than the number of constructor arguments of its base class.")};ae.ARGUMENTS_LENGTH_MISMATCH=te,ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ae.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var de=function(){for(var le=[],P=0;P<arguments.length;P++)le[P]=arguments[P];return"@postConstruct error in class "+le[0]+": "+le[1]};ae.POST_CONSTRUCT_ERROR=de;var y=function(){for(var le=[],P=0;P<arguments.length;P++)le[P]=arguments[P];return"It looks like there is a circular dependency "+("in one of the '"+le[0]+"' bindings. Please investigate bindings with")+("service identifier '"+le[1]+"'.")};ae.CIRCULAR_DEPENDENCY_IN_FACTORY=y,ae.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.TargetTypeEnum=ae.BindingTypeEnum=ae.BindingScopeEnum=void 0;var O={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ae.BindingScopeEnum=O;var te={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ae.BindingTypeEnum=te;var de={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ae.TargetTypeEnum=de},6867:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.NON_CUSTOM_TAG_KEYS=ae.POST_CONSTRUCT=ae.DESIGN_PARAM_TYPES=ae.PARAM_TYPES=ae.TAGGED_PROP=ae.TAGGED=ae.MULTI_INJECT_TAG=ae.INJECT_TAG=ae.OPTIONAL_TAG=ae.UNMANAGED_TAG=ae.NAME_TAG=ae.NAMED_TAG=void 0,ae.NAMED_TAG="named",ae.NAME_TAG="name",ae.UNMANAGED_TAG="unmanaged",ae.OPTIONAL_TAG="optional",ae.INJECT_TAG="inject",ae.MULTI_INJECT_TAG="multi_inject",ae.TAGGED="inversify:tagged",ae.TAGGED_PROP="inversify:tagged_props",ae.PARAM_TYPES="inversify:paramtypes",ae.DESIGN_PARAM_TYPES="design:paramtypes",ae.POST_CONSTRUCT="post_construct";function O(){return[ae.INJECT_TAG,ae.MULTI_INJECT_TAG,ae.NAME_TAG,ae.UNMANAGED_TAG,ae.NAMED_TAG,ae.OPTIONAL_TAG]}ae.NON_CUSTOM_TAG_KEYS=O()},51389:function(Ut,ae,O){"use strict";var te=this&&this.__awaiter||function(Ze,ht,it,dr){function yr(cr){return cr instanceof it?cr:new it(function(ft){ft(cr)})}return new(it||(it=Promise))(function(cr,ft){function Pe(Vt){try{Ve(dr.next(Vt))}catch(mr){ft(mr)}}function Rt(Vt){try{Ve(dr.throw(Vt))}catch(mr){ft(mr)}}function Ve(Vt){Vt.done?cr(Vt.value):yr(Vt.value).then(Pe,Rt)}Ve((dr=dr.apply(Ze,ht||[])).next())})},de=this&&this.__generator||function(Ze,ht){var it={label:0,sent:function(){if(cr[0]&1)throw cr[1];return cr[1]},trys:[],ops:[]},dr,yr,cr,ft;return ft={next:Pe(0),throw:Pe(1),return:Pe(2)},typeof Symbol=="function"&&(ft[Symbol.iterator]=function(){return this}),ft;function Pe(Ve){return function(Vt){return Rt([Ve,Vt])}}function Rt(Ve){if(dr)throw new TypeError("Generator is already executing.");for(;it;)try{if(dr=1,yr&&(cr=Ve[0]&2?yr.return:Ve[0]?yr.throw||((cr=yr.return)&&cr.call(yr),0):yr.next)&&!(cr=cr.call(yr,Ve[1])).done)return cr;switch(yr=0,cr&&(Ve=[Ve[0]&2,cr.value]),Ve[0]){case 0:case 1:cr=Ve;break;case 4:return it.label++,{value:Ve[1],done:!1};case 5:it.label++,yr=Ve[1],Ve=[0];continue;case 7:Ve=it.ops.pop(),it.trys.pop();continue;default:if(cr=it.trys,!(cr=cr.length>0&&cr[cr.length-1])&&(Ve[0]===6||Ve[0]===2)){it=0;continue}if(Ve[0]===3&&(!cr||Ve[1]>cr[0]&&Ve[1]<cr[3])){it.label=Ve[1];break}if(Ve[0]===6&&it.label<cr[1]){it.label=cr[1],cr=Ve;break}if(cr&&it.label<cr[2]){it.label=cr[2],it.ops.push(Ve);break}cr[2]&&it.ops.pop(),it.trys.pop();continue}Ve=ht.call(Ze,it)}catch(Vt){Ve=[6,Vt],yr=0}finally{dr=cr=0}if(Ve[0]&5)throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Ze,ht){for(var it=0,dr=ht.length,yr=Ze.length;it<dr;it++,yr++)Ze[yr]=ht[it];return Ze};Object.defineProperty(ae,"__esModule",{value:!0}),ae.Container=void 0;var le=O(44290),P=O(16674),Y=O(28421),V=O(6867),ue=O(51377),H=O(86311),Ae=O(31927),Ce=O(51860),ge=O(37791),ct=O(55800),ye=O(85700),St=O(80175),mt=function(){function Ze(ht){this._appliedMiddleware=[];var it=ht||{};if(typeof it!="object")throw new Error(""+P.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(it.defaultScope===void 0)it.defaultScope=Y.BindingScopeEnum.Transient;else if(it.defaultScope!==Y.BindingScopeEnum.Singleton&&it.defaultScope!==Y.BindingScopeEnum.Transient&&it.defaultScope!==Y.BindingScopeEnum.Request)throw new Error(""+P.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(it.autoBindInjectable===void 0)it.autoBindInjectable=!1;else if(typeof it.autoBindInjectable!="boolean")throw new Error(""+P.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(it.skipBaseClassChecks===void 0)it.skipBaseClassChecks=!1;else if(typeof it.skipBaseClassChecks!="boolean")throw new Error(""+P.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:it.autoBindInjectable,defaultScope:it.defaultScope,skipBaseClassChecks:it.skipBaseClassChecks},this.id=ge.id(),this._bindingDictionary=new St.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ue.MetadataReader}return Ze.merge=function(ht,it){for(var dr=[],yr=2;yr<arguments.length;yr++)dr[yr-2]=arguments[yr];var cr=new Ze,ft=y([ht,it],dr).map(function(Ve){return H.getBindingDictionary(Ve)}),Pe=H.getBindingDictionary(cr);function Rt(Ve,Vt){Ve.traverse(function(mr,ie){ie.forEach(function(j){Vt.add(j.serviceIdentifier,j.clone())})})}return ft.forEach(function(Ve){Rt(Ve,Pe)}),cr},Ze.prototype.load=function(){for(var ht=[],it=0;it<arguments.length;it++)ht[it]=arguments[it];for(var dr=this._getContainerModuleHelpersFactory(),yr=0,cr=ht;yr<cr.length;yr++){var ft=cr[yr],Pe=dr(ft.id);ft.registry(Pe.bindFunction,Pe.unbindFunction,Pe.isboundFunction,Pe.rebindFunction)}},Ze.prototype.loadAsync=function(){for(var ht=[],it=0;it<arguments.length;it++)ht[it]=arguments[it];return te(this,void 0,void 0,function(){var dr,yr,cr,ft,Pe;return de(this,function(Rt){switch(Rt.label){case 0:dr=this._getContainerModuleHelpersFactory(),yr=0,cr=ht,Rt.label=1;case 1:return yr<cr.length?(ft=cr[yr],Pe=dr(ft.id),[4,ft.registry(Pe.bindFunction,Pe.unbindFunction,Pe.isboundFunction,Pe.rebindFunction)]):[3,4];case 2:Rt.sent(),Rt.label=3;case 3:return yr++,[3,1];case 4:return[2]}})})},Ze.prototype.unload=function(){for(var ht=this,it=[],dr=0;dr<arguments.length;dr++)it[dr]=arguments[dr];var yr=function(cr){return function(ft){return ft.moduleId===cr}};it.forEach(function(cr){var ft=yr(cr.id);ht._bindingDictionary.removeByCondition(ft)})},Ze.prototype.bind=function(ht){var it=this.options.defaultScope||Y.BindingScopeEnum.Transient,dr=new le.Binding(ht,it);return this._bindingDictionary.add(ht,dr),new Ce.BindingToSyntax(dr)},Ze.prototype.rebind=function(ht){return this.unbind(ht),this.bind(ht)},Ze.prototype.unbind=function(ht){try{this._bindingDictionary.remove(ht)}catch(it){throw new Error(P.CANNOT_UNBIND+" "+ct.getServiceIdentifierAsString(ht))}},Ze.prototype.unbindAll=function(){this._bindingDictionary=new St.Lookup},Ze.prototype.isBound=function(ht){var it=this._bindingDictionary.hasKey(ht);return!it&&this.parent&&(it=this.parent.isBound(ht)),it},Ze.prototype.isBoundNamed=function(ht,it){return this.isBoundTagged(ht,V.NAMED_TAG,it)},Ze.prototype.isBoundTagged=function(ht,it,dr){var yr=!1;if(this._bindingDictionary.hasKey(ht)){var cr=this._bindingDictionary.get(ht),ft=H.createMockRequest(this,ht,it,dr);yr=cr.some(function(Pe){return Pe.constraint(ft)})}return!yr&&this.parent&&(yr=this.parent.isBoundTagged(ht,it,dr)),yr},Ze.prototype.snapshot=function(){this._snapshots.push(ye.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ze.prototype.restore=function(){var ht=this._snapshots.pop();if(ht===void 0)throw new Error(P.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ht.bindings,this._middleware=ht.middleware},Ze.prototype.createChild=function(ht){var it=new Ze(ht||this.options);return it.parent=this,it},Ze.prototype.applyMiddleware=function(){for(var ht=[],it=0;it<arguments.length;it++)ht[it]=arguments[it];this._appliedMiddleware=this._appliedMiddleware.concat(ht);var dr=this._middleware?this._middleware:this._planAndResolve();this._middleware=ht.reduce(function(yr,cr){return cr(yr)},dr)},Ze.prototype.applyCustomMetadataReader=function(ht){this._metadataReader=ht},Ze.prototype.get=function(ht){return this._get(!1,!1,Y.TargetTypeEnum.Variable,ht)},Ze.prototype.getTagged=function(ht,it,dr){return this._get(!1,!1,Y.TargetTypeEnum.Variable,ht,it,dr)},Ze.prototype.getNamed=function(ht,it){return this.getTagged(ht,V.NAMED_TAG,it)},Ze.prototype.getAll=function(ht){return this._get(!0,!0,Y.TargetTypeEnum.Variable,ht)},Ze.prototype.getAllTagged=function(ht,it,dr){return this._get(!1,!0,Y.TargetTypeEnum.Variable,ht,it,dr)},Ze.prototype.getAllNamed=function(ht,it){return this.getAllTagged(ht,V.NAMED_TAG,it)},Ze.prototype.resolve=function(ht){var it=this.createChild();return it.bind(ht).toSelf(),this._appliedMiddleware.forEach(function(dr){it.applyMiddleware(dr)}),it.get(ht)},Ze.prototype._getContainerModuleHelpersFactory=function(){var ht=this,it=function(Pe,Rt){Pe._binding.moduleId=Rt},dr=function(Pe){return function(Rt){var Ve=ht.bind.bind(ht),Vt=Ve(Rt);return it(Vt,Pe),Vt}},yr=function(Pe){return function(Rt){var Ve=ht.unbind.bind(ht);Ve(Rt)}},cr=function(Pe){return function(Rt){var Ve=ht.isBound.bind(ht);return Ve(Rt)}},ft=function(Pe){return function(Rt){var Ve=ht.rebind.bind(ht),Vt=Ve(Rt);return it(Vt,Pe),Vt}};return function(Pe){return{bindFunction:dr(Pe),isboundFunction:cr(Pe),rebindFunction:ft(Pe),unbindFunction:yr(Pe)}}},Ze.prototype._get=function(ht,it,dr,yr,cr,ft){var Pe=null,Rt={avoidConstraints:ht,contextInterceptor:function(Ve){return Ve},isMultiInject:it,key:cr,serviceIdentifier:yr,targetType:dr,value:ft};if(this._middleware){if(Pe=this._middleware(Rt),Pe==null)throw new Error(P.INVALID_MIDDLEWARE_RETURN)}else Pe=this._planAndResolve()(Rt);return Pe},Ze.prototype._planAndResolve=function(){var ht=this;return function(it){var dr=H.plan(ht._metadataReader,ht,it.isMultiInject,it.targetType,it.serviceIdentifier,it.key,it.value,it.avoidConstraints);dr=it.contextInterceptor(dr);var yr=Ae.resolve(dr);return yr}},Ze}();ae.Container=mt},33244:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.AsyncContainerModule=ae.ContainerModule=void 0;var te=O(37791),de=function(){function le(P){this.id=te.id(),this.registry=P}return le}();ae.ContainerModule=de;var y=function(){function le(P){this.id=te.id(),this.registry=P}return le}();ae.AsyncContainerModule=y},85700:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.ContainerSnapshot=void 0;var O=function(){function te(){}return te.of=function(de,y){var le=new te;return le.bindings=de,le.middleware=y,le},te}();ae.ContainerSnapshot=O},80175:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Lookup=void 0;var te=O(16674),de=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(le,P){if(le==null)throw new Error(te.NULL_ARGUMENT);if(P==null)throw new Error(te.NULL_ARGUMENT);var Y=this._map.get(le);Y!==void 0?(Y.push(P),this._map.set(le,Y)):this._map.set(le,[P])},y.prototype.get=function(le){if(le==null)throw new Error(te.NULL_ARGUMENT);var P=this._map.get(le);if(P!==void 0)return P;throw new Error(te.KEY_NOT_FOUND)},y.prototype.remove=function(le){if(le==null)throw new Error(te.NULL_ARGUMENT);if(!this._map.delete(le))throw new Error(te.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(le){var P=this;this._map.forEach(function(Y,V){var ue=Y.filter(function(H){return!le(H)});ue.length>0?P._map.set(V,ue):P._map.delete(V)})},y.prototype.hasKey=function(le){if(le==null)throw new Error(te.NULL_ARGUMENT);return this._map.has(le)},y.prototype.clone=function(){var le=new y;return this._map.forEach(function(P,Y){P.forEach(function(V){return le.add(Y,V.clone())})}),le},y.prototype.traverse=function(le){this._map.forEach(function(P,Y){le(Y,P)})},y}();ae.Lookup=de},86700:function(Ut,ae,O){"use strict";var te;te={value:!0},te=te=te=te=te=te=ae.GW=te=te=ae.zY=te=te=te=te=te=ae.f3=te=te=ae.b2=te=te=te=te=te=ae.W2=te=void 0;var de=O(6867);te=de;var y=O(51389);Object.defineProperty(ae,"W2",{enumerable:!0,get:function(){return y.Container}});var le=O(28421);te={enumerable:!0,get:function(){return le.BindingScopeEnum}},te={enumerable:!0,get:function(){return le.BindingTypeEnum}},te={enumerable:!0,get:function(){return le.TargetTypeEnum}};var P=O(33244);te={enumerable:!0,get:function(){return P.AsyncContainerModule}},te={enumerable:!0,get:function(){return P.ContainerModule}};var Y=O(64315);Object.defineProperty(ae,"b2",{enumerable:!0,get:function(){return Y.injectable}});var V=O(32052);te={enumerable:!0,get:function(){return V.tagged}};var ue=O(38085);te={enumerable:!0,get:function(){return ue.named}};var H=O(5744);Object.defineProperty(ae,"f3",{enumerable:!0,get:function(){return H.inject}}),te={enumerable:!0,get:function(){return H.LazyServiceIdentifer}};var Ae=O(6515);te={enumerable:!0,get:function(){return Ae.optional}};var Ce=O(86757);te={enumerable:!0,get:function(){return Ce.unmanaged}};var ge=O(71693);te={enumerable:!0,get:function(){return ge.multiInject}};var ct=O(55638);te={enumerable:!0,get:function(){return ct.targetName}};var ye=O(7014);Object.defineProperty(ae,"zY",{enumerable:!0,get:function(){return ye.postConstruct}});var St=O(51377);te={enumerable:!0,get:function(){return St.MetadataReader}};var mt=O(37791);te={enumerable:!0,get:function(){return mt.id}};var Ze=O(99934);Object.defineProperty(ae,"GW",{enumerable:!0,get:function(){return Ze.decorate}});var ht=O(80758);te={enumerable:!0,get:function(){return ht.traverseAncerstors}},te={enumerable:!0,get:function(){return ht.taggedConstraint}},te={enumerable:!0,get:function(){return ht.namedConstraint}},te={enumerable:!0,get:function(){return ht.typeConstraint}};var it=O(55800);te={enumerable:!0,get:function(){return it.getServiceIdentifierAsString}};var dr=O(70600);te={enumerable:!0,get:function(){return dr.multiBindToService}}},95228:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Context=void 0;var te=O(37791),de=function(){function y(le){this.id=te.id(),this.container=le}return y.prototype.addPlan=function(le){this.plan=le},y.prototype.setCurrentRequest=function(le){this.currentRequest=le},y}();ae.Context=de},47738:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Metadata=void 0;var te=O(6867),de=function(){function y(le,P){this.key=le,this.value=P}return y.prototype.toString=function(){return this.key===te.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();ae.Metadata=de},51377:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.MetadataReader=void 0;var te=O(6867),de=function(){function y(){}return y.prototype.getConstructorMetadata=function(le){var P=Reflect.getMetadata(te.PARAM_TYPES,le),Y=Reflect.getMetadata(te.TAGGED,le);return{compilerGeneratedMetadata:P,userGeneratedMetadata:Y||{}}},y.prototype.getPropertiesMetadata=function(le){var P=Reflect.getMetadata(te.TAGGED_PROP,le)||[];return P},y}();ae.MetadataReader=de},55314:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Plan=void 0;var O=function(){function te(de,y){this.parentContext=de,this.rootRequest=y}return te}();ae.Plan=O},86311:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.getBindingDictionary=ae.createMockRequest=ae.plan=void 0;var te=O(23184),de=O(16674),y=O(28421),le=O(6867),P=O(54623),Y=O(55800),V=O(95228),ue=O(47738),H=O(55314),Ae=O(6e3),Ce=O(6748),ge=O(18924);function ct(yr){return yr._bindingDictionary}ae.getBindingDictionary=ct;function ye(yr,cr,ft,Pe,Rt,Ve){var Vt=yr?le.MULTI_INJECT_TAG:le.INJECT_TAG,mr=new ue.Metadata(Vt,ft),ie=new ge.Target(cr,Pe,ft,mr);if(Rt!==void 0){var j=new ue.Metadata(Rt,Ve);ie.metadata.push(j)}return ie}function St(yr,cr,ft,Pe,Rt){var Ve=ht(ft.container,Rt.serviceIdentifier),Vt=[];return Ve.length===te.BindingCount.NoBindingsAvailable&&ft.container.options.autoBindInjectable&&typeof Rt.serviceIdentifier=="function"&&yr.getConstructorMetadata(Rt.serviceIdentifier).compilerGeneratedMetadata&&(ft.container.bind(Rt.serviceIdentifier).toSelf(),Ve=ht(ft.container,Rt.serviceIdentifier)),cr?Vt=Ve:Vt=Ve.filter(function(mr){var ie=new Ce.Request(mr.serviceIdentifier,ft,Pe,mr,Rt);return mr.constraint(ie)}),mt(Rt.serviceIdentifier,Vt,Rt,ft.container),Vt}function mt(yr,cr,ft,Pe){switch(cr.length){case te.BindingCount.NoBindingsAvailable:if(ft.isOptional())return cr;var Rt=Y.getServiceIdentifierAsString(yr),Ve=de.NOT_REGISTERED;throw Ve+=Y.listMetadataForTarget(Rt,ft),Ve+=Y.listRegisteredBindingsForServiceIdentifier(Pe,Rt,ht),new Error(Ve);case te.BindingCount.OnlyOneBindingAvailable:if(!ft.isArray())return cr;case te.BindingCount.MultipleBindingsAvailable:default:if(ft.isArray())return cr;var Rt=Y.getServiceIdentifierAsString(yr),Ve=de.AMBIGUOUS_MATCH+" "+Rt;throw Ve+=Y.listRegisteredBindingsForServiceIdentifier(Pe,Rt,ht),new Error(Ve)}}function Ze(yr,cr,ft,Pe,Rt,Ve){var Vt,mr;if(Rt===null){Vt=St(yr,cr,Pe,null,Ve),mr=new Ce.Request(ft,Pe,null,Vt,Ve);var ie=new H.Plan(Pe,mr);Pe.addPlan(ie)}else Vt=St(yr,cr,Pe,Rt,Ve),mr=Rt.addChildRequest(Ve.serviceIdentifier,Vt,Ve);Vt.forEach(function(j){var re=null;if(Ve.isArray())re=mr.addChildRequest(j.serviceIdentifier,j,Ve);else{if(j.cache)return;re=mr}if(j.type===y.BindingTypeEnum.Instance&&j.implementationType!==null){var ke=Ae.getDependencies(yr,j.implementationType);if(!Pe.container.options.skipBaseClassChecks){var Te=Ae.getBaseClassDependencyCount(yr,j.implementationType);if(ke.length<Te){var st=de.ARGUMENTS_LENGTH_MISMATCH(Ae.getFunctionName(j.implementationType));throw new Error(st)}}ke.forEach(function(ze){Ze(yr,!1,ze.serviceIdentifier,Pe,re,ze)})}})}function ht(yr,cr){var ft=[],Pe=ct(yr);return Pe.hasKey(cr)?ft=Pe.get(cr):yr.parent!==null&&(ft=ht(yr.parent,cr)),ft}function it(yr,cr,ft,Pe,Rt,Ve,Vt,mr){mr===void 0&&(mr=!1);var ie=new V.Context(cr),j=ye(ft,Pe,Rt,"",Ve,Vt);try{return Ze(yr,mr,Rt,ie,null,j),ie}catch(re){throw P.isStackOverflowExeption(re)&&ie.plan&&Y.circularDependencyToException(ie.plan.rootRequest),re}}ae.plan=it;function dr(yr,cr,ft,Pe){var Rt=new ge.Target(y.TargetTypeEnum.Variable,"",cr,new ue.Metadata(ft,Pe)),Ve=new V.Context(yr),Vt=new Ce.Request(cr,Ve,null,[],Rt);return Vt}ae.createMockRequest=dr},88460:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.QueryableString=void 0;var O=function(){function te(de){this.str=de}return te.prototype.startsWith=function(de){return this.str.indexOf(de)===0},te.prototype.endsWith=function(de){var y="",le=de.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},le)},te.prototype.contains=function(de){return this.str.indexOf(de)!==-1},te.prototype.equals=function(de){return this.str===de},te.prototype.value=function(){return this.str},te}();ae.QueryableString=O},6e3:function(Ut,ae,O){"use strict";var te=this&&this.__spreadArray||function(St,mt){for(var Ze=0,ht=mt.length,it=St.length;Ze<ht;Ze++,it++)St[it]=mt[Ze];return St};Object.defineProperty(ae,"__esModule",{value:!0}),ae.getFunctionName=ae.getBaseClassDependencyCount=ae.getDependencies=void 0;var de=O(5744),y=O(16674),le=O(28421),P=O(6867),Y=O(55800);Object.defineProperty(ae,"getFunctionName",{enumerable:!0,get:function(){return Y.getFunctionName}});var V=O(18924);function ue(St,mt){var Ze=Y.getFunctionName(mt),ht=H(St,Ze,mt,!1);return ht}ae.getDependencies=ue;function H(St,mt,Ze,ht){var it=St.getConstructorMetadata(Ze),dr=it.compilerGeneratedMetadata;if(dr===void 0){var yr=y.MISSING_INJECTABLE_ANNOTATION+" "+mt+".";throw new Error(yr)}var cr=it.userGeneratedMetadata,ft=Object.keys(cr),Pe=Ze.length===0&&ft.length>0,Rt=ft.length>Ze.length,Ve=Pe||Rt?ft.length:Ze.length,Vt=Ce(ht,mt,dr,cr,Ve),mr=ge(St,Ze),ie=te(te([],Vt),mr);return ie}function Ae(St,mt,Ze,ht,it){var dr=it[St.toString()]||[],yr=ye(dr),cr=yr.unmanaged!==!0,ft=ht[St],Pe=yr.inject||yr.multiInject;if(ft=Pe||ft,ft instanceof de.LazyServiceIdentifer&&(ft=ft.unwrap()),cr){var Rt=ft===Object,Ve=ft===Function,Vt=ft===void 0,mr=Rt||Ve||Vt;if(!mt&&mr){var ie=y.MISSING_INJECT_ANNOTATION+" argument "+St+" in class "+Ze+".";throw new Error(ie)}var j=new V.Target(le.TargetTypeEnum.ConstructorArgument,yr.targetName,ft);return j.metadata=dr,j}return null}function Ce(St,mt,Ze,ht,it){for(var dr=[],yr=0;yr<it;yr++){var cr=yr,ft=Ae(cr,St,mt,Ze,ht);ft!==null&&dr.push(ft)}return dr}function ge(St,mt){for(var Ze=St.getPropertiesMetadata(mt),ht=[],it=Object.keys(Ze),dr=0,yr=it;dr<yr.length;dr++){var cr=yr[dr],ft=Ze[cr],Pe=ye(Ze[cr]),Rt=Pe.targetName||cr,Ve=Pe.inject||Pe.multiInject,Vt=new V.Target(le.TargetTypeEnum.ClassProperty,Rt,Ve);Vt.metadata=ft,ht.push(Vt)}var mr=Object.getPrototypeOf(mt.prototype).constructor;if(mr!==Object){var ie=ge(St,mr);ht=te(te([],ht),ie)}return ht}function ct(St,mt){var Ze=Object.getPrototypeOf(mt.prototype).constructor;if(Ze!==Object){var ht=Y.getFunctionName(Ze),it=H(St,ht,Ze,!0),dr=it.map(function(ft){return ft.metadata.filter(function(Pe){return Pe.key===P.UNMANAGED_TAG})}),yr=[].concat.apply([],dr).length,cr=it.length-yr;return cr>0?cr:ct(St,Ze)}else return 0}ae.getBaseClassDependencyCount=ct;function ye(St){var mt={};return St.forEach(function(Ze){mt[Ze.key.toString()]=Ze.value}),{inject:mt[P.INJECT_TAG],multiInject:mt[P.MULTI_INJECT_TAG],targetName:mt[P.NAME_TAG],unmanaged:mt[P.UNMANAGED_TAG]}}},6748:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Request=void 0;var te=O(37791),de=function(){function y(le,P,Y,V,ue){this.id=te.id(),this.serviceIdentifier=le,this.parentContext=P,this.parentRequest=Y,this.target=ue,this.childRequests=[],this.bindings=Array.isArray(V)?V:[V],this.requestScope=Y===null?new Map:null}return y.prototype.addChildRequest=function(le,P,Y){var V=new y(le,this.parentContext,this,P,Y);return this.childRequests.push(V),V},y}();ae.Request=de},18924:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.Target=void 0;var te=O(6867),de=O(37791),y=O(47738),le=O(88460),P=function(){function Y(V,ue,H,Ae){this.id=de.id(),this.type=V,this.serviceIdentifier=H,this.name=new le.QueryableString(ue||""),this.metadata=new Array;var Ce=null;typeof Ae=="string"?Ce=new y.Metadata(te.NAMED_TAG,Ae):Ae instanceof y.Metadata&&(Ce=Ae),Ce!==null&&this.metadata.push(Ce)}return Y.prototype.hasTag=function(V){for(var ue=0,H=this.metadata;ue<H.length;ue++){var Ae=H[ue];if(Ae.key===V)return!0}return!1},Y.prototype.isArray=function(){return this.hasTag(te.MULTI_INJECT_TAG)},Y.prototype.matchesArray=function(V){return this.matchesTag(te.MULTI_INJECT_TAG)(V)},Y.prototype.isNamed=function(){return this.hasTag(te.NAMED_TAG)},Y.prototype.isTagged=function(){return this.metadata.some(function(V){return te.NON_CUSTOM_TAG_KEYS.every(function(ue){return V.key!==ue})})},Y.prototype.isOptional=function(){return this.matchesTag(te.OPTIONAL_TAG)(!0)},Y.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(V){return V.key===te.NAMED_TAG})[0]:null},Y.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(V){return te.NON_CUSTOM_TAG_KEYS.every(function(ue){return V.key!==ue})}):null},Y.prototype.matchesNamedTag=function(V){return this.matchesTag(te.NAMED_TAG)(V)},Y.prototype.matchesTag=function(V){var ue=this;return function(H){for(var Ae=0,Ce=ue.metadata;Ae<Ce.length;Ae++){var ge=Ce[Ae];if(ge.key===V&&ge.value===H)return!0}return!1}},Y}();ae.Target=P},52279:function(Ut,ae,O){"use strict";var te=this&&this.__spreadArray||function(H,Ae){for(var Ce=0,ge=Ae.length,ct=H.length;Ce<ge;Ce++,ct++)H[ct]=Ae[Ce];return H};Object.defineProperty(ae,"__esModule",{value:!0}),ae.resolveInstance=void 0;var de=O(16674),y=O(28421),le=O(6867);function P(H,Ae,Ce){var ge=Ae.filter(function(ye){return ye.target!==null&&ye.target.type===y.TargetTypeEnum.ClassProperty}),ct=ge.map(Ce);return ge.forEach(function(ye,St){var mt="";mt=ye.target.name.value();var Ze=ct[St];H[mt]=Ze}),H}function Y(H,Ae){return new(H.bind.apply(H,te([void 0],Ae)))}function V(H,Ae){if(Reflect.hasMetadata(le.POST_CONSTRUCT,H)){var Ce=Reflect.getMetadata(le.POST_CONSTRUCT,H);try{Ae[Ce.value]()}catch(ge){throw new Error(de.POST_CONSTRUCT_ERROR(H.name,ge.message))}}}function ue(H,Ae,Ce){var ge=null;if(Ae.length>0){var ct=Ae.filter(function(St){return St.target!==null&&St.target.type===y.TargetTypeEnum.ConstructorArgument}),ye=ct.map(Ce);ge=Y(H,ye),ge=P(ge,Ae,Ce)}else ge=new H;return V(H,ge),ge}ae.resolveInstance=ue},31927:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.resolve=void 0;var te=O(16674),de=O(28421),y=O(54623),le=O(55800),P=O(52279),Y=function(H,Ae,Ce){try{return Ce()}catch(ge){throw y.isStackOverflowExeption(ge)?new Error(te.CIRCULAR_DEPENDENCY_IN_FACTORY(H,Ae.toString())):ge}},V=function(H){return function(Ae){Ae.parentContext.setCurrentRequest(Ae);var Ce=Ae.bindings,ge=Ae.childRequests,ct=Ae.target&&Ae.target.isArray(),ye=!Ae.parentRequest||!Ae.parentRequest.target||!Ae.target||!Ae.parentRequest.target.matchesArray(Ae.target.serviceIdentifier);if(ct&&ye)return ge.map(function(dr){var yr=V(H);return yr(dr)});var St=null;if(Ae.target.isOptional()&&Ce.length===0)return;var mt=Ce[0],Ze=mt.scope===de.BindingScopeEnum.Singleton,ht=mt.scope===de.BindingScopeEnum.Request;if(Ze&&mt.activated)return mt.cache;if(ht&&H!==null&&H.has(mt.id))return H.get(mt.id);if(mt.type===de.BindingTypeEnum.ConstantValue)St=mt.cache,mt.activated=!0;else if(mt.type===de.BindingTypeEnum.Function)St=mt.cache,mt.activated=!0;else if(mt.type===de.BindingTypeEnum.Constructor)St=mt.implementationType;else if(mt.type===de.BindingTypeEnum.DynamicValue&&mt.dynamicValue!==null)St=Y("toDynamicValue",mt.serviceIdentifier,function(){return mt.dynamicValue(Ae.parentContext)});else if(mt.type===de.BindingTypeEnum.Factory&&mt.factory!==null)St=Y("toFactory",mt.serviceIdentifier,function(){return mt.factory(Ae.parentContext)});else if(mt.type===de.BindingTypeEnum.Provider&&mt.provider!==null)St=Y("toProvider",mt.serviceIdentifier,function(){return mt.provider(Ae.parentContext)});else if(mt.type===de.BindingTypeEnum.Instance&&mt.implementationType!==null)St=P.resolveInstance(mt.implementationType,ge,V(H));else{var it=le.getServiceIdentifierAsString(Ae.serviceIdentifier);throw new Error(te.INVALID_BINDING_TYPE+" "+it)}return typeof mt.onActivation=="function"&&(St=mt.onActivation(Ae.parentContext,St)),Ze&&(mt.cache=St,mt.activated=!0),ht&&H!==null&&!H.has(mt.id)&&H.set(mt.id,St),St}};function ue(H){var Ae=V(H.plan.rootRequest.requestScope);return Ae(H.plan.rootRequest)}ae.resolve=ue},83366:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingInSyntax=void 0;var te=O(28421),de=O(71325),y=function(){function le(P){this._binding=P}return le.prototype.inRequestScope=function(){return this._binding.scope=te.BindingScopeEnum.Request,new de.BindingWhenOnSyntax(this._binding)},le.prototype.inSingletonScope=function(){return this._binding.scope=te.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},le.prototype.inTransientScope=function(){return this._binding.scope=te.BindingScopeEnum.Transient,new de.BindingWhenOnSyntax(this._binding)},le}();ae.BindingInSyntax=y},99812:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingInWhenOnSyntax=void 0;var te=O(83366),de=O(51811),y=O(98370),le=function(){function P(Y){this._binding=Y,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new de.BindingOnSyntax(this._binding),this._bindingInSyntax=new te.BindingInSyntax(Y)}return P.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},P.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},P.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},P.prototype.when=function(Y){return this._bindingWhenSyntax.when(Y)},P.prototype.whenTargetNamed=function(Y){return this._bindingWhenSyntax.whenTargetNamed(Y)},P.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},P.prototype.whenTargetTagged=function(Y,V){return this._bindingWhenSyntax.whenTargetTagged(Y,V)},P.prototype.whenInjectedInto=function(Y){return this._bindingWhenSyntax.whenInjectedInto(Y)},P.prototype.whenParentNamed=function(Y){return this._bindingWhenSyntax.whenParentNamed(Y)},P.prototype.whenParentTagged=function(Y,V){return this._bindingWhenSyntax.whenParentTagged(Y,V)},P.prototype.whenAnyAncestorIs=function(Y){return this._bindingWhenSyntax.whenAnyAncestorIs(Y)},P.prototype.whenNoAncestorIs=function(Y){return this._bindingWhenSyntax.whenNoAncestorIs(Y)},P.prototype.whenAnyAncestorNamed=function(Y){return this._bindingWhenSyntax.whenAnyAncestorNamed(Y)},P.prototype.whenAnyAncestorTagged=function(Y,V){return this._bindingWhenSyntax.whenAnyAncestorTagged(Y,V)},P.prototype.whenNoAncestorNamed=function(Y){return this._bindingWhenSyntax.whenNoAncestorNamed(Y)},P.prototype.whenNoAncestorTagged=function(Y,V){return this._bindingWhenSyntax.whenNoAncestorTagged(Y,V)},P.prototype.whenAnyAncestorMatches=function(Y){return this._bindingWhenSyntax.whenAnyAncestorMatches(Y)},P.prototype.whenNoAncestorMatches=function(Y){return this._bindingWhenSyntax.whenNoAncestorMatches(Y)},P.prototype.onActivation=function(Y){return this._bindingOnSyntax.onActivation(Y)},P}();ae.BindingInWhenOnSyntax=le},51811:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingOnSyntax=void 0;var te=O(98370),de=function(){function y(le){this._binding=le}return y.prototype.onActivation=function(le){return this._binding.onActivation=le,new te.BindingWhenSyntax(this._binding)},y}();ae.BindingOnSyntax=de},51860:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingToSyntax=void 0;var te=O(16674),de=O(28421),y=O(99812),le=O(71325),P=function(){function Y(V){this._binding=V}return Y.prototype.to=function(V){return this._binding.type=de.BindingTypeEnum.Instance,this._binding.implementationType=V,new y.BindingInWhenOnSyntax(this._binding)},Y.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+te.INVALID_TO_SELF_VALUE);var V=this._binding.serviceIdentifier;return this.to(V)},Y.prototype.toConstantValue=function(V){return this._binding.type=de.BindingTypeEnum.ConstantValue,this._binding.cache=V,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=de.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},Y.prototype.toDynamicValue=function(V){return this._binding.type=de.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=V,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},Y.prototype.toConstructor=function(V){return this._binding.type=de.BindingTypeEnum.Constructor,this._binding.implementationType=V,this._binding.scope=de.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},Y.prototype.toFactory=function(V){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=V,this._binding.scope=de.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},Y.prototype.toFunction=function(V){if(typeof V!="function")throw new Error(te.INVALID_FUNCTION_BINDING);var ue=this.toConstantValue(V);return this._binding.type=de.BindingTypeEnum.Function,this._binding.scope=de.BindingScopeEnum.Singleton,ue},Y.prototype.toAutoFactory=function(V){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=function(ue){var H=function(){return ue.container.get(V)};return H},this._binding.scope=de.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},Y.prototype.toProvider=function(V){return this._binding.type=de.BindingTypeEnum.Provider,this._binding.provider=V,this._binding.scope=de.BindingScopeEnum.Singleton,new le.BindingWhenOnSyntax(this._binding)},Y.prototype.toService=function(V){this.toDynamicValue(function(ue){return ue.container.get(V)})},Y}();ae.BindingToSyntax=P},71325:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingWhenOnSyntax=void 0;var te=O(51811),de=O(98370),y=function(){function le(P){this._binding=P,this._bindingWhenSyntax=new de.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new te.BindingOnSyntax(this._binding)}return le.prototype.when=function(P){return this._bindingWhenSyntax.when(P)},le.prototype.whenTargetNamed=function(P){return this._bindingWhenSyntax.whenTargetNamed(P)},le.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},le.prototype.whenTargetTagged=function(P,Y){return this._bindingWhenSyntax.whenTargetTagged(P,Y)},le.prototype.whenInjectedInto=function(P){return this._bindingWhenSyntax.whenInjectedInto(P)},le.prototype.whenParentNamed=function(P){return this._bindingWhenSyntax.whenParentNamed(P)},le.prototype.whenParentTagged=function(P,Y){return this._bindingWhenSyntax.whenParentTagged(P,Y)},le.prototype.whenAnyAncestorIs=function(P){return this._bindingWhenSyntax.whenAnyAncestorIs(P)},le.prototype.whenNoAncestorIs=function(P){return this._bindingWhenSyntax.whenNoAncestorIs(P)},le.prototype.whenAnyAncestorNamed=function(P){return this._bindingWhenSyntax.whenAnyAncestorNamed(P)},le.prototype.whenAnyAncestorTagged=function(P,Y){return this._bindingWhenSyntax.whenAnyAncestorTagged(P,Y)},le.prototype.whenNoAncestorNamed=function(P){return this._bindingWhenSyntax.whenNoAncestorNamed(P)},le.prototype.whenNoAncestorTagged=function(P,Y){return this._bindingWhenSyntax.whenNoAncestorTagged(P,Y)},le.prototype.whenAnyAncestorMatches=function(P){return this._bindingWhenSyntax.whenAnyAncestorMatches(P)},le.prototype.whenNoAncestorMatches=function(P){return this._bindingWhenSyntax.whenNoAncestorMatches(P)},le.prototype.onActivation=function(P){return this._bindingOnSyntax.onActivation(P)},le}();ae.BindingWhenOnSyntax=y},98370:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.BindingWhenSyntax=void 0;var te=O(51811),de=O(80758),y=function(){function le(P){this._binding=P}return le.prototype.when=function(P){return this._binding.constraint=P,new te.BindingOnSyntax(this._binding)},le.prototype.whenTargetNamed=function(P){return this._binding.constraint=de.namedConstraint(P),new te.BindingOnSyntax(this._binding)},le.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(P){var Y=P.target!==null&&!P.target.isNamed()&&!P.target.isTagged();return Y},new te.BindingOnSyntax(this._binding)},le.prototype.whenTargetTagged=function(P,Y){return this._binding.constraint=de.taggedConstraint(P)(Y),new te.BindingOnSyntax(this._binding)},le.prototype.whenInjectedInto=function(P){return this._binding.constraint=function(Y){return de.typeConstraint(P)(Y.parentRequest)},new te.BindingOnSyntax(this._binding)},le.prototype.whenParentNamed=function(P){return this._binding.constraint=function(Y){return de.namedConstraint(P)(Y.parentRequest)},new te.BindingOnSyntax(this._binding)},le.prototype.whenParentTagged=function(P,Y){return this._binding.constraint=function(V){return de.taggedConstraint(P)(Y)(V.parentRequest)},new te.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorIs=function(P){return this._binding.constraint=function(Y){return de.traverseAncerstors(Y,de.typeConstraint(P))},new te.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorIs=function(P){return this._binding.constraint=function(Y){return!de.traverseAncerstors(Y,de.typeConstraint(P))},new te.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorNamed=function(P){return this._binding.constraint=function(Y){return de.traverseAncerstors(Y,de.namedConstraint(P))},new te.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorNamed=function(P){return this._binding.constraint=function(Y){return!de.traverseAncerstors(Y,de.namedConstraint(P))},new te.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorTagged=function(P,Y){return this._binding.constraint=function(V){return de.traverseAncerstors(V,de.taggedConstraint(P)(Y))},new te.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorTagged=function(P,Y){return this._binding.constraint=function(V){return!de.traverseAncerstors(V,de.taggedConstraint(P)(Y))},new te.BindingOnSyntax(this._binding)},le.prototype.whenAnyAncestorMatches=function(P){return this._binding.constraint=function(Y){return de.traverseAncerstors(Y,P)},new te.BindingOnSyntax(this._binding)},le.prototype.whenNoAncestorMatches=function(P){return this._binding.constraint=function(Y){return!de.traverseAncerstors(Y,P)},new te.BindingOnSyntax(this._binding)},le}();ae.BindingWhenSyntax=y},80758:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.typeConstraint=ae.namedConstraint=ae.taggedConstraint=ae.traverseAncerstors=void 0;var te=O(6867),de=O(47738),y=function(V,ue){var H=V.parentRequest;return H!==null?ue(H)?!0:y(H,ue):!1};ae.traverseAncerstors=y;var le=function(V){return function(ue){var H=function(Ae){return Ae!==null&&Ae.target!==null&&Ae.target.matchesTag(V)(ue)};return H.metaData=new de.Metadata(V,ue),H}};ae.taggedConstraint=le;var P=le(te.NAMED_TAG);ae.namedConstraint=P;var Y=function(V){return function(ue){var H=null;if(ue!==null)if(H=ue.bindings[0],typeof V=="string"){var Ae=H.serviceIdentifier;return Ae===V}else{var Ce=ue.bindings[0].implementationType;return V===Ce}return!1}};ae.typeConstraint=Y},70600:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.multiBindToService=void 0;var O=function(te){return function(de){return function(){for(var y=[],le=0;le<arguments.length;le++)y[le]=arguments[le];return y.forEach(function(P){return te.bind(P).toService(de)})}}};ae.multiBindToService=O},54623:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.isStackOverflowExeption=void 0;var te=O(16674);function de(y){return y instanceof RangeError||y.message===te.STACK_OVERFLOW}ae.isStackOverflowExeption=de},37791:function(Ut,ae){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.id=void 0;var O=0;function te(){return O++}ae.id=te},55800:function(Ut,ae,O){"use strict";Object.defineProperty(ae,"__esModule",{value:!0}),ae.circularDependencyToException=ae.listMetadataForTarget=ae.listRegisteredBindingsForServiceIdentifier=ae.getServiceIdentifierAsString=ae.getFunctionName=void 0;var te=O(16674);function de(H){if(typeof H=="function"){var Ae=H;return Ae.name}else{if(typeof H=="symbol")return H.toString();var Ae=H;return Ae}}ae.getServiceIdentifierAsString=de;function y(H,Ae,Ce){var ge="",ct=Ce(H,Ae);return ct.length!==0&&(ge=`
Registered bindings:`,ct.forEach(function(ye){var St="Object";ye.implementationType!==null&&(St=ue(ye.implementationType)),ge=ge+`
 `+St,ye.constraint.metaData&&(ge=ge+" - "+ye.constraint.metaData)})),ge}ae.listRegisteredBindingsForServiceIdentifier=y;function le(H,Ae){return H.parentRequest===null?!1:H.parentRequest.serviceIdentifier===Ae?!0:le(H.parentRequest,Ae)}function P(H){function Ae(ge,ct){ct===void 0&&(ct=[]);var ye=de(ge.serviceIdentifier);return ct.push(ye),ge.parentRequest!==null?Ae(ge.parentRequest,ct):ct}var Ce=Ae(H);return Ce.reverse().join(" --> ")}function Y(H){H.childRequests.forEach(function(Ae){if(le(Ae,Ae.serviceIdentifier)){var Ce=P(Ae);throw new Error(te.CIRCULAR_DEPENDENCY+" "+Ce)}else Y(Ae)})}ae.circularDependencyToException=Y;function V(H,Ae){if(Ae.isTagged()||Ae.isNamed()){var Ce="",ge=Ae.getNamedTag(),ct=Ae.getCustomTags();return ge!==null&&(Ce+=ge.toString()+`
`),ct!==null&&ct.forEach(function(ye){Ce+=ye.toString()+`
`})," "+H+`
 `+H+" - "+Ce}else return" "+H}ae.listMetadataForTarget=V;function ue(H){if(H.name)return H.name;var Ae=H.toString(),Ce=Ae.match(/^function\s*([^\s(]+)/);return Ce?Ce[1]:"Anonymous function: "+Ae}ae.getFunctionName=ue},47443:function(Ut,ae,O){var te=O(42118);function de(y,le){var P=y==null?0:y.length;return!!P&&te(y,le,0)>-1}Ut.exports=de},1196:function(Ut){function ae(O,te,de){for(var y=-1,le=O==null?0:O.length;++y<le;)if(de(te,O[y]))return!0;return!1}Ut.exports=ae},29750:function(Ut){function ae(O,te,de){return O===O&&(de!==void 0&&(O=O<=de?O:de),te!==void 0&&(O=O>=te?O:te)),O}Ut.exports=ae},41848:function(Ut){function ae(O,te,de,y){for(var le=O.length,P=de+(y?1:-1);y?P--:++P<le;)if(te(O[P],P,O))return P;return-1}Ut.exports=ae},42118:function(Ut,ae,O){var te=O(41848),de=O(62722),y=O(42351);function le(P,Y,V){return Y===Y?y(P,Y,V):te(P,de,V)}Ut.exports=le},74221:function(Ut){function ae(O,te,de,y){for(var le=de-1,P=O.length;++le<P;)if(y(O[le],te))return le;return-1}Ut.exports=ae},62722:function(Ut){function ae(O){return O!==O}Ut.exports=ae},65464:function(Ut,ae,O){var te=O(29932),de=O(42118),y=O(74221),le=O(7518),P=O(278),Y=Array.prototype,V=Y.splice;function ue(H,Ae,Ce,ge){var ct=ge?y:de,ye=-1,St=Ae.length,mt=H;for(H===Ae&&(Ae=P(Ae)),Ce&&(mt=te(H,le(Ce)));++ye<St;)for(var Ze=0,ht=Ae[ye],it=Ce?Ce(ht):ht;(Ze=ct(mt,it,Ze,ge))>-1;)mt!==H&&V.call(mt,Ze,1),V.call(H,Ze,1);return H}Ut.exports=ue},45652:function(Ut,ae,O){var te=O(88668),de=O(47443),y=O(1196),le=O(74757),P=O(23593),Y=O(21814),V=200;function ue(H,Ae,Ce){var ge=-1,ct=de,ye=H.length,St=!0,mt=[],Ze=mt;if(Ce)St=!1,ct=y;else if(ye>=V){var ht=Ae?null:P(H);if(ht)return Y(ht);St=!1,ct=le,Ze=new te}else Ze=Ae?[]:mt;e:for(;++ge<ye;){var it=H[ge],dr=Ae?Ae(it):it;if(it=Ce||it!==0?it:0,St&&dr===dr){for(var yr=Ze.length;yr--;)if(Ze[yr]===dr)continue e;Ae&&Ze.push(dr),mt.push(it)}else ct(Ze,dr,Ce)||(Ze!==mt&&Ze.push(dr),mt.push(it))}return mt}Ut.exports=ue},23593:function(Ut,ae,O){var te=O(58525),de=O(50308),y=O(21814),le=1/0,P=te&&1/y(new te([,-0]))[1]==le?function(Y){return new te(Y)}:de;Ut.exports=P},42351:function(Ut){function ae(O,te,de){for(var y=de-1,le=O.length;++y<le;)if(O[y]===te)return y;return-1}Ut.exports=ae},74691:function(Ut,ae,O){var te=O(29750),de=O(14841);function y(le,P,Y){return Y===void 0&&(Y=P,P=void 0),Y!==void 0&&(Y=de(Y),Y=Y===Y?Y:0),P!==void 0&&(P=de(P),P=P===P?P:0),te(de(le),P,Y)}Ut.exports=y},51584:function(Ut,ae,O){var te=O(44239),de=O(37005),y="[object Boolean]";function le(P){return P===!0||P===!1||de(P)&&te(P)==y}Ut.exports=le},18446:function(Ut,ae,O){var te=O(90939);function de(y,le){return te(y,le)}Ut.exports=de},14293:function(Ut){function ae(O){return O==null}Ut.exports=ae},81763:function(Ut,ae,O){var te=O(44239),de=O(37005),y="[object Number]";function le(P){return typeof P=="number"||de(P)&&te(P)==y}Ut.exports=le},52353:function(Ut){function ae(O){return O===void 0}Ut.exports=ae},30236:function(Ut,ae,O){var te=O(42980),de=O(21463),y=de(function(le,P,Y,V){te(le,P,Y,V)});Ut.exports=y},50308:function(Ut){function ae(){}Ut.exports=ae},97019:function(Ut,ae,O){var te=O(5976),de=O(45604),y=te(de);Ut.exports=y},45604:function(Ut,ae,O){var te=O(65464);function de(y,le){return y&&y.length&&le&&le.length?te(y,le):y}Ut.exports=de},44908:function(Ut,ae,O){var te=O(45652);function de(y){return y&&y.length?te(y):[]}Ut.exports=de},6158:function(Ut){(function(ae,O){Ut.exports=O()})(this,function(){"use strict";var ae,O,te;function de(y,le){if(!ae)ae=le;else if(!O)O=le;else{var P="var sharedChunk = {}; ("+ae+")(sharedChunk); ("+O+")(sharedChunk);",Y={};ae(Y),te=le(Y),typeof window!="undefined"&&(te.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}return de(["exports"],function(y){"use strict";function le(o,u){return o(u={exports:{}},u.exports),u.exports}var P=Y;function Y(o,u,c,m){this.cx=3*o,this.bx=3*(c-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=c,this.p2y=m}Y.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},Y.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},Y.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},Y.prototype.solveCurveX=function(o,u){var c,m,b,E,T;for(u===void 0&&(u=1e-6),b=o,T=0;T<8;T++){if(E=this.sampleCurveX(b)-o,Math.abs(E)<u)return b;var M=this.sampleCurveDerivativeX(b);if(Math.abs(M)<1e-6)break;b-=E/M}if((b=o)<(c=0))return c;if(b>(m=1))return m;for(;c<m;){if(E=this.sampleCurveX(b),Math.abs(E-o)<u)return b;o>E?c=b:m=b,b=.5*(m-c)+c}return b},Y.prototype.solve=function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))};var V=ue;function ue(o,u){this.x=o,this.y=u}ue.prototype={clone:function(){return new ue(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,u){return this.clone()._rotateAround(o,u)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var u=o.x-this.x,c=o.y-this.y;return u*u+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,u){return Math.atan2(this.x*u-this.y*o,this.x*o+this.y*u)},_matMult:function(o){var u=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=u,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var u=Math.cos(o),c=Math.sin(o),m=c*this.x+u*this.y;return this.x=u*this.x-c*this.y,this.y=m,this},_rotateAround:function(o,u){var c=Math.cos(o),m=Math.sin(o),b=u.y+m*(this.x-u.x)+c*(this.y-u.y);return this.x=u.x+c*(this.x-u.x)-m*(this.y-u.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ue.convert=function(o){return o instanceof ue?o:Array.isArray(o)?new ue(o[0],o[1]):o};var H=typeof self!="undefined"?self:{},Ae=Math.pow(2,53)-1;function Ce(o,u,c,m){var b=new P(o,u,c,m);return function(E){return b.solve(E)}}var ge=Ce(.25,.1,.25,1);function ct(o,u,c){return Math.min(c,Math.max(u,o))}function ye(o,u,c){var m=c-u,b=((o-u)%m+m)%m+u;return b===u?c:b}function St(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,b=u;m<b.length;m+=1){var E=b[m];for(var T in E)o[T]=E[T]}return o}var mt=1;function Ze(){return mt++}function ht(){return function o(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function it(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function dr(o,u){o.forEach(function(c){u[c]&&(u[c]=u[c].bind(u))})}function yr(o,u){return o.indexOf(u,o.length-u.length)!==-1}function cr(o,u,c){var m={};for(var b in o)m[b]=u.call(c||this,o[b],b,o);return m}function ft(o,u,c){var m={};for(var b in o)u.call(c||this,o[b],b,o)&&(m[b]=o[b]);return m}function Pe(o){return Array.isArray(o)?o.map(Pe):typeof o=="object"&&o?cr(o,Pe):o}var Rt={};function Ve(o){Rt[o]||(typeof console!="undefined"&&console.warn(o),Rt[o]=!0)}function Vt(o,u,c){return(c.y-o.y)*(u.x-o.x)>(u.y-o.y)*(c.x-o.x)}function mr(o){for(var u=0,c=0,m=o.length,b=m-1,E=void 0,T=void 0;c<m;b=c++)u+=((T=o[b]).x-(E=o[c]).x)*(E.y+T.y);return u}function ie(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function j(o){var u={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,b,E,T){var M=E||T;return u[b]=!M||M.toLowerCase(),""}),u["max-age"]){var c=parseInt(u["max-age"],10);isNaN(c)?delete u["max-age"]:u["max-age"]=c}return u}var re=null;function ke(o){if(re==null){var u=o.navigator?o.navigator.userAgent:null;re=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return re}function Te(o){try{var u=H[o];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var st,ze,Qe,at,Mt=H.performance&&H.performance.now?H.performance.now.bind(H.performance):Date.now.bind(Date),vr=H.requestAnimationFrame||H.mozRequestAnimationFrame||H.webkitRequestAnimationFrame||H.msRequestAnimationFrame,kt=H.cancelAnimationFrame||H.mozCancelAnimationFrame||H.webkitCancelAnimationFrame||H.msCancelAnimationFrame,Vr={now:Mt,frame:function(o){var u=vr(o);return{cancel:function(){return kt(u)}}},getImageData:function(o,u){u===void 0&&(u=0);var c=H.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=o.width,c.height=o.height,m.drawImage(o,0,0,o.width,o.height),m.getImageData(-u,-u,o.width+2*u,o.height+2*u)},resolveURL:function(o){return st||(st=H.document.createElement("a")),st.href=o,st.href},hardwareConcurrency:H.navigator&&H.navigator.hardwareConcurrency||4,get devicePixelRatio(){return H.devicePixelRatio},get prefersReducedMotion(){return!!H.matchMedia&&(ze==null&&(ze=H.matchMedia("(prefers-reduced-motion: reduce)")),ze.matches)}},Kr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ir={supported:!1,testSupport:function(o){!In&&at&&(gn?nn(o):Qe=o)}},In=!1,gn=!1;function nn(o){var u=o.createTexture();o.bindTexture(o.TEXTURE_2D,u);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,at),o.isContextLost())return;Ir.supported=!0}catch(c){}o.deleteTexture(u),In=!0}H.document&&((at=H.document.createElement("img")).onload=function(){Qe&&nn(Qe),Qe=null,gn=!0},at.onerror=function(){In=!0,Qe=null},at.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var hi="01",Lr=function(o,u){this._transformRequestFn=o,this._customAccessToken=u,this._createSkuToken()};function jn(o){return o.indexOf("mapbox:")===0}Lr.prototype._createSkuToken=function(){var o=function(){for(var u="",c=0;c<10;c++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",hi,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt},Lr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Lr.prototype.transformRequest=function(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}},Lr.prototype.normalizeStyleURL=function(o,u){if(!jn(o))return o;var c=Ei(o);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Lr.prototype.normalizeGlyphsURL=function(o,u){if(!jn(o))return o;var c=Ei(o);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Lr.prototype.normalizeSourceURL=function(o,u){if(!jn(o))return o;var c=Ei(o);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||u)},Lr.prototype.normalizeSpriteURL=function(o,u,c,m){var b=Ei(o);return jn(o)?(b.path="/styles/v1"+b.path+"/sprite"+u+c,this._makeAPIURL(b,this._customAccessToken||m)):(b.path+=""+u+c,ia(b))},Lr.prototype.normalizeTileURL=function(o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!jn(o))return o;var c=Ei(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Vr.devicePixelRatio>=2||u===512?"@2x":"")+(Ir.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(b){for(var E=0,T=b;E<T.length;E+=1){var M=T[E].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(c.params)||Kr.ACCESS_TOKEN;return Kr.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Lr.prototype.canonicalizeTileURL=function(o,u){var c=Ei(o);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return o;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var b=c.params;return u&&(b=b.filter(function(E){return!E.match(/^access_token=/)})),b.length&&(m+="?"+b.join("&")),m},Lr.prototype.canonicalizeTileset=function(o,u){for(var c=!!u&&jn(u),m=[],b=0,E=o.tiles||[];b<E.length;b+=1){var T=E[b];hn(T)?m.push(this.canonicalizeTileURL(T,c)):m.push(T)}return m},Lr.prototype._makeAPIURL=function(o,u){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Ei(Kr.API_URL);if(o.protocol=m.protocol,o.authority=m.authority,o.protocol==="http"){var b=o.params.indexOf("secure");b>=0&&o.params.splice(b,1)}if(m.path!=="/"&&(o.path=""+m.path+o.path),!Kr.REQUIRE_ACCESS_TOKEN)return ia(o);if(!(u=u||Kr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return o.params=o.params.filter(function(E){return E.indexOf("access_token")===-1}),o.params.push("access_token="+u),ia(o)};var jr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function hn(o){return jr.test(o)}var qi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ei(o){var u=o.match(qi);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function ia(o){var u=o.params.length?"?"+o.params.join("&"):"";return o.protocol+"://"+o.authority+o.path+u}function ta(o){if(!o)return null;var u=o.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(H.atob(u[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var Se=function(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Se.prototype.getStorageKey=function(o){var u,c=ta(Kr.ACCESS_TOKEN);return u=c&&c.u?H.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,b){return String.fromCharCode(+("0x"+b))})):Kr.ACCESS_TOKEN||"",o?"mapbox.eventData."+o+":"+u:"mapbox.eventData:"+u},Se.prototype.fetchEventData=function(){var o=Te("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{var m=H.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));var b=H.localStorage.getItem(c);b&&(this.anonId=b)}catch(E){Ve("Unable to read from LocalStorage")}},Se.prototype.saveEventData=function(){var o=Te("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{H.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&H.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(m){Ve("Unable to write to LocalStorage")}},Se.prototype.processRequests=function(o){},Se.prototype.postEvent=function(o,u,c,m){var b=this;if(Kr.EVENTS_URL){var E=Ei(Kr.EVENTS_URL);E.params.push("access_token="+(m||Kr.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:hi,userId:this.anonId},M=u?St(T,u):T,B={url:ia(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=xt(B,function(G){b.pendingRequest=null,c(G),b.saveEventData(),b.processRequests(m)})}},Se.prototype.queueRequest=function(o,u){this.queue.push(o),this.processRequests(u)};var Ni,aa,da=function(o){function u(){o.call(this,"map.load"),this.success={},this.skuToken=""}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(c,m,b,E){this.skuToken=b;var T=!(!E&&!Kr.ACCESS_TOKEN),M=Array.isArray(c)&&c.some(function(B){return jn(B)||hn(B)});Kr.EVENTS_URL&&T&&M&&this.queueRequest({id:m,timestamp:Date.now()},E)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var b=this.queue.shift(),E=b.id,T=b.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=ht()),this.postEvent(T,{skuToken:this.skuToken},function(M){M||E&&(m.success[E]=!0)},c))}},u}(Se),so=new(function(o){function u(c){o.call(this,"appUserTurnstile"),this._customAccessToken=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(c,m){Kr.EVENTS_URL&&Kr.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(b){return jn(b)||hn(b)})&&this.queueRequest(Date.now(),m)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var b=ta(Kr.ACCESS_TOKEN),E=b?b.u:Kr.ACCESS_TOKEN,T=E!==this.eventData.tokenU;it(this.anonId)||(this.anonId=ht(),T=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var B=new Date(this.eventData.lastSuccess),G=new Date(M),Q=(M-this.eventData.lastSuccess)/864e5;T=T||Q>=1||Q<-1||B.getDate()!==G.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(ee){ee||(m.eventData.lastSuccess=M,m.eventData.tokenU=E)},c)}},u}(Se)),po=so.postTurnstileEvent.bind(so),To=new da,Gt=To.postMapLoadEvent.bind(To),br=500,Gr=50;function rn(){H.caches&&!Ni&&(Ni=H.caches.open("mapbox-tiles"))}function yn(o){var u=o.indexOf("?");return u<0?o:o.slice(0,u)}var Ci,he=1/0;function L(){return Ci==null&&(Ci=H.OffscreenCanvas&&new H.OffscreenCanvas(1,1).getContext("2d")&&typeof H.createImageBitmap=="function"),Ci}var z={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(z);var fe=function(o){function u(c,m,b){m===401&&hn(b)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),o.call(this,c),this.status=m,this.url=b,this.name=this.constructor.name,this.message=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),Re=ie()?function(){return self.worker&&self.worker.referrer}:function(){return(H.location.protocol==="blob:"?H.parent:H).location.href},Ue,$t,Lt=function(o,u){if(!(/^file:/.test(c=o.url)||/^file:/.test(Re())&&!/^\w+:/.test(c))){if(H.fetch&&H.Request&&H.AbortController&&H.Request.prototype.hasOwnProperty("signal"))return function(m,b){var E,T=new H.AbortController,M=new H.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:Re(),signal:T.signal}),B=!1,G=!1,Q=(E=M.url).indexOf("sku=")>0&&hn(E);m.type==="json"&&M.headers.set("Accept","application/json");var ee=function(_e,Ge,Ye){if(!G){if(_e&&_e.message!=="SecurityError"&&Ve(_e),Ge&&Ye)return pe(Ge);var yt=Date.now();H.fetch(M).then(function(ot){if(ot.ok){var Dt=Q?ot.clone():null;return pe(ot,Dt,yt)}return b(new fe(ot.statusText,ot.status,m.url))}).catch(function(ot){ot.code!==20&&b(new Error(ot.message))})}},pe=function(_e,Ge,Ye){(m.type==="arrayBuffer"?_e.arrayBuffer():m.type==="json"?_e.json():_e.text()).then(function(yt){G||(Ge&&Ye&&function(ot,Dt,Ht){if(rn(),Ni){var ir={status:Dt.status,statusText:Dt.statusText,headers:new H.Headers};Dt.headers.forEach(function(xr,Wr){return ir.headers.set(Wr,xr)});var ur=j(Dt.headers.get("Cache-Control")||"");ur["no-store"]||(ur["max-age"]&&ir.headers.set("Expires",new Date(Ht+1e3*ur["max-age"]).toUTCString()),new Date(ir.headers.get("Expires")).getTime()-Ht<42e4||function(xr,Wr){if(aa===void 0)try{new Response(new ReadableStream),aa=!0}catch(on){aa=!1}aa?Wr(xr.body):xr.blob().then(Wr)}(Dt,function(xr){var Wr=new H.Response(xr,ir);rn(),Ni&&Ni.then(function(on){return on.put(yn(ot.url),Wr)}).catch(function(on){return Ve(on.message)})}))}}(M,Ge,Ye),B=!0,b(null,yt,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))}).catch(function(yt){G||b(new Error(yt.message))})};return Q?function(_e,Ge){if(rn(),!Ni)return Ge(null);var Ye=yn(_e.url);Ni.then(function(yt){yt.match(Ye).then(function(ot){var Dt=function(Ht){if(!Ht)return!1;var ir=new Date(Ht.headers.get("Expires")||0),ur=j(Ht.headers.get("Cache-Control")||"");return ir>Date.now()&&!ur["no-cache"]}(ot);yt.delete(Ye),Dt&&yt.put(Ye,ot.clone()),Ge(null,ot,Dt)}).catch(Ge)}).catch(Ge)}(M,ee):ee(null,null),{cancel:function(){G=!0,B||T.abort()}}}(o,u);if(ie()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,u,void 0,!0)}var c;return function(m,b){var E=new H.XMLHttpRequest;for(var T in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(T,m.headers[T]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){b(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var M=E.response;if(m.type==="json")try{M=JSON.parse(E.response)}catch(B){return b(B)}b(null,M,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else b(new fe(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(o,u)},Bt=function(o,u){return Lt(St(o,{type:"arrayBuffer"}),u)},xt=function(o,u){return Lt(St(o,{method:"POST"}),u)},U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ue=[],$t=0;var N=function(o,u){if(Ir.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),$t>=Kr.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:o,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ue.push(c),c}$t++;var m=!1,b=function(){if(!m)for(m=!0,$t--;Ue.length&&$t<Kr.MAX_PARALLEL_IMAGE_REQUESTS;){var T=Ue.shift();T.cancelled||(T.cancel=N(T.requestParameters,T.callback).cancel)}},E=Bt(o,function(T,M,B,G){b(),T?u(T):M&&(L()?function(Q,ee){var pe=new H.Blob([new Uint8Array(Q)],{type:"image/png"});H.createImageBitmap(pe).then(function(_e){ee(null,_e)}).catch(function(_e){ee(new Error("Could not load image because of "+_e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,u):function(Q,ee,pe,_e){var Ge=new H.Image,Ye=H.URL;Ge.onload=function(){ee(null,Ge),Ye.revokeObjectURL(Ge.src),Ge.onload=null,H.requestAnimationFrame(function(){Ge.src=U})},Ge.onerror=function(){return ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var yt=new H.Blob([new Uint8Array(Q)],{type:"image/png"});Ge.cacheControl=pe,Ge.expires=_e,Ge.src=Q.byteLength?Ye.createObjectURL(yt):U}(M,u,B,G))});return{cancel:function(){E.cancel(),b()}}};function q(o,u,c){c[o]&&c[o].indexOf(u)!==-1||(c[o]=c[o]||[],c[o].push(u))}function se(o,u,c){if(c&&c[o]){var m=c[o].indexOf(u);m!==-1&&c[o].splice(m,1)}}var Me=function(o,u){u===void 0&&(u={}),St(this,u),this.type=o},We=function(o){function u(c,m){m===void 0&&(m={}),o.call(this,"error",St({error:c},m))}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Me),ut=function(){};ut.prototype.on=function(o,u){return this._listeners=this._listeners||{},q(o,u,this._listeners),this},ut.prototype.off=function(o,u){return se(o,u,this._listeners),se(o,u,this._oneTimeListeners),this},ut.prototype.once=function(o,u){return this._oneTimeListeners=this._oneTimeListeners||{},q(o,u,this._oneTimeListeners),this},ut.prototype.fire=function(o,u){typeof o=="string"&&(o=new Me(o,u||{}));var c=o.type;if(this.listens(c)){o.target=this;for(var m=0,b=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<b.length;m+=1)b[m].call(this,o);for(var E=0,T=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];E<T.length;E+=1){var M=T[E];se(c,M,this._oneTimeListeners),M.call(this,o)}var B=this._eventedParent;B&&(St(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(o))}else o instanceof We&&console.error(o.error);return this},ut.prototype.listens=function(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)},ut.prototype.setEventedParent=function(o,u){return this._eventedParent=o,this._eventedParentData=u,this};var W={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ne=function(o,u,c,m){this.message=(o?o+": ":"")+c,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)};function je(o){var u=o.value;return u?[new ne(o.key,u,"constants have been deprecated as of v8")]:[]}function lt(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,b=u;m<b.length;m+=1){var E=b[m];for(var T in E)o[T]=E[T]}return o}function Ie(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Kt(o){if(Array.isArray(o))return o.map(Kt);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){var u={};for(var c in o)u[c]=Kt(o[c]);return u}return Ie(o)}var Er=function(o){function u(c,m){o.call(this,m),this.message=m,this.key=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Error),sn=function(o,u){u===void 0&&(u=[]),this.parent=o,this.bindings={};for(var c=0,m=u;c<m.length;c+=1){var b=m[c];this.bindings[b[0]]=b[1]}};sn.prototype.concat=function(o){return new sn(this,o)},sn.prototype.get=function(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(o+" not found in scope.")},sn.prototype.has=function(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)};var un={kind:"null"},nr={kind:"number"},Qr={kind:"string"},Hr={kind:"boolean"},$r={kind:"color"},oi={kind:"object"},pn={kind:"value"},mi={kind:"collator"},Gi={kind:"formatted"},di={kind:"resolvedImage"};function zi(o,u){return{kind:"array",itemType:o,N:u}}function Ri(o){if(o.kind==="array"){var u=Ri(o.itemType);return typeof o.N=="number"?"array<"+u+", "+o.N+">":o.itemType.kind==="value"?"array":"array<"+u+">"}return o.kind}var ss=[un,nr,Qr,Hr,$r,Gi,oi,zi(pn),di];function oa(o,u){if(u.kind==="error")return null;if(o.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!oa(o.itemType,u.itemType))&&(typeof o.N!="number"||o.N===u.N))return null}else{if(o.kind===u.kind)return null;if(o.kind==="value"){for(var c=0,m=ss;c<m.length;c+=1)if(!oa(m[c],u))return null}}return"Expected "+Ri(o)+" but found "+Ri(u)+" instead."}function La(o,u){return u.some(function(c){return c.kind===o.kind})}function Mi(o,u){return u.some(function(c){return c==="null"?o===null:c==="array"?Array.isArray(o):c==="object"?o&&!Array.isArray(o)&&typeof o=="object":c===typeof o})}var yi=le(function(o,u){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function b(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function E(M){return(B=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:B>1?1:B;var B}function T(M,B,G){return G<0?G+=1:G>1&&(G-=1),6*G<1?M+(B-M)*G*6:2*G<1?B:3*G<2?M+(B-M)*(2/3-G)*6:M}try{u.parseCSSColor=function(M){var B,G=M.replace(/ /g,"").toLowerCase();if(G in c)return c[G].slice();if(G[0]==="#")return G.length===4?(B=parseInt(G.substr(1),16))>=0&&B<=4095?[(3840&B)>>4|(3840&B)>>8,240&B|(240&B)>>4,15&B|(15&B)<<4,1]:null:G.length===7&&(B=parseInt(G.substr(1),16))>=0&&B<=16777215?[(16711680&B)>>16,(65280&B)>>8,255&B,1]:null;var Q=G.indexOf("("),ee=G.indexOf(")");if(Q!==-1&&ee+1===G.length){var pe=G.substr(0,Q),_e=G.substr(Q+1,ee-(Q+1)).split(","),Ge=1;switch(pe){case"rgba":if(_e.length!==4)return null;Ge=E(_e.pop());case"rgb":return _e.length!==3?null:[b(_e[0]),b(_e[1]),b(_e[2]),Ge];case"hsla":if(_e.length!==4)return null;Ge=E(_e.pop());case"hsl":if(_e.length!==3)return null;var Ye=(parseFloat(_e[0])%360+360)%360/360,yt=E(_e[1]),ot=E(_e[2]),Dt=ot<=.5?ot*(yt+1):ot+yt-ot*yt,Ht=2*ot-Dt;return[m(255*T(Ht,Dt,Ye+1/3)),m(255*T(Ht,Dt,Ye)),m(255*T(Ht,Dt,Ye-1/3)),Ge];default:return null}}return null}}catch(M){}}).parseCSSColor,Ii=function(o,u,c,m){m===void 0&&(m=1),this.r=o,this.g=u,this.b=c,this.a=m};Ii.parse=function(o){if(o){if(o instanceof Ii)return o;if(typeof o=="string"){var u=yi(o);if(u)return new Ii(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Ii.prototype.toString=function(){var o=this.toArray(),u=o[1],c=o[2],m=o[3];return"rgba("+Math.round(o[0])+","+Math.round(u)+","+Math.round(c)+","+m+")"},Ii.prototype.toArray=function(){var o=this.a;return o===0?[0,0,0,0]:[255*this.r/o,255*this.g/o,255*this.b/o,o]},Ii.black=new Ii(0,0,0,1),Ii.white=new Ii(1,1,1,1),Ii.transparent=new Ii(0,0,0,0),Ii.red=new Ii(1,0,0,1);var Ba=function(o,u,c){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ba.prototype.compare=function(o,u){return this.collator.compare(o,u)},Ba.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var vu=function(o,u,c,m,b){this.text=o,this.image=u,this.scale=c,this.fontStack=m,this.textColor=b},_a=function(o){this.sections=o};_a.fromString=function(o){return new _a([new vu(o,null,null,null,null)])},_a.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(o){return o.text.length!==0||o.image&&o.image.name.length!==0})},_a.factory=function(o){return o instanceof _a?o:_a.fromString(o)},_a.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(o){return o.text}).join("")},_a.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];if(m.image)o.push(["image",m.image.name]);else{o.push(m.text);var b={};m.fontStack&&(b["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(b["font-scale"]=m.scale),m.textColor&&(b["text-color"]=["rgba"].concat(m.textColor.toArray())),o.push(b)}}return o};var Ia=function(o){this.name=o.name,this.available=o.available};function Hl(o,u,c,m){return typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[o,u,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[o,u,c,m]:[o,u,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ho(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ii||o instanceof Ba||o instanceof _a||o instanceof Ia)return!0;if(Array.isArray(o)){for(var u=0,c=o;u<c.length;u+=1)if(!Ho(c[u]))return!1;return!0}if(typeof o=="object"){for(var m in o)if(!Ho(o[m]))return!1;return!0}return!1}function Pa(o){if(o===null)return un;if(typeof o=="string")return Qr;if(typeof o=="boolean")return Hr;if(typeof o=="number")return nr;if(o instanceof Ii)return $r;if(o instanceof Ba)return mi;if(o instanceof _a)return Gi;if(o instanceof Ia)return di;if(Array.isArray(o)){for(var u,c=o.length,m=0,b=o;m<b.length;m+=1){var E=Pa(b[m]);if(u){if(u===E)continue;u=pn;break}u=E}return zi(u||pn,c)}return oi}function bi(o){var u=typeof o;return o===null?"":u==="string"||u==="number"||u==="boolean"?String(o):o instanceof Ii||o instanceof _a||o instanceof Ia?o.toString():JSON.stringify(o)}Ia.prototype.toString=function(){return this.name},Ia.fromString=function(o){return o?new Ia({name:o,available:!1}):null},Ia.prototype.serialize=function(){return["image",this.name]};var Fa=function(o,u){this.type=o,this.value=u};Fa.parse=function(o,u){if(o.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(!Ho(o[1]))return u.error("invalid value");var c=o[1],m=Pa(c),b=u.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new Fa(m,c)},Fa.prototype.evaluate=function(){return this.value},Fa.prototype.eachChild=function(){},Fa.prototype.outputDefined=function(){return!0},Fa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ii?["rgba"].concat(this.value.toArray()):this.value instanceof _a?this.value.serialize():this.value};var ca=function(o){this.name="ExpressionEvaluationError",this.message=o};ca.prototype.toJSON=function(){return this.message};var Wo={string:Qr,number:nr,boolean:Hr,object:oi},ma=function(o,u){this.type=o,this.args=u};ma.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c,m=1,b=o[0];if(b==="array"){var E,T;if(o.length>2){var M=o[1];if(typeof M!="string"||!(M in Wo)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Wo[M],m++}else E=pn;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}c=zi(E,T)}else c=Wo[b];for(var B=[];m<o.length;m++){var G=u.parse(o[m],m,pn);if(!G)return null;B.push(G)}return new ma(c,B)},ma.prototype.evaluate=function(o){for(var u=0;u<this.args.length;u++){var c=this.args[u].evaluate(o);if(!oa(this.type,Pa(c)))return c;if(u===this.args.length-1)throw new ca("Expected value to be of type "+Ri(this.type)+", but found "+Ri(Pa(c))+" instead.")}return null},ma.prototype.eachChild=function(o){this.args.forEach(o)},ma.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},ma.prototype.serialize=function(){var o=this.type,u=[o.kind];if(o.kind==="array"){var c=o.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){u.push(c.kind);var m=o.N;(typeof m=="number"||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(function(b){return b.serialize()}))};var us=function(o){this.type=Gi,this.sections=o};us.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[1];if(!Array.isArray(c)&&typeof c=="object")return u.error("First argument must be an image or text section.");for(var m=[],b=!1,E=1;E<=o.length-1;++E){var T=o[E];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;var M=null;if(T["font-scale"]&&!(M=u.parse(T["font-scale"],1,nr)))return null;var B=null;if(T["text-font"]&&!(B=u.parse(T["text-font"],1,zi(Qr))))return null;var G=null;if(T["text-color"]&&!(G=u.parse(T["text-color"],1,$r)))return null;var Q=m[m.length-1];Q.scale=M,Q.font=B,Q.textColor=G}else{var ee=u.parse(o[E],1,pn);if(!ee)return null;var pe=ee.type.kind;if(pe!=="string"&&pe!=="value"&&pe!=="null"&&pe!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:ee,scale:null,font:null,textColor:null})}}return new us(m)},us.prototype.evaluate=function(o){return new _a(this.sections.map(function(u){var c=u.content.evaluate(o);return Pa(c)===di?new vu("",c,null,null,null):new vu(bi(c),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))},us.prototype.eachChild=function(o){for(var u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o(m.content),m.scale&&o(m.scale),m.font&&o(m.font),m.textColor&&o(m.textColor)}},us.prototype.outputDefined=function(){return!1},us.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o.push(m.content.serialize());var b={};m.scale&&(b["font-scale"]=m.scale.serialize()),m.font&&(b["text-font"]=m.font.serialize()),m.textColor&&(b["text-color"]=m.textColor.serialize()),o.push(b)}return o};var Qo=function(o){this.type=di,this.input=o};Qo.parse=function(o,u){if(o.length!==2)return u.error("Expected two arguments.");var c=u.parse(o[1],1,Qr);return c?new Qo(c):u.error("No image name provided.")},Qo.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=Ia.fromString(u);return c&&o.availableImages&&(c.available=o.availableImages.indexOf(u)>-1),c},Qo.prototype.eachChild=function(o){o(this.input)},Qo.prototype.outputDefined=function(){return!1},Qo.prototype.serialize=function(){return["image",this.input.serialize()]};var Bu={"to-boolean":Hr,"to-color":$r,"to-number":nr,"to-string":Qr},gs=function(o,u){this.type=o,this.args=u};gs.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[0];if((c==="to-boolean"||c==="to-string")&&o.length!==2)return u.error("Expected one argument.");for(var m=Bu[c],b=[],E=1;E<o.length;E++){var T=u.parse(o[E],E,pn);if(!T)return null;b.push(T)}return new gs(m,b)},gs.prototype.evaluate=function(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){for(var u,c,m=0,b=this.args;m<b.length;m+=1){if(c=null,(u=b[m].evaluate(o))instanceof Ii)return u;if(typeof u=="string"){var E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(c=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Hl(u[0],u[1],u[2],u[3])))return new Ii(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ca(c||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var T=null,M=0,B=this.args;M<B.length;M+=1){if((T=B[M].evaluate(o))===null)return 0;var G=Number(T);if(!isNaN(G))return G}throw new ca("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?_a.fromString(bi(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Ia.fromString(bi(this.args[0].evaluate(o))):bi(this.args[0].evaluate(o))},gs.prototype.eachChild=function(o){this.args.forEach(o)},gs.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},gs.prototype.serialize=function(){if(this.type.kind==="formatted")return new us([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Qo(this.args[0]).serialize();var o=["to-"+this.type.kind];return this.eachChild(function(u){o.push(u.serialize())}),o};var xc=["Unknown","Point","LineString","Polygon"],Ra=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ra.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ra.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?xc[this.feature.type]:this.feature.type:null},Ra.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ra.prototype.canonicalID=function(){return this.canonical},Ra.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ra.prototype.parseColor=function(o){var u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Ii.parse(o)),u};var sa=function(o,u,c,m){this.name=o,this.type=u,this._evaluate=c,this.args=m};sa.prototype.evaluate=function(o){return this._evaluate(o,this.args)},sa.prototype.eachChild=function(o){this.args.forEach(o)},sa.prototype.outputDefined=function(){return!1},sa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(o){return o.serialize()}))},sa.parse=function(o,u){var c,m=o[0],b=sa.definitions[m];if(!b)return u.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,M=T.filter(function(Gn){var An=Gn[0];return!Array.isArray(An)||An.length===o.length-1}),B=null,G=0,Q=M;G<Q.length;G+=1){var ee=Q[G],pe=ee[0],_e=ee[1];B=new el(u.registry,u.path,null,u.scope);for(var Ge=[],Ye=!1,yt=1;yt<o.length;yt++){var ot=o[yt],Dt=Array.isArray(pe)?pe[yt-1]:pe.type,Ht=B.parse(ot,1+Ge.length,Dt);if(!Ht){Ye=!0;break}Ge.push(Ht)}if(!Ye)if(Array.isArray(pe)&&pe.length!==Ge.length)B.error("Expected "+pe.length+" arguments, but found "+Ge.length+" instead.");else{for(var ir=0;ir<Ge.length;ir++){var ur=Array.isArray(pe)?pe[ir]:pe.type,xr=Ge[ir];B.concat(ir+1).checkSubtype(ur,xr.type)}if(B.errors.length===0)return new sa(m,E,_e,Ge)}}if(M.length===1)(c=u.errors).push.apply(c,B.errors);else{for(var Wr=(M.length?M:T).map(function(Gn){var An;return An=Gn[0],Array.isArray(An)?"("+An.map(Ri).join(", ")+")":"("+Ri(An.type)+"...)"}).join(" | "),on=[],Dn=1;Dn<o.length;Dn++){var Sn=u.parse(o[Dn],1+on.length);if(!Sn)return null;on.push(Ri(Sn.type))}u.error("Expected arguments of type "+Wr+", but found ("+on.join(", ")+") instead.")}return null},sa.register=function(o,u){for(var c in sa.definitions=u,u)o[c]=sa};var er=function(o,u,c){this.type=mi,this.locale=c,this.caseSensitive=o,this.diacriticSensitive=u};function Rn(o,u){o[0]=Math.min(o[0],u[0]),o[1]=Math.min(o[1],u[1]),o[2]=Math.max(o[2],u[0]),o[3]=Math.max(o[3],u[1])}function Ee(o,u){return!(o[0]<=u[0]||o[2]>=u[2]||o[1]<=u[1]||o[3]>=u[3])}function Ne(o,u){var c=(180+o[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,b=Math.pow(2,u.z);return[Math.round(c*b*8192),Math.round(m*b*8192)]}function Tt(o,u,c){return u[1]>o[1]!=c[1]>o[1]&&o[0]<(c[0]-u[0])*(o[1]-u[1])/(c[1]-u[1])+u[0]}function fr(o,u){for(var c,m,b,E,T,M,B,G=!1,Q=0,ee=u.length;Q<ee;Q++)for(var pe=u[Q],_e=0,Ge=pe.length;_e<Ge-1;_e++){if((E=(c=o)[0]-(m=pe[_e])[0])*(B=c[1]-(b=pe[_e+1])[1])-(M=c[0]-b[0])*(T=c[1]-m[1])==0&&E*M<=0&&T*B<=0)return!1;Tt(o,pe[_e],pe[_e+1])&&(G=!G)}return G}function tn(o,u){for(var c=0;c<u.length;c++)if(fr(o,u[c]))return!0;return!1}function Bn(o,u,c,m){var b=m[0]-c[0],E=m[1]-c[1],T=(o[0]-c[0])*E-b*(o[1]-c[1]),M=(u[0]-c[0])*E-b*(u[1]-c[1]);return T>0&&M<0||T<0&&M>0}function Xi(o,u,c){for(var m=0,b=c;m<b.length;m+=1)for(var E=b[m],T=0;T<E.length-1;++T)if((ee=[(Q=E[T+1])[0]-(G=E[T])[0],Q[1]-G[1]])[0]*(pe=[(B=u)[0]-(M=o)[0],B[1]-M[1]])[1]-ee[1]*pe[0]!=0&&Bn(M,B,G,Q)&&Bn(G,Q,M,B))return!0;var M,B,G,Q,ee,pe;return!1}function yo(o,u){for(var c=0;c<o.length;++c)if(!fr(o[c],u))return!1;for(var m=0;m<o.length-1;++m)if(Xi(o[m],o[m+1],u))return!1;return!0}function wo(o,u){for(var c=0;c<u.length;c++)if(yo(o,u[c]))return!0;return!1}function vo(o,u,c){for(var m=[],b=0;b<o.length;b++){for(var E=[],T=0;T<o[b].length;T++){var M=Ne(o[b][T],c);Rn(u,M),E.push(M)}m.push(E)}return m}function Bs(o,u,c){for(var m=[],b=0;b<o.length;b++){var E=vo(o[b],u,c);m.push(E)}return m}function Rs(o,u,c,m){if(o[0]<c[0]||o[0]>c[2]){var b=.5*m,E=o[0]-c[0]>b?-m:c[0]-o[0]>b?m:0;E===0&&(E=o[0]-c[2]>b?-m:c[2]-o[0]>b?m:0),o[0]+=E}Rn(u,o)}function ep(o,u,c,m){for(var b=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],T=[],M=0,B=o;M<B.length;M+=1)for(var G=0,Q=B[M];G<Q.length;G+=1){var ee=Q[G],pe=[ee.x+E[0],ee.y+E[1]];Rs(pe,u,c,b),T.push(pe)}return T}function Sf(o,u,c,m){for(var b,E=8192*Math.pow(2,m.z),T=[8192*m.x,8192*m.y],M=[],B=0,G=o;B<G.length;B+=1){for(var Q=[],ee=0,pe=G[B];ee<pe.length;ee+=1){var _e=pe[ee],Ge=[_e.x+T[0],_e.y+T[1]];Rn(u,Ge),Q.push(Ge)}M.push(Q)}if(u[2]-u[0]<=E/2){(b=u)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(var Ye=0,yt=M;Ye<yt.length;Ye+=1)for(var ot=0,Dt=yt[Ye];ot<Dt.length;ot+=1)Rs(Dt[ot],u,c,E)}return M}er.parse=function(o,u){if(o.length!==2)return u.error("Expected one argument.");var c=o[1];if(typeof c!="object"||Array.isArray(c))return u.error("Collator options argument must be an object.");var m=u.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Hr);if(!m)return null;var b=u.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Hr);if(!b)return null;var E=null;return c.locale&&!(E=u.parse(c.locale,1,Qr))?null:new er(m,b,E)},er.prototype.evaluate=function(o){return new Ba(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)},er.prototype.eachChild=function(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)},er.prototype.outputDefined=function(){return!1},er.prototype.serialize=function(){var o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]};var Jo=function(o,u){this.type=Hr,this.geojson=o,this.geometries=u};function Tl(o){if(o instanceof sa&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Jo)return!1;var u=!0;return o.eachChild(function(c){u&&!Tl(c)&&(u=!1)}),u}function wl(o){if(o instanceof sa&&o.name==="feature-state")return!1;var u=!0;return o.eachChild(function(c){u&&!wl(c)&&(u=!1)}),u}function Fu(o,u){if(o instanceof sa&&u.indexOf(o.name)>=0)return!1;var c=!0;return o.eachChild(function(m){c&&!Fu(m,u)&&(c=!1)}),c}Jo.parse=function(o,u){if(o.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(Ho(o[1])){var c=o[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var b=c.features[m].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Jo(c,c.features[m].geometry)}else if(c.type==="Feature"){var E=c.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Jo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Jo(c,c)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Jo.prototype.evaluate=function(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var T=vo(c.coordinates,b,E),M=ep(u.geometry(),m,b,E);if(!Ee(m,b))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!fr(G[B],T))return!1}if(c.type==="MultiPolygon"){var Q=Bs(c.coordinates,b,E),ee=ep(u.geometry(),m,b,E);if(!Ee(m,b))return!1;for(var pe=0,_e=ee;pe<_e.length;pe+=1)if(!tn(_e[pe],Q))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var T=vo(c.coordinates,b,E),M=Sf(u.geometry(),m,b,E);if(!Ee(m,b))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!yo(G[B],T))return!1}if(c.type==="MultiPolygon"){var Q=Bs(c.coordinates,b,E),ee=Sf(u.geometry(),m,b,E);if(!Ee(m,b))return!1;for(var pe=0,_e=ee;pe<_e.length;pe+=1)if(!wo(_e[pe],Q))return!1}return!0}(o,this.geometries)}return!1},Jo.prototype.eachChild=function(){},Jo.prototype.outputDefined=function(){return!0},Jo.prototype.serialize=function(){return["within",this.geojson]};var Nu=function(o,u){this.type=u.type,this.name=o,this.boundExpression=u};Nu.parse=function(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var c=o[1];return u.scope.has(c)?new Nu(c,u.scope.get(c)):u.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},Nu.prototype.evaluate=function(o){return this.boundExpression.evaluate(o)},Nu.prototype.eachChild=function(){},Nu.prototype.outputDefined=function(){return!1},Nu.prototype.serialize=function(){return["var",this.name]};var el=function(o,u,c,m,b){u===void 0&&(u=[]),m===void 0&&(m=new sn),b===void 0&&(b=[]),this.registry=o,this.path=u,this.key=u.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=b,this.expectedType=c};function qc(o,u){for(var c,m=o.length-1,b=0,E=m,T=0;b<=E;)if((c=o[T=Math.floor((b+E)/2)])<=u){if(T===m||u<o[T+1])return T;b=T+1}else{if(!(c>u))throw new ca("Input is not a number.");E=T-1}return 0}el.prototype.parse=function(o,u,c,m,b){return b===void 0&&(b={}),u?this.concat(u,c,m)._parse(o,b):this._parse(o,b)},el.prototype._parse=function(o,u){function c(G,Q,ee){return ee==="assert"?new ma(Q,[G]):ee==="coerce"?new gs(Q,[G]):G}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=o[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var b=this.registry[m];if(b){var E=b.parse(o,this);if(!E)return null;if(this.expectedType){var T=this.expectedType,M=E.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(T,M))return null}else E=c(E,T,u.typeAnnotation||"coerce");else E=c(E,T,u.typeAnnotation||"assert")}if(!(E instanceof Fa)&&E.type.kind!=="resolvedImage"&&function G(Q){if(Q instanceof Nu)return G(Q.boundExpression);if(Q instanceof sa&&Q.name==="error"||Q instanceof er||Q instanceof Jo)return!1;var ee=Q instanceof gs||Q instanceof ma,pe=!0;return Q.eachChild(function(_e){pe=ee?pe&&G(_e):pe&&_e instanceof Fa}),!!pe&&Tl(Q)&&Fu(Q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var B=new Ra;try{E=new Fa(E.type,E.evaluate(B))}catch(G){return this.error(G.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof o+" instead.")},el.prototype.concat=function(o,u,c){var m=typeof o=="number"?this.path.concat(o):this.path,b=c?this.scope.concat(c):this.scope;return new el(this.registry,m,u||null,b,this.errors)},el.prototype.error=function(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];var m=""+this.key+u.map(function(b){return"["+b+"]"}).join("");this.errors.push(new Er(m,o))},el.prototype.checkSubtype=function(o,u){var c=oa(o,u);return c&&this.error(c),c};var Fs=function(o,u,c){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(var m=0,b=c;m<b.length;m+=1){var E=b[m],T=E[1];this.labels.push(E[0]),this.outputs.push(T)}};function ro(o,u,c){return o*(1-c)+u*c}Fs.parse=function(o,u){if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");var c=u.parse(o[1],1,nr);if(!c)return null;var m=[],b=null;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);for(var E=1;E<o.length;E+=2){var T=E===1?-1/0:o[E],M=o[E+1],B=E,G=E+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(m.length&&m[m.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);var Q=u.parse(M,G,b);if(!Q)return null;b=b||Q.type,m.push([T,Q])}return new Fs(b,c,m)},Fs.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var b=u.length;return m>=u[b-1]?c[b-1].evaluate(o):c[qc(u,m)].evaluate(o)},Fs.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},Fs.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Fs.prototype.serialize=function(){for(var o=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o};var Cl=Object.freeze({__proto__:null,number:ro,color:function(o,u,c){return new Ii(ro(o.r,u.r,c),ro(o.g,u.g,c),ro(o.b,u.b,c),ro(o.a,u.a,c))},array:function(o,u,c){return o.map(function(m,b){return ro(m,u[b],c)})}}),tl=6/29*3*(6/29),Af=Math.PI/180,tp=180/Math.PI;function Tf(o){return o>.008856451679035631?Math.pow(o,1/3):o/tl+4/29}function dh(o){return o>6/29?o*o*o:tl*(o-4/29)}function vh(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function mh(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function rp(o){var u=mh(o.r),c=mh(o.g),m=mh(o.b),b=Tf((.4124564*u+.3575761*c+.1804375*m)/.95047),E=Tf((.2126729*u+.7151522*c+.072175*m)/1);return{l:116*E-16,a:500*(b-E),b:200*(E-Tf((.0193339*u+.119192*c+.9503041*m)/1.08883)),alpha:o.a}}function np(o){var u=(o.l+16)/116,c=isNaN(o.a)?u:u+o.a/500,m=isNaN(o.b)?u:u-o.b/200;return u=1*dh(u),c=.95047*dh(c),m=1.08883*dh(m),new Ii(vh(3.2404542*c-1.5371385*u-.4985314*m),vh(-.969266*c+1.8760108*u+.041556*m),vh(.0556434*c-.2040259*u+1.0572252*m),o.alpha)}function Gp(o,u,c){var m=u-o;return o+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var Kc={forward:rp,reverse:np,interpolate:function(o,u,c){return{l:ro(o.l,u.l,c),a:ro(o.a,u.a,c),b:ro(o.b,u.b,c),alpha:ro(o.alpha,u.alpha,c)}}},Uu={forward:function(o){var u=rp(o),c=u.l,m=u.a,b=u.b,E=Math.atan2(b,m)*tp;return{h:E<0?E+360:E,c:Math.sqrt(m*m+b*b),l:c,alpha:o.a}},reverse:function(o){var u=o.h*Af,c=o.c;return np({l:o.l,a:Math.cos(u)*c,b:Math.sin(u)*c,alpha:o.alpha})},interpolate:function(o,u,c){return{h:Gp(o.h,u.h,c),c:ro(o.c,u.c,c),l:ro(o.l,u.l,c),alpha:ro(o.alpha,u.alpha,c)}}},ip=Object.freeze({__proto__:null,lab:Kc,hcl:Uu}),es=function(o,u,c,m,b){this.type=o,this.operator=u,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var E=0,T=b;E<T.length;E+=1){var M=T[E],B=M[1];this.labels.push(M[0]),this.outputs.push(B)}};function Wl(o,u,c,m){var b=m-c,E=o-c;return b===0?0:u===1?E/b:(Math.pow(u,E)-1)/(Math.pow(u,b)-1)}es.interpolationFactor=function(o,u,c,m){var b=0;if(o.name==="exponential")b=Wl(u,o.base,c,m);else if(o.name==="linear")b=Wl(u,1,c,m);else if(o.name==="cubic-bezier"){var E=o.controlPoints;b=new P(E[0],E[1],E[2],E[3]).solve(Wl(u,1,c,m))}return b},es.parse=function(o,u){var c=o[0],m=o[1],b=o[2],E=o.slice(3);if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var T=m[1];if(typeof T!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:T}}else{if(m[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(yt){return typeof yt!="number"||yt<0||yt>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(b=u.parse(b,2,nr)))return null;var B=[],G=null;c==="interpolate-hcl"||c==="interpolate-lab"?G=$r:u.expectedType&&u.expectedType.kind!=="value"&&(G=u.expectedType);for(var Q=0;Q<E.length;Q+=2){var ee=E[Q],pe=E[Q+1],_e=Q+3,Ge=Q+4;if(typeof ee!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(B.length&&B[B.length-1][0]>=ee)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var Ye=u.parse(pe,Ge,G);if(!Ye)return null;G=G||Ye.type,B.push([ee,Ye])}return G.kind==="number"||G.kind==="color"||G.kind==="array"&&G.itemType.kind==="number"&&typeof G.N=="number"?new es(G,c,m,b,B):u.error("Type "+Ri(G)+" is not interpolatable.")},es.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var b=u.length;if(m>=u[b-1])return c[b-1].evaluate(o);var E=qc(u,m),T=es.interpolationFactor(this.interpolation,m,u[E],u[E+1]),M=c[E].evaluate(o),B=c[E+1].evaluate(o);return this.operator==="interpolate"?Cl[this.type.kind.toLowerCase()](M,B,T):this.operator==="interpolate-hcl"?Uu.reverse(Uu.interpolate(Uu.forward(M),Uu.forward(B),T)):Kc.reverse(Kc.interpolate(Kc.forward(M),Kc.forward(B),T))},es.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},es.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},es.prototype.serialize=function(){var o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,o,this.input.serialize()],c=0;c<this.labels.length;c++)u.push(this.labels[c],this.outputs[c].serialize());return u};var Rl=function(o,u){this.type=o,this.args=u};Rl.parse=function(o,u){if(o.length<2)return u.error("Expectected at least one argument.");var c=null,m=u.expectedType;m&&m.kind!=="value"&&(c=m);for(var b=[],E=0,T=o.slice(1);E<T.length;E+=1){var M=u.parse(T[E],1+b.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,b.push(M)}var B=m&&b.some(function(G){return oa(m,G.type)});return new Rl(B?pn:c,b)},Rl.prototype.evaluate=function(o){for(var u,c=null,m=0,b=0,E=this.args;b<E.length&&(m++,(c=E[b].evaluate(o))&&c instanceof Ia&&!c.available&&(u||(u=c.name),c=null,m===this.args.length&&(c=u)),c===null);b+=1);return c},Rl.prototype.eachChild=function(o){this.args.forEach(o)},Rl.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},Rl.prototype.serialize=function(){var o=["coalesce"];return this.eachChild(function(u){o.push(u.serialize())}),o};var Ks=function(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u};Ks.prototype.evaluate=function(o){return this.result.evaluate(o)},Ks.prototype.eachChild=function(o){for(var u=0,c=this.bindings;u<c.length;u+=1)o(c[u][1]);o(this.result)},Ks.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found "+(o.length-1)+" instead.");for(var c=[],m=1;m<o.length-1;m+=2){var b=o[m];if(typeof b!="string")return u.error("Expected string, but found "+typeof b+" instead.",m);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=u.parse(o[m+1],m+1);if(!E)return null;c.push([b,E])}var T=u.parse(o[o.length-1],o.length-1,u.expectedType,c);return T?new Ks(c,T):null},Ks.prototype.outputDefined=function(){return this.result.outputDefined()},Ks.prototype.serialize=function(){for(var o=["let"],u=0,c=this.bindings;u<c.length;u+=1){var m=c[u];o.push(m[0],m[1].serialize())}return o.push(this.result.serialize()),o};var Ml=function(o,u,c){this.type=o,this.index=u,this.input=c};Ml.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,nr),m=u.parse(o[2],2,zi(u.expectedType||pn));return c&&m?new Ml(m.type.itemType,c,m):null},Ml.prototype.evaluate=function(o){var u=this.index.evaluate(o),c=this.input.evaluate(o);if(u<0)throw new ca("Array index out of bounds: "+u+" < 0.");if(u>=c.length)throw new ca("Array index out of bounds: "+u+" > "+(c.length-1)+".");if(u!==Math.floor(u))throw new ca("Array index must be an integer, but found "+u+" instead.");return c[u]},Ml.prototype.eachChild=function(o){o(this.index),o(this.input)},Ml.prototype.outputDefined=function(){return!1},Ml.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var pi=function(o,u){this.type=Hr,this.needle=o,this.haystack=u};pi.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,pn),m=u.parse(o[2],2,pn);return c&&m?La(c.type,[Hr,Qr,nr,un,pn])?new pi(c,m):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(c.type)+" instead"):null},pi.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!c)return!1;if(!Mi(u,["boolean","string","number","null"]))throw new ca("Expected first argument to be of type boolean, string, number or null, but found "+Ri(Pa(u))+" instead.");if(!Mi(c,["string","array"]))throw new ca("Expected second argument to be of type array or string, but found "+Ri(Pa(c))+" instead.");return c.indexOf(u)>=0},pi.prototype.eachChild=function(o){o(this.needle),o(this.haystack)},pi.prototype.outputDefined=function(){return!0},pi.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var rl=function(o,u,c){this.type=nr,this.needle=o,this.haystack=u,this.fromIndex=c};rl.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,pn),m=u.parse(o[2],2,pn);if(!c||!m)return null;if(!La(c.type,[Hr,Qr,nr,un,pn]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(c.type)+" instead");if(o.length===4){var b=u.parse(o[3],3,nr);return b?new rl(c,m,b):null}return new rl(c,m)},rl.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!Mi(u,["boolean","string","number","null"]))throw new ca("Expected first argument to be of type boolean, string, number or null, but found "+Ri(Pa(u))+" instead.");if(!Mi(c,["string","array"]))throw new ca("Expected second argument to be of type array or string, but found "+Ri(Pa(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(o);return c.indexOf(u,m)}return c.indexOf(u)},rl.prototype.eachChild=function(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)},rl.prototype.outputDefined=function(){return!1},rl.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ns=function(o,u,c,m,b,E){this.inputType=o,this.type=u,this.input=c,this.cases=m,this.outputs=b,this.otherwise=E};Ns.parse=function(o,u){if(o.length<5)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if(o.length%2!=1)return u.error("Expected an even number of arguments.");var c,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(var b={},E=[],T=2;T<o.length-1;T+=2){var M=o[T],B=o[T+1];Array.isArray(M)||(M=[M]);var G=u.concat(T);if(M.length===0)return G.error("Expected at least one branch label.");for(var Q=0,ee=M;Q<ee.length;Q+=1){var pe=ee[Q];if(typeof pe!="number"&&typeof pe!="string")return G.error("Branch labels must be numbers or strings.");if(typeof pe=="number"&&Math.abs(pe)>Number.MAX_SAFE_INTEGER)return G.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof pe=="number"&&Math.floor(pe)!==pe)return G.error("Numeric branch labels must be integer values.");if(c){if(G.checkSubtype(c,Pa(pe)))return null}else c=Pa(pe);if(b[String(pe)]!==void 0)return G.error("Branch labels must be unique.");b[String(pe)]=E.length}var _e=u.parse(B,T,m);if(!_e)return null;m=m||_e.type,E.push(_e)}var Ge=u.parse(o[1],1,pn);if(!Ge)return null;var Ye=u.parse(o[o.length-1],o.length-1,m);return Ye?Ge.type.kind!=="value"&&u.concat(1).checkSubtype(c,Ge.type)?null:new Ns(c,m,Ge,b,E,Ye):null},Ns.prototype.evaluate=function(o){var u=this.input.evaluate(o);return(Pa(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)},Ns.prototype.eachChild=function(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)},Ns.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})&&this.otherwise.outputDefined()},Ns.prototype.serialize=function(){for(var o=this,u=["match",this.input.serialize()],c=[],m={},b=0,E=Object.keys(this.cases).sort();b<E.length;b+=1){var T=E[b];(ee=m[this.cases[T]])===void 0?(m[this.cases[T]]=c.length,c.push([this.cases[T],[T]])):c[ee][1].push(T)}for(var M=function(_e){return o.inputType.kind==="number"?Number(_e):_e},B=0,G=c;B<G.length;B+=1){var Q=G[B],ee=Q[0],pe=Q[1];u.push(pe.length===1?M(pe[0]):pe.map(M)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var zu=function(o,u,c){this.type=o,this.branches=u,this.otherwise=c};zu.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found only "+(o.length-1)+".");if(o.length%2!=0)return u.error("Expected an odd number of arguments.");var c;u.expectedType&&u.expectedType.kind!=="value"&&(c=u.expectedType);for(var m=[],b=1;b<o.length-1;b+=2){var E=u.parse(o[b],b,Hr);if(!E)return null;var T=u.parse(o[b+1],b+1,c);if(!T)return null;m.push([E,T]),c=c||T.type}var M=u.parse(o[o.length-1],o.length-1,c);return M?new zu(c,m,M):null},zu.prototype.evaluate=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],b=m[1];if(m[0].evaluate(o))return b.evaluate(o)}return this.otherwise.evaluate(o)},zu.prototype.eachChild=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],b=m[1];o(m[0]),o(b)}o(this.otherwise)},zu.prototype.outputDefined=function(){return this.branches.every(function(o){return o[1].outputDefined()})&&this.otherwise.outputDefined()},zu.prototype.serialize=function(){var o=["case"];return this.eachChild(function(u){o.push(u.serialize())}),o};var nl=function(o,u,c,m){this.type=o,this.input=u,this.beginIndex=c,this.endIndex=m};function ap(o,u){return o==="=="||o==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function ra(o,u,c,m){return m.compare(u,c)===0}function ki(o,u,c){var m=o!=="=="&&o!=="!=";return function(){function b(E,T,M){this.type=Hr,this.lhs=E,this.rhs=T,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}return b.parse=function(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");var M=E[0],B=T.parse(E[1],1,pn);if(!B)return null;if(!ap(M,B.type))return T.concat(1).error('"'+M+`" comparisons are not supported for type '`+Ri(B.type)+"'.");var G=T.parse(E[2],2,pn);if(!G)return null;if(!ap(M,G.type))return T.concat(2).error('"'+M+`" comparisons are not supported for type '`+Ri(G.type)+"'.");if(B.type.kind!==G.type.kind&&B.type.kind!=="value"&&G.type.kind!=="value")return T.error("Cannot compare types '"+Ri(B.type)+"' and '"+Ri(G.type)+"'.");m&&(B.type.kind==="value"&&G.type.kind!=="value"?B=new ma(G.type,[B]):B.type.kind!=="value"&&G.type.kind==="value"&&(G=new ma(B.type,[G])));var Q=null;if(E.length===4){if(B.type.kind!=="string"&&G.type.kind!=="string"&&B.type.kind!=="value"&&G.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!(Q=T.parse(E[3],3,mi)))return null}return new b(B,G,Q)},b.prototype.evaluate=function(E){var T=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var B=Pa(T),G=Pa(M);if(B.kind!==G.kind||B.kind!=="string"&&B.kind!=="number")throw new ca('Expected arguments for "'+o+'" to be (string, string) or (number, number), but found ('+B.kind+", "+G.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var Q=Pa(T),ee=Pa(M);if(Q.kind!=="string"||ee.kind!=="string")return u(E,T,M)}return this.collator?c(E,T,M,this.collator.evaluate(E)):u(E,T,M)},b.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},b.prototype.outputDefined=function(){return!0},b.prototype.serialize=function(){var E=[o];return this.eachChild(function(T){E.push(T.serialize())}),E},b}()}nl.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,pn),m=u.parse(o[2],2,nr);if(!c||!m)return null;if(!La(c.type,[zi(pn),Qr,pn]))return u.error("Expected first argument to be of type array or string, but found "+Ri(c.type)+" instead");if(o.length===4){var b=u.parse(o[3],3,nr);return b?new nl(c.type,c,m,b):null}return new nl(c.type,c,m)},nl.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=this.beginIndex.evaluate(o);if(!Mi(u,["string","array"]))throw new ca("Expected first argument to be of type array or string, but found "+Ri(Pa(u))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(o);return u.slice(c,m)}return u.slice(c)},nl.prototype.eachChild=function(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)},nl.prototype.outputDefined=function(){return!1},nl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var au=ki("==",function(o,u,c){return u===c},ra),mu=ki("!=",function(o,u,c){return u!==c},function(o,u,c,m){return!ra(0,u,c,m)}),wf=ki("<",function(o,u,c){return u<c},function(o,u,c,m){return m.compare(u,c)<0}),$a=ki(">",function(o,u,c){return u>c},function(o,u,c,m){return m.compare(u,c)>0}),gh=ki("<=",function(o,u,c){return u<=c},function(o,u,c,m){return m.compare(u,c)<=0}),Cf=ki(">=",function(o,u,c){return u>=c},function(o,u,c,m){return m.compare(u,c)>=0}),Us=function(o,u,c,m,b){this.type=Qr,this.number=o,this.locale=u,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=b};Us.parse=function(o,u){if(o.length!==3)return u.error("Expected two arguments.");var c=u.parse(o[1],1,nr);if(!c)return null;var m=o[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");var b=null;if(m.locale&&!(b=u.parse(m.locale,1,Qr)))return null;var E=null;if(m.currency&&!(E=u.parse(m.currency,1,Qr)))return null;var T=null;if(m["min-fraction-digits"]&&!(T=u.parse(m["min-fraction-digits"],1,nr)))return null;var M=null;return m["max-fraction-digits"]&&!(M=u.parse(m["max-fraction-digits"],1,nr))?null:new Us(c,b,E,T,M)},Us.prototype.evaluate=function(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))},Us.prototype.eachChild=function(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)},Us.prototype.outputDefined=function(){return!1},Us.prototype.serialize=function(){var o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]};var il=function(o){this.type=nr,this.input=o};il.parse=function(o,u){if(o.length!==2)return u.error("Expected 1 argument, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Ri(c.type)+" instead."):new il(c):null},il.prototype.evaluate=function(o){var u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ca("Expected value to be of type string or array, but found "+Ri(Pa(u))+" instead.")},il.prototype.eachChild=function(o){o(this.input)},il.prototype.outputDefined=function(){return!1},il.prototype.serialize=function(){var o=["length"];return this.eachChild(function(u){o.push(u.serialize())}),o};var gu={"==":au,"!=":mu,">":$a,"<":wf,">=":Cf,"<=":gh,array:ma,at:Ml,boolean:ma,case:zu,coalesce:Rl,collator:er,format:us,image:Qo,in:pi,"index-of":rl,interpolate:es,"interpolate-hcl":es,"interpolate-lab":es,length:il,let:Ks,literal:Fa,match:Ns,number:ma,"number-format":Us,object:ma,slice:nl,step:Fs,string:ma,"to-boolean":gs,"to-color":gs,"to-number":gs,"to-string":gs,var:Nu,within:Jo};function Gl(o,u){var c=u[0],m=u[1],b=u[2],E=u[3];c=c.evaluate(o),m=m.evaluate(o),b=b.evaluate(o);var T=E?E.evaluate(o):1,M=Hl(c,m,b,T);if(M)throw new ca(M);return new Ii(c/255*T,m/255*T,b/255*T,T)}function yh(o,u){return o in u}function Ec(o,u){var c=u[o];return c===void 0?null:c}function va(o){return{type:o}}function Sc(o){return{result:"success",value:o}}function al(o){return{result:"error",value:o}}function Il(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function _h(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Qc(o){return!!o.expression&&o.expression.interpolated}function ba(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Pl(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function op(o){return o}function ol(o,u,c){return o!==void 0?o:u!==void 0?u:c!==void 0?c:void 0}function Jc(o,u,c,m,b){return ol(typeof c===b?m[c]:void 0,o.default,u.default)}function ef(o,u,c){if(ba(c)!=="number")return ol(o.default,u.default);var m=o.stops.length;if(m===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[m-1][0])return o.stops[m-1][1];var b=qc(o.stops.map(function(E){return E[0]}),c);return o.stops[b][1]}function Rf(o,u,c){var m=o.base!==void 0?o.base:1;if(ba(c)!=="number")return ol(o.default,u.default);var b=o.stops.length;if(b===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[b-1][0])return o.stops[b-1][1];var E=qc(o.stops.map(function(ee){return ee[0]}),c),T=function(ee,pe,_e,Ge){var Ye=Ge-_e,yt=ee-_e;return Ye===0?0:pe===1?yt/Ye:(Math.pow(pe,yt)-1)/(Math.pow(pe,Ye)-1)}(c,m,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],B=o.stops[E+1][1],G=Cl[u.type]||op;if(o.colorSpace&&o.colorSpace!=="rgb"){var Q=ip[o.colorSpace];G=function(ee,pe){return Q.reverse(Q.interpolate(Q.forward(ee),Q.forward(pe),T))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var ee=[],pe=arguments.length;pe--;)ee[pe]=arguments[pe];var _e=M.evaluate.apply(void 0,ee),Ge=B.evaluate.apply(void 0,ee);if(_e!==void 0&&Ge!==void 0)return G(_e,Ge,T)}}:G(M,B,T)}function sl(o,u,c){return u.type==="color"?c=Ii.parse(c):u.type==="formatted"?c=_a.fromString(c.toString()):u.type==="resolvedImage"?c=Ia.fromString(c.toString()):ba(c)===u.type||u.type==="enum"&&u.values[c]||(c=void 0),ol(c,o.default,u.default)}sa.register(gu,{error:[{kind:"error"},[Qr],function(o,u){throw new ca(u[0].evaluate(o))}],typeof:[Qr,[pn],function(o,u){return Ri(Pa(u[0].evaluate(o)))}],"to-rgba":[zi(nr,4),[$r],function(o,u){return u[0].evaluate(o).toArray()}],rgb:[$r,[nr,nr,nr],Gl],rgba:[$r,[nr,nr,nr,nr],Gl],has:{type:Hr,overloads:[[[Qr],function(o,u){return yh(u[0].evaluate(o),o.properties())}],[[Qr,oi],function(o,u){var c=u[1];return yh(u[0].evaluate(o),c.evaluate(o))}]]},get:{type:pn,overloads:[[[Qr],function(o,u){return Ec(u[0].evaluate(o),o.properties())}],[[Qr,oi],function(o,u){var c=u[1];return Ec(u[0].evaluate(o),c.evaluate(o))}]]},"feature-state":[pn,[Qr],function(o,u){return Ec(u[0].evaluate(o),o.featureState||{})}],properties:[oi,[],function(o){return o.properties()}],"geometry-type":[Qr,[],function(o){return o.geometryType()}],id:[pn,[],function(o){return o.id()}],zoom:[nr,[],function(o){return o.globals.zoom}],"heatmap-density":[nr,[],function(o){return o.globals.heatmapDensity||0}],"line-progress":[nr,[],function(o){return o.globals.lineProgress||0}],accumulated:[pn,[],function(o){return o.globals.accumulated===void 0?null:o.globals.accumulated}],"+":[nr,va(nr),function(o,u){for(var c=0,m=0,b=u;m<b.length;m+=1)c+=b[m].evaluate(o);return c}],"*":[nr,va(nr),function(o,u){for(var c=1,m=0,b=u;m<b.length;m+=1)c*=b[m].evaluate(o);return c}],"-":{type:nr,overloads:[[[nr,nr],function(o,u){var c=u[1];return u[0].evaluate(o)-c.evaluate(o)}],[[nr],function(o,u){return-u[0].evaluate(o)}]]},"/":[nr,[nr,nr],function(o,u){var c=u[1];return u[0].evaluate(o)/c.evaluate(o)}],"%":[nr,[nr,nr],function(o,u){var c=u[1];return u[0].evaluate(o)%c.evaluate(o)}],ln2:[nr,[],function(){return Math.LN2}],pi:[nr,[],function(){return Math.PI}],e:[nr,[],function(){return Math.E}],"^":[nr,[nr,nr],function(o,u){var c=u[1];return Math.pow(u[0].evaluate(o),c.evaluate(o))}],sqrt:[nr,[nr],function(o,u){return Math.sqrt(u[0].evaluate(o))}],log10:[nr,[nr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN10}],ln:[nr,[nr],function(o,u){return Math.log(u[0].evaluate(o))}],log2:[nr,[nr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN2}],sin:[nr,[nr],function(o,u){return Math.sin(u[0].evaluate(o))}],cos:[nr,[nr],function(o,u){return Math.cos(u[0].evaluate(o))}],tan:[nr,[nr],function(o,u){return Math.tan(u[0].evaluate(o))}],asin:[nr,[nr],function(o,u){return Math.asin(u[0].evaluate(o))}],acos:[nr,[nr],function(o,u){return Math.acos(u[0].evaluate(o))}],atan:[nr,[nr],function(o,u){return Math.atan(u[0].evaluate(o))}],min:[nr,va(nr),function(o,u){return Math.min.apply(Math,u.map(function(c){return c.evaluate(o)}))}],max:[nr,va(nr),function(o,u){return Math.max.apply(Math,u.map(function(c){return c.evaluate(o)}))}],abs:[nr,[nr],function(o,u){return Math.abs(u[0].evaluate(o))}],round:[nr,[nr],function(o,u){var c=u[0].evaluate(o);return c<0?-Math.round(-c):Math.round(c)}],floor:[nr,[nr],function(o,u){return Math.floor(u[0].evaluate(o))}],ceil:[nr,[nr],function(o,u){return Math.ceil(u[0].evaluate(o))}],"filter-==":[Hr,[Qr,pn],function(o,u){var c=u[0],m=u[1];return o.properties()[c.value]===m.value}],"filter-id-==":[Hr,[pn],function(o,u){var c=u[0];return o.id()===c.value}],"filter-type-==":[Hr,[Qr],function(o,u){var c=u[0];return o.geometryType()===c.value}],"filter-<":[Hr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b<E}],"filter-id-<":[Hr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m<b}],"filter->":[Hr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b>E}],"filter-id->":[Hr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m>b}],"filter-<=":[Hr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b<=E}],"filter-id-<=":[Hr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m<=b}],"filter->=":[Hr,[Qr,pn],function(o,u){var c=u[0],m=u[1],b=o.properties()[c.value],E=m.value;return typeof b==typeof E&&b>=E}],"filter-id->=":[Hr,[pn],function(o,u){var c=u[0],m=o.id(),b=c.value;return typeof m==typeof b&&m>=b}],"filter-has":[Hr,[pn],function(o,u){return u[0].value in o.properties()}],"filter-has-id":[Hr,[],function(o){return o.id()!==null&&o.id()!==void 0}],"filter-type-in":[Hr,[zi(Qr)],function(o,u){return u[0].value.indexOf(o.geometryType())>=0}],"filter-id-in":[Hr,[zi(pn)],function(o,u){return u[0].value.indexOf(o.id())>=0}],"filter-in-small":[Hr,[Qr,zi(pn)],function(o,u){var c=u[0];return u[1].value.indexOf(o.properties()[c.value])>=0}],"filter-in-large":[Hr,[Qr,zi(pn)],function(o,u){var c=u[0],m=u[1];return function(b,E,T,M){for(;T<=M;){var B=T+M>>1;if(E[B]===b)return!0;E[B]>b?M=B-1:T=B+1}return!1}(o.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:Hr,overloads:[[[Hr,Hr],function(o,u){var c=u[1];return u[0].evaluate(o)&&c.evaluate(o)}],[va(Hr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(!m[c].evaluate(o))return!1;return!0}]]},any:{type:Hr,overloads:[[[Hr,Hr],function(o,u){var c=u[1];return u[0].evaluate(o)||c.evaluate(o)}],[va(Hr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(m[c].evaluate(o))return!0;return!1}]]},"!":[Hr,[Hr],function(o,u){return!u[0].evaluate(o)}],"is-supported-script":[Hr,[Qr],function(o,u){var c=o.globals&&o.globals.isSupportedScript;return!c||c(u[0].evaluate(o))}],upcase:[Qr,[Qr],function(o,u){return u[0].evaluate(o).toUpperCase()}],downcase:[Qr,[Qr],function(o,u){return u[0].evaluate(o).toLowerCase()}],concat:[Qr,va(pn),function(o,u){return u.map(function(c){return bi(c.evaluate(o))}).join("")}],"resolved-locale":[Qr,[mi],function(o,u){return u[0].evaluate(o).resolvedLocale()}]});var Xl=function(o,u){this.expression=o,this._warningHistory={},this._evaluator=new Ra,this._defaultValue=u?function(c){return c.type==="color"&&Pl(c.default)?new Ii(0,0,0,0):c.type==="color"?Ii.parse(c.default)||null:c.default===void 0?null:c.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function Zu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in gu}function tf(o,u){var c=new el(gu,[],u?function(b){var E={color:$r,string:Qr,number:nr,enum:Qr,boolean:Hr,formatted:Gi,resolvedImage:di};return b.type==="array"?zi(E[b.value]||pn,b.length):E[b.type]}(u):void 0),m=c.parse(o,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Sc(new Xl(m,u)):al(c.errors)}Xl.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,b,E){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Xl.prototype.evaluate=function(o,u,c,m,b,E){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ca("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Ac=function(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!wl(u.expression)};Ac.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,b,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,b,E)},Ac.prototype.evaluate=function(o,u,c,m,b,E){return this._styleExpression.evaluate(o,u,c,m,b,E)};var $l=function(o,u,c,m){this.kind=o,this.zoomStops=c,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!wl(u.expression),this.interpolationType=m};function bh(o,u){if((o=tf(o,u)).result==="error")return o;var c=o.value.expression,m=Tl(c);if(!m&&!Il(u))return al([new Er("","data expressions not supported")]);var b=Fu(c,["zoom"]);if(!b&&!_h(u))return al([new Er("","zoom expressions not supported")]);var E=function T(M){var B=null;if(M instanceof Ks)B=T(M.result);else if(M instanceof Rl)for(var G=0,Q=M.args;G<Q.length&&!(B=T(Q[G]));G+=1);else(M instanceof Fs||M instanceof es)&&M.input instanceof sa&&M.input.name==="zoom"&&(B=M);return B instanceof Er||M.eachChild(function(ee){var pe=T(ee);pe instanceof Er?B=pe:!B&&pe?B=new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):B&&pe&&B!==pe&&(B=new Er("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),B}(c);return E||b?E instanceof Er?al([E]):E instanceof es&&!Qc(u)?al([new Er("",'"interpolate" expressions cannot be used with this property')]):Sc(E?new $l(m?"camera":"composite",o.value,E.labels,E instanceof es?E.interpolation:void 0):new Ac(m?"constant":"source",o.value)):al([new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}$l.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,b,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,b,E)},$l.prototype.evaluate=function(o,u,c,m,b,E){return this._styleExpression.evaluate(o,u,c,m,b,E)},$l.prototype.interpolationFactor=function(o,u,c){return this.interpolationType?es.interpolationFactor(this.interpolationType,o,u,c):0};var Tc=function(o,u){this._parameters=o,this._specification=u,lt(this,function c(m,b){var E,T,M,B=b.type==="color",G=m.stops&&typeof m.stops[0][0]=="object",Q=G||!(G||m.property!==void 0),ee=m.type||(Qc(b)?"exponential":"interval");if(B&&((m=lt({},m)).stops&&(m.stops=m.stops.map(function(Sn){return[Sn[0],Ii.parse(Sn[1])]})),m.default=Ii.parse(m.default?m.default:b.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!ip[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(ee==="exponential")E=Rf;else if(ee==="interval")E=ef;else if(ee==="categorical"){E=Jc,T=Object.create(null);for(var pe=0,_e=m.stops;pe<_e.length;pe+=1){var Ge=_e[pe];T[Ge[0]]=Ge[1]}M=typeof m.stops[0][0]}else{if(ee!=="identity")throw new Error('Unknown function type "'+ee+'"');E=sl}if(G){for(var Ye={},yt=[],ot=0;ot<m.stops.length;ot++){var Dt=m.stops[ot],Ht=Dt[0].zoom;Ye[Ht]===void 0&&(Ye[Ht]={zoom:Ht,type:m.type,property:m.property,default:m.default,stops:[]},yt.push(Ht)),Ye[Ht].stops.push([Dt[0].value,Dt[1]])}for(var ir=[],ur=0,xr=yt;ur<xr.length;ur+=1){var Wr=xr[ur];ir.push([Ye[Wr].zoom,c(Ye[Wr],b)])}var on={name:"linear"};return{kind:"composite",interpolationType:on,interpolationFactor:es.interpolationFactor.bind(void 0,on),zoomStops:ir.map(function(Sn){return Sn[0]}),evaluate:function(Sn,Gn){var An=Sn.zoom;return Rf({stops:ir,base:m.base},b,An).evaluate(An,Gn)}}}if(Q){var Dn=ee==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Dn,interpolationFactor:es.interpolationFactor.bind(void 0,Dn),zoomStops:m.stops.map(function(Sn){return Sn[0]}),evaluate:function(Sn){return E(m,b,Sn.zoom,T,M)}}}return{kind:"source",evaluate:function(Sn,Gn){var An=Gn&&Gn.properties?Gn.properties[m.property]:void 0;return An===void 0?ol(m.default,b.default):E(m,b,An,T,M)}}}(this._parameters,this._specification))};function zs(o){var u=o.key,c=o.value,m=o.valueSpec||{},b=o.objectElementValidators||{},E=o.style,T=o.styleSpec,M=[],B=ba(c);if(B!=="object")return[new ne(u,c,"object expected, "+B+" found")];for(var G in c){var Q=G.split(".")[0],ee=m[Q]||m["*"],pe=void 0;if(b[Q])pe=b[Q];else if(m[Q])pe=Zi;else if(b["*"])pe=b["*"];else{if(!m["*"]){M.push(new ne(u,c[G],'unknown property "'+G+'"'));continue}pe=Zi}M=M.concat(pe({key:(u&&u+".")+G,value:c[G],valueSpec:ee,style:E,styleSpec:T,object:c,objectKey:G},c))}for(var _e in m)b[_e]||m[_e].required&&m[_e].default===void 0&&c[_e]===void 0&&M.push(new ne(u,c,'missing required property "'+_e+'"'));return M}function xh(o){var u=o.value,c=o.valueSpec,m=o.style,b=o.styleSpec,E=o.key,T=o.arrayElementValidator||Zi;if(ba(u)!=="array")return[new ne(E,u,"array expected, "+ba(u)+" found")];if(c.length&&u.length!==c.length)return[new ne(E,u,"array length "+c.length+" expected, length "+u.length+" found")];if(c["min-length"]&&u.length<c["min-length"])return[new ne(E,u,"array length at least "+c["min-length"]+" expected, length "+u.length+" found")];var M={type:c.value,values:c.values};b.$version<7&&(M.function=c.function),ba(c.value)==="object"&&(M=c.value);for(var B=[],G=0;G<u.length;G++)B=B.concat(T({array:u,arrayIndex:G,value:u[G],valueSpec:M,style:m,styleSpec:b,key:E+"["+G+"]"}));return B}function rf(o){var u=o.key,c=o.value,m=o.valueSpec,b=ba(c);return b==="number"&&c!=c&&(b="NaN"),b!=="number"?[new ne(u,c,"number expected, "+b+" found")]:"minimum"in m&&c<m.minimum?[new ne(u,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new ne(u,c,c+" is greater than the maximum value "+m.maximum)]:[]}function wc(o){var u,c,m,b=o.valueSpec,E=Ie(o.value.type),T={},M=E!=="categorical"&&o.value.property===void 0,B=!M,G=ba(o.value.stops)==="array"&&ba(o.value.stops[0])==="array"&&ba(o.value.stops[0][0])==="object",Q=zs({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(_e){if(E==="identity")return[new ne(_e.key,_e.value,'identity function may not have a "stops" property')];var Ge=[],Ye=_e.value;return Ge=Ge.concat(xh({key:_e.key,value:Ye,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:ee})),ba(Ye)==="array"&&Ye.length===0&&Ge.push(new ne(_e.key,Ye,"array must have at least one stop")),Ge},default:function(_e){return Zi({key:_e.key,value:_e.value,valueSpec:b,style:_e.style,styleSpec:_e.styleSpec})}}});return E==="identity"&&M&&Q.push(new ne(o.key,o.value,'missing required property "property"')),E==="identity"||o.value.stops||Q.push(new ne(o.key,o.value,'missing required property "stops"')),E==="exponential"&&o.valueSpec.expression&&!Qc(o.valueSpec)&&Q.push(new ne(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(B&&!Il(o.valueSpec)?Q.push(new ne(o.key,o.value,"property functions not supported")):M&&!_h(o.valueSpec)&&Q.push(new ne(o.key,o.value,"zoom functions not supported"))),E!=="categorical"&&!G||o.value.property!==void 0||Q.push(new ne(o.key,o.value,'"property" property is required')),Q;function ee(_e){var Ge=[],Ye=_e.value,yt=_e.key;if(ba(Ye)!=="array")return[new ne(yt,Ye,"array expected, "+ba(Ye)+" found")];if(Ye.length!==2)return[new ne(yt,Ye,"array length 2 expected, length "+Ye.length+" found")];if(G){if(ba(Ye[0])!=="object")return[new ne(yt,Ye,"object expected, "+ba(Ye[0])+" found")];if(Ye[0].zoom===void 0)return[new ne(yt,Ye,"object stop key must have zoom")];if(Ye[0].value===void 0)return[new ne(yt,Ye,"object stop key must have value")];if(m&&m>Ie(Ye[0].zoom))return[new ne(yt,Ye[0].zoom,"stop zoom values must appear in ascending order")];Ie(Ye[0].zoom)!==m&&(m=Ie(Ye[0].zoom),c=void 0,T={}),Ge=Ge.concat(zs({key:yt+"[0]",value:Ye[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:rf,value:pe}}))}else Ge=Ge.concat(pe({key:yt+"[0]",value:Ye[0],valueSpec:{},style:_e.style,styleSpec:_e.styleSpec},Ye));return Zu(Kt(Ye[1]))?Ge.concat([new ne(yt+"[1]",Ye[1],"expressions are not allowed in function stops.")]):Ge.concat(Zi({key:yt+"[1]",value:Ye[1],valueSpec:b,style:_e.style,styleSpec:_e.styleSpec}))}function pe(_e,Ge){var Ye=ba(_e.value),yt=Ie(_e.value),ot=_e.value!==null?_e.value:Ge;if(u){if(Ye!==u)return[new ne(_e.key,ot,Ye+" stop domain type must match previous stop domain type "+u)]}else u=Ye;if(Ye!=="number"&&Ye!=="string"&&Ye!=="boolean")return[new ne(_e.key,ot,"stop domain value must be a number, string, or boolean")];if(Ye!=="number"&&E!=="categorical"){var Dt="number expected, "+Ye+" found";return Il(b)&&E===void 0&&(Dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ne(_e.key,ot,Dt)]}return E!=="categorical"||Ye!=="number"||isFinite(yt)&&Math.floor(yt)===yt?E!=="categorical"&&Ye==="number"&&c!==void 0&&yt<c?[new ne(_e.key,ot,"stop domain values must appear in ascending order")]:(c=yt,E==="categorical"&&yt in T?[new ne(_e.key,ot,"stop domain values must be unique")]:(T[yt]=!0,[])):[new ne(_e.key,ot,"integer expected, found "+yt)]}}function Ol(o){var u=(o.expressionContext==="property"?bh:tf)(Kt(o.value),o.valueSpec);if(u.result==="error")return u.value.map(function(m){return new ne(""+o.key+m.key,o.value,m.message)});var c=u.value.expression||u.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!c.outputDefined())return[new ne(o.key,o.value,'Invalid data expression for "'+o.propertyKey+'". Output values must be contained as literals within the expression.')];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!wl(c))return[new ne(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!wl(c))return[new ne(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Fu(c,["zoom","feature-state"]))return[new ne(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Tl(c))return[new ne(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vu(o){var u=o.key,c=o.value,m=o.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(Ie(c))===-1&&b.push(new ne(u,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(Ie(c))===-1&&b.push(new ne(u,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),b}function Yl(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(var u=0,c=o.slice(1);u<c.length;u+=1){var m=c[u];if(!Yl(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}Tc.deserialize=function(o){return new Tc(o._parameters,o._specification)},Tc.serialize=function(o){return{_parameters:o._parameters,_specification:o._specification}};var Mf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ul(o){if(o==null)return{filter:function(){return!0},needGeometry:!1};Yl(o)||(o=Sh(o));var u=tf(o,Mf);if(u.result==="error")throw new Error(u.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,b){return u.value.evaluate(c,m,{},b)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var b=1;b<m.length;b++)if(c(m[b]))return!0;return!1}(o)}}function Eh(o,u){return o<u?-1:o>u?1:0}function Sh(o){if(!o)return!0;var u,c=o[0];return o.length<=1?c!=="any":c==="=="?Ah(o[1],o[2],"=="):c==="!="?Ya(Ah(o[1],o[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Ah(o[1],o[2],c):c==="any"?(u=o.slice(1),["any"].concat(u.map(Sh))):c==="all"?["all"].concat(o.slice(1).map(Sh)):c==="none"?["all"].concat(o.slice(1).map(Sh).map(Ya)):c==="in"?If(o[1],o.slice(2)):c==="!in"?Ya(If(o[1],o.slice(2))):c==="has"?sp(o[1]):c==="!has"?Ya(sp(o[1])):c!=="within"||o}function Ah(o,u,c){switch(o){case"$type":return["filter-type-"+c,u];case"$id":return["filter-id-"+c,u];default:return["filter-"+c,o,u]}}function If(o,u){if(u.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(c){return typeof c!=typeof u[0]})?["filter-in-large",o,["literal",u.sort(Eh)]]:["filter-in-small",o,["literal",u]]}}function sp(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ya(o){return["!",o]}function up(o){return Yl(Kt(o.value))?Ol(lt({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(c){var m=c.value,b=c.key;if(ba(m)!=="array")return[new ne(b,m,"array expected, "+ba(m)+" found")];var E,T=c.styleSpec,M=[];if(m.length<1)return[new ne(b,m,"filter array must have at least 1 element")];switch(M=M.concat(Vu({key:b+"[0]",value:m[0],valueSpec:T.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ie(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&Ie(m[1])==="$type"&&M.push(new ne(b,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new ne(b,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=ba(m[1]))!=="string"&&M.push(new ne(b+"[1]",m[1],"string expected, "+E+" found"));for(var B=2;B<m.length;B++)E=ba(m[B]),Ie(m[1])==="$type"?M=M.concat(Vu({key:b+"["+B+"]",value:m[B],valueSpec:T.geometry_type,style:c.style,styleSpec:c.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new ne(b+"["+B+"]",m[B],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var G=1;G<m.length;G++)M=M.concat(u({key:b+"["+G+"]",value:m[G],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":E=ba(m[1]),m.length!==2?M.push(new ne(b,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&M.push(new ne(b+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=ba(m[1]),m.length!==2?M.push(new ne(b,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&M.push(new ne(b+"[1]",m[1],"object expected, "+E+" found"))}return M}(o)}function Pf(o,u){var c=o.key,m=o.style,b=o.styleSpec,E=o.value,T=o.objectKey,M=b[u+"_"+o.layerType];if(!M)return[];var B=T.match(/^(.*)-transition$/);if(u==="paint"&&B&&M[B[1]]&&M[B[1]].transition)return Zi({key:c,value:E,valueSpec:b.transition,style:m,styleSpec:b});var G,Q=o.valueSpec||M[T];if(!Q)return[new ne(c,E,'unknown property "'+T+'"')];if(ba(E)==="string"&&Il(Q)&&!Q.tokens&&(G=/^{([^}]+)}$/.exec(E)))return[new ne(c,E,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(G[1])+" }`.")];var ee=[];return o.layerType==="symbol"&&(T==="text-field"&&m&&!m.glyphs&&ee.push(new ne(c,E,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Pl(Kt(E))&&Ie(E.type)==="identity"&&ee.push(new ne(c,E,'"text-font" does not support identity functions'))),ee.concat(Zi({key:o.key,value:E,valueSpec:Q,style:m,styleSpec:b,expressionContext:"property",propertyType:u,propertyKey:T}))}function lp(o){return Pf(o,"paint")}function ql(o){return Pf(o,"layout")}function cp(o){var u=[],c=o.value,m=o.key,b=o.style,E=o.styleSpec;c.type||c.ref||u.push(new ne(m,c,'either "type" or "ref" is required'));var T,M=Ie(c.type),B=Ie(c.ref);if(c.id)for(var G=Ie(c.id),Q=0;Q<o.arrayIndex;Q++){var ee=b.layers[Q];Ie(ee.id)===G&&u.push(new ne(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+ee.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(Ge){Ge in c&&u.push(new ne(m,c[Ge],'"'+Ge+'" is prohibited for ref layers'))}),b.layers.forEach(function(Ge){Ie(Ge.id)===B&&(T=Ge)}),T?T.ref?u.push(new ne(m,c.ref,"ref cannot reference another ref layer")):M=Ie(T.type):u.push(new ne(m,c.ref,'ref layer "'+B+'" not found'));else if(M!=="background")if(c.source){var pe=b.sources&&b.sources[c.source],_e=pe&&Ie(pe.type);pe?_e==="vector"&&M==="raster"?u.push(new ne(m,c.source,'layer "'+c.id+'" requires a raster source')):_e==="raster"&&M!=="raster"?u.push(new ne(m,c.source,'layer "'+c.id+'" requires a vector source')):_e!=="vector"||c["source-layer"]?_e==="raster-dem"&&M!=="hillshade"?u.push(new ne(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!c.paint||!c.paint["line-gradient"]||_e==="geojson"&&pe.lineMetrics||u.push(new ne(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new ne(m,c,'layer "'+c.id+'" must specify a "source-layer"')):u.push(new ne(m,c.source,'source "'+c.source+'" not found'))}else u.push(new ne(m,c,'missing required property "source"'));return u=u.concat(zs({key:m,value:c,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Zi({key:m+".type",value:c.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,object:c,objectKey:"type"})},filter:up,layout:function(Ge){return zs({layer:c,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(Ye){return ql(lt({layerType:M},Ye))}}})},paint:function(Ge){return zs({layer:c,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(Ye){return lp(lt({layerType:M},Ye))}}})}}}))}function ju(o){var u=o.value,c=o.key,m=ba(u);return m!=="string"?[new ne(c,u,"string expected, "+m+" found")]:[]}var Sa={promoteId:function(o){var u=o.key,c=o.value;if(ba(c)==="string")return ju({key:u,value:c});var m=[];for(var b in c)m.push.apply(m,ju({key:u+"."+b,value:c[b]}));return m}};function Kl(o){var u=o.value,c=o.key,m=o.styleSpec,b=o.style;if(!u.type)return[new ne(c,u,'"type" is required')];var E,T=Ie(u.type);switch(T){case"vector":case"raster":case"raster-dem":return zs({key:c,value:u,valueSpec:m["source_"+T.replace("-","_")],style:o.style,styleSpec:m,objectElementValidators:Sa});case"geojson":if(E=zs({key:c,value:u,valueSpec:m.source_geojson,style:b,styleSpec:m,objectElementValidators:Sa}),u.cluster)for(var M in u.clusterProperties){var B=u.clusterProperties[M],G=B[0],Q=typeof G=="string"?[G,["accumulated"],["get",M]]:G;E.push.apply(E,Ol({key:c+"."+M+".map",value:B[1],expressionContext:"cluster-map"})),E.push.apply(E,Ol({key:c+"."+M+".reduce",value:Q,expressionContext:"cluster-reduce"}))}return E;case"video":return zs({key:c,value:u,valueSpec:m.source_video,style:b,styleSpec:m});case"image":return zs({key:c,value:u,valueSpec:m.source_image,style:b,styleSpec:m});case"canvas":return[new ne(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vu({key:c+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,styleSpec:m})}}function Hu(o){var u=o.value,c=o.styleSpec,m=c.light,b=o.style,E=[],T=ba(u);if(u===void 0)return E;if(T!=="object")return E.concat([new ne("light",u,"object expected, "+T+" found")]);for(var M in u){var B=M.match(/^(.*)-transition$/);E=E.concat(B&&m[B[1]]&&m[B[1]].transition?Zi({key:M,value:u[M],valueSpec:c.transition,style:b,styleSpec:c}):m[M]?Zi({key:M,value:u[M],valueSpec:m[M],style:b,styleSpec:c}):[new ne(M,u[M],'unknown property "'+M+'"')])}return E}var ll={"*":function(){return[]},array:xh,boolean:function(o){var u=o.value,c=o.key,m=ba(u);return m!=="boolean"?[new ne(c,u,"boolean expected, "+m+" found")]:[]},number:rf,color:function(o){var u=o.key,c=o.value,m=ba(c);return m!=="string"?[new ne(u,c,"color expected, "+m+" found")]:yi(c)===null?[new ne(u,c,'color expected, "'+c+'" found')]:[]},constants:je,enum:Vu,filter:up,function:wc,layer:cp,object:zs,source:Kl,light:Hu,string:ju,formatted:function(o){return ju(o).length===0?[]:Ol(o)},resolvedImage:function(o){return ju(o).length===0?[]:Ol(o)}};function Zi(o){var u=o.value,c=o.valueSpec,m=o.styleSpec;return c.expression&&Pl(Ie(u))?wc(o):c.expression&&Zu(Kt(u))?Ol(o):c.type&&ll[c.type]?ll[c.type](o):zs(lt({},o,{valueSpec:c.type?m[c.type]:c}))}function Aa(o){var u=o.value,c=o.key,m=ju(o);return m.length||(u.indexOf("{fontstack}")===-1&&m.push(new ne(c,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&m.push(new ne(c,u,'"glyphs" url must include a "{range}" token'))),m}function ou(o,u){u===void 0&&(u=W);var c=[];return c=c.concat(Zi({key:"",value:o,valueSpec:u.$root,styleSpec:u,style:o,objectElementValidators:{glyphs:Aa,"*":function(){return[]}}})),o.constants&&(c=c.concat(je({key:"constants",value:o.constants,style:o,styleSpec:u}))),nf(c)}function nf(o){return[].concat(o).sort(function(u,c){return u.line-c.line})}function af(o){return function(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];return nf(o.apply(this,u))}}ou.source=af(Kl),ou.light=af(Hu),ou.layer=af(cp),ou.filter=af(up),ou.paintProperty=af(lp),ou.layoutProperty=af(ql);var Qs=ou,fp=Qs.light,Of=Qs.paintProperty,kf=Qs.layoutProperty;function Ql(o,u){var c=!1;if(u&&u.length)for(var m=0,b=u;m<b.length;m+=1)o.fire(new We(new Error(b[m].message))),c=!0;return c}var Co=qa;function qa(o,u,c){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var b=new Int32Array(this.arrayBuffer);o=b[0],this.d=(u=b[1])+2*(c=b[2]);for(var E=0;E<this.d*this.d;E++){var T=b[3+E],M=b[3+E+1];m.push(T===M?null:b.subarray(T,M))}var B=b[3+m.length+1];this.keys=b.subarray(b[3+m.length],B),this.bboxes=b.subarray(B),this.insert=this._insertReadonly}else{this.d=u+2*c;for(var G=0;G<this.d*this.d;G++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=c,this.scale=u/o,this.uid=0;var Q=c/u*o;this.min=-Q,this.max=o+Q}qa.prototype.insert=function(o,u,c,m,b){this._forEachCell(u,c,m,b,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(b)},qa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qa.prototype._insertCell=function(o,u,c,m,b,E){this.cells[b].push(E)},qa.prototype.query=function(o,u,c,m,b){var E=this.min,T=this.max;if(o<=E&&u<=E&&T<=c&&T<=m&&!b)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(o,u,c,m,this._queryCell,M,{},b),M},qa.prototype._queryCell=function(o,u,c,m,b,E,T,M){var B=this.cells[b];if(B!==null)for(var G=this.keys,Q=this.bboxes,ee=0;ee<B.length;ee++){var pe=B[ee];if(T[pe]===void 0){var _e=4*pe;(M?M(Q[_e+0],Q[_e+1],Q[_e+2],Q[_e+3]):o<=Q[_e+2]&&u<=Q[_e+3]&&c>=Q[_e+0]&&m>=Q[_e+1])?(T[pe]=!0,E.push(G[pe])):T[pe]=!1}}},qa.prototype._forEachCell=function(o,u,c,m,b,E,T,M){for(var B=this._convertToCellCoord(o),G=this._convertToCellCoord(u),Q=this._convertToCellCoord(c),ee=this._convertToCellCoord(m),pe=B;pe<=Q;pe++)for(var _e=G;_e<=ee;_e++){var Ge=this.d*_e+pe;if((!M||M(this._convertFromCellCoord(pe),this._convertFromCellCoord(_e),this._convertFromCellCoord(pe+1),this._convertFromCellCoord(_e+1)))&&b.call(this,o,u,c,m,Ge,E,T,M))return}},qa.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},qa.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},qa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var b=new Int32Array(u+c+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var E=u,T=0;T<o.length;T++){var M=o[T];b[3+T]=E,b.set(M,E),E+=M.length}return b[3+o.length]=E,b.set(this.keys,E),b[3+o.length+1]=E+=this.keys.length,b.set(this.bboxes,E),E+=this.bboxes.length,b.buffer};var of=H.ImageData,Cc=H.ImageBitmap,uo={};function Mn(o,u,c){c===void 0&&(c={}),Object.defineProperty(u,"_classRegistryKey",{value:o,writeable:!1}),uo[o]={klass:u,omit:c.omit||[],shallow:c.shallow||[]}}for(var ys in Mn("Object",Object),Co.serialize=function(o,u){var c=o.toArrayBuffer();return u&&u.push(c),{buffer:c}},Co.deserialize=function(o){return new Co(o.buffer)},Mn("Grid",Co),Mn("Color",Ii),Mn("Error",Error),Mn("ResolvedImage",Ia),Mn("StylePropertyFunction",Tc),Mn("StyleExpression",Xl,{omit:["_evaluator"]}),Mn("ZoomDependentExpression",$l),Mn("ZoomConstantExpression",Ac),Mn("CompoundExpression",sa,{omit:["_evaluate"]}),gu)gu[ys]._classRegistryKey||Mn("Expression_"+ys,gu[ys]);function Df(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Rc(o){return Cc&&o instanceof Cc}function ls(o,u){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Df(o)||Rc(o))return u&&u.push(o),o;if(ArrayBuffer.isView(o)){var c=o;return u&&u.push(c.buffer),c}if(o instanceof of)return u&&u.push(o.data.buffer),o;if(Array.isArray(o)){for(var m=[],b=0,E=o;b<E.length;b+=1)m.push(ls(E[b],u));return m}if(typeof o=="object"){var T=o.constructor,M=T._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var B=T.serialize?T.serialize(o,u):{};if(!T.serialize){for(var G in o)if(o.hasOwnProperty(G)&&!(uo[M].omit.indexOf(G)>=0)){var Q=o[G];B[G]=uo[M].shallow.indexOf(G)>=0?Q:ls(Q,u)}o instanceof Error&&(B.message=o.message)}if(B.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(B.$name=M),B}throw new Error("can't serialize object of type "+typeof o)}function xa(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Df(o)||Rc(o)||ArrayBuffer.isView(o)||o instanceof of)return o;if(Array.isArray(o))return o.map(xa);if(typeof o=="object"){var u=o.$name||"Object",c=uo[u].klass;if(!c)throw new Error("can't deserialize unregistered class "+u);if(c.deserialize)return c.deserialize(o);for(var m=Object.create(c.prototype),b=0,E=Object.keys(o);b<E.length;b+=1){var T=E[b];if(T!=="$name"){var M=o[T];m[T]=uo[u].shallow.indexOf(T)>=0?M:xa(M)}}return m}throw new Error("can't deserialize object of type "+typeof o)}var Lf=function(){this.first=!0};Lf.prototype.update=function(o,u){var c=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=c,!0))};var cn={"Latin-1 Supplement":function(o){return o>=128&&o<=255},Arabic:function(o){return o>=1536&&o<=1791},"Arabic Supplement":function(o){return o>=1872&&o<=1919},"Arabic Extended-A":function(o){return o>=2208&&o<=2303},"Hangul Jamo":function(o){return o>=4352&&o<=4607},"Unified Canadian Aboriginal Syllabics":function(o){return o>=5120&&o<=5759},Khmer:function(o){return o>=6016&&o<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(o){return o>=6320&&o<=6399},"General Punctuation":function(o){return o>=8192&&o<=8303},"Letterlike Symbols":function(o){return o>=8448&&o<=8527},"Number Forms":function(o){return o>=8528&&o<=8591},"Miscellaneous Technical":function(o){return o>=8960&&o<=9215},"Control Pictures":function(o){return o>=9216&&o<=9279},"Optical Character Recognition":function(o){return o>=9280&&o<=9311},"Enclosed Alphanumerics":function(o){return o>=9312&&o<=9471},"Geometric Shapes":function(o){return o>=9632&&o<=9727},"Miscellaneous Symbols":function(o){return o>=9728&&o<=9983},"Miscellaneous Symbols and Arrows":function(o){return o>=11008&&o<=11263},"CJK Radicals Supplement":function(o){return o>=11904&&o<=12031},"Kangxi Radicals":function(o){return o>=12032&&o<=12255},"Ideographic Description Characters":function(o){return o>=12272&&o<=12287},"CJK Symbols and Punctuation":function(o){return o>=12288&&o<=12351},Hiragana:function(o){return o>=12352&&o<=12447},Katakana:function(o){return o>=12448&&o<=12543},Bopomofo:function(o){return o>=12544&&o<=12591},"Hangul Compatibility Jamo":function(o){return o>=12592&&o<=12687},Kanbun:function(o){return o>=12688&&o<=12703},"Bopomofo Extended":function(o){return o>=12704&&o<=12735},"CJK Strokes":function(o){return o>=12736&&o<=12783},"Katakana Phonetic Extensions":function(o){return o>=12784&&o<=12799},"Enclosed CJK Letters and Months":function(o){return o>=12800&&o<=13055},"CJK Compatibility":function(o){return o>=13056&&o<=13311},"CJK Unified Ideographs Extension A":function(o){return o>=13312&&o<=19903},"Yijing Hexagram Symbols":function(o){return o>=19904&&o<=19967},"CJK Unified Ideographs":function(o){return o>=19968&&o<=40959},"Yi Syllables":function(o){return o>=40960&&o<=42127},"Yi Radicals":function(o){return o>=42128&&o<=42191},"Hangul Jamo Extended-A":function(o){return o>=43360&&o<=43391},"Hangul Syllables":function(o){return o>=44032&&o<=55215},"Hangul Jamo Extended-B":function(o){return o>=55216&&o<=55295},"Private Use Area":function(o){return o>=57344&&o<=63743},"CJK Compatibility Ideographs":function(o){return o>=63744&&o<=64255},"Arabic Presentation Forms-A":function(o){return o>=64336&&o<=65023},"Vertical Forms":function(o){return o>=65040&&o<=65055},"CJK Compatibility Forms":function(o){return o>=65072&&o<=65103},"Small Form Variants":function(o){return o>=65104&&o<=65135},"Arabic Presentation Forms-B":function(o){return o>=65136&&o<=65279},"Halfwidth and Fullwidth Forms":function(o){return o>=65280&&o<=65519}};function cl(o){for(var u=0,c=o;u<c.length;u+=1)if(sf(c[u].charCodeAt(0)))return!0;return!1}function sf(o){return!(o!==746&&o!==747&&(o<4352||!(cn["Bopomofo Extended"](o)||cn.Bopomofo(o)||cn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||cn["CJK Compatibility Ideographs"](o)||cn["CJK Compatibility"](o)||cn["CJK Radicals Supplement"](o)||cn["CJK Strokes"](o)||!(!cn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||cn["CJK Unified Ideographs Extension A"](o)||cn["CJK Unified Ideographs"](o)||cn["Enclosed CJK Letters and Months"](o)||cn["Hangul Compatibility Jamo"](o)||cn["Hangul Jamo Extended-A"](o)||cn["Hangul Jamo Extended-B"](o)||cn["Hangul Jamo"](o)||cn["Hangul Syllables"](o)||cn.Hiragana(o)||cn["Ideographic Description Characters"](o)||cn.Kanbun(o)||cn["Kangxi Radicals"](o)||cn["Katakana Phonetic Extensions"](o)||cn.Katakana(o)&&o!==12540||!(!cn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!cn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||cn["Unified Canadian Aboriginal Syllabics"](o)||cn["Unified Canadian Aboriginal Syllabics Extended"](o)||cn["Vertical Forms"](o)||cn["Yijing Hexagram Symbols"](o)||cn["Yi Syllables"](o)||cn["Yi Radicals"](o))))}function uf(o){return!(sf(o)||function(u){return!!(cn["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||cn["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||cn["Letterlike Symbols"](u)||cn["Number Forms"](u)||cn["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||cn["Control Pictures"](u)&&u!==9251||cn["Optical Character Recognition"](u)||cn["Enclosed Alphanumerics"](u)||cn["Geometric Shapes"](u)||cn["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||cn["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||cn["CJK Symbols and Punctuation"](u)||cn.Katakana(u)||cn["Private Use Area"](u)||cn["CJK Compatibility Forms"](u)||cn["Small Form Variants"](u)||cn["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(o))}function yu(o){return o>=1424&&o<=2303||cn["Arabic Presentation Forms-A"](o)||cn["Arabic Presentation Forms-B"](o)}function Zs(o,u){return!(!u&&yu(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||cn.Khmer(o))}function Bf(o){for(var u=0,c=o;u<c.length;u+=1)if(yu(c[u].charCodeAt(0)))return!0;return!1}var Ff=null,_s="unavailable",_u=null,hp=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(_s="error"),Ff&&Ff(o)};function Mc(){Ic.fire(new Me("pluginStateChange",{pluginStatus:_s,pluginURL:_u}))}var Ic=new ut,Nf=function(){return _s},Js=function(){if(_s!=="deferred"||!_u)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_s="loading",Mc(),_u&&Bt({url:_u},function(o){o?hp(o):(_s="loaded",Mc())})},Nt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return _s==="loaded"||Nt.applyArabicShaping!=null},isLoading:function(){return _s==="loading"},setState:function(o){_s=o.pluginStatus,_u=o.pluginURL},isParsed:function(){return Nt.applyArabicShaping!=null&&Nt.processBidirectionalText!=null&&Nt.processStyledBidirectionalText!=null},getPluginURL:function(){return _u}},Le=function(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lf,this.transition={})};Le.prototype.isSupportedScript=function(o){return function(u,c){for(var m=0,b=u;m<b.length;m+=1)if(!Zs(b[m].charCodeAt(0),c))return!1;return!0}(o,Nt.isLoaded())},Le.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Le.prototype.getCrossfadeParameters=function(){var o=this.zoom,u=o-Math.floor(o),c=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*u}};var F=function(o,u){this.property=o,this.value=u,this.expression=function(c,m){if(Pl(c))return new Tc(c,m);if(Zu(c)){var b=bh(c,m);if(b.result==="error")throw new Error(b.value.map(function(T){return T.key+": "+T.message}).join(", "));return b.value}var E=c;return typeof c=="string"&&m.type==="color"&&(E=Ii.parse(c)),{kind:"constant",evaluate:function(){return E}}}(u===void 0?o.specification.default:u,o.specification)};F.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},F.prototype.possiblyEvaluate=function(o,u,c){return this.property.possiblyEvaluate(this,o,u,c)};var eu=function(o){this.property=o,this.value=new F(o,void 0)};eu.prototype.transitioned=function(o,u){return new kl(this.property,this.value,u,St({},o.transition,this.transition),o.now)},eu.prototype.untransitioned=function(){return new kl(this.property,this.value,null,{},0)};var ve=function(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)};ve.prototype.getValue=function(o){return Pe(this._values[o].value.value)},ve.prototype.setValue=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new eu(this._values[o].property)),this._values[o].value=new F(this._values[o].property,u===null?void 0:Pe(u))},ve.prototype.getTransition=function(o){return Pe(this._values[o].transition)},ve.prototype.setTransition=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new eu(this._values[o].property)),this._values[o].transition=Pe(u)||void 0},ve.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],b=this.getValue(m);b!==void 0&&(o[m]=b);var E=this.getTransition(m);E!==void 0&&(o[m+"-transition"]=E)}return o},ve.prototype.transitioned=function(o,u){for(var c=new Wu(this._properties),m=0,b=Object.keys(this._values);m<b.length;m+=1){var E=b[m];c._values[E]=this._values[E].transitioned(o,u._values[E])}return c},ve.prototype.untransitioned=function(){for(var o=new Wu(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u];o._values[m]=this._values[m].untransitioned()}return o};var kl=function(o,u,c,m,b){this.property=o,this.value=u,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};kl.prototype.possiblyEvaluate=function(o,u,c){var m=o.now||0,b=this.value.possiblyEvaluate(o,u,c),E=this.prior;if(E){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return E.possiblyEvaluate(o,u,c);var T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(o,u,c),b,function(M){if(M<=0)return 0;if(M>=1)return 1;var B=M*M,G=B*M;return 4*(M<.5?G:3*(M-B)+G-.75)}(T))}return b};var Wu=function(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)};Wu.prototype.possiblyEvaluate=function(o,u,c){for(var m=new bs(this._properties),b=0,E=Object.keys(this._values);b<E.length;b+=1){var T=E[b];m._values[T]=this._values[T].possiblyEvaluate(o,u,c)}return m},Wu.prototype.hasTransition=function(){for(var o=0,u=Object.keys(this._values);o<u.length;o+=1)if(this._values[u[o]].prior)return!0;return!1};var su=function(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)};su.prototype.getValue=function(o){return Pe(this._values[o].value)},su.prototype.setValue=function(o,u){this._values[o]=new F(this._values[o].property,u===null?void 0:Pe(u))},su.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],b=this.getValue(m);b!==void 0&&(o[m]=b)}return o},su.prototype.possiblyEvaluate=function(o,u,c){for(var m=new bs(this._properties),b=0,E=Object.keys(this._values);b<E.length;b+=1){var T=E[b];m._values[T]=this._values[T].possiblyEvaluate(o,u,c)}return m};var Ro=function(o,u,c){this.property=o,this.value=u,this.parameters=c};Ro.prototype.isConstant=function(){return this.value.kind==="constant"},Ro.prototype.constantOr=function(o){return this.value.kind==="constant"?this.value.value:o},Ro.prototype.evaluate=function(o,u,c,m){return this.property.evaluate(this.value,this.parameters,o,u,c,m)};var bs=function(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)};bs.prototype.get=function(o){return this._values[o]};var Zn=function(o){this.specification=o};Zn.prototype.possiblyEvaluate=function(o,u){return o.expression.evaluate(u)},Zn.prototype.interpolate=function(o,u,c){var m=Cl[this.specification.type];return m?m(o,u,c):o};var Pn=function(o,u){this.specification=o,this.overrides=u};Pn.prototype.possiblyEvaluate=function(o,u,c,m){return new Ro(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},c,m)}:o.expression,u)},Pn.prototype.interpolate=function(o,u,c){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new Ro(this,{kind:"constant",value:void 0},o.parameters);var m=Cl[this.specification.type];return m?new Ro(this,{kind:"constant",value:m(o.value.value,u.value.value,c)},o.parameters):o},Pn.prototype.evaluate=function(o,u,c,m,b,E){return o.kind==="constant"?o.value:o.evaluate(u,c,m,b,E)};var cs=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m,b,E){if(c.value===void 0)return new Ro(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var T=c.expression.evaluate(m,null,{},b,E),M=c.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,B=this._calculate(M,M,M,m);return new Ro(this,{kind:"constant",value:B},m)}if(c.expression.kind==="camera"){var G=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new Ro(this,{kind:"constant",value:G},m)}return new Ro(this,c.expression,m)},u.prototype.evaluate=function(c,m,b,E,T,M){if(c.kind==="source"){var B=c.evaluate(m,b,E,T,M);return this._calculate(B,B,B,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},b,E),c.evaluate({zoom:Math.floor(m.zoom)},b,E),c.evaluate({zoom:Math.floor(m.zoom)+1},b,E),m):c.value},u.prototype._calculate=function(c,m,b,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:b,to:m}},u.prototype.interpolate=function(c){return c},u}(Pn),fs=function(o){this.specification=o};fs.prototype.possiblyEvaluate=function(o,u,c,m){if(o.value!==void 0){if(o.expression.kind==="constant"){var b=o.expression.evaluate(u,null,{},c,m);return this._calculate(b,b,b,u)}return this._calculate(o.expression.evaluate(new Le(Math.floor(u.zoom-1),u)),o.expression.evaluate(new Le(Math.floor(u.zoom),u)),o.expression.evaluate(new Le(Math.floor(u.zoom+1),u)),u)}},fs.prototype._calculate=function(o,u,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:c,to:u}},fs.prototype.interpolate=function(o){return o};var bu=function(o){this.specification=o};bu.prototype.possiblyEvaluate=function(o,u,c,m){return!!o.expression.evaluate(u,null,{},c,m)},bu.prototype.interpolate=function(){return!1};var Ua=function(o){for(var u in this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],o){var c=o[u];c.specification.overridable&&this.overridableProperties.push(u);var m=this.defaultPropertyValues[u]=new F(c,void 0),b=this.defaultTransitionablePropertyValues[u]=new eu(c);this.defaultTransitioningPropertyValues[u]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}};Mn("DataDrivenProperty",Pn),Mn("DataConstantProperty",Zn),Mn("CrossFadedDataDrivenProperty",cs),Mn("CrossFadedProperty",fs),Mn("ColorRampProperty",bu);var tu=function(o){function u(c,m){if(o.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new su(m.layout)),m.paint)){for(var b in this._transitionablePaint=new ve(m.paint),c.paint)this.setPaintProperty(b,c.paint[b],{validate:!1});for(var E in c.layout)this.setLayoutProperty(E,c.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new bs(m.paint)}}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},u.prototype.setLayoutProperty=function(c,m,b){b===void 0&&(b={}),m!=null&&this._validate(kf,"layers."+this.id+".layout."+c,c,m,b)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},u.prototype.getPaintProperty=function(c){return yr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)},u.prototype.setPaintProperty=function(c,m,b){if(b===void 0&&(b={}),m!=null&&this._validate(Of,"layers."+this.id+".paint."+c,c,m,b))return!1;if(yr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-11),m||void 0),!1;var E=this._transitionablePaint._values[c],T=E.property.specification["property-type"]==="cross-faded-data-driven",M=E.value.isDataDriven(),B=E.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var G=this._transitionablePaint._values[c].value;return G.isDataDriven()||M||T||this._handleOverridablePaintPropertyUpdate(c,B,G)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,b){return!1},u.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},u.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ft(c,function(m,b){return!(m===void 0||b==="layout"&&!Object.keys(m).length||b==="paint"&&!Object.keys(m).length)})},u.prototype._validate=function(c,m,b,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Ql(this,c.call(Qs,{key:m,layerType:this.type,objectKey:b,value:E,styleSpec:W,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof Ro&&Il(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},u}(ut),xu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Eu=function(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},pa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function _o(o,u){u===void 0&&(u=1);var c=0,m=0;return{members:o.map(function(b){var E=xu[b.type].BYTES_PER_ELEMENT,T=c=Th(c,Math.max(u,E)),M=b.components||1;return m=Math.max(m,E),c+=E*M,{name:b.name,type:b.type,components:M,offset:T}}),size:Th(c,Math.max(m,u)),alignment:u}}function Th(o,u){return Math.ceil(o/u)*u}pa.serialize=function(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}},pa.deserialize=function(o){var u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},pa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},pa.prototype.clear=function(){this.length=0},pa.prototype.resize=function(o){this.reserve(o),this.length=o},pa.prototype.reserve=function(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},pa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Dl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,m)},u.prototype.emplace=function(c,m,b){var E=2*c;return this.int16[E+0]=m,this.int16[E+1]=b,c},u}(pa);Dl.prototype.bytesPerElement=4,Mn("StructArrayLayout2i4",Dl);var Uf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,b,E)},u.prototype.emplace=function(c,m,b,E,T){var M=4*c;return this.int16[M+0]=m,this.int16[M+1]=b,this.int16[M+2]=E,this.int16[M+3]=T,c},u}(pa);Uf.prototype.bytesPerElement=8,Mn("StructArrayLayout4i8",Uf);var fl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M){var B=this.length;return this.resize(B+1),this.emplace(B,c,m,b,E,T,M)},u.prototype.emplace=function(c,m,b,E,T,M,B){var G=6*c;return this.int16[G+0]=m,this.int16[G+1]=b,this.int16[G+2]=E,this.int16[G+3]=T,this.int16[G+4]=M,this.int16[G+5]=B,c},u}(pa);fl.prototype.bytesPerElement=12,Mn("StructArrayLayout2i4i12",fl);var xs=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M){var B=this.length;return this.resize(B+1),this.emplace(B,c,m,b,E,T,M)},u.prototype.emplace=function(c,m,b,E,T,M,B){var G=4*c,Q=8*c;return this.int16[G+0]=m,this.int16[G+1]=b,this.uint8[Q+4]=E,this.uint8[Q+5]=T,this.uint8[Q+6]=M,this.uint8[Q+7]=B,c},u}(pa);xs.prototype.bytesPerElement=8,Mn("StructArrayLayout2i4ub8",xs);var Jl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,m)},u.prototype.emplace=function(c,m,b){var E=2*c;return this.float32[E+0]=m,this.float32[E+1]=b,c},u}(pa);Jl.prototype.bytesPerElement=8,Mn("StructArrayLayout2f8",Jl);var Su=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,B,G,Q,ee){var pe=this.length;return this.resize(pe+1),this.emplace(pe,c,m,b,E,T,M,B,G,Q,ee)},u.prototype.emplace=function(c,m,b,E,T,M,B,G,Q,ee,pe){var _e=10*c;return this.uint16[_e+0]=m,this.uint16[_e+1]=b,this.uint16[_e+2]=E,this.uint16[_e+3]=T,this.uint16[_e+4]=M,this.uint16[_e+5]=B,this.uint16[_e+6]=G,this.uint16[_e+7]=Q,this.uint16[_e+8]=ee,this.uint16[_e+9]=pe,c},u}(pa);Su.prototype.bytesPerElement=20,Mn("StructArrayLayout10ui20",Su);var zf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,B,G,Q,ee,pe,_e){var Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,c,m,b,E,T,M,B,G,Q,ee,pe,_e)},u.prototype.emplace=function(c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge){var Ye=12*c;return this.int16[Ye+0]=m,this.int16[Ye+1]=b,this.int16[Ye+2]=E,this.int16[Ye+3]=T,this.uint16[Ye+4]=M,this.uint16[Ye+5]=B,this.uint16[Ye+6]=G,this.uint16[Ye+7]=Q,this.int16[Ye+8]=ee,this.int16[Ye+9]=pe,this.int16[Ye+10]=_e,this.int16[Ye+11]=Ge,c},u}(pa);zf.prototype.bytesPerElement=24,Mn("StructArrayLayout4i4ui4i24",zf);var Pc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=3*c;return this.float32[T+0]=m,this.float32[T+1]=b,this.float32[T+2]=E,c},u}(pa);Pc.prototype.bytesPerElement=12,Mn("StructArrayLayout3f12",Pc);var lf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},u}(pa);lf.prototype.bytesPerElement=4,Mn("StructArrayLayout1ul4",lf);var Zf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,B,G,Q){var ee=this.length;return this.resize(ee+1),this.emplace(ee,c,m,b,E,T,M,B,G,Q)},u.prototype.emplace=function(c,m,b,E,T,M,B,G,Q,ee){var pe=10*c,_e=5*c;return this.int16[pe+0]=m,this.int16[pe+1]=b,this.int16[pe+2]=E,this.int16[pe+3]=T,this.int16[pe+4]=M,this.int16[pe+5]=B,this.uint32[_e+3]=G,this.uint16[pe+8]=Q,this.uint16[pe+9]=ee,c},u}(pa);Zf.prototype.bytesPerElement=20,Mn("StructArrayLayout6i1ul2ui20",Zf);var ec=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M){var B=this.length;return this.resize(B+1),this.emplace(B,c,m,b,E,T,M)},u.prototype.emplace=function(c,m,b,E,T,M,B){var G=6*c;return this.int16[G+0]=m,this.int16[G+1]=b,this.int16[G+2]=E,this.int16[G+3]=T,this.int16[G+4]=M,this.int16[G+5]=B,c},u}(pa);ec.prototype.bytesPerElement=12,Mn("StructArrayLayout2i2i2i12",ec);var tc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T){var M=this.length;return this.resize(M+1),this.emplace(M,c,m,b,E,T)},u.prototype.emplace=function(c,m,b,E,T,M){var B=4*c,G=8*c;return this.float32[B+0]=m,this.float32[B+1]=b,this.float32[B+2]=E,this.int16[G+6]=T,this.int16[G+7]=M,c},u}(pa);tc.prototype.bytesPerElement=16,Mn("StructArrayLayout2f1f2i16",tc);var wh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,b,E)},u.prototype.emplace=function(c,m,b,E,T){var M=12*c,B=3*c;return this.uint8[M+0]=m,this.uint8[M+1]=b,this.float32[B+1]=E,this.float32[B+2]=T,c},u}(pa);wh.prototype.bytesPerElement=12,Mn("StructArrayLayout2ub2f12",wh);var hs=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=3*c;return this.uint16[T+0]=m,this.uint16[T+1]=b,this.uint16[T+2]=E,c},u}(pa);hs.prototype.bytesPerElement=6,Mn("StructArrayLayout3ui6",hs);var Au=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye,yt,ot,Dt){var Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye,yt,ot,Dt)},u.prototype.emplace=function(c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye,yt,ot,Dt,Ht){var ir=24*c,ur=12*c,xr=48*c;return this.int16[ir+0]=m,this.int16[ir+1]=b,this.uint16[ir+2]=E,this.uint16[ir+3]=T,this.uint32[ur+2]=M,this.uint32[ur+3]=B,this.uint32[ur+4]=G,this.uint16[ir+10]=Q,this.uint16[ir+11]=ee,this.uint16[ir+12]=pe,this.float32[ur+7]=_e,this.float32[ur+8]=Ge,this.uint8[xr+36]=Ye,this.uint8[xr+37]=yt,this.uint8[xr+38]=ot,this.uint32[ur+10]=Dt,this.int16[ir+22]=Ht,c},u}(pa);Au.prototype.bytesPerElement=48,Mn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Au);var cf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye,yt,ot,Dt,Ht,ir,ur,xr,Wr,on,Dn,Sn,Gn,An,wi){var ai=this.length;return this.resize(ai+1),this.emplace(ai,c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye,yt,ot,Dt,Ht,ir,ur,xr,Wr,on,Dn,Sn,Gn,An,wi)},u.prototype.emplace=function(c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye,yt,ot,Dt,Ht,ir,ur,xr,Wr,on,Dn,Sn,Gn,An,wi,ai){var Ln=34*c,Fi=17*c;return this.int16[Ln+0]=m,this.int16[Ln+1]=b,this.int16[Ln+2]=E,this.int16[Ln+3]=T,this.int16[Ln+4]=M,this.int16[Ln+5]=B,this.int16[Ln+6]=G,this.int16[Ln+7]=Q,this.uint16[Ln+8]=ee,this.uint16[Ln+9]=pe,this.uint16[Ln+10]=_e,this.uint16[Ln+11]=Ge,this.uint16[Ln+12]=Ye,this.uint16[Ln+13]=yt,this.uint16[Ln+14]=ot,this.uint16[Ln+15]=Dt,this.uint16[Ln+16]=Ht,this.uint16[Ln+17]=ir,this.uint16[Ln+18]=ur,this.uint16[Ln+19]=xr,this.uint16[Ln+20]=Wr,this.uint16[Ln+21]=on,this.uint16[Ln+22]=Dn,this.uint32[Fi+12]=Sn,this.float32[Fi+13]=Gn,this.float32[Fi+14]=An,this.float32[Fi+15]=wi,this.float32[Fi+16]=ai,c},u}(pa);cf.prototype.bytesPerElement=68,Mn("StructArrayLayout8i15ui1ul4f68",cf);var Ll=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},u}(pa);Ll.prototype.bytesPerElement=4,Mn("StructArrayLayout1f4",Ll);var uu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=3*c;return this.int16[T+0]=m,this.int16[T+1]=b,this.int16[T+2]=E,c},u}(pa);uu.prototype.bytesPerElement=6,Mn("StructArrayLayout3i6",uu);var Ch=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,b)},u.prototype.emplace=function(c,m,b,E){var T=4*c;return this.uint32[2*c+0]=m,this.uint16[T+2]=b,this.uint16[T+3]=E,c},u}(pa);Ch.prototype.bytesPerElement=8,Mn("StructArrayLayout1ul2ui8",Ch);var Gu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var b=this.length;return this.resize(b+1),this.emplace(b,c,m)},u.prototype.emplace=function(c,m,b){var E=2*c;return this.uint16[E+0]=m,this.uint16[E+1]=b,c},u}(pa);Gu.prototype.bytesPerElement=4,Mn("StructArrayLayout2ui4",Gu);var Vf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},u}(pa);Vf.prototype.bytesPerElement=2,Mn("StructArrayLayout1ui2",Vf);var Rh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,b,E)},u.prototype.emplace=function(c,m,b,E,T){var M=4*c;return this.float32[M+0]=m,this.float32[M+1]=b,this.float32[M+2]=E,this.float32[M+3]=T,c},u}(pa);Rh.prototype.bytesPerElement=16,Mn("StructArrayLayout4f16",Rh);var h=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new V(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,c),u}(Eu);h.prototype.size=20;var v=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new h(this,c)},u}(Zf);Mn("CollisionBoxArray",v);var p=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,c),u}(Eu);p.prototype.size=48;var g=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new p(this,c)},u}(Au);Mn("PlacedSymbolArray",g);var S=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,c),u}(Eu);S.prototype.size=68;var w=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new S(this,c)},u}(cf);Mn("SymbolInstanceArray",w);var R=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getoffsetX=function(c){return this.float32[1*c+0]},u}(Ll);Mn("GlyphOffsetArray",R);var k=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getx=function(c){return this.int16[3*c+0]},u.prototype.gety=function(c){return this.int16[3*c+1]},u.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},u}(uu);Mn("SymbolLineVertexArray",k);var $=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,c),u}(Eu);$.prototype.size=8;var oe=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new $(this,c)},u}(Ch);Mn("FeatureIndexArray",oe);var be=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(o){o===void 0&&(o=[]),this.segments=o};function Oe(o,u){return 256*(o=ct(Math.floor(o),0,255))+ct(Math.floor(u),0,255)}we.prototype.prepareSegment=function(o,u,c,m){var b=this.segments[this.segments.length-1];return o>we.MAX_VERTEX_ARRAY_LENGTH&&Ve("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+o),(!b||b.vertexLength+o>we.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m)&&(b={vertexOffset:u.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(b.sortKey=m),this.segments.push(b)),b},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var o=0,u=this.segments;o<u.length;o+=1){var c=u[o];for(var m in c.vaos)c.vaos[m].destroy()}},we.simpleSegment=function(o,u,c,m){return new we([{vertexOffset:o,primitiveOffset:u,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mn("SegmentVector",we);var qe=_o([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),$e=le(function(o){o.exports=function(u,c){var m,b,E,T,M,B,G,Q;for(b=u.length-(m=3&u.length),E=c,M=3432918353,B=461845907,Q=0;Q<b;)G=255&u.charCodeAt(Q)|(255&u.charCodeAt(++Q))<<8|(255&u.charCodeAt(++Q))<<16|(255&u.charCodeAt(++Q))<<24,++Q,E=27492+(65535&(T=5*(65535&(E=(E^=G=(65535&(G=(G=(65535&G)*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(G=0,m){case 3:G^=(255&u.charCodeAt(Q+2))<<16;case 2:G^=(255&u.charCodeAt(Q+1))<<8;case 1:E^=G=(65535&(G=(G=(65535&(G^=255&u.charCodeAt(Q)))*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),vt=le(function(o){o.exports=function(u,c){for(var m,b=u.length,E=c^b,T=0;b>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(T)|(255&u.charCodeAt(++T))<<8|(255&u.charCodeAt(++T))<<16|(255&u.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),b-=4,++T;switch(b){case 3:E^=(255&u.charCodeAt(T+2))<<16;case 2:E^=(255&u.charCodeAt(T+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(T)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),He=$e,dt=vt;He.murmur3=$e,He.murmur2=dt;var wt=function(){this.ids=[],this.positions=[],this.indexed=!1};wt.prototype.add=function(o,u,c,m){this.ids.push(ar(o)),this.positions.push(u,c,m)},wt.prototype.getPositions=function(o){for(var u=ar(o),c=0,m=this.ids.length-1;c<m;){var b=c+m>>1;this.ids[b]>=u?m=b:c=b+1}for(var E=[];this.ids[c]===u;)E.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return E},wt.serialize=function(o,u){var c=new Float64Array(o.ids),m=new Uint32Array(o.positions);return function b(E,T,M,B){for(;M<B;){for(var G=E[M+B>>1],Q=M-1,ee=B+1;;){do Q++;while(E[Q]<G);do ee--;while(E[ee]>G);if(Q>=ee)break;Qt(E,Q,ee),Qt(T,3*Q,3*ee),Qt(T,3*Q+1,3*ee+1),Qt(T,3*Q+2,3*ee+2)}ee-M<B-ee?(b(E,T,M,ee),M=ee+1):(b(E,T,ee+1,B),B=ee)}}(c,m,0,c.length-1),u&&u.push(c.buffer,m.buffer),{ids:c,positions:m}},wt.deserialize=function(o){var u=new wt;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u};var zt=Math.pow(2,53)-1;function ar(o){var u=+o;return!isNaN(u)&&u<=zt?u:He(String(o))}function Qt(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}Mn("FeaturePositionMap",wt);var hr=function(o,u){this.gl=o.gl,this.location=u},Tr=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},u}(hr),Yr=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},u}(hr),Ur=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},u}(hr),_n=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},u}(hr),Hn=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},u}(hr),Vn=function(o){function u(c,m){o.call(this,c,m),this.current=Ii.transparent}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},u}(hr),Wn=new Float32Array(16),Wi=function(o){function u(c,m){o.call(this,c,m),this.current=Wn}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},u}(hr);function Tn(o){return[Oe(255*o.r,255*o.g),Oe(255*o.b,255*o.a)]}var ui=function(o,u,c){this.value=o,this.uniformNames=u.map(function(m){return"u_"+m}),this.type=c};ui.prototype.setUniform=function(o,u,c){o.set(c.constantOr(this.value))},ui.prototype.getBinding=function(o,u,c){return this.type==="color"?new Vn(o,u):new Yr(o,u)};var gi=function(o,u){this.uniformNames=u.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};gi.prototype.setConstantPatternPositions=function(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr},gi.prototype.setUniform=function(o,u,c,m){var b=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&o.set(b)},gi.prototype.getBinding=function(o,u,c){return c.substr(0,9)==="u_pattern"?new Hn(o,u):new Yr(o,u)};var si=function(o,u,c,m){this.expression=o,this.type=c,this.maxValue=0,this.paintVertexAttributes=u.map(function(b){return{name:"a_"+b,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};si.prototype.populatePaintArray=function(o,u,c,m,b){var E=this.paintVertexArray.length,T=this.expression.evaluate(new Le(0),u,{},m,[],b);this.paintVertexArray.resize(o),this._setPaintValue(E,o,T)},si.prototype.updatePaintArray=function(o,u,c,m){var b=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(o,u,b)},si.prototype._setPaintValue=function(o,u,c){if(this.type==="color")for(var m=Tn(c),b=o;b<u;b++)this.paintVertexArray.emplace(b,m[0],m[1]);else{for(var E=o;E<u;E++)this.paintVertexArray.emplace(E,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},si.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},si.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ni=function(o,u,c,m,b,E){this.expression=o,this.uniformNames=u.map(function(T){return"u_"+T+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=u.map(function(T){return{name:"a_"+T,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ni.prototype.populatePaintArray=function(o,u,c,m,b){var E=this.expression.evaluate(new Le(this.zoom),u,{},m,[],b),T=this.expression.evaluate(new Le(this.zoom+1),u,{},m,[],b),M=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(M,o,E,T)},ni.prototype.updatePaintArray=function(o,u,c,m){var b=this.expression.evaluate({zoom:this.zoom},c,m),E=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(o,u,b,E)},ni.prototype._setPaintValue=function(o,u,c,m){if(this.type==="color")for(var b=Tn(c),E=Tn(m),T=o;T<u;T++)this.paintVertexArray.emplace(T,b[0],b[1],E[0],E[1]);else{for(var M=o;M<u;M++)this.paintVertexArray.emplace(M,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},ni.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ni.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ni.prototype.setUniform=function(o,u){var c=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=ct(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);o.set(m)},ni.prototype.getBinding=function(o,u,c){return new Yr(o,u)};var vi=function(o,u,c,m,b,E){this.expression=o,this.type=u,this.useIntegerZoom=c,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b};vi.prototype.populatePaintArray=function(o,u,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,u.patterns&&u.patterns[this.layerId],c)},vi.prototype.updatePaintArray=function(o,u,c,m,b){this._setPaintValues(o,u,c.patterns&&c.patterns[this.layerId],b)},vi.prototype._setPaintValues=function(o,u,c,m){if(m&&c){var b=m[c.min],E=m[c.mid],T=m[c.max];if(b&&E&&T)for(var M=o;M<u;M++)this.zoomInPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],E.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],E.pixelRatio,T.pixelRatio)}},vi.prototype.upload=function(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,qe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,qe.members,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ii=function(o,u,c){this.binders={},this._buffers=[];var m=[];for(var b in o.paint._values)if(c(b)){var E=o.paint.get(b);if(E instanceof Ro&&Il(E.property.specification)){var T=Mo(b,o.type),M=E.value,B=E.property.specification.type,G=E.property.useIntegerZoom,Q=E.property.specification["property-type"],ee=Q==="cross-faded"||Q==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=ee?new gi(M.value,T):new ui(M.value,T,B),m.push("/u_"+b);else if(M.kind==="source"||ee){var pe=no(b,B,"source");this.binders[b]=ee?new vi(M,B,G,u,pe,o.id):new si(M,T,B,pe),m.push("/a_"+b)}else{var _e=no(b,B,"composite");this.binders[b]=new ni(M,T,B,G,u,_e),m.push("/z_"+b)}}}this.cacheKey=m.sort().join("")};ii.prototype.getMaxValue=function(o){var u=this.binders[o];return u instanceof si||u instanceof ni?u.maxValue:0},ii.prototype.populatePaintArrays=function(o,u,c,m,b){for(var E in this.binders){var T=this.binders[E];(T instanceof si||T instanceof ni||T instanceof vi)&&T.populatePaintArray(o,u,c,m,b)}},ii.prototype.setConstantPatternPositions=function(o,u){for(var c in this.binders){var m=this.binders[c];m instanceof gi&&m.setConstantPatternPositions(o,u)}},ii.prototype.updatePaintArrays=function(o,u,c,m,b){var E=!1;for(var T in o)for(var M=0,B=u.getPositions(T);M<B.length;M+=1){var G=B[M],Q=c.feature(G.index);for(var ee in this.binders){var pe=this.binders[ee];if((pe instanceof si||pe instanceof ni||pe instanceof vi)&&pe.expression.isStateDependent===!0){var _e=m.paint.get(ee);pe.expression=_e.value,pe.updatePaintArray(G.start,G.end,Q,o[T],b),E=!0}}}return E},ii.prototype.defines=function(){var o=[];for(var u in this.binders){var c=this.binders[u];(c instanceof ui||c instanceof gi)&&o.push.apply(o,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return o},ii.prototype.getBinderAttributes=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof si||c instanceof ni)for(var m=0;m<c.paintVertexAttributes.length;m++)o.push(c.paintVertexAttributes[m].name);else if(c instanceof vi)for(var b=0;b<qe.members.length;b++)o.push(qe.members[b].name)}return o},ii.prototype.getBinderUniforms=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof ui||c instanceof gi||c instanceof ni)for(var m=0,b=c.uniformNames;m<b.length;m+=1)o.push(b[m])}return o},ii.prototype.getPaintVertexBuffers=function(){return this._buffers},ii.prototype.getUniforms=function(o,u){var c=[];for(var m in this.binders){var b=this.binders[m];if(b instanceof ui||b instanceof gi||b instanceof ni)for(var E=0,T=b.uniformNames;E<T.length;E+=1){var M=T[E];if(u[M]){var B=b.getBinding(o,u[M],M);c.push({name:M,property:m,binding:B})}}}return c},ii.prototype.setUniforms=function(o,u,c,m){for(var b=0,E=u;b<E.length;b+=1){var T=E[b],M=T.name,B=T.property;this.binders[B].setUniform(T.binding,m,c.get(B),M)}},ii.prototype.updatePaintBuffers=function(o){for(var u in this._buffers=[],this.binders){var c=this.binders[u];if(o&&c instanceof vi){var m=o.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof si||c instanceof ni)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},ii.prototype.upload=function(o){for(var u in this.binders){var c=this.binders[u];(c instanceof si||c instanceof ni||c instanceof vi)&&c.upload(o)}this.updatePaintBuffers()},ii.prototype.destroy=function(){for(var o in this.binders){var u=this.binders[o];(u instanceof si||u instanceof ni||u instanceof vi)&&u.destroy()}};var Jn=function(o,u,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,b=o;m<b.length;m+=1){var E=b[m];this.programConfigurations[E.id]=new ii(E,u,c)}this.needsUpload=!1,this._featureMap=new wt,this._bufferOffset=0};function Mo(o,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(u+"-","").replace(/-/g,"_")]}function no(o,u,c){var m={color:{source:Jl,composite:Rh},number:{source:Ll,composite:Jl}},b=function(E){return{"line-pattern":{source:Su,composite:Su},"fill-pattern":{source:Su,composite:Su},"fill-extrusion-pattern":{source:Su,composite:Su}}[E]}(o);return b&&b[c]||m[u][c]}Jn.prototype.populatePaintArrays=function(o,u,c,m,b,E){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,u,m,b,E);u.id!==void 0&&this._featureMap.add(u.id,c,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0},Jn.prototype.updatePaintArrays=function(o,u,c,m){for(var b=0,E=c;b<E.length;b+=1){var T=E[b];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(o,this._featureMap,u,T,m)||this.needsUpload}},Jn.prototype.get=function(o){return this.programConfigurations[o]},Jn.prototype.upload=function(o){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}},Jn.prototype.destroy=function(){for(var o in this.programConfigurations)this.programConfigurations[o].destroy()},Mn("ConstantBinder",ui),Mn("CrossFadedConstantBinder",gi),Mn("SourceExpressionBinder",si),Mn("CrossFadedCompositeBinder",vi),Mn("CompositeExpressionBinder",ni),Mn("ProgramConfiguration",ii,{omit:["_buffers"]}),Mn("ProgramConfigurationSet",Jn);var Io=Math.pow(2,14)-1,bo=-Io-1;function Ka(o){for(var u=8192/o.extent,c=o.loadGeometry(),m=0;m<c.length;m++)for(var b=c[m],E=0;E<b.length;E++){var T=b[E],M=Math.round(T.x*u),B=Math.round(T.y*u);T.x=ct(M,bo,Io),T.y=ct(B,bo,Io),(M<T.x||M>T.x+1||B<T.y||B>T.y+1)&&Ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function io(o,u){return{type:o.type,id:o.id,properties:o.properties,geometry:u?Ka(o):[]}}function Es(o,u,c,m,b){o.emplaceBack(2*u+(m+1)/2,2*c+(b+1)/2)}var Ss=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Dl,this.indexArray=new hs,this.segments=new we,this.programConfigurations=new Jn(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function hl(o,u){for(var c=0;c<o.length;c++)if(cu(u,o[c]))return!0;for(var m=0;m<u.length;m++)if(cu(o,u[m]))return!0;return!!Oc(o,u)}function As(o,u,c){return!!cu(o,u)||!!Tu(u,o,c)}function lu(o,u){if(o.length===1)return pl(u,o[0]);for(var c=0;c<u.length;c++)for(var m=u[c],b=0;b<m.length;b++)if(cu(o,m[b]))return!0;for(var E=0;E<o.length;E++)if(pl(u,o[E]))return!0;for(var T=0;T<u.length;T++)if(Oc(o,u[T]))return!0;return!1}function Vs(o,u,c){if(o.length>1){if(Oc(o,u))return!0;for(var m=0;m<u.length;m++)if(Tu(u[m],o,c))return!0}for(var b=0;b<o.length;b++)if(Tu(o[b],u,c))return!0;return!1}function Oc(o,u){if(o.length===0||u.length===0)return!1;for(var c=0;c<o.length-1;c++)for(var m=o[c],b=o[c+1],E=0;E<u.length-1;E++)if(Xu(m,b,u[E],u[E+1]))return!0;return!1}function Xu(o,u,c,m){return Vt(o,c,m)!==Vt(u,c,m)&&Vt(o,u,c)!==Vt(o,u,m)}function Tu(o,u,c){var m=c*c;if(u.length===1)return o.distSqr(u[0])<m;for(var b=1;b<u.length;b++)if(rc(o,u[b-1],u[b])<m)return!0;return!1}function rc(o,u,c){var m=u.distSqr(c);if(m===0)return o.distSqr(u);var b=((o.x-u.x)*(c.x-u.x)+(o.y-u.y)*(c.y-u.y))/m;return o.distSqr(b<0?u:b>1?c:c.sub(u)._mult(b)._add(u))}function pl(o,u){for(var c,m,b,E=!1,T=0;T<o.length;T++)for(var M=0,B=(c=o[T]).length-1;M<c.length;B=M++)(m=c[M]).y>u.y!=(b=c[B]).y>u.y&&u.x<(b.x-m.x)*(u.y-m.y)/(b.y-m.y)+m.x&&(E=!E);return E}function cu(o,u){for(var c=!1,m=0,b=o.length-1;m<o.length;b=m++){var E=o[m],T=o[b];E.y>u.y!=T.y>u.y&&u.x<(T.x-E.x)*(u.y-E.y)/(T.y-E.y)+E.x&&(c=!c)}return c}function dl(o,u,c){var m=c[0],b=c[2];if(o.x<m.x&&u.x<m.x||o.x>b.x&&u.x>b.x||o.y<m.y&&u.y<m.y||o.y>b.y&&u.y>b.y)return!1;var E=Vt(o,u,c[0]);return E!==Vt(o,u,c[1])||E!==Vt(o,u,c[2])||E!==Vt(o,u,c[3])}function Po(o,u,c){var m=u.paint.get(o).value;return m.kind==="constant"?m.value:c.programConfigurations.get(u.id).getMaxValue(o)}function lo(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ms(o,u,c,m,b){if(!u[0]&&!u[1])return o;var E=V.convert(u)._mult(b);c==="viewport"&&E._rotate(-m);for(var T=[],M=0;M<o.length;M++)T.push(o[M].sub(E));return T}Ss.prototype.populate=function(o,u,c){var m=this.layers[0],b=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var T=0,M=o;T<M.length;T+=1){var B=M[T],G=B.feature,Q=B.id,ee=B.index,pe=B.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Ge=io(G,_e);if(this.layers[0]._featureFilter.filter(new Le(this.zoom),Ge,c)){var Ye=E?E.evaluate(Ge,{},c):void 0,yt={id:Q,properties:G.properties,type:G.type,sourceLayerIndex:pe,index:ee,geometry:_e?Ge.geometry:Ka(G),patterns:{},sortKey:Ye};b.push(yt)}}E&&b.sort(function(on,Dn){return on.sortKey-Dn.sortKey});for(var ot=0,Dt=b;ot<Dt.length;ot+=1){var Ht=Dt[ot],ir=Ht.geometry,ur=Ht.index,xr=Ht.sourceLayerIndex,Wr=o[ur].feature;this.addFeature(Ht,ir,ur,c),u.featureIndex.insert(Wr,ir,ur,xr,this.index)}},Ss.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},Ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,be),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ss.prototype.addFeature=function(o,u,c,m){for(var b=0,E=u;b<E.length;b+=1)for(var T=0,M=E[b];T<M.length;T+=1){var B=M[T],G=B.x,Q=B.y;if(!(G<0||G>=8192||Q<0||Q>=8192)){var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),pe=ee.vertexLength;Es(this.layoutVertexArray,G,Q,-1,-1),Es(this.layoutVertexArray,G,Q,1,-1),Es(this.layoutVertexArray,G,Q,1,1),Es(this.layoutVertexArray,G,Q,-1,1),this.indexArray.emplaceBack(pe,pe+1,pe+2),this.indexArray.emplaceBack(pe,pe+3,pe+2),ee.vertexLength+=4,ee.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,{},m)},Mn("CircleBucket",Ss,{omit:["layers"]});var fu=new Ua({"circle-sort-key":new Pn(W.layout_circle["circle-sort-key"])}),wu={paint:new Ua({"circle-radius":new Pn(W.paint_circle["circle-radius"]),"circle-color":new Pn(W.paint_circle["circle-color"]),"circle-blur":new Pn(W.paint_circle["circle-blur"]),"circle-opacity":new Pn(W.paint_circle["circle-opacity"]),"circle-translate":new Zn(W.paint_circle["circle-translate"]),"circle-translate-anchor":new Zn(W.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Zn(W.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Zn(W.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pn(W.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pn(W.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pn(W.paint_circle["circle-stroke-opacity"])}),layout:fu},Vi=typeof Float32Array!="undefined"?Float32Array:Array;function ts(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function co(o,u,c){var m=u[0],b=u[1],E=u[2],T=u[3],M=u[4],B=u[5],G=u[6],Q=u[7],ee=u[8],pe=u[9],_e=u[10],Ge=u[11],Ye=u[12],yt=u[13],ot=u[14],Dt=u[15],Ht=c[0],ir=c[1],ur=c[2],xr=c[3];return o[0]=Ht*m+ir*M+ur*ee+xr*Ye,o[1]=Ht*b+ir*B+ur*pe+xr*yt,o[2]=Ht*E+ir*G+ur*_e+xr*ot,o[3]=Ht*T+ir*Q+ur*Ge+xr*Dt,o[4]=(Ht=c[4])*m+(ir=c[5])*M+(ur=c[6])*ee+(xr=c[7])*Ye,o[5]=Ht*b+ir*B+ur*pe+xr*yt,o[6]=Ht*E+ir*G+ur*_e+xr*ot,o[7]=Ht*T+ir*Q+ur*Ge+xr*Dt,o[8]=(Ht=c[8])*m+(ir=c[9])*M+(ur=c[10])*ee+(xr=c[11])*Ye,o[9]=Ht*b+ir*B+ur*pe+xr*yt,o[10]=Ht*E+ir*G+ur*_e+xr*ot,o[11]=Ht*T+ir*Q+ur*Ge+xr*Dt,o[12]=(Ht=c[12])*m+(ir=c[13])*M+(ur=c[14])*ee+(xr=c[15])*Ye,o[13]=Ht*b+ir*B+ur*pe+xr*yt,o[14]=Ht*E+ir*G+ur*_e+xr*ot,o[15]=Ht*T+ir*Q+ur*Ge+xr*Dt,o}Math.hypot||(Math.hypot=function(){for(var o=arguments,u=0,c=arguments.length;c--;)u+=o[c]*o[c];return Math.sqrt(u)});var hu,kc=co;function $u(o,u,c){var m=u[0],b=u[1],E=u[2],T=u[3];return o[0]=c[0]*m+c[4]*b+c[8]*E+c[12]*T,o[1]=c[1]*m+c[5]*b+c[9]*E+c[13]*T,o[2]=c[2]*m+c[6]*b+c[10]*E+c[14]*T,o[3]=c[3]*m+c[7]*b+c[11]*E+c[15]*T,o}hu=new Vi(3),Vi!=Float32Array&&(hu[0]=0,hu[1]=0,hu[2]=0),function(){var o=new Vi(4);Vi!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0)}();var Mh=(function(){var o=new Vi(2);Vi!=Float32Array&&(o[0]=0,o[1]=0)}(),function(o){function u(c){o.call(this,c,wu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Ss(c)},u.prototype.queryRadius=function(c){var m=c;return Po("circle-radius",this,m)+Po("circle-stroke-width",this,m)+lo(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,B,G){for(var Q=Ms(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,B),ee=this.paint.get("circle-radius").evaluate(m,b)+this.paint.get("circle-stroke-width").evaluate(m,b),pe=this.paint.get("circle-pitch-alignment")==="map",_e=pe?Q:function(Wr,on){return Wr.map(function(Dn){return Oo(Dn,on)})}(Q,G),Ge=pe?ee*B:ee,Ye=0,yt=E;Ye<yt.length;Ye+=1)for(var ot=0,Dt=yt[Ye];ot<Dt.length;ot+=1){var Ht=Dt[ot],ir=pe?Ht:Oo(Ht,G),ur=Ge,xr=$u([],[Ht.x,Ht.y,0,1],G);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ur*=xr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ur*=M.cameraToCenterDistance/xr[3]),As(_e,ir,ur))return!0}return!1},u}(tu));function Oo(o,u){var c=$u([],[o.x,o.y,0,1],u);return new V(c[0]/c[3],c[1]/c[3])}var Br=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Ss);function js(o,u,c,m){var b=u.width,E=u.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==b*E*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(b*E*c);return o.width=b,o.height=E,o.data=m,o}function Ih(o,u,c){var m=u.width,b=u.height;if(m!==o.width||b!==o.height){var E=js({},{width:m,height:b},c);ko(o,E,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,m),height:Math.min(o.height,b)},c),o.width=m,o.height=b,o.data=E.data}}function ko(o,u,c,m,b,E){if(b.width===0||b.height===0)return u;if(b.width>o.width||b.height>o.height||c.x>o.width-b.width||c.y>o.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>u.width||b.height>u.height||m.x>u.width-b.width||m.y>u.height-b.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=o.data,M=u.data,B=0;B<b.height;B++)for(var G=((c.y+B)*o.width+c.x)*E,Q=((m.y+B)*u.width+m.x)*E,ee=0;ee<b.width*E;ee++)M[Q+ee]=T[G+ee];return u}Mn("HeatmapBucket",Br,{omit:["layers"]});var ru=function(o,u){js(this,o,1,u)};ru.prototype.resize=function(o){Ih(this,o,1)},ru.prototype.clone=function(){return new ru({width:this.width,height:this.height},new Uint8Array(this.data))},ru.copy=function(o,u,c,m,b){ko(o,u,c,m,b,1)};var Do=function(o,u){js(this,o,4,u)};Do.prototype.resize=function(o){Ih(this,o,4)},Do.prototype.replace=function(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o},Do.prototype.clone=function(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))},Do.copy=function(o,u,c,m,b){ko(o,u,c,m,b,4)},Mn("AlphaImage",ru),Mn("RGBAImage",Do);var pp={paint:new Ua({"heatmap-radius":new Pn(W.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pn(W.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Zn(W.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bu(W.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Zn(W.paint_heatmap["heatmap-opacity"])})};function nc(o){var u={},c=o.resolution||256,m=o.clips?o.clips.length:1,b=o.image||new Do({width:c,height:m}),E=function(Ge,Ye,yt){u[o.evaluationKey]=yt;var ot=o.expression.evaluate(u);b.data[Ge+Ye+0]=Math.floor(255*ot.r/ot.a),b.data[Ge+Ye+1]=Math.floor(255*ot.g/ot.a),b.data[Ge+Ye+2]=Math.floor(255*ot.b/ot.a),b.data[Ge+Ye+3]=Math.floor(255*ot.a)};if(o.clips)for(var T=0,M=0;T<m;++T,M+=4*c)for(var B=0,G=0;B<c;B++,G+=4){var Q=B/(c-1),ee=o.clips[T];E(M,G,ee.start*(1-Q)+ee.end*Q)}else for(var pe=0,_e=0;pe<c;pe++,_e+=4)E(0,_e,pe/(c-1));return b}var vl=function(o){function u(c){o.call(this,c,pp),this._updateColorRamp()}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Br(c)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=nc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(tu),Xp={paint:new Ua({"hillshade-illumination-direction":new Zn(W.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Zn(W.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Zn(W.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Zn(W.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Zn(W.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Zn(W.paint_hillshade["hillshade-accent-color"])})},ng=function(o){function u(c){o.call(this,c,Xp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(tu),Zv=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,jf=Ph,dp=Ph;function Ph(o,u,c){c=c||2;var m,b,E,T,M,B,G,Q=u&&u.length,ee=Q?u[0]*c:o.length,pe=Ld(o,0,ee,c,!0),_e=[];if(!pe||pe.next===pe.prev)return _e;if(Q&&(pe=function(Ye,yt,ot,Dt){var Ht,ir,ur,xr=[];for(Ht=0,ir=yt.length;Ht<ir;Ht++)(ur=Ld(Ye,yt[Ht]*Dt,Ht<ir-1?yt[Ht+1]*Dt:Ye.length,Dt,!1))===ur.next&&(ur.steiner=!0),xr.push(vp(ur));for(xr.sort(Fd),Ht=0;Ht<xr.length;Ht++)Nd(xr[Ht],ot),ot=Dc(ot,ot.next);return ot}(o,u,pe,c)),o.length>80*c){m=E=o[0],b=T=o[1];for(var Ge=c;Ge<ee;Ge+=c)(M=o[Ge])<m&&(m=M),(B=o[Ge+1])<b&&(b=B),M>E&&(E=M),B>T&&(T=B);G=(G=Math.max(E-m,T-b))!==0?1/G:0}return Oh(pe,_e,c,m,b,G),_e}function Ld(o,u,c,m,b){var E,T;if(b===ic(o,u,c,m)>0)for(E=u;E<c;E+=m)T=Xf(E,o[E],o[E+1],T);else for(E=c-m;E>=u;E-=m)T=Xf(E,o[E],o[E+1],T);return T&&Hf(T,T.next)&&(Fc(T),T=T.next),T}function Dc(o,u){if(!o)return o;u||(u=o);var c,m=o;do if(c=!1,m.steiner||!Hf(m,m.next)&&ao(m.prev,m,m.next)!==0)m=m.next;else{if(Fc(m),(m=u=m.prev)===m.next)break;c=!0}while(c||m!==u);return u}function Oh(o,u,c,m,b,E,T){if(o){!T&&E&&function(Q,ee,pe,_e){var Ge=Q;do Ge.z===null&&(Ge.z=Bl(Ge.x,Ge.y,ee,pe,_e)),Ge.prevZ=Ge.prev,Ge.nextZ=Ge.next,Ge=Ge.next;while(Ge!==Q);Ge.prevZ.nextZ=null,Ge.prevZ=null,function(Ye){var yt,ot,Dt,Ht,ir,ur,xr,Wr,on=1;do{for(ot=Ye,Ye=null,ir=null,ur=0;ot;){for(ur++,Dt=ot,xr=0,yt=0;yt<on&&(xr++,Dt=Dt.nextZ);yt++);for(Wr=on;xr>0||Wr>0&&Dt;)xr!==0&&(Wr===0||!Dt||ot.z<=Dt.z)?(Ht=ot,ot=ot.nextZ,xr--):(Ht=Dt,Dt=Dt.nextZ,Wr--),ir?ir.nextZ=Ht:Ye=Ht,Ht.prevZ=ir,ir=Ht;ot=Dt}ir.nextZ=null,on*=2}while(ur>1)}(Ge)}(o,m,b,E);for(var M,B,G=o;o.prev!==o.next;)if(M=o.prev,B=o.next,E?Bd(o,m,b,E):Vv(o))u.push(M.i/c),u.push(o.i/c),u.push(B.i/c),Fc(o),o=B.next,G=B.next;else if((o=B)===G){T?T===1?Oh(o=ig(Dc(o),u,c),u,c,m,b,E,2):T===2&&$p(o,u,c,m,b,E):Oh(Dc(o),u,c,m,b,E,1);break}}}function Vv(o){var u=o.prev,c=o,m=o.next;if(ao(u,c,m)>=0)return!1;for(var b=o.next.next;b!==o.prev;){if(Lc(u.x,u.y,c.x,c.y,m.x,m.y,b.x,b.y)&&ao(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function Bd(o,u,c,m){var b=o.prev,E=o,T=o.next;if(ao(b,E,T)>=0)return!1;for(var M=b.x>E.x?b.x>T.x?b.x:T.x:E.x>T.x?E.x:T.x,B=b.y>E.y?b.y>T.y?b.y:T.y:E.y>T.y?E.y:T.y,G=Bl(b.x<E.x?b.x<T.x?b.x:T.x:E.x<T.x?E.x:T.x,b.y<E.y?b.y<T.y?b.y:T.y:E.y<T.y?E.y:T.y,u,c,m),Q=Bl(M,B,u,c,m),ee=o.prevZ,pe=o.nextZ;ee&&ee.z>=G&&pe&&pe.z<=Q;){if(ee!==o.prev&&ee!==o.next&&Lc(b.x,b.y,E.x,E.y,T.x,T.y,ee.x,ee.y)&&ao(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,pe!==o.prev&&pe!==o.next&&Lc(b.x,b.y,E.x,E.y,T.x,T.y,pe.x,pe.y)&&ao(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;ee&&ee.z>=G;){if(ee!==o.prev&&ee!==o.next&&Lc(b.x,b.y,E.x,E.y,T.x,T.y,ee.x,ee.y)&&ao(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;pe&&pe.z<=Q;){if(pe!==o.prev&&pe!==o.next&&Lc(b.x,b.y,E.x,E.y,T.x,T.y,pe.x,pe.y)&&ao(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function ig(o,u,c){var m=o;do{var b=m.prev,E=m.next.next;!Hf(b,E)&&Wf(b,m,m.next,E)&&Bc(b,E)&&Bc(E,b)&&(u.push(b.i/c),u.push(m.i/c),u.push(E.i/c),Fc(m),Fc(m.next),m=o=E),m=m.next}while(m!==o);return Dc(m)}function $p(o,u,c,m,b,E){var T=o;do{for(var M=T.next.next;M!==T.prev;){if(T.i!==M.i&&qp(T,M)){var B=Gf(T,M);return T=Dc(T,T.next),B=Dc(B,B.next),Oh(T,u,c,m,b,E),void Oh(B,u,c,m,b,E)}M=M.next}T=T.next}while(T!==o)}function Fd(o,u){return o.x-u.x}function Nd(o,u){if(u=function(m,b){var E,T=b,M=m.x,B=m.y,G=-1/0;do{if(B<=T.y&&B>=T.next.y&&T.next.y!==T.y){var Q=T.x+(B-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(Q<=M&&Q>G){if(G=Q,Q===M){if(B===T.y)return T;if(B===T.next.y)return T.next}E=T.x<T.next.x?T:T.next}}T=T.next}while(T!==b);if(!E)return null;if(M===G)return E;var ee,pe=E,_e=E.x,Ge=E.y,Ye=1/0;T=E;do M>=T.x&&T.x>=_e&&M!==T.x&&Lc(B<Ge?M:G,B,_e,Ge,B<Ge?G:M,B,T.x,T.y)&&(ee=Math.abs(B-T.y)/(M-T.x),Bc(T,m)&&(ee<Ye||ee===Ye&&(T.x>E.x||T.x===E.x&&Yp(E,T)))&&(E=T,Ye=ee)),T=T.next;while(T!==pe);return E}(o,u)){var c=Gf(u,o);Dc(u,u.next),Dc(c,c.next)}}function Yp(o,u){return ao(o.prev,o,u.prev)<0&&ao(u.next,o,o.next)<0}function Bl(o,u,c,m,b){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-c)*b)|o<<8))|o<<4))|o<<2))|o<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-m)*b)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function vp(o){var u=o,c=o;do(u.x<c.x||u.x===c.x&&u.y<c.y)&&(c=u),u=u.next;while(u!==o);return c}function Lc(o,u,c,m,b,E,T,M){return(b-T)*(u-M)-(o-T)*(E-M)>=0&&(o-T)*(m-M)-(c-T)*(u-M)>=0&&(c-T)*(E-M)-(b-T)*(m-M)>=0}function qp(o,u){return o.next.i!==u.i&&o.prev.i!==u.i&&!function(c,m){var b=c;do{if(b.i!==c.i&&b.next.i!==c.i&&b.i!==m.i&&b.next.i!==m.i&&Wf(b,b.next,c,m))return!0;b=b.next}while(b!==c);return!1}(o,u)&&(Bc(o,u)&&Bc(u,o)&&function(c,m){var b=c,E=!1,T=(c.x+m.x)/2,M=(c.y+m.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&T<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(E=!E),b=b.next;while(b!==c);return E}(o,u)&&(ao(o.prev,o,u.prev)||ao(o,u.prev,u))||Hf(o,u)&&ao(o.prev,o,o.next)>0&&ao(u.prev,u,u.next)>0)}function ao(o,u,c){return(u.y-o.y)*(c.x-u.x)-(u.x-o.x)*(c.y-u.y)}function Hf(o,u){return o.x===u.x&&o.y===u.y}function Wf(o,u,c,m){var b=ff(ao(o,u,c)),E=ff(ao(o,u,m)),T=ff(ao(c,m,o)),M=ff(ao(c,m,u));return b!==E&&T!==M||!(b!==0||!ml(o,c,u))||!(E!==0||!ml(o,m,u))||!(T!==0||!ml(c,o,m))||!(M!==0||!ml(c,u,m))}function ml(o,u,c){return u.x<=Math.max(o.x,c.x)&&u.x>=Math.min(o.x,c.x)&&u.y<=Math.max(o.y,c.y)&&u.y>=Math.min(o.y,c.y)}function ff(o){return o>0?1:o<0?-1:0}function Bc(o,u){return ao(o.prev,o,o.next)<0?ao(o,u,o.next)>=0&&ao(o,o.prev,u)>=0:ao(o,u,o.prev)<0||ao(o,o.next,u)<0}function Gf(o,u){var c=new Nc(o.i,o.x,o.y),m=new Nc(u.i,u.x,u.y),b=o.next,E=u.prev;return o.next=u,u.prev=o,c.next=b,b.prev=c,m.next=c,c.prev=m,E.next=m,m.prev=E,m}function Xf(o,u,c,m){var b=new Nc(o,u,c);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function Fc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Nc(o,u,c){this.i=o,this.x=u,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ic(o,u,c,m){for(var b=0,E=u,T=c-m;E<c;E+=m)b+=(o[T]-o[E])*(o[E+1]+o[T+1]),T=E;return b}function Kp(o,u,c,m,b){(function E(T,M,B,G,Q){for(;G>B;){if(G-B>600){var ee=G-B+1,pe=M-B+1,_e=Math.log(ee),Ge=.5*Math.exp(2*_e/3),Ye=.5*Math.sqrt(_e*Ge*(ee-Ge)/ee)*(pe-ee/2<0?-1:1);E(T,M,Math.max(B,Math.floor(M-pe*Ge/ee+Ye)),Math.min(G,Math.floor(M+(ee-pe)*Ge/ee+Ye)),Q)}var yt=T[M],ot=B,Dt=G;for(ac(T,B,M),Q(T[G],yt)>0&&ac(T,B,G);ot<Dt;){for(ac(T,ot,Dt),ot++,Dt--;Q(T[ot],yt)<0;)ot++;for(;Q(T[Dt],yt)>0;)Dt--}Q(T[B],yt)===0?ac(T,B,Dt):ac(T,++Dt,G),Dt<=M&&(B=Dt+1),M<=Dt&&(G=Dt-1)}})(o,u,c||0,m||o.length-1,b||Hs)}function ac(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}function Hs(o,u){return o<u?-1:o>u?1:0}function mp(o,u){var c=o.length;if(c<=1)return[o];for(var m,b,E=[],T=0;T<c;T++){var M=mr(o[T]);M!==0&&(o[T].area=Math.abs(M),b===void 0&&(b=M<0),b===M<0?(m&&E.push(m),m=[o[T]]):m.push(o[T]))}if(m&&E.push(m),u>1)for(var B=0;B<E.length;B++)E[B].length<=u||(Kp(E[B],u,1,E[B].length-1,Qp),E[B]=E[B].slice(0,u));return E}function Qp(o,u){return u.area-o.area}function Jp(o,u,c){for(var m=c.patternDependencies,b=!1,E=0,T=u;E<T.length;E+=1){var M=T[E].paint.get(o+"-pattern");M.isConstant()||(b=!0);var B=M.constantOr(null);B&&(b=!0,m[B.to]=!0,m[B.from]=!0)}return b}function kh(o,u,c,m,b){for(var E=b.patternDependencies,T=0,M=u;T<M.length;T+=1){var B=M[T],G=B.paint.get(o+"-pattern").value;if(G.kind!=="constant"){var Q=G.evaluate({zoom:m-1},c,{},b.availableImages),ee=G.evaluate({zoom:m},c,{},b.availableImages),pe=G.evaluate({zoom:m+1},c,{},b.availableImages);ee=ee&&ee.name?ee.name:ee,pe=pe&&pe.name?pe.name:pe,E[Q=Q&&Q.name?Q.name:Q]=!0,E[ee]=!0,E[pe]=!0,c.patterns[B.id]={min:Q,mid:ee,max:pe}}}return c}Ph.deviation=function(o,u,c,m){var b=u&&u.length,E=Math.abs(ic(o,0,b?u[0]*c:o.length,c));if(b)for(var T=0,M=u.length;T<M;T++)E-=Math.abs(ic(o,u[T]*c,T<M-1?u[T+1]*c:o.length,c));var B=0;for(T=0;T<m.length;T+=3){var G=m[T]*c,Q=m[T+1]*c,ee=m[T+2]*c;B+=Math.abs((o[G]-o[ee])*(o[Q+1]-o[G+1])-(o[G]-o[Q])*(o[ee+1]-o[G+1]))}return E===0&&B===0?0:Math.abs((B-E)/E)},Ph.flatten=function(o){for(var u=o[0][0].length,c={vertices:[],holes:[],dimensions:u},m=0,b=0;b<o.length;b++){for(var E=0;E<o[b].length;E++)for(var T=0;T<u;T++)c.vertices.push(o[b][E][T]);b>0&&c.holes.push(m+=o[b-1].length)}return c},jf.default=dp;var gl=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dl,this.indexArray=new hs,this.indexArray2=new Gu,this.programConfigurations=new Jn(o.layers,o.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};gl.prototype.populate=function(o,u,c){this.hasPattern=Jp("fill",this.layers,u);for(var m=this.layers[0].layout.get("fill-sort-key"),b=[],E=0,T=o;E<T.length;E+=1){var M=T[E],B=M.feature,G=M.id,Q=M.index,ee=M.sourceLayerIndex,pe=this.layers[0]._featureFilter.needGeometry,_e=io(B,pe);if(this.layers[0]._featureFilter.filter(new Le(this.zoom),_e,c)){var Ge=m?m.evaluate(_e,{},c,u.availableImages):void 0,Ye={id:G,properties:B.properties,type:B.type,sourceLayerIndex:ee,index:Q,geometry:pe?_e.geometry:Ka(B),patterns:{},sortKey:Ge};b.push(Ye)}}m&&b.sort(function(Wr,on){return Wr.sortKey-on.sortKey});for(var yt=0,ot=b;yt<ot.length;yt+=1){var Dt=ot[yt],Ht=Dt.geometry,ir=Dt.index,ur=Dt.sourceLayerIndex;if(this.hasPattern){var xr=kh("fill",this.layers,Dt,this.zoom,u);this.patternFeatures.push(xr)}else this.addFeature(Dt,Ht,ir,c,{});u.featureIndex.insert(o[ir].feature,Ht,ir,ur,this.index)}},gl.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},gl.prototype.addFeatures=function(o,u,c){for(var m=0,b=this.patternFeatures;m<b.length;m+=1){var E=b[m];this.addFeature(E,E.geometry,E.index,u,c)}},gl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},gl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},gl.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0},gl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},gl.prototype.addFeature=function(o,u,c,m,b){for(var E=0,T=mp(u,500);E<T.length;E+=1){for(var M=T[E],B=0,G=0,Q=M;G<Q.length;G+=1)B+=Q[G].length;for(var ee=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray),pe=ee.vertexLength,_e=[],Ge=[],Ye=0,yt=M;Ye<yt.length;Ye+=1){var ot=yt[Ye];if(ot.length!==0){ot!==M[0]&&Ge.push(_e.length/2);var Dt=this.segments2.prepareSegment(ot.length,this.layoutVertexArray,this.indexArray2),Ht=Dt.vertexLength;this.layoutVertexArray.emplaceBack(ot[0].x,ot[0].y),this.indexArray2.emplaceBack(Ht+ot.length-1,Ht),_e.push(ot[0].x),_e.push(ot[0].y);for(var ir=1;ir<ot.length;ir++)this.layoutVertexArray.emplaceBack(ot[ir].x,ot[ir].y),this.indexArray2.emplaceBack(Ht+ir-1,Ht+ir),_e.push(ot[ir].x),_e.push(ot[ir].y);Dt.vertexLength+=ot.length,Dt.primitiveLength+=ot.length}}for(var ur=jf(_e,Ge),xr=0;xr<ur.length;xr+=3)this.indexArray.emplaceBack(pe+ur[xr],pe+ur[xr+1],pe+ur[xr+2]);ee.vertexLength+=B,ee.primitiveLength+=ur.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,b,m)},Mn("FillBucket",gl,{omit:["layers","patternFeatures"]});var Yu=new Ua({"fill-sort-key":new Pn(W.layout_fill["fill-sort-key"])}),Ud={paint:new Ua({"fill-antialias":new Zn(W.paint_fill["fill-antialias"]),"fill-opacity":new Pn(W.paint_fill["fill-opacity"]),"fill-color":new Pn(W.paint_fill["fill-color"]),"fill-outline-color":new Pn(W.paint_fill["fill-outline-color"]),"fill-translate":new Zn(W.paint_fill["fill-translate"]),"fill-translate-anchor":new Zn(W.paint_fill["fill-translate-anchor"]),"fill-pattern":new cs(W.paint_fill["fill-pattern"])}),layout:Yu},gp=function(o){function u(c){o.call(this,c,Ud)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m);var b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(c){return new gl(c)},u.prototype.queryRadius=function(){return lo(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,B){return lu(Ms(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,B),E)},u.prototype.isTileClipped=function(){return!0},u}(tu),zd=_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Dh=Uc;function Uc(o,u,c,m,b){this.properties={},this.extent=c,this.type=0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=b,o.readFields(ed,this,u)}function ed(o,u,c){o==1?u.id=c.readVarint():o==2?function(m,b){for(var E=m.readVarint()+m.pos;m.pos<E;){var T=b._keys[m.readVarint()],M=b._values[m.readVarint()];b.properties[T]=M}}(c,u):o==3?u.type=c.readVarint():o==4&&(u._geometry=c.pos)}function qu(o){for(var u,c,m=0,b=0,E=o.length,T=E-1;b<E;T=b++)m+=((c=o[T]).x-(u=o[b]).x)*(u.y+c.y);return m}Uc.types=["Unknown","Point","LineString","Polygon"],Uc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var u,c=o.readVarint()+o.pos,m=1,b=0,E=0,T=0,M=[];o.pos<c;){if(b<=0){var B=o.readVarint();m=7&B,b=B>>3}if(b--,m===1||m===2)E+=o.readSVarint(),T+=o.readSVarint(),m===1&&(u&&M.push(u),u=[]),u.push(new V(E,T));else{if(m!==7)throw new Error("unknown command "+m);u&&u.push(u[0].clone())}}return u&&M.push(u),M},Uc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var u=o.readVarint()+o.pos,c=1,m=0,b=0,E=0,T=1/0,M=-1/0,B=1/0,G=-1/0;o.pos<u;){if(m<=0){var Q=o.readVarint();c=7&Q,m=Q>>3}if(m--,c===1||c===2)(b+=o.readSVarint())<T&&(T=b),b>M&&(M=b),(E+=o.readSVarint())<B&&(B=E),E>G&&(G=E);else if(c!==7)throw new Error("unknown command "+c)}return[T,B,M,G]},Uc.prototype.toGeoJSON=function(o,u,c){var m,b,E=this.extent*Math.pow(2,c),T=this.extent*o,M=this.extent*u,B=this.loadGeometry(),G=Uc.types[this.type];function Q(_e){for(var Ge=0;Ge<_e.length;Ge++){var Ye=_e[Ge];_e[Ge]=[360*(Ye.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ye.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var ee=[];for(m=0;m<B.length;m++)ee[m]=B[m][0];Q(B=ee);break;case 2:for(m=0;m<B.length;m++)Q(B[m]);break;case 3:for(B=function(_e){var Ge=_e.length;if(Ge<=1)return[_e];for(var Ye,yt,ot=[],Dt=0;Dt<Ge;Dt++){var Ht=qu(_e[Dt]);Ht!==0&&(yt===void 0&&(yt=Ht<0),yt===Ht<0?(Ye&&ot.push(Ye),Ye=[_e[Dt]]):Ye.push(_e[Dt]))}return Ye&&ot.push(Ye),ot}(B),m=0;m<B.length;m++)for(b=0;b<B[m].length;b++)Q(B[m][b])}B.length===1?B=B[0]:G="Multi"+G;var pe={type:"Feature",geometry:{type:G,coordinates:B},properties:this.properties};return"id"in this&&(pe.id=this.id),pe};var yp=zc;function zc(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Ws,this,u),this.length=this._features.length}function Ws(o,u,c){o===15?u.version=c.readVarint():o===1?u.name=c.readString():o===5?u.extent=c.readVarint():o===2?u._features.push(c.pos):o===3?u._keys.push(c.readString()):o===4&&u._values.push(function(m){for(var b=null,E=m.readVarint()+m.pos;m.pos<E;){var T=m.readVarint()>>3;b=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return b}(c))}function Zd(o,u,c){if(o===3){var m=new yp(c,c.readVarint()+c.pos);m.length&&(u[m.name]=m)}}zc.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new Dh(this._pbf,u,this.extent,this._keys,this._values)};var oc={VectorTile:function(o,u){this.layers=o.readFields(Zd,{},u)},VectorTileFeature:Dh,VectorTileLayer:yp},Lh=oc.VectorTileFeature.types,$f=Math.pow(2,13);function ps(o,u,c,m,b,E,T,M){o.emplaceBack(u,c,2*Math.floor(m*$f)+T,b*$f*2,E*$f*2,Math.round(M))}var Ts=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new fl,this.indexArray=new hs,this.programConfigurations=new Jn(o.layers,o.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Lo(o,u){return o.x===u.x&&(o.x<0||o.x>8192)||o.y===u.y&&(o.y<0||o.y>8192)}Ts.prototype.populate=function(o,u,c){this.features=[],this.hasPattern=Jp("fill-extrusion",this.layers,u);for(var m=0,b=o;m<b.length;m+=1){var E=b[m],T=E.feature,M=E.id,B=E.index,G=E.sourceLayerIndex,Q=this.layers[0]._featureFilter.needGeometry,ee=io(T,Q);if(this.layers[0]._featureFilter.filter(new Le(this.zoom),ee,c)){var pe={id:M,sourceLayerIndex:G,index:B,geometry:Q?ee.geometry:Ka(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(kh("fill-extrusion",this.layers,pe,this.zoom,u)):this.addFeature(pe,pe.geometry,B,c,{}),u.featureIndex.insert(T,pe.geometry,B,G,this.index,!0)}}},Ts.prototype.addFeatures=function(o,u,c){for(var m=0,b=this.features;m<b.length;m+=1){var E=b[m];this.addFeature(E,E.geometry,E.index,u,c)}},Ts.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},Ts.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ts.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ts.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,zd),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Ts.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ts.prototype.addFeature=function(o,u,c,m,b){for(var E=0,T=mp(u,500);E<T.length;E+=1){for(var M=T[E],B=0,G=0,Q=M;G<Q.length;G+=1)B+=Q[G].length;for(var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),pe=0,_e=M;pe<_e.length;pe+=1){var Ge=_e[pe];if(Ge.length!==0&&!((Fi=Ge).every(function(_i){return _i.x<0})||Fi.every(function(_i){return _i.x>8192})||Fi.every(function(_i){return _i.y<0})||Fi.every(function(_i){return _i.y>8192})))for(var Ye=0,yt=0;yt<Ge.length;yt++){var ot=Ge[yt];if(yt>=1){var Dt=Ge[yt-1];if(!Lo(ot,Dt)){ee.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ht=ot.sub(Dt)._perp()._unit(),ir=Dt.dist(ot);Ye+ir>32768&&(Ye=0),ps(this.layoutVertexArray,ot.x,ot.y,Ht.x,Ht.y,0,0,Ye),ps(this.layoutVertexArray,ot.x,ot.y,Ht.x,Ht.y,0,1,Ye),ps(this.layoutVertexArray,Dt.x,Dt.y,Ht.x,Ht.y,0,0,Ye+=ir),ps(this.layoutVertexArray,Dt.x,Dt.y,Ht.x,Ht.y,0,1,Ye);var ur=ee.vertexLength;this.indexArray.emplaceBack(ur,ur+2,ur+1),this.indexArray.emplaceBack(ur+1,ur+2,ur+3),ee.vertexLength+=4,ee.primitiveLength+=2}}}}if(ee.vertexLength+B>we.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),Lh[o.type]==="Polygon"){for(var xr=[],Wr=[],on=ee.vertexLength,Dn=0,Sn=M;Dn<Sn.length;Dn+=1){var Gn=Sn[Dn];if(Gn.length!==0){Gn!==M[0]&&Wr.push(xr.length/2);for(var An=0;An<Gn.length;An++){var wi=Gn[An];ps(this.layoutVertexArray,wi.x,wi.y,0,0,1,1,0),xr.push(wi.x),xr.push(wi.y)}}}for(var ai=jf(xr,Wr),Ln=0;Ln<ai.length;Ln+=3)this.indexArray.emplaceBack(on+ai[Ln],on+ai[Ln+2],on+ai[Ln+1]);ee.primitiveLength+=ai.length/3,ee.vertexLength+=B}}var Fi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,b,m)},Mn("FillExtrusionBucket",Ts,{omit:["layers","features"]});var pu={paint:new Ua({"fill-extrusion-opacity":new Zn(W["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pn(W["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Zn(W["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Zn(W["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new cs(W["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pn(W["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pn(W["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Zn(W["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},td=function(o){function u(c){o.call(this,c,pu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Ts(c)},u.prototype.queryRadius=function(){return lo(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,B,G){var Q=Ms(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,B),ee=this.paint.get("fill-extrusion-height").evaluate(m,b),pe=this.paint.get("fill-extrusion-base").evaluate(m,b),_e=function(Ye,yt,ot,Dt){for(var Ht=[],ir=0,ur=Ye;ir<ur.length;ir+=1){var xr=ur[ir],Wr=[xr.x,xr.y,0,1];$u(Wr,Wr,yt),Ht.push(new V(Wr[0]/Wr[3],Wr[1]/Wr[3]))}return Ht}(Q,G),Ge=function(Ye,yt,ot,Dt){for(var Ht=[],ir=[],ur=Dt[8]*yt,xr=Dt[9]*yt,Wr=Dt[10]*yt,on=Dt[11]*yt,Dn=Dt[8]*ot,Sn=Dt[9]*ot,Gn=Dt[10]*ot,An=Dt[11]*ot,wi=0,ai=Ye;wi<ai.length;wi+=1){for(var Ln=[],Fi=[],_i=0,Qi=ai[wi];_i<Qi.length;_i+=1){var Yn=Qi[_i],ua=Yn.x,Za=Yn.y,fo=Dt[0]*ua+Dt[4]*Za+Dt[12],oo=Dt[1]*ua+Dt[5]*Za+Dt[13],Va=Dt[2]*ua+Dt[6]*Za+Dt[14],ja=Dt[3]*ua+Dt[7]*Za+Dt[15],Go=Va+Wr,Xo=ja+on,Ps=fo+Dn,zo=oo+Sn,Gs=Va+Gn,go=ja+An,ms=new V((fo+ur)/Xo,(oo+xr)/Xo);ms.z=Go/Xo,Ln.push(ms);var ji=new V(Ps/go,zo/go);ji.z=Gs/go,Fi.push(ji)}Ht.push(Ln),ir.push(Fi)}return[Ht,ir]}(E,pe,ee,G);return function(Ye,yt,ot){var Dt=1/0;lu(ot,yt)&&(Dt=rd(ot,yt[0]));for(var Ht=0;Ht<yt.length;Ht++)for(var ir=yt[Ht],ur=Ye[Ht],xr=0;xr<ir.length-1;xr++){var Wr=ir[xr],on=[Wr,ir[xr+1],ur[xr+1],ur[xr],Wr];hl(ot,on)&&(Dt=Math.min(Dt,rd(ot,on)))}return Dt!==1/0&&Dt}(Ge[0],Ge[1],_e)},u}(tu);function hf(o,u){return o.x*u.x+o.y*u.y}function rd(o,u){if(o.length===1){for(var c,m=0,b=u[m++];!c||b.equals(c);)if(!(c=u[m++]))return 1/0;for(;m<u.length;m++){var E=u[m],T=o[0],M=c.sub(b),B=E.sub(b),G=T.sub(b),Q=hf(M,M),ee=hf(M,B),pe=hf(B,B),_e=hf(G,M),Ge=hf(G,B),Ye=Q*pe-ee*ee,yt=(pe*_e-ee*Ge)/Ye,ot=(Q*Ge-ee*_e)/Ye,Dt=b.z*(1-yt-ot)+c.z*yt+E.z*ot;if(isFinite(Dt))return Dt}return 1/0}for(var Ht=1/0,ir=0,ur=u;ir<ur.length;ir+=1)Ht=Math.min(Ht,ur[ir].z);return Ht}var Vd=_o([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,jv=_o([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,jd=oc.VectorTileFeature.types,nd=Math.cos(Math.PI/180*37.5),Hd=Math.pow(2,14)/.5,Is=function(o){var u=this;this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){u.gradients[c.id]={}}),this.layoutVertexArray=new xs,this.layoutVertexArray2=new Jl,this.indexArray=new hs,this.programConfigurations=new Jn(o.layers,o.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};Is.prototype.populate=function(o,u,c){this.hasPattern=Jp("line",this.layers,u);for(var m=this.layers[0].layout.get("line-sort-key"),b=[],E=0,T=o;E<T.length;E+=1){var M=T[E],B=M.feature,G=M.id,Q=M.index,ee=M.sourceLayerIndex,pe=this.layers[0]._featureFilter.needGeometry,_e=io(B,pe);if(this.layers[0]._featureFilter.filter(new Le(this.zoom),_e,c)){var Ge=m?m.evaluate(_e,{},c):void 0,Ye={id:G,properties:B.properties,type:B.type,sourceLayerIndex:ee,index:Q,geometry:pe?_e.geometry:Ka(B),patterns:{},sortKey:Ge};b.push(Ye)}}m&&b.sort(function(Wr,on){return Wr.sortKey-on.sortKey});for(var yt=0,ot=b;yt<ot.length;yt+=1){var Dt=ot[yt],Ht=Dt.geometry,ir=Dt.index,ur=Dt.sourceLayerIndex;if(this.hasPattern){var xr=kh("line",this.layers,Dt,this.zoom,u);this.patternFeatures.push(xr)}else this.addFeature(Dt,Ht,ir,c,{});u.featureIndex.insert(o[ir].feature,Ht,ir,ur,this.index)}},Is.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},Is.prototype.addFeatures=function(o,u,c){for(var m=0,b=this.patternFeatures;m<b.length;m+=1){var E=b[m];this.addFeature(E,E.geometry,E.index,u,c)}},Is.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Is.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Is.prototype.upload=function(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,jv)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Vd),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Is.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Is.prototype.lineFeatureClips=function(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}},Is.prototype.addFeature=function(o,u,c,m,b){var E=this.layers[0].layout,T=E.get("line-join").evaluate(o,{}),M=E.get("line-cap"),B=E.get("line-miter-limit"),G=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(var Q=0,ee=u;Q<ee.length;Q+=1)this.addLine(ee[Q],o,T,M,B,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,b,m)},Is.prototype.addLine=function(o,u,c,m,b,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<o.length-1;T++)this.totalDistance+=o[T].dist(o[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=jd[u.type]==="Polygon",B=o.length;B>=2&&o[B-1].equals(o[B-2]);)B--;for(var G=0;G<B-1&&o[G].equals(o[G+1]);)G++;if(!(B<(M?3:2))){c==="bevel"&&(b=1.05);var Q,ee=this.overscaling<=16?122880/(512*this.overscaling):0,pe=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),_e=void 0,Ge=void 0,Ye=void 0,yt=void 0;this.e1=this.e2=-1,M&&(yt=o[G].sub(Q=o[B-2])._unit()._perp());for(var ot=G;ot<B;ot++)if(!(Ge=ot===B-1?M?o[G+1]:void 0:o[ot+1])||!o[ot].equals(Ge)){yt&&(Ye=yt),Q&&(_e=Q),Q=o[ot],yt=Ge?Ge.sub(Q)._unit()._perp():Ye;var Dt=(Ye=Ye||yt).add(yt);Dt.x===0&&Dt.y===0||Dt._unit();var Ht=Ye.x*yt.x+Ye.y*yt.y,ir=Dt.x*yt.x+Dt.y*yt.y,ur=ir!==0?1/ir:1/0,xr=2*Math.sqrt(2-2*ir),Wr=ir<nd&&_e&&Ge,on=Ye.x*yt.y-Ye.y*yt.x>0;if(Wr&&ot>G){var Dn=Q.dist(_e);if(Dn>2*ee){var Sn=Q.sub(Q.sub(_e)._mult(ee/Dn)._round());this.updateDistance(_e,Sn),this.addCurrentVertex(Sn,Ye,0,0,pe),_e=Sn}}var Gn=_e&&Ge,An=Gn?c:M?"butt":m;if(Gn&&An==="round"&&(ur<E?An="miter":ur<=2&&(An="fakeround")),An==="miter"&&ur>b&&(An="bevel"),An==="bevel"&&(ur>2&&(An="flipbevel"),ur<b&&(An="miter")),_e&&this.updateDistance(_e,Q),An==="miter")Dt._mult(ur),this.addCurrentVertex(Q,Dt,0,0,pe);else if(An==="flipbevel"){if(ur>100)Dt=yt.mult(-1);else{var wi=ur*Ye.add(yt).mag()/Ye.sub(yt).mag();Dt._perp()._mult(wi*(on?-1:1))}this.addCurrentVertex(Q,Dt,0,0,pe),this.addCurrentVertex(Q,Dt.mult(-1),0,0,pe)}else if(An==="bevel"||An==="fakeround"){var ai=-Math.sqrt(ur*ur-1),Ln=on?ai:0,Fi=on?0:ai;if(_e&&this.addCurrentVertex(Q,Ye,Ln,Fi,pe),An==="fakeround")for(var _i=Math.round(180*xr/Math.PI/20),Qi=1;Qi<_i;Qi++){var Yn=Qi/_i;if(Yn!==.5){var ua=Yn-.5;Yn+=Yn*ua*(Yn-1)*((1.0904+Ht*(Ht*(3.55645-1.43519*Ht)-3.2452))*ua*ua+(.848013+Ht*(.215638*Ht-1.06021)))}var Za=yt.sub(Ye)._mult(Yn)._add(Ye)._unit()._mult(on?-1:1);this.addHalfVertex(Q,Za.x,Za.y,!1,on,0,pe)}Ge&&this.addCurrentVertex(Q,yt,-Ln,-Fi,pe)}else if(An==="butt")this.addCurrentVertex(Q,Dt,0,0,pe);else if(An==="square"){var fo=_e?1:-1;this.addCurrentVertex(Q,Dt,fo,fo,pe)}else An==="round"&&(_e&&(this.addCurrentVertex(Q,Ye,0,0,pe),this.addCurrentVertex(Q,Ye,1,1,pe,!0)),Ge&&(this.addCurrentVertex(Q,yt,-1,-1,pe,!0),this.addCurrentVertex(Q,yt,0,0,pe)));if(Wr&&ot<B-1){var oo=Q.dist(Ge);if(oo>2*ee){var Va=Q.add(Ge.sub(Q)._mult(ee/oo)._round());this.updateDistance(Q,Va),this.addCurrentVertex(Va,yt,0,0,pe),Q=Va}}}}},Is.prototype.addCurrentVertex=function(o,u,c,m,b,E){E===void 0&&(E=!1);var T=u.y*m-u.x,M=-u.y-u.x*m;this.addHalfVertex(o,u.x+u.y*c,u.y-u.x*c,E,!1,c,b),this.addHalfVertex(o,T,M,E,!0,-m,b),this.distance>Hd/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(o,u,c,m,b,E))},Is.prototype.addHalfVertex=function(o,u,c,m,b,E,T){var M=.5*(this.lineClips?this.scaledDistance*(Hd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o.x<<1)+(m?1:0),(o.y<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*c)+128,1+(E===0?0:E<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var B=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),T.primitiveLength++),b?this.e2=B:this.e1=B},Is.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Is.prototype.updateDistance=function(o,u){this.distance+=o.dist(u),this.updateScaledDistance()},Mn("LineBucket",Is,{omit:["layers","patternFeatures"]});var _p=new Ua({"line-cap":new Zn(W.layout_line["line-cap"]),"line-join":new Pn(W.layout_line["line-join"]),"line-miter-limit":new Zn(W.layout_line["line-miter-limit"]),"line-round-limit":new Zn(W.layout_line["line-round-limit"]),"line-sort-key":new Pn(W.layout_line["line-sort-key"])}),bp={paint:new Ua({"line-opacity":new Pn(W.paint_line["line-opacity"]),"line-color":new Pn(W.paint_line["line-color"]),"line-translate":new Zn(W.paint_line["line-translate"]),"line-translate-anchor":new Zn(W.paint_line["line-translate-anchor"]),"line-width":new Pn(W.paint_line["line-width"]),"line-gap-width":new Pn(W.paint_line["line-gap-width"]),"line-offset":new Pn(W.paint_line["line-offset"]),"line-blur":new Pn(W.paint_line["line-blur"]),"line-dasharray":new fs(W.paint_line["line-dasharray"]),"line-pattern":new cs(W.paint_line["line-pattern"]),"line-gradient":new bu(W.paint_line["line-gradient"])}),layout:_p},id=new(function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m){return m=new Le(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),o.prototype.possiblyEvaluate.call(this,c,m)},u.prototype.evaluate=function(c,m,b,E){return m=St({},m,{zoom:Math.floor(m.zoom)}),o.prototype.evaluate.call(this,c,m,b,E)},u}(Pn))(bp.paint.properties["line-width"].specification);id.useIntegerZoom=!0;var Yf=function(o){function u(c){o.call(this,c,bp),this.gradientVersion=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Fs,this.gradientVersion=(this.gradientVersion+1)%Ae)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=id.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},u.prototype.createBucket=function(c){return new Is(c)},u.prototype.queryRadius=function(c){var m=c,b=ad(Po("line-width",this,m),Po("line-gap-width",this,m)),E=Po("line-offset",this,m);return b/2+Math.abs(E)+lo(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(c,m,b,E,T,M,B){var G=Ms(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,B),Q=B/2*ad(this.paint.get("line-width").evaluate(m,b),this.paint.get("line-gap-width").evaluate(m,b)),ee=this.paint.get("line-offset").evaluate(m,b);return ee&&(E=function(pe,_e){for(var Ge=[],Ye=new V(0,0),yt=0;yt<pe.length;yt++){for(var ot=pe[yt],Dt=[],Ht=0;Ht<ot.length;Ht++){var ir=ot[Ht],ur=ot[Ht+1],xr=Ht===0?Ye:ir.sub(ot[Ht-1])._unit()._perp(),Wr=Ht===ot.length-1?Ye:ur.sub(ir)._unit()._perp(),on=xr._add(Wr)._unit();on._mult(1/(on.x*Wr.x+on.y*Wr.y)),Dt.push(on._mult(_e)._add(ir))}Ge.push(Dt)}return Ge}(E,ee*B)),function(pe,_e,Ge){for(var Ye=0;Ye<_e.length;Ye++){var yt=_e[Ye];if(pe.length>=3){for(var ot=0;ot<yt.length;ot++)if(cu(pe,yt[ot]))return!0}if(Vs(pe,yt,Ge))return!0}return!1}(G,E,Q)},u.prototype.isTileClipped=function(){return!0},u}(tu);function ad(o,u){return u>0?u+2*o:o}var Hv=_o([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Wv=_o([{name:"a_projected_pos",components:3,type:"Float32"}],4),Wd=(_o([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),_o([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Gd=(_o([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),X=_o([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function De(o,u,c){return o.sections.forEach(function(m){m.text=function(b,E,T){var M=E.layout.get("text-transform").evaluate(T,{});return M==="uppercase"?b=b.toLocaleUpperCase():M==="lowercase"&&(b=b.toLocaleLowerCase()),Nt.applyArabicShaping&&(b=Nt.applyArabicShaping(b)),b}(m.text,u,c)}),o}_o([{name:"triangle",components:3,type:"Uint16"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_o([{type:"Float32",name:"offsetX"}]),_o([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var rt={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Jt=function(o,u,c,m,b){var E,T,M=8*b-m-1,B=(1<<M)-1,G=B>>1,Q=-7,ee=c?b-1:0,pe=c?-1:1,_e=o[u+ee];for(ee+=pe,E=_e&(1<<-Q)-1,_e>>=-Q,Q+=M;Q>0;E=256*E+o[u+ee],ee+=pe,Q-=8);for(T=E&(1<<-Q)-1,E>>=-Q,Q+=m;Q>0;T=256*T+o[u+ee],ee+=pe,Q-=8);if(E===0)E=1-G;else{if(E===B)return T?NaN:1/0*(_e?-1:1);T+=Math.pow(2,m),E-=G}return(_e?-1:1)*T*Math.pow(2,E-m)},_r=function(o,u,c,m,b,E){var T,M,B,G=8*E-b-1,Q=(1<<G)-1,ee=Q>>1,pe=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,_e=m?0:E-1,Ge=m?1:-1,Ye=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(M=isNaN(u)?1:0,T=Q):(T=Math.floor(Math.log(u)/Math.LN2),u*(B=Math.pow(2,-T))<1&&(T--,B*=2),(u+=T+ee>=1?pe/B:pe*Math.pow(2,1-ee))*B>=2&&(T++,B/=2),T+ee>=Q?(M=0,T=Q):T+ee>=1?(M=(u*B-1)*Math.pow(2,b),T+=ee):(M=u*Math.pow(2,ee-1)*Math.pow(2,b),T=0));b>=8;o[c+_e]=255&M,_e+=Ge,M/=256,b-=8);for(T=T<<b|M,G+=b;G>0;o[c+_e]=255&T,_e+=Ge,T/=256,G-=8);o[c+_e-Ge]|=128*Ye},rr=Xt;function Xt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Xt.Varint=0,Xt.Fixed64=1,Xt.Bytes=2,Xt.Fixed32=5;var Nr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Or(o){return o.type===Xt.Bytes?o.readVarint()+o.pos:o.pos+1}function en(o,u,c){return c?4294967296*u+(o>>>0):4294967296*(u>>>0)+(o>>>0)}function zr(o,u,c){var m=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));c.realloc(m);for(var b=c.pos-1;b>=o;b--)c.buf[b+m]=c.buf[b]}function qr(o,u){for(var c=0;c<o.length;c++)u.writeVarint(o[c])}function an(o,u){for(var c=0;c<o.length;c++)u.writeSVarint(o[c])}function Dr(o,u){for(var c=0;c<o.length;c++)u.writeFloat(o[c])}function Jr(o,u){for(var c=0;c<o.length;c++)u.writeDouble(o[c])}function Ft(o,u){for(var c=0;c<o.length;c++)u.writeBoolean(o[c])}function lr(o,u){for(var c=0;c<o.length;c++)u.writeFixed32(o[c])}function Zr(o,u){for(var c=0;c<o.length;c++)u.writeSFixed32(o[c])}function dn(o,u){for(var c=0;c<o.length;c++)u.writeFixed64(o[c])}function Rr(o,u){for(var c=0;c<o.length;c++)u.writeSFixed64(o[c])}function bn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+16777216*o[u+3]}function Pr(o,u,c){o[c]=u,o[c+1]=u>>>8,o[c+2]=u>>>16,o[c+3]=u>>>24}function vn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+(o[u+3]<<24)}function Cr(o,u,c){o===1&&c.readMessage(fn,u)}function fn(o,u,c){if(o===3){var m=c.readMessage($n,{}),b=m.width,E=m.height,T=m.left,M=m.top,B=m.advance;u.push({id:m.id,bitmap:new ru({width:b+6,height:E+6},m.bitmap),metrics:{width:b,height:E,left:T,top:M,advance:B}})}}function $n(o,u,c){o===1?u.id=c.readVarint():o===2?u.bitmap=c.readBytes():o===3?u.width=c.readVarint():o===4?u.height=c.readVarint():o===5?u.left=c.readSVarint():o===6?u.top=c.readSVarint():o===7&&(u.advance=c.readVarint())}function li(o){for(var u=0,c=0,m=0,b=o;m<b.length;m+=1){var E=b[m];u+=E.w*E.h,c=Math.max(c,E.w)}o.sort(function(Ye,yt){return yt.h-Ye.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),c),h:1/0}],M=0,B=0,G=0,Q=o;G<Q.length;G+=1)for(var ee=Q[G],pe=T.length-1;pe>=0;pe--){var _e=T[pe];if(!(ee.w>_e.w||ee.h>_e.h)){if(ee.x=_e.x,ee.y=_e.y,B=Math.max(B,ee.y+ee.h),M=Math.max(M,ee.x+ee.w),ee.w===_e.w&&ee.h===_e.h){var Ge=T.pop();pe<T.length&&(T[pe]=Ge)}else ee.h===_e.h?(_e.x+=ee.w,_e.w-=ee.w):ee.w===_e.w?(_e.y+=ee.h,_e.h-=ee.h):(T.push({x:_e.x+ee.w,y:_e.y,w:_e.w-ee.w,h:ee.h}),_e.y+=ee.h,_e.h-=ee.h);break}}return{w:M,h:B,fill:u/(M*B)||0}}Xt.prototype={destroy:function(){this.buf=null},readFields:function(o,u,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),b=m>>3,E=this.pos;this.type=7&m,o(b,u,this),this.pos===E&&this.skip(m)}return u},readMessage:function(o,u){return this.readFields(o,u,this.readVarint()+this.pos)},readFixed32:function(){var o=bn(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=vn(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=bn(this.buf,this.pos)+4294967296*bn(this.buf,this.pos+4);return this.pos+=8,o},readSFixed64:function(){var o=bn(this.buf,this.pos)+4294967296*vn(this.buf,this.pos+4);return this.pos+=8,o},readFloat:function(){var o=Jt(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Jt(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var u,c,m=this.buf;return u=127&(c=m[this.pos++]),c<128?u:(u|=(127&(c=m[this.pos++]))<<7,c<128?u:(u|=(127&(c=m[this.pos++]))<<14,c<128?u:(u|=(127&(c=m[this.pos++]))<<21,c<128?u:function(b,E,T){var M,B,G=T.buf;if(M=(112&(B=G[T.pos++]))>>4,B<128||(M|=(127&(B=G[T.pos++]))<<3,B<128)||(M|=(127&(B=G[T.pos++]))<<10,B<128)||(M|=(127&(B=G[T.pos++]))<<17,B<128)||(M|=(127&(B=G[T.pos++]))<<24,B<128)||(M|=(1&(B=G[T.pos++]))<<31,B<128))return en(b,M,E);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(c=m[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&Nr?function(c,m,b){return Nr.decode(c.subarray(m,b))}(this.buf,u,o):function(c,m,b){for(var E="",T=m;T<b;){var M,B,G,Q=c[T],ee=null,pe=Q>239?4:Q>223?3:Q>191?2:1;if(T+pe>b)break;pe===1?Q<128&&(ee=Q):pe===2?(192&(M=c[T+1]))==128&&(ee=(31&Q)<<6|63&M)<=127&&(ee=null):pe===3?(B=c[T+2],(192&(M=c[T+1]))==128&&(192&B)==128&&((ee=(15&Q)<<12|(63&M)<<6|63&B)<=2047||ee>=55296&&ee<=57343)&&(ee=null)):pe===4&&(B=c[T+2],G=c[T+3],(192&(M=c[T+1]))==128&&(192&B)==128&&(192&G)==128&&((ee=(15&Q)<<18|(63&M)<<12|(63&B)<<6|63&G)<=65535||ee>=1114112)&&(ee=null)),ee===null?(ee=65533,pe=1):ee>65535&&(ee-=65536,E+=String.fromCharCode(ee>>>10&1023|55296),ee=56320|1023&ee),E+=String.fromCharCode(ee),T+=pe}return E}(this.buf,u,o)},readBytes:function(){var o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u},readPackedVarint:function(o,u){if(this.type!==Xt.Bytes)return o.push(this.readVarint(u));var c=Or(this);for(o=o||[];this.pos<c;)o.push(this.readVarint(u));return o},readPackedSVarint:function(o){if(this.type!==Xt.Bytes)return o.push(this.readSVarint());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Xt.Bytes)return o.push(this.readBoolean());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Xt.Bytes)return o.push(this.readFloat());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Xt.Bytes)return o.push(this.readDouble());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Xt.Bytes)return o.push(this.readFixed32());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Xt.Bytes)return o.push(this.readSFixed32());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Xt.Bytes)return o.push(this.readFixed64());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Xt.Bytes)return o.push(this.readSFixed64());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed64());return o},skip:function(o){var u=7&o;if(u===Xt.Varint)for(;this.buf[this.pos++]>127;);else if(u===Xt.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Xt.Fixed32)this.pos+=4;else{if(u!==Xt.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(o,u){this.writeVarint(o<<3|u)},realloc:function(o){for(var u=this.length||16;u<this.pos+o;)u*=2;if(u!==this.length){var c=new Uint8Array(u);c.set(this.buf),this.buf=c,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Pr(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Pr(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Pr(this.buf,-1&o,this.pos),Pr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Pr(this.buf,-1&o,this.pos),Pr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(u,c){var m,b;if(u>=0?(m=u%4294967296|0,b=u/4294967296|0):(b=~(-u/4294967296),4294967295^(m=~(-u%4294967296))?m=m+1|0:(m=0,b=b+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(E,T,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(m,0,c),function(E,T){var M=(7&E)<<4;T.buf[T.pos++]|=M|((E>>>=3)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E)))))}(b,c)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var u=this.pos;this.pos=function(m,b,E){for(var T,M,B=0;B<b.length;B++){if((T=b.charCodeAt(B))>55295&&T<57344){if(!M){T>56319||B+1===b.length?(m[E++]=239,m[E++]=191,m[E++]=189):M=T;continue}if(T<56320){m[E++]=239,m[E++]=191,m[E++]=189,M=T;continue}T=M-55296<<10|T-56320|65536,M=null}else M&&(m[E++]=239,m[E++]=191,m[E++]=189,M=null);T<128?m[E++]=T:(T<2048?m[E++]=T>>6|192:(T<65536?m[E++]=T>>12|224:(m[E++]=T>>18|240,m[E++]=T>>12&63|128),m[E++]=T>>6&63|128),m[E++]=63&T|128)}return E}(this.buf,o,this.pos);var c=this.pos-u;c>=128&&zr(u,c,this),this.pos=u-1,this.writeVarint(c),this.pos+=c},writeFloat:function(o){this.realloc(4),_r(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),_r(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var u=o.length;this.writeVarint(u),this.realloc(u);for(var c=0;c<u;c++)this.buf[this.pos++]=o[c]},writeRawMessage:function(o,u){this.pos++;var c=this.pos;o(u,this);var m=this.pos-c;m>=128&&zr(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(o,u,c){this.writeTag(o,Xt.Bytes),this.writeRawMessage(u,c)},writePackedVarint:function(o,u){u.length&&this.writeMessage(o,qr,u)},writePackedSVarint:function(o,u){u.length&&this.writeMessage(o,an,u)},writePackedBoolean:function(o,u){u.length&&this.writeMessage(o,Ft,u)},writePackedFloat:function(o,u){u.length&&this.writeMessage(o,Dr,u)},writePackedDouble:function(o,u){u.length&&this.writeMessage(o,Jr,u)},writePackedFixed32:function(o,u){u.length&&this.writeMessage(o,lr,u)},writePackedSFixed32:function(o,u){u.length&&this.writeMessage(o,Zr,u)},writePackedFixed64:function(o,u){u.length&&this.writeMessage(o,dn,u)},writePackedSFixed64:function(o,u){u.length&&this.writeMessage(o,Rr,u)},writeBytesField:function(o,u){this.writeTag(o,Xt.Bytes),this.writeBytes(u)},writeFixed32Field:function(o,u){this.writeTag(o,Xt.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(o,u){this.writeTag(o,Xt.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(o,u){this.writeTag(o,Xt.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(o,u){this.writeTag(o,Xt.Fixed64),this.writeSFixed64(u)},writeVarintField:function(o,u){this.writeTag(o,Xt.Varint),this.writeVarint(u)},writeSVarintField:function(o,u){this.writeTag(o,Xt.Varint),this.writeSVarint(u)},writeStringField:function(o,u){this.writeTag(o,Xt.Bytes),this.writeString(u)},writeFloatField:function(o,u){this.writeTag(o,Xt.Fixed32),this.writeFloat(u)},writeDoubleField:function(o,u){this.writeTag(o,Xt.Fixed64),this.writeDouble(u)},writeBooleanField:function(o,u){this.writeVarintField(o,!!u)}};var ln=function(o,u){var c=u.pixelRatio,m=u.version,b=u.stretchX,E=u.stretchY,T=u.content;this.paddedRect=o,this.pixelRatio=c,this.stretchX=b,this.stretchY=E,this.content=T,this.version=m},Fr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Fr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Fr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Fr.tlbr.get=function(){return this.tl.concat(this.br)},Fr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ln.prototype,Fr);var Sr=function(o,u){var c={},m={};this.haveRenderCallbacks=[];var b=[];this.addImages(o,c,b),this.addImages(u,m,b);var E=li(b),T=new Do({width:E.w||1,height:E.h||1});for(var M in o){var B=o[M],G=c[M].paddedRect;Do.copy(B.data,T,{x:0,y:0},{x:G.x+1,y:G.y+1},B.data)}for(var Q in u){var ee=u[Q],pe=m[Q].paddedRect,_e=pe.x+1,Ge=pe.y+1,Ye=ee.data.width,yt=ee.data.height;Do.copy(ee.data,T,{x:0,y:0},{x:_e,y:Ge},ee.data),Do.copy(ee.data,T,{x:0,y:yt-1},{x:_e,y:Ge-1},{width:Ye,height:1}),Do.copy(ee.data,T,{x:0,y:0},{x:_e,y:Ge+yt},{width:Ye,height:1}),Do.copy(ee.data,T,{x:Ye-1,y:0},{x:_e-1,y:Ge},{width:1,height:yt}),Do.copy(ee.data,T,{x:0,y:0},{x:_e+Ye,y:Ge},{width:1,height:yt})}this.image=T,this.iconPositions=c,this.patternPositions=m};Sr.prototype.addImages=function(o,u,c){for(var m in o){var b=o[m],E={x:0,y:0,w:b.data.width+2,h:b.data.height+2};c.push(E),u[m]=new ln(E,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},Sr.prototype.patchUpdatedImages=function(o,u){for(var c in o.dispatchRenderCallbacks(this.haveRenderCallbacks),o.updatedImages)this.patchUpdatedImage(this.iconPositions[c],o.getImage(c),u),this.patchUpdatedImage(this.patternPositions[c],o.getImage(c),u)},Sr.prototype.patchUpdatedImage=function(o,u,c){if(o&&u&&o.version!==u.version){o.version=u.version;var m=o.tl;c.update(u.data,void 0,{x:m[0],y:m[1]})}},Mn("ImagePosition",ln),Mn("ImageAtlas",Sr);var Fn={horizontal:1,vertical:2,horizontalOnly:3},Pi=function(){this.scale=1,this.fontStack="",this.imageName=null};Pi.forText=function(o,u){var c=new Pi;return c.scale=o||1,c.fontStack=u,c},Pi.forImage=function(o){var u=new Pi;return u.imageName=o,u};var Zt=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Ai(o,u,c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye){var yt,ot=Zt.fromFeature(o,b);ee===Fn.vertical&&ot.verticalizePunctuation();var Dt=Nt.processBidirectionalText,Ht=Nt.processStyledBidirectionalText;if(Dt&&ot.sections.length===1){yt=[];for(var ir=0,ur=Dt(ot.toString(),Qa(ot,G,E,u,m,_e,Ge));ir<ur.length;ir+=1){var xr=ur[ir],Wr=new Zt;Wr.text=xr,Wr.sections=ot.sections;for(var on=0;on<xr.length;on++)Wr.sectionIndex.push(0);yt.push(Wr)}}else if(Ht){yt=[];for(var Dn=0,Sn=Ht(ot.text,ot.sectionIndex,Qa(ot,G,E,u,m,_e,Ge));Dn<Sn.length;Dn+=1){var Gn=Sn[Dn],An=new Zt;An.text=Gn[0],An.sectionIndex=Gn[1],An.sections=ot.sections,yt.push(An)}}else yt=function(Ln,Fi){for(var _i=[],Qi=Ln.text,Yn=0,ua=0,Za=Fi;ua<Za.length;ua+=1){var fo=Za[ua];_i.push(Ln.substring(Yn,fo)),Yn=fo}return Yn<Qi.length&&_i.push(Ln.substring(Yn,Qi.length)),_i}(ot,Qa(ot,G,E,u,m,_e,Ge));var wi=[],ai={positionedLines:wi,text:ot.toString(),top:Q[1],bottom:Q[1],left:Q[0],right:Q[0],writingMode:ee,iconsInText:!1,verticalizable:!1};return function(Ln,Fi,_i,Qi,Yn,ua,Za,fo,oo,Va,ja,Go){for(var Xo=0,Ps=-17,zo=0,Gs=0,go=fo==="right"?1:fo==="left"?0:.5,ms=0,ji=0,Ta=Yn;ji<Ta.length;ji+=1){var Ea=Ta[ji];Ea.trim();var xi=Ea.getMaxScale(),K=24*(xi-1),Os={positionedGlyphs:[],lineOffset:0};Ln.positionedLines[ms]=Os;var Ha=Os.positionedGlyphs,Zo=0;if(Ea.length()){for(var ks=0;ks<Ea.length();ks++){var $i=Ea.getSection(ks),lc=Ea.getSectionIndex(ks),Ru=Ea.getCharCode(ks),cc=0,ho=null,fc=null,Nl=null,Ap=24,mf=!(oo===Fn.horizontal||!ja&&!sf(Ru)||ja&&(Ct[Ru]||(as=Ru,cn.Arabic(as)||cn["Arabic Supplement"](as)||cn["Arabic Extended-A"](as)||cn["Arabic Presentation Forms-A"](as)||cn["Arabic Presentation Forms-B"](as))));if($i.imageName){var qf=Qi[$i.imageName];if(!qf)continue;Nl=$i.imageName,Ln.iconsInText=Ln.iconsInText||!0,fc=qf.paddedRect;var hc=qf.displaySize;$i.scale=24*$i.scale/Go,cc=K+(24-hc[1]*$i.scale),Ap=(ho={width:hc[0],height:hc[1],left:1,top:-3,advance:mf?hc[1]:hc[0]}).advance;var gf=mf?hc[0]*$i.scale-24*xi:hc[1]*$i.scale-24*xi;gf>0&&gf>Zo&&(Zo=gf)}else{var Fh=_i[$i.fontStack],Kf=Fh&&Fh[Ru];if(Kf&&Kf.rect)fc=Kf.rect,ho=Kf.metrics;else{var Nh=Fi[$i.fontStack],Uh=Nh&&Nh[Ru];if(!Uh)continue;ho=Uh.metrics}cc=24*(xi-$i.scale)}mf?(Ln.verticalizable=!0,Ha.push({glyph:Ru,imageName:Nl,x:Xo,y:Ps+cc,vertical:mf,scale:$i.scale,fontStack:$i.fontStack,sectionIndex:lc,metrics:ho,rect:fc}),Xo+=Ap*$i.scale+Va):(Ha.push({glyph:Ru,imageName:Nl,x:Xo,y:Ps+cc,vertical:mf,scale:$i.scale,fontStack:$i.fontStack,sectionIndex:lc,metrics:ho,rect:fc}),Xo+=ho.advance*$i.scale+Va)}Ha.length!==0&&(zo=Math.max(Xo-Va,zo),Bo(Ha,0,Ha.length-1,go,Zo)),Xo=0;var Qf=ua*xi+Zo;Os.lineOffset=Math.max(Zo,K),Ps+=Qf,Gs=Math.max(Qf,Gs),++ms}else Ps+=ua,++ms}var as,zh=Ps- -17,Jf=Oa(Za),Mu=Jf.horizontalAlign,Tp=Jf.verticalAlign;(function($d,Yd,wp,Cp,eh,ld,cd,fd,hd){var Rp,qd=(Yd-wp)*eh;Rp=ld!==cd?-fd*Cp- -17:(-Cp*hd+.5)*cd;for(var Mp=0,pc=$d;Mp<pc.length;Mp+=1)for(var yf=0,th=pc[Mp].positionedGlyphs;yf<th.length;yf+=1){var rh=th[yf];rh.x+=qd,rh.y+=Rp}})(Ln.positionedLines,go,Mu,Tp,zo,Gs,ua,zh,Yn.length),Ln.top+=-Tp*zh,Ln.bottom=Ln.top+zh,Ln.left+=-Mu*zo,Ln.right=Ln.left+zo}(ai,u,c,m,yt,T,M,B,ee,G,pe,Ye),!function(Ln){for(var Fi=0,_i=Ln;Fi<_i.length;Fi+=1)if(_i[Fi].positionedGlyphs.length!==0)return!1;return!0}(wi)&&ai}Zt.fromFeature=function(o,u){for(var c=new Zt,m=0;m<o.sections.length;m++){var b=o.sections[m];b.image?c.addImageSection(b):c.addTextSection(b,u)}return c},Zt.prototype.length=function(){return this.text.length},Zt.prototype.getSection=function(o){return this.sections[this.sectionIndex[o]]},Zt.prototype.getSectionIndex=function(o){return this.sectionIndex[o]},Zt.prototype.getCharCode=function(o){return this.text.charCodeAt(o)},Zt.prototype.verticalizePunctuation=function(){this.text=function(o){for(var u="",c=0;c<o.length;c++){var m=o.charCodeAt(c+1)||null,b=o.charCodeAt(c-1)||null;u+=m&&uf(m)&&!rt[o[c+1]]||b&&uf(b)&&!rt[o[c-1]]||!rt[o[c]]?o[c]:rt[o[c]]}return u}(this.text)},Zt.prototype.trim=function(){for(var o=0,u=0;u<this.text.length&&Ct[this.text.charCodeAt(u)];u++)o++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=o&&Ct[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)},Zt.prototype.substring=function(o,u){var c=new Zt;return c.text=this.text.substring(o,u),c.sectionIndex=this.sectionIndex.slice(o,u),c.sections=this.sections,c},Zt.prototype.toString=function(){return this.text},Zt.prototype.getMaxScale=function(){var o=this;return this.sectionIndex.reduce(function(u,c){return Math.max(u,o.sections[c].scale)},0)},Zt.prototype.addTextSection=function(o,u){this.text+=o.text,this.sections.push(Pi.forText(o.scale,o.fontStack||u));for(var c=this.sections.length-1,m=0;m<o.text.length;++m)this.sectionIndex.push(c)},Zt.prototype.addImageSection=function(o){var u=o.image?o.image.name:"";if(u.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Pi.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ve("Reached maximum number of images 6401")}else Ve("Can't add FormattedSection with an empty image.")},Zt.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ct={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ri={};function na(o,u,c,m,b,E){if(u.imageName){var T=m[u.imageName];return T?T.displaySize[0]*u.scale*24/E+b:0}var M=c[u.fontStack],B=M&&M[o];return B?B.metrics.advance*u.scale+b:0}function mo(o,u,c,m){var b=Math.pow(o-u,2);return m?o<u?b/2:2*b:b+Math.abs(c)*c}function rs(o,u,c){var m=0;return o===10&&(m-=1e4),c&&(m+=150),o!==40&&o!==65288||(m+=50),u!==41&&u!==65289||(m+=50),m}function Di(o,u,c,m,b,E){for(var T=null,M=mo(u,c,b,E),B=0,G=m;B<G.length;B+=1){var Q=G[B],ee=mo(u-Q.x,c,b,E)+Q.badness;ee<=M&&(T=Q,M=ee)}return{index:o,x:u,priorBreak:T,badness:M}}function Qa(o,u,c,m,b,E,T){if(E!=="point")return[];if(!o)return[];for(var M,B=[],G=function(yt,ot,Dt,Ht,ir,ur){for(var xr=0,Wr=0;Wr<yt.length();Wr++){var on=yt.getSection(Wr);xr+=na(yt.getCharCode(Wr),on,Ht,ir,ot,ur)}return xr/Math.max(1,Math.ceil(xr/Dt))}(o,u,c,m,b,T),Q=o.text.indexOf("\u200B")>=0,ee=0,pe=0;pe<o.length();pe++){var _e=o.getSection(pe),Ge=o.getCharCode(pe);if(Ct[Ge]||(ee+=na(Ge,_e,m,b,u,T)),pe<o.length()-1){var Ye=!((M=Ge)<11904||!(cn["Bopomofo Extended"](M)||cn.Bopomofo(M)||cn["CJK Compatibility Forms"](M)||cn["CJK Compatibility Ideographs"](M)||cn["CJK Compatibility"](M)||cn["CJK Radicals Supplement"](M)||cn["CJK Strokes"](M)||cn["CJK Symbols and Punctuation"](M)||cn["CJK Unified Ideographs Extension A"](M)||cn["CJK Unified Ideographs"](M)||cn["Enclosed CJK Letters and Months"](M)||cn["Halfwidth and Fullwidth Forms"](M)||cn.Hiragana(M)||cn["Ideographic Description Characters"](M)||cn["Kangxi Radicals"](M)||cn["Katakana Phonetic Extensions"](M)||cn.Katakana(M)||cn["Vertical Forms"](M)||cn["Yi Radicals"](M)||cn["Yi Syllables"](M)));(ri[Ge]||Ye||_e.imageName)&&B.push(Di(pe+1,ee,G,B,rs(Ge,o.getCharCode(pe+1),Ye&&Q),!1))}}return function yt(ot){return ot?yt(ot.priorBreak).concat(ot.index):[]}(Di(o.length(),ee,G,B,0,!0))}function Oa(o){var u=.5,c=.5;switch(o){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:u,verticalAlign:c}}function Bo(o,u,c,m,b){if(m||b)for(var E=o[c],T=(o[c].x+E.metrics.advance*E.scale)*m,M=u;M<=c;M++)o[M].x-=T,o[M].y+=b}function xo(o,u,c,m,b,E){var T,M=o.image;if(M.content){var B=M.content,G=M.pixelRatio||1;T=[B[0]/G,B[1]/G,M.displaySize[0]-B[2]/G,M.displaySize[1]-B[3]/G]}var Q,ee,pe,_e,Ge=u.left*E,Ye=u.right*E;c==="width"||c==="both"?(_e=b[0]+Ge-m[3],ee=b[0]+Ye+m[1]):ee=(_e=b[0]+(Ge+Ye-M.displaySize[0])/2)+M.displaySize[0];var yt=u.top*E,ot=u.bottom*E;return c==="height"||c==="both"?(Q=b[1]+yt-m[0],pe=b[1]+ot+m[2]):pe=(Q=b[1]+(yt+ot-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:Q,right:ee,bottom:pe,left:_e,collisionPadding:T}}ri[10]=!0,ri[32]=!0,ri[38]=!0,ri[40]=!0,ri[41]=!0,ri[43]=!0,ri[45]=!0,ri[47]=!0,ri[173]=!0,ri[183]=!0,ri[8203]=!0,ri[8208]=!0,ri[8211]=!0,ri[8231]=!0;var Ja=function(o){function u(c,m,b,E){o.call(this,c,m),this.angle=b,E!==void 0&&(this.segment=E)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(V);function Fo(o,u){var c=u.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Le(o+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,b=c.interpolationType,E=0;E<m.length&&m[E]<=o;)E++;for(var T=E=Math.max(0,E-1);T<m.length&&m[T]<o+1;)T++;T=Math.min(m.length-1,T);var M=m[E],B=m[T];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:B,interpolationType:b}:{kind:"camera",minZoom:M,maxZoom:B,minSize:c.evaluate(new Le(M)),maxSize:c.evaluate(new Le(B)),interpolationType:b}}function ds(o,u,c){var m=u.uSize,b=c.lowerSize;return o.kind==="source"?b/128:o.kind==="composite"?ro(b/128,c.upperSize/128,u.uSizeT):m}function Eo(o,u){var c=0,m=0;if(o.kind==="constant")m=o.layoutSize;else if(o.kind!=="source"){var b=o.interpolationType,E=b?ct(es.interpolationFactor(b,u,o.minZoom,o.maxZoom),0,1):0;o.kind==="camera"?m=ro(o.minSize,o.maxSize,E):c=E}return{uSizeT:c,uSize:m}}Mn("Anchor",Ja);var Si=Object.freeze({__proto__:null,getSizeData:Fo,evaluateSizeForFeature:ds,evaluateSizeForZoom:Eo,SIZE_PACK_FACTOR:128});function ns(o,u,c,m,b){if(u.segment===void 0)return!0;for(var E=u,T=u.segment+1,M=0;M>-c/2;){if(--T<0)return!1;M-=o[T].dist(E),E=o[T]}M+=o[T].dist(o[T+1]),T++;for(var B=[],G=0;M<c/2;){var Q=o[T],ee=o[T+1];if(!ee)return!1;var pe=o[T-1].angleTo(Q)-Q.angleTo(ee);for(pe=Math.abs((pe+3*Math.PI)%(2*Math.PI)-Math.PI),B.push({distance:M,angleDelta:pe}),G+=pe;M-B[0].distance>m;)G-=B.shift().angleDelta;if(G>b)return!1;T++,M+=Q.dist(ee)}return!0}function fa(o){for(var u=0,c=0;c<o.length-1;c++)u+=o[c].dist(o[c+1]);return u}function ei(o,u,c){return o?.6*u*c:0}function Li(o,u){return Math.max(o?o.right-o.left:0,u?u.right-u.left:0)}function Ki(o,u,c,m,b,E){for(var T=ei(c,b,E),M=Li(c,m)*E,B=0,G=fa(o)/2,Q=0;Q<o.length-1;Q++){var ee=o[Q],pe=o[Q+1],_e=ee.dist(pe);if(B+_e>G){var Ge=(G-B)/_e,Ye=ro(ee.x,pe.x,Ge),yt=ro(ee.y,pe.y,Ge),ot=new Ja(Ye,yt,pe.angleTo(ee),Q);return ot._round(),!T||ns(o,ot,M,T,u)?ot:void 0}B+=_e}}function So(o,u,c,m,b,E,T,M,B){var G=ei(m,E,T),Q=Li(m,b),ee=Q*T,pe=o[0].x===0||o[0].x===B||o[0].y===0||o[0].y===B;return u-ee<u/4&&(u=ee+u/4),function _e(Ge,Ye,yt,ot,Dt,Ht,ir,ur,xr){for(var Wr=Ht/2,on=fa(Ge),Dn=0,Sn=Ye-yt,Gn=[],An=0;An<Ge.length-1;An++){for(var wi=Ge[An],ai=Ge[An+1],Ln=wi.dist(ai),Fi=ai.angleTo(wi);Sn+yt<Dn+Ln;){var _i=((Sn+=yt)-Dn)/Ln,Qi=ro(wi.x,ai.x,_i),Yn=ro(wi.y,ai.y,_i);if(Qi>=0&&Qi<xr&&Yn>=0&&Yn<xr&&Sn-Wr>=0&&Sn+Wr<=on){var ua=new Ja(Qi,Yn,Fi,An);ua._round(),ot&&!ns(Ge,ua,Ht,ot,Dt)||Gn.push(ua)}}Dn+=Ln}return ur||Gn.length||ir||(Gn=_e(Ge,Dn/2,yt,ot,Dt,Ht,ir,!0,xr)),Gn}(o,pe?u/2*M%u:(Q/2+2*E)*T*M%u,u,G,c,ee,pe,!1,B)}function yl(o,u,c,m,b){for(var E=[],T=0;T<o.length;T++)for(var M=o[T],B=void 0,G=0;G<M.length-1;G++){var Q=M[G],ee=M[G+1];Q.x<u&&ee.x<u||(Q.x<u?Q=new V(u,Q.y+(u-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round():ee.x<u&&(ee=new V(u,Q.y+(u-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round()),Q.y<c&&ee.y<c||(Q.y<c?Q=new V(Q.x+(c-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),c)._round():ee.y<c&&(ee=new V(Q.x+(c-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),c)._round()),Q.x>=m&&ee.x>=m||(Q.x>=m?Q=new V(m,Q.y+(m-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round():ee.x>=m&&(ee=new V(m,Q.y+(m-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round()),Q.y>=b&&ee.y>=b||(Q.y>=b?Q=new V(Q.x+(b-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),b)._round():ee.y>=b&&(ee=new V(Q.x+(b-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),b)._round()),B&&Q.equals(B[B.length-1])||E.push(B=[Q]),B.push(ee)))))}return E}function Ke(o,u,c,m){var b=[],E=o.image,T=E.pixelRatio,M=E.paddedRect.w-2,B=E.paddedRect.h-2,G=o.right-o.left,Q=o.bottom-o.top,ee=E.stretchX||[[0,M]],pe=E.stretchY||[[0,B]],_e=function(Qi,Yn){return Qi+Yn[1]-Yn[0]},Ge=ee.reduce(_e,0),Ye=pe.reduce(_e,0),yt=M-Ge,ot=B-Ye,Dt=0,Ht=Ge,ir=0,ur=Ye,xr=0,Wr=yt,on=0,Dn=ot;if(E.content&&m){var Sn=E.content;Dt=or(ee,0,Sn[0]),ir=or(pe,0,Sn[1]),Ht=or(ee,Sn[0],Sn[2]),ur=or(pe,Sn[1],Sn[3]),xr=Sn[0]-Dt,on=Sn[1]-ir,Wr=Sn[2]-Sn[0]-Ht,Dn=Sn[3]-Sn[1]-ur}var Gn=function(Qi,Yn,ua,Za){var fo=xn(Qi.stretch-Dt,Ht,G,o.left),oo=Ti(Qi.fixed-xr,Wr,Qi.stretch,Ge),Va=xn(Yn.stretch-ir,ur,Q,o.top),ja=Ti(Yn.fixed-on,Dn,Yn.stretch,Ye),Go=xn(ua.stretch-Dt,Ht,G,o.left),Xo=Ti(ua.fixed-xr,Wr,ua.stretch,Ge),Ps=xn(Za.stretch-ir,ur,Q,o.top),zo=Ti(Za.fixed-on,Dn,Za.stretch,Ye),Gs=new V(fo,Va),go=new V(Go,Va),ms=new V(Go,Ps),ji=new V(fo,Ps),Ta=new V(oo/T,ja/T),Ea=new V(Xo/T,zo/T),xi=u*Math.PI/180;if(xi){var K=Math.sin(xi),Os=Math.cos(xi),Ha=[Os,-K,K,Os];Gs._matMult(Ha),go._matMult(Ha),ji._matMult(Ha),ms._matMult(Ha)}var Zo=Qi.stretch+Qi.fixed,ks=Yn.stretch+Yn.fixed;return{tl:Gs,tr:go,bl:ji,br:ms,tex:{x:E.paddedRect.x+1+Zo,y:E.paddedRect.y+1+ks,w:ua.stretch+ua.fixed-Zo,h:Za.stretch+Za.fixed-ks},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ta,pixelOffsetBR:Ea,minFontScaleX:Wr/T/G,minFontScaleY:Dn/T/Q,isSDF:c}};if(m&&(E.stretchX||E.stretchY))for(var An=Yt(ee,yt,Ge),wi=Yt(pe,ot,Ye),ai=0;ai<An.length-1;ai++)for(var Ln=An[ai],Fi=An[ai+1],_i=0;_i<wi.length-1;_i++)b.push(Gn(Ln,wi[_i],Fi,wi[_i+1]));else b.push(Gn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:B+1}));return b}function or(o,u,c){for(var m=0,b=0,E=o;b<E.length;b+=1){var T=E[b];m+=Math.max(u,Math.min(c,T[1]))-Math.max(u,Math.min(c,T[0]))}return m}function Yt(o,u,c){for(var m=[{fixed:-1,stretch:0}],b=0,E=o;b<E.length;b+=1){var T=E[b],M=T[0],B=T[1],G=m[m.length-1];m.push({fixed:M-G.stretch,stretch:G.stretch}),m.push({fixed:M-G.stretch,stretch:G.stretch+(B-M)})}return m.push({fixed:u+1,stretch:c}),m}function xn(o,u,c,m){return o/u*c+m}function Ti(o,u,c,m){return o-u*c/m}var ga=function(o,u,c,m,b,E,T,M,B,G){if(this.boxStartIndex=o.length,B){var Q=E.top,ee=E.bottom,pe=E.collisionPadding;pe&&(Q-=pe[1],ee+=pe[3]);var _e=ee-Q;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{var Ge=E.top*T-M,Ye=E.bottom*T+M,yt=E.left*T-M,ot=E.right*T+M,Dt=E.collisionPadding;if(Dt&&(yt-=Dt[0]*T,Ge-=Dt[1]*T,ot+=Dt[2]*T,Ye+=Dt[3]*T),G){var Ht=new V(yt,Ge),ir=new V(ot,Ge),ur=new V(yt,Ye),xr=new V(ot,Ye),Wr=G*Math.PI/180;Ht._rotate(Wr),ir._rotate(Wr),ur._rotate(Wr),xr._rotate(Wr),yt=Math.min(Ht.x,ir.x,ur.x,xr.x),ot=Math.max(Ht.x,ir.x,ur.x,xr.x),Ge=Math.min(Ht.y,ir.y,ur.y,xr.y),Ye=Math.max(Ht.y,ir.y,ur.y,xr.y)}o.emplaceBack(u.x,u.y,yt,Ge,ot,Ye,c,m,b)}this.boxEndIndex=o.length},me=function(o,u){if(o===void 0&&(o=[]),u===void 0&&(u=Fe),this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Fe(o,u){return o<u?-1:o>u?1:0}function nt(o,u,c){u===void 0&&(u=1),c===void 0&&(c=!1);for(var m=1/0,b=1/0,E=-1/0,T=-1/0,M=o[0],B=0;B<M.length;B++){var G=M[B];(!B||G.x<m)&&(m=G.x),(!B||G.y<b)&&(b=G.y),(!B||G.x>E)&&(E=G.x),(!B||G.y>T)&&(T=G.y)}var Q=Math.min(E-m,T-b),ee=Q/2,pe=new me([],qt);if(Q===0)return new V(m,b);for(var _e=m;_e<E;_e+=Q)for(var Ge=b;Ge<T;Ge+=Q)pe.push(new Wt(_e+ee,Ge+ee,ee,o));for(var Ye=function(Dt){for(var Ht=0,ir=0,ur=0,xr=Dt[0],Wr=0,on=xr.length,Dn=on-1;Wr<on;Dn=Wr++){var Sn=xr[Wr],Gn=xr[Dn],An=Sn.x*Gn.y-Gn.x*Sn.y;ir+=(Sn.x+Gn.x)*An,ur+=(Sn.y+Gn.y)*An,Ht+=3*An}return new Wt(ir/Ht,ur/Ht,0,Dt)}(o),yt=pe.length;pe.length;){var ot=pe.pop();(ot.d>Ye.d||!Ye.d)&&(Ye=ot,c&&console.log("found best %d after %d probes",Math.round(1e4*ot.d)/1e4,yt)),ot.max-Ye.d<=u||(pe.push(new Wt(ot.p.x-(ee=ot.h/2),ot.p.y-ee,ee,o)),pe.push(new Wt(ot.p.x+ee,ot.p.y-ee,ee,o)),pe.push(new Wt(ot.p.x-ee,ot.p.y+ee,ee,o)),pe.push(new Wt(ot.p.x+ee,ot.p.y+ee,ee,o)),yt+=4)}return c&&(console.log("num probes: "+yt),console.log("best distance: "+Ye.d)),Ye.p}function qt(o,u){return u.max-o.max}function Wt(o,u,c,m){this.p=new V(o,u),this.h=c,this.d=function(b,E){for(var T=!1,M=1/0,B=0;B<E.length;B++)for(var G=E[B],Q=0,ee=G.length,pe=ee-1;Q<ee;pe=Q++){var _e=G[Q],Ge=G[pe];_e.y>b.y!=Ge.y>b.y&&b.x<(Ge.x-_e.x)*(b.y-_e.y)/(Ge.y-_e.y)+_e.x&&(T=!T),M=Math.min(M,rc(b,_e,Ge))}return(T?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}me.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},me.prototype.pop=function(){if(this.length!==0){var o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}},me.prototype.peek=function(){return this.data[0]},me.prototype._up=function(o){for(var u=this.data,c=this.compare,m=u[o];o>0;){var b=o-1>>1,E=u[b];if(c(m,E)>=0)break;u[o]=E,o=b}u[o]=m},me.prototype._down=function(o){for(var u=this.data,c=this.compare,m=this.length>>1,b=u[o];o<m;){var E=1+(o<<1),T=u[E],M=E+1;if(M<this.length&&c(u[M],T)<0&&(E=M,T=u[M]),c(T,b)>=0)break;u[o]=T,o=E}u[o]=b};var gt=Number.POSITIVE_INFINITY;function At(o,u){return u[1]!==gt?function(c,m,b){var E=0,T=0;switch(m=Math.abs(m),b=Math.abs(b),c){case"top-right":case"top-left":case"top":T=b-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-b}switch(c){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,T]}(o,u[0],u[1]):function(c,m){var b=0,E=0;m<0&&(m=0);var T=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":E=T-7;break;case"bottom-right":case"bottom-left":E=7-T;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(c){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=m;break;case"right":b=-m}return[b,E]}(o,u[0])}function It(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Je(o,u,c,m,b,E,T,M,B,G,Q,ee,pe,_e,Ge){var Ye=function(ir,ur,xr,Wr,on,Dn,Sn,Gn){for(var An=Wr.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,wi=[],ai=0,Ln=ur.positionedLines;ai<Ln.length;ai+=1)for(var Fi=Ln[ai],_i=0,Qi=Fi.positionedGlyphs;_i<Qi.length;_i+=1){var Yn=Qi[_i];if(Yn.rect){var ua=Yn.rect||{},Za=4,fo=!0,oo=1,Va=0,ja=(on||Gn)&&Yn.vertical,Go=Yn.metrics.advance*Yn.scale/2;if(Gn&&ur.verticalizable&&(Va=Fi.lineOffset/2-(Yn.imageName?-(24-Yn.metrics.width*Yn.scale)/2:24*(Yn.scale-1))),Yn.imageName){var Xo=Sn[Yn.imageName];fo=Xo.sdf,Za=1/(oo=Xo.pixelRatio)}var Ps=on?[Yn.x+Go,Yn.y]:[0,0],zo=on?[0,0]:[Yn.x+Go+xr[0],Yn.y+xr[1]-Va],Gs=[0,0];ja&&(Gs=zo,zo=[0,0]);var go=(Yn.metrics.left-Za)*Yn.scale-Go+zo[0],ms=(-Yn.metrics.top-Za)*Yn.scale+zo[1],ji=go+ua.w*Yn.scale/oo,Ta=ms+ua.h*Yn.scale/oo,Ea=new V(go,ms),xi=new V(ji,ms),K=new V(go,Ta),Os=new V(ji,Ta);if(ja){var Ha=new V(-Go,Go- -17),Zo=-Math.PI/2,ks=12-Go,$i=new V(22-ks,-(Yn.imageName?ks:0)),lc=new(Function.prototype.bind.apply(V,[null].concat(Gs)));Ea._rotateAround(Zo,Ha)._add($i)._add(lc),xi._rotateAround(Zo,Ha)._add($i)._add(lc),K._rotateAround(Zo,Ha)._add($i)._add(lc),Os._rotateAround(Zo,Ha)._add($i)._add(lc)}if(An){var Ru=Math.sin(An),cc=Math.cos(An),ho=[cc,-Ru,Ru,cc];Ea._matMult(ho),xi._matMult(ho),K._matMult(ho),Os._matMult(ho)}var fc=new V(0,0),Nl=new V(0,0);wi.push({tl:Ea,tr:xi,bl:K,br:Os,tex:ua,writingMode:ur.writingMode,glyphOffset:Ps,sectionIndex:Yn.sectionIndex,isSDF:fo,pixelOffsetTL:fc,pixelOffsetBR:Nl,minFontScaleX:0,minFontScaleY:0})}}return wi}(0,c,M,b,E,T,m,o.allowVerticalPlacement),yt=o.textSizeData,ot=null;yt.kind==="source"?(ot=[128*b.layout.get("text-size").evaluate(T,{})])[0]>32640&&Ve(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):yt.kind==="composite"&&((ot=[128*_e.compositeTextSizes[0].evaluate(T,{},Ge),128*_e.compositeTextSizes[1].evaluate(T,{},Ge)])[0]>32640||ot[1]>32640)&&Ve(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),o.addSymbols(o.text,Ye,ot,M,E,T,G,u,B.lineStartIndex,B.lineLength,pe,Ge);for(var Dt=0,Ht=Q;Dt<Ht.length;Dt+=1)ee[Ht[Dt]]=o.text.placedSymbolArray.length-1;return 4*Ye.length}function _t(o){for(var u in o)return o[u];return null}function Be(o,u,c,m){var b=o.compareText;if(u in b){for(var E=b[u],T=E.length-1;T>=0;T--)if(m.dist(E[T])<c)return!0}else b[u]=[];return b[u].push(m),!1}var Et=oc.VectorTileFeature.types,tr=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pr(o,u,c,m,b,E,T,M,B,G,Q,ee,pe){var _e=M?Math.min(32640,Math.round(M[0])):0,Ge=M?Math.min(32640,Math.round(M[1])):0;o.emplaceBack(u,c,Math.round(32*m),Math.round(32*b),E,T,(_e<<1)+(B?1:0),Ge,16*G,16*Q,256*ee,256*pe)}function sr(o,u,c){o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c)}function wr(o){for(var u=0,c=o.sections;u<c.length;u+=1)if(Bf(c[u].text))return!0;return!1}var kr=function(o){this.layoutVertexArray=new zf,this.indexArray=new hs,this.programConfigurations=o,this.segments=new we,this.dynamicLayoutVertexArray=new Pc,this.opacityVertexArray=new lf,this.placedSymbolArray=new g};kr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},kr.prototype.upload=function(o,u,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Hv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Wv.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,tr,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(o))},kr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Mn("SymbolBuffers",kr);var Nn=function(o,u,c){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new c,this.segments=new we,this.collisionVertexArray=new wh};Nn.prototype.upload=function(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Wd.members,!0)},Nn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Mn("CollisionBuffers",Nn);var En=function(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ts([]),this.placementViewportMatrix=ts([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fo(this.zoom,u["text-size"]),this.iconSizeData=Fo(this.zoom,u["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),b=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(E){return Fn[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=o.sourceID};En.prototype.createArrays=function(){this.text=new kr(new Jn(this.layers,this.zoom,function(o){return/^text/.test(o)})),this.icon=new kr(new Jn(this.layers,this.zoom,function(o){return/^icon/.test(o)})),this.glyphOffsetArray=new R,this.lineVertexArray=new k,this.symbolInstances=new w},En.prototype.calculateGlyphDependencies=function(o,u,c,m,b){for(var E=0;E<o.length;E++)if(u[o.charCodeAt(E)]=!0,(c||m)&&b){var T=rt[o.charAt(E)];T&&(u[T.charCodeAt(0)]=!0)}},En.prototype.populate=function(o,u,c){var m=this.layers[0],b=m.layout,E=b.get("text-font"),T=b.get("text-field"),M=b.get("icon-image"),B=(T.value.kind!=="constant"||T.value.value instanceof _a&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),G=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,Q=b.get("symbol-sort-key");if(this.features=[],B||G){for(var ee=u.iconDependencies,pe=u.glyphDependencies,_e=u.availableImages,Ge=new Le(this.zoom),Ye=0,yt=o;Ye<yt.length;Ye+=1){var ot=yt[Ye],Dt=ot.feature,Ht=ot.id,ir=ot.index,ur=ot.sourceLayerIndex,xr=m._featureFilter.needGeometry,Wr=io(Dt,xr);if(m._featureFilter.filter(Ge,Wr,c)){xr||(Wr.geometry=Ka(Dt));var on=void 0;if(B){var Dn=m.getValueAndResolveTokens("text-field",Wr,c,_e),Sn=_a.factory(Dn);wr(Sn)&&(this.hasRTLText=!0),(!this.hasRTLText||Nf()==="unavailable"||this.hasRTLText&&Nt.isParsed())&&(on=De(Sn,m,Wr))}var Gn=void 0;if(G){var An=m.getValueAndResolveTokens("icon-image",Wr,c,_e);Gn=An instanceof Ia?An:Ia.fromString(An)}if(on||Gn){var wi=this.sortFeaturesByKey?Q.evaluate(Wr,{},c):void 0;if(this.features.push({id:Ht,text:on,icon:Gn,index:ir,sourceLayerIndex:ur,geometry:Wr.geometry,properties:Dt.properties,type:Et[Dt.type],sortKey:wi}),Gn&&(ee[Gn.name]=!0),on){var ai=E.evaluate(Wr,{},c).join(","),Ln=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fn.vertical)>=0;for(var Fi=0,_i=on.sections;Fi<_i.length;Fi+=1){var Qi=_i[Fi];if(Qi.image)ee[Qi.image.name]=!0;else{var Yn=cl(on.toString()),ua=Qi.fontStack||ai,Za=pe[ua]=pe[ua]||{};this.calculateGlyphDependencies(Qi.text,Za,Ln,this.allowVerticalPlacement,Yn)}}}}}}b.get("symbol-placement")==="line"&&(this.features=function(fo){var oo={},Va={},ja=[],Go=0;function Xo(Ha){ja.push(fo[Ha]),Go++}function Ps(Ha,Zo,ks){var $i=Va[Ha];return delete Va[Ha],Va[Zo]=$i,ja[$i].geometry[0].pop(),ja[$i].geometry[0]=ja[$i].geometry[0].concat(ks[0]),$i}function zo(Ha,Zo,ks){var $i=oo[Zo];return delete oo[Zo],oo[Ha]=$i,ja[$i].geometry[0].shift(),ja[$i].geometry[0]=ks[0].concat(ja[$i].geometry[0]),$i}function Gs(Ha,Zo,ks){var $i=ks?Zo[0][Zo[0].length-1]:Zo[0][0];return Ha+":"+$i.x+":"+$i.y}for(var go=0;go<fo.length;go++){var ms=fo[go],ji=ms.geometry,Ta=ms.text?ms.text.toString():null;if(Ta){var Ea=Gs(Ta,ji),xi=Gs(Ta,ji,!0);if(Ea in Va&&xi in oo&&Va[Ea]!==oo[xi]){var K=zo(Ea,xi,ji),Os=Ps(Ea,xi,ja[K].geometry);delete oo[Ea],delete Va[xi],Va[Gs(Ta,ja[Os].geometry,!0)]=Os,ja[K].geometry=null}else Ea in Va?Ps(Ea,xi,ji):xi in oo?zo(Ea,xi,ji):(Xo(go),oo[Ea]=Go-1,Va[xi]=Go-1)}else Xo(go)}return ja.filter(function(Ha){return Ha.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(fo,oo){return fo.sortKey-oo.sortKey})}},En.prototype.update=function(o,u,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,c),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,c))},En.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},En.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},En.prototype.upload=function(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},En.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},En.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},En.prototype.addToLineVertexArray=function(o,u){var c=this.lineVertexArray.length;if(o.segment!==void 0){for(var m=o.dist(u[o.segment+1]),b=o.dist(u[o.segment]),E={},T=o.segment+1;T<u.length;T++)E[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:m},T<u.length-1&&(m+=u[T+1].dist(u[T]));for(var M=o.segment||0;M>=0;M--)E[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:b},M>0&&(b+=u[M-1].dist(u[M]));for(var B=0;B<u.length;B++){var G=E[B];this.lineVertexArray.emplaceBack(G.x,G.y,G.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},En.prototype.addSymbols=function(o,u,c,m,b,E,T,M,B,G,Q,ee){for(var pe=o.indexArray,_e=o.layoutVertexArray,Ge=o.segments.prepareSegment(4*u.length,_e,pe,this.canOverlap?E.sortKey:void 0),Ye=this.glyphOffsetArray.length,yt=Ge.vertexLength,ot=this.allowVerticalPlacement&&T===Fn.vertical?Math.PI/2:0,Dt=E.text&&E.text.sections,Ht=0;Ht<u.length;Ht++){var ir=u[Ht],ur=ir.tl,xr=ir.tr,Wr=ir.bl,on=ir.br,Dn=ir.tex,Sn=ir.pixelOffsetTL,Gn=ir.pixelOffsetBR,An=ir.minFontScaleX,wi=ir.minFontScaleY,ai=ir.glyphOffset,Ln=ir.isSDF,Fi=ir.sectionIndex,_i=Ge.vertexLength,Qi=ai[1];pr(_e,M.x,M.y,ur.x,Qi+ur.y,Dn.x,Dn.y,c,Ln,Sn.x,Sn.y,An,wi),pr(_e,M.x,M.y,xr.x,Qi+xr.y,Dn.x+Dn.w,Dn.y,c,Ln,Gn.x,Sn.y,An,wi),pr(_e,M.x,M.y,Wr.x,Qi+Wr.y,Dn.x,Dn.y+Dn.h,c,Ln,Sn.x,Gn.y,An,wi),pr(_e,M.x,M.y,on.x,Qi+on.y,Dn.x+Dn.w,Dn.y+Dn.h,c,Ln,Gn.x,Gn.y,An,wi),sr(o.dynamicLayoutVertexArray,M,ot),pe.emplaceBack(_i,_i+1,_i+2),pe.emplaceBack(_i+1,_i+2,_i+3),Ge.vertexLength+=4,Ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),Ht!==u.length-1&&Fi===u[Ht+1].sectionIndex||o.programConfigurations.populatePaintArrays(_e.length,E,E.index,{},ee,Dt&&Dt[Fi])}o.placedSymbolArray.emplaceBack(M.x,M.y,Ye,this.glyphOffsetArray.length-Ye,yt,B,G,M.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],T,0,!1,0,Q)},En.prototype._addCollisionDebugVertex=function(o,u,c,m,b,E){return u.emplaceBack(0,0),o.emplaceBack(c.x,c.y,m,b,Math.round(E.x),Math.round(E.y))},En.prototype.addCollisionDebugVertices=function(o,u,c,m,b,E,T){var M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),B=M.vertexLength,G=b.layoutVertexArray,Q=b.collisionVertexArray,ee=T.anchorX,pe=T.anchorY;this._addCollisionDebugVertex(G,Q,E,ee,pe,new V(o,u)),this._addCollisionDebugVertex(G,Q,E,ee,pe,new V(c,u)),this._addCollisionDebugVertex(G,Q,E,ee,pe,new V(c,m)),this._addCollisionDebugVertex(G,Q,E,ee,pe,new V(o,m)),M.vertexLength+=4;var _e=b.indexArray;_e.emplaceBack(B,B+1),_e.emplaceBack(B+1,B+2),_e.emplaceBack(B+2,B+3),_e.emplaceBack(B+3,B),M.primitiveLength+=4},En.prototype.addDebugCollisionBoxes=function(o,u,c,m){for(var b=o;b<u;b++){var E=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,c)}},En.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nn(ec,Gd.members,Gu),this.iconCollisionBox=new Nn(ec,Gd.members,Gu);for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},En.prototype._deserializeCollisionBoxesForSymbol=function(o,u,c,m,b,E,T,M,B){for(var G={},Q=u;Q<c;Q++){var ee=o.get(Q);G.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},G.textFeatureIndex=ee.featureIndex;break}for(var pe=m;pe<b;pe++){var _e=o.get(pe);G.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},G.verticalTextFeatureIndex=_e.featureIndex;break}for(var Ge=E;Ge<T;Ge++){var Ye=o.get(Ge);G.iconBox={x1:Ye.x1,y1:Ye.y1,x2:Ye.x2,y2:Ye.y2,anchorPointX:Ye.anchorPointX,anchorPointY:Ye.anchorPointY},G.iconFeatureIndex=Ye.featureIndex;break}for(var yt=M;yt<B;yt++){var ot=o.get(yt);G.verticalIconBox={x1:ot.x1,y1:ot.y1,x2:ot.x2,y2:ot.y2,anchorPointX:ot.anchorPointX,anchorPointY:ot.anchorPointY},G.verticalIconFeatureIndex=ot.featureIndex;break}return G},En.prototype.deserializeCollisionBoxes=function(o){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var c=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},En.prototype.hasTextData=function(){return this.text.segments.get().length>0},En.prototype.hasIconData=function(){return this.icon.segments.get().length>0},En.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},En.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},En.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},En.prototype.addIndicesForPlacedSymbol=function(o,u){for(var c=o.placedSymbolArray.get(u),m=c.vertexStartIndex+4*c.numGlyphs,b=c.vertexStartIndex;b<m;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)},En.prototype.getSortedSymbolIndexes=function(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(o),c=Math.cos(o),m=[],b=[],E=[],T=0;T<this.symbolInstances.length;++T){E.push(T);var M=this.symbolInstances.get(T);m.push(0|Math.round(u*M.anchorX+c*M.anchorY)),b.push(M.featureIndex)}return E.sort(function(B,G){return m[B]-m[G]||b[G]-b[B]}),E},En.prototype.addToSortKeyRanges=function(o,u){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===u?c.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})},En.prototype.sortFeatures=function(o){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var b=this.symbolInstances.get(m[c]);this.featureSortOrder.push(b.featureIndex),[b.rightJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.leftJustifiedTextSymbolIndex].forEach(function(E,T,M){E>=0&&M.indexOf(E)===T&&u.addIndicesForPlacedSymbol(u.text,E)}),b.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,b.verticalPlacedTextSymbolIndex),b.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.placedIconSymbolIndex),b.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Mn("SymbolBucket",En,{omit:["layers","collisionBoxArray","features","compareText"]}),En.MAX_GLYPHS=65535,En.addDynamicAttributes=sr;var On=new Ua({"symbol-placement":new Zn(W.layout_symbol["symbol-placement"]),"symbol-spacing":new Zn(W.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Zn(W.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pn(W.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Zn(W.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Zn(W.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Zn(W.layout_symbol["icon-ignore-placement"]),"icon-optional":new Zn(W.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Zn(W.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pn(W.layout_symbol["icon-size"]),"icon-text-fit":new Zn(W.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Zn(W.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pn(W.layout_symbol["icon-image"]),"icon-rotate":new Pn(W.layout_symbol["icon-rotate"]),"icon-padding":new Zn(W.layout_symbol["icon-padding"]),"icon-keep-upright":new Zn(W.layout_symbol["icon-keep-upright"]),"icon-offset":new Pn(W.layout_symbol["icon-offset"]),"icon-anchor":new Pn(W.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Zn(W.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Zn(W.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Zn(W.layout_symbol["text-rotation-alignment"]),"text-field":new Pn(W.layout_symbol["text-field"]),"text-font":new Pn(W.layout_symbol["text-font"]),"text-size":new Pn(W.layout_symbol["text-size"]),"text-max-width":new Pn(W.layout_symbol["text-max-width"]),"text-line-height":new Zn(W.layout_symbol["text-line-height"]),"text-letter-spacing":new Pn(W.layout_symbol["text-letter-spacing"]),"text-justify":new Pn(W.layout_symbol["text-justify"]),"text-radial-offset":new Pn(W.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Zn(W.layout_symbol["text-variable-anchor"]),"text-anchor":new Pn(W.layout_symbol["text-anchor"]),"text-max-angle":new Zn(W.layout_symbol["text-max-angle"]),"text-writing-mode":new Zn(W.layout_symbol["text-writing-mode"]),"text-rotate":new Pn(W.layout_symbol["text-rotate"]),"text-padding":new Zn(W.layout_symbol["text-padding"]),"text-keep-upright":new Zn(W.layout_symbol["text-keep-upright"]),"text-transform":new Pn(W.layout_symbol["text-transform"]),"text-offset":new Pn(W.layout_symbol["text-offset"]),"text-allow-overlap":new Zn(W.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Zn(W.layout_symbol["text-ignore-placement"]),"text-optional":new Zn(W.layout_symbol["text-optional"])}),Kn={paint:new Ua({"icon-opacity":new Pn(W.paint_symbol["icon-opacity"]),"icon-color":new Pn(W.paint_symbol["icon-color"]),"icon-halo-color":new Pn(W.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pn(W.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pn(W.paint_symbol["icon-halo-blur"]),"icon-translate":new Zn(W.paint_symbol["icon-translate"]),"icon-translate-anchor":new Zn(W.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pn(W.paint_symbol["text-opacity"]),"text-color":new Pn(W.paint_symbol["text-color"],{runtimeType:$r,getOverride:function(o){return o.textColor},hasOverride:function(o){return!!o.textColor}}),"text-halo-color":new Pn(W.paint_symbol["text-halo-color"]),"text-halo-width":new Pn(W.paint_symbol["text-halo-width"]),"text-halo-blur":new Pn(W.paint_symbol["text-halo-blur"]),"text-translate":new Zn(W.paint_symbol["text-translate"]),"text-translate-anchor":new Zn(W.paint_symbol["text-translate-anchor"])}),layout:On},ci=function(o){this.type=o.property.overrides?o.property.overrides.runtimeType:un,this.defaultValue=o};ci.prototype.evaluate=function(o){if(o.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default},ci.prototype.eachChild=function(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)},ci.prototype.outputDefined=function(){return!1},ci.prototype.serialize=function(){return null},Mn("FormatSectionOverride",ci,{omit:["defaultValue"]});var ha=function(o){function u(c){o.call(this,c,Kn)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){if(o.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var b=this.layout.get("text-writing-mode");if(b){for(var E=[],T=0,M=b;T<M.length;T+=1){var B=M[T];E.indexOf(B)<0&&E.push(B)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(c,m,b,E){var T=this.layout.get(c).evaluate(m,{},b,E),M=this._unevaluatedLayout._values[c];return M.isDataDriven()||Zu(M.value)||!T?T:function(B,G){return G.replace(/{([^{}]+)}/g,function(Q,ee){return ee in B?String(B[ee]):""})}(m.properties,T)},u.prototype.createBucket=function(c){return new En(c)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var c=0,m=Kn.paint.overridableProperties;c<m.length;c+=1){var b=m[c];if(u.hasPaintOverride(this.layout,b)){var E,T=this.paint.get(b),M=new ci(T),B=new Xl(M,T.property.specification);E=T.value.kind==="constant"||T.value.kind==="source"?new Ac("source",B):new $l("composite",B,T.value.zoomStops,T.value._interpolationType),this.paint._values[b]=new Ro(T.property,E,T.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,b){return!(!this.layout||m.isDataDriven()||b.isDataDriven())&&u.hasPaintOverride(this.layout,c)},u.hasPaintOverride=function(c,m){var b=c.get("text-field"),E=Kn.paint.properties[m],T=!1,M=function(Q){for(var ee=0,pe=Q;ee<pe.length;ee+=1)if(E.overrides&&E.overrides.hasOverride(pe[ee]))return void(T=!0)};if(b.value.kind==="constant"&&b.value.value instanceof _a)M(b.value.value.sections);else if(b.value.kind==="source"){var B=function(Q){T||(Q instanceof Fa&&Pa(Q.value)===Gi?M(Q.value.sections):Q instanceof us?M(Q.sections):Q.eachChild(B))},G=b.value;G._styleExpression&&B(G._styleExpression.expression)}return T},u}(tu),Ao={paint:new Ua({"background-color":new Zn(W.paint_background["background-color"]),"background-pattern":new fs(W.paint_background["background-pattern"]),"background-opacity":new Zn(W.paint_background["background-opacity"])})},_l=function(o){function u(c){o.call(this,c,Ao)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(tu),od={paint:new Ua({"raster-opacity":new Zn(W.paint_raster["raster-opacity"]),"raster-hue-rotate":new Zn(W.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Zn(W.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Zn(W.paint_raster["raster-brightness-max"]),"raster-saturation":new Zn(W.paint_raster["raster-saturation"]),"raster-contrast":new Zn(W.paint_raster["raster-contrast"]),"raster-resampling":new Zn(W.paint_raster["raster-resampling"]),"raster-fade-duration":new Zn(W.paint_raster["raster-fade-duration"])})},Cu=function(o){function u(c){o.call(this,c,od)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(tu),sd=function(o){function u(c){o.call(this,c,{}),this.implementation=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},u.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},u}(tu),sc={circle:Mh,heatmap:vl,hillshade:ng,fill:gp,"fill-extrusion":td,line:Yf,symbol:ha,background:_l,raster:Cu},xp=H.HTMLImageElement,Gv=H.HTMLCanvasElement,ag=H.HTMLVideoElement,pf=H.ImageData,Zc=H.ImageBitmap,Vc=function(o,u,c,m){this.context=o,this.format=c,this.texture=o.gl.createTexture(),this.update(u,m)};Vc.prototype.update=function(o,u,c){var m=o.width,b=o.height,E=!(this.size&&this.size[0]===m&&this.size[1]===b||c),T=this.context,M=T.gl;if(this.useMipmap=!!(u&&u.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,b],o instanceof xp||o instanceof Gv||o instanceof ag||o instanceof pf||Zc&&o instanceof Zc?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,m,b,0,this.format,M.UNSIGNED_BYTE,o.data);else{var B=c||{x:0,y:0},G=B.x,Q=B.y;o instanceof xp||o instanceof Gv||o instanceof ag||o instanceof pf||Zc&&o instanceof Zc?M.texSubImage2D(M.TEXTURE_2D,0,G,Q,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,G,Q,m,b,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},Vc.prototype.bind=function(o,u,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),o!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||o),this.filter=o),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)},Vc.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Vc.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var vs=function(o){var u=this;this._callback=o,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};vs.prototype.trigger=function(){var o=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){o._triggered=!1,o._callback()},0))},vs.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ep=function(o,u,c){this.target=o,this.parent=u,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},dr(["receive","process"],this),this.invoker=new vs(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ie()?o:H};function og(o,u,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[o*m-2*Math.PI*6378137/2,u*m-2*Math.PI*6378137/2]}Ep.prototype.send=function(o,u,c,m,b){var E=this;b===void 0&&(b=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[T]=c);var M=ke(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:o,hasCallback:!!c,targetMapId:m,mustQueue:b,sourceMapId:this.mapId,data:ls(u,M)},M),{cancel:function(){c&&delete E.callbacks[T],E.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},Ep.prototype.receive=function(o){var u=o.data,c=u.id;if(c&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else ie()||u.mustQueue?(this.tasks[c]=u,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,u)},Ep.prototype.process=function(){if(this.taskQueue.length){var o=this.taskQueue.shift(),u=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(o,u)}},Ep.prototype.processTask=function(o,u){var c=this;if(u.type==="<response>"){var m=this.callbacks[o];delete this.callbacks[o],m&&(u.error?m(xa(u.error)):m(null,xa(u.data)))}else{var b=!1,E=ke(this.globalScope)?void 0:[],T=u.hasCallback?function(Q,ee){b=!0,delete c.cancelCallbacks[o],c.target.postMessage({id:o,type:"<response>",sourceMapId:c.mapId,error:Q?ls(Q):null,data:ls(ee,E)},E)}:function(Q){b=!0},M=null,B=xa(u.data);if(this.parent[u.type])M=this.parent[u.type](u.sourceMapId,B,T);else if(this.parent.getWorkerSource){var G=u.type.split(".");M=this.parent.getWorkerSource(u.sourceMapId,G[0],B.source)[G[1]](B,T)}else T(new Error("Could not find function "+u.type));!b&&M&&M.cancel&&(this.cancelCallbacks[o]=M.cancel)}},Ep.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var No=function(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))};No.prototype.setNorthEast=function(o){return this._ne=o instanceof za?new za(o.lng,o.lat):za.convert(o),this},No.prototype.setSouthWest=function(o){return this._sw=o instanceof za?new za(o.lng,o.lat):za.convert(o),this},No.prototype.extend=function(o){var u,c,m=this._sw,b=this._ne;if(o instanceof za)u=o,c=o;else{if(!(o instanceof No))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(No.convert(o)):this.extend(za.convert(o)):this;if(c=o._ne,!(u=o._sw)||!c)return this}return m||b?(m.lng=Math.min(u.lng,m.lng),m.lat=Math.min(u.lat,m.lat),b.lng=Math.max(c.lng,b.lng),b.lat=Math.max(c.lat,b.lat)):(this._sw=new za(u.lng,u.lat),this._ne=new za(c.lng,c.lat)),this},No.prototype.getCenter=function(){return new za((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},No.prototype.getSouthWest=function(){return this._sw},No.prototype.getNorthEast=function(){return this._ne},No.prototype.getNorthWest=function(){return new za(this.getWest(),this.getNorth())},No.prototype.getSouthEast=function(){return new za(this.getEast(),this.getSouth())},No.prototype.getWest=function(){return this._sw.lng},No.prototype.getSouth=function(){return this._sw.lat},No.prototype.getEast=function(){return this._ne.lng},No.prototype.getNorth=function(){return this._ne.lat},No.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},No.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},No.prototype.isEmpty=function(){return!(this._sw&&this._ne)},No.prototype.contains=function(o){var u=za.convert(o),c=u.lng,m=u.lat,b=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&b},No.convert=function(o){return!o||o instanceof No?o:new No(o)};var za=function(o,u){if(isNaN(o)||isNaN(u))throw new Error("Invalid LngLat object: ("+o+", "+u+")");if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};za.prototype.wrap=function(){return new za(ye(this.lng,-180,180),this.lat)},za.prototype.toArray=function(){return[this.lng,this.lat]},za.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},za.prototype.distanceTo=function(o){var u=Math.PI/180,c=this.lat*u,m=o.lat*u,b=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((o.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(b,1))},za.prototype.toBounds=function(o){o===void 0&&(o=0);var u=360*o/40075017,c=u/Math.cos(Math.PI/180*this.lat);return new No(new za(this.lng-c,this.lat-u),new za(this.lng+c,this.lat+u))},za.convert=function(o){if(o instanceof za)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new za(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new za(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var sg=2*Math.PI*63710088e-1;function ug(o){return sg*Math.cos(o*Math.PI/180)}function lg(o){return(180+o)/360}function cg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Ui(o,u){return o/ug(u)}function Bi(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}var Fl=function(o,u,c){c===void 0&&(c=0),this.x=+o,this.y=+u,this.z=+c};Fl.fromLngLat=function(o,u){u===void 0&&(u=0);var c=za.convert(o);return new Fl(lg(c.lng),cg(c.lat),Ui(u,c.lat))},Fl.prototype.toLngLat=function(){return new za(360*this.x-180,Bi(this.y))},Fl.prototype.toAltitude=function(){return this.z*ug(Bi(this.y))},Fl.prototype.meterInMercatorCoordinateUnits=function(){return 1/sg*(o=Bi(this.y),1/Math.cos(o*Math.PI/180));var o};var df=function(o,u,c){this.z=o,this.x=u,this.y=c,this.key=Sp(0,o,o,u,c)};df.prototype.equals=function(o){return this.z===o.z&&this.x===o.x&&this.y===o.y},df.prototype.url=function(o,u){var c,m,b,E,T,M=(m=this.y,b=this.z,E=og(256*(c=this.x),256*(m=Math.pow(2,b)-m-1),b),T=og(256*(c+1),256*(m+1),b),E[0]+","+E[1]+","+T[0]+","+T[1]),B=function(G,Q,ee){for(var pe,_e="",Ge=G;Ge>0;Ge--)_e+=(Q&(pe=1<<Ge-1)?1:0)+(ee&pe?2:0);return _e}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",B).replace("{bbox-epsg-3857}",M)},df.prototype.getTilePoint=function(o){var u=Math.pow(2,this.z);return new V(8192*(o.x*u-this.x),8192*(o.y*u-this.y))},df.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var fg=function(o,u){this.wrap=o,this.canonical=u,this.key=Sp(o,u.z,u.z,u.x,u.y)},Uo=function(o,u,c,m,b){this.overscaledZ=o,this.wrap=u,this.canonical=new df(c,+m,+b),this.key=Sp(u,o,c,m,b)};function Sp(o,u,c,m,b){(o*=2)<0&&(o=-1*o-1);var E=1<<c;return(E*E*o+E*b+m).toString(36)+c.toString(36)+u.toString(36)}Uo.prototype.equals=function(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)},Uo.prototype.scaledTo=function(o){var u=this.canonical.z-o;return o>this.canonical.z?new Uo(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Uo(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)},Uo.prototype.calculateScaledKey=function(o,u){var c=this.canonical.z-o;return o>this.canonical.z?Sp(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):Sp(this.wrap*+u,o,o,this.canonical.x>>c,this.canonical.y>>c)},Uo.prototype.isChildOf=function(o){if(o.wrap!==this.wrap)return!1;var u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u},Uo.prototype.children=function(o){if(this.overscaledZ>=o)return[new Uo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new Uo(u,this.wrap,u,c,m),new Uo(u,this.wrap,u,c+1,m),new Uo(u,this.wrap,u,c,m+1),new Uo(u,this.wrap,u,c+1,m+1)]},Uo.prototype.isLessThan=function(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))},Uo.prototype.wrapped=function(){return new Uo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Uo.prototype.unwrapTo=function(o){return new Uo(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)},Uo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Uo.prototype.toUnwrapped=function(){return new fg(this.wrap,this.canonical)},Uo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Uo.prototype.getTilePoint=function(o){return this.canonical.getTilePoint(new Fl(o.x-this.wrap,o.y))},Mn("CanonicalTileID",df),Mn("OverscaledTileID",Uo,{omit:["posMatrix"]});var Ku=function(o,u,c){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Ve('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var m=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=c||"mapbox";for(var b=0;b<m;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(m,b)]=this.data[this._idx(m-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,m)]=this.data[this._idx(b,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};Ku.prototype.get=function(o,u){var c=new Uint8Array(this.data.buffer),m=4*this._idx(o,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},Ku.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ku.prototype._idx=function(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)},Ku.prototype._unpackMapbox=function(o,u,c){return(256*o*256+256*u+c)/10-1e4},Ku.prototype._unpackTerrarium=function(o,u,c){return 256*o+u+c/256-32768},Ku.prototype.getPixels=function(){return new Do({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ku.prototype.backfillBorder=function(o,u,c){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");var m=u*this.dim,b=u*this.dim+this.dim,E=c*this.dim,T=c*this.dim+this.dim;switch(u){case-1:m=b-1;break;case 1:b=m+1}switch(c){case-1:E=T-1;break;case 1:T=E+1}for(var M=-u*this.dim,B=-c*this.dim,G=E;G<T;G++)for(var Q=m;Q<b;Q++)this.data[this._idx(Q,G)]=o.data[this._idx(Q+M,G+B)]},Mn("DEMData",Ku);var jc=function(o){this._stringToNumber={},this._numberToString=[];for(var u=0;u<o.length;u++){var c=o[u];this._stringToNumber[c]=u,this._numberToString[u]=c}};jc.prototype.encode=function(o){return this._stringToNumber[o]},jc.prototype.decode=function(o){return this._numberToString[o]};var ud=function(o,u,c,m,b){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=c,o._y=m,this.properties=o.properties,this.id=b},Xd={geometry:{configurable:!0}};Xd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Xd.geometry.set=function(o){this._geometry=o},ud.prototype.toJSON=function(){var o={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o},Object.defineProperties(ud.prototype,Xd);var Bh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Bh.prototype.updateState=function(o,u,c){var m=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},St(this.stateChanges[o][m],c),this.deletedStates[o]===null)for(var b in this.deletedStates[o]={},this.state[o])b!==m&&(this.deletedStates[o][b]=null);else if(this.deletedStates[o]&&this.deletedStates[o][m]===null)for(var E in this.deletedStates[o][m]={},this.state[o][m])c[E]||(this.deletedStates[o][m][E]=null);else for(var T in c)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][T]===null&&delete this.deletedStates[o][m][T]},Bh.prototype.removeFeatureState=function(o,u,c){if(this.deletedStates[o]!==null){var m=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},c&&u!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][c]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(c in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][c]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}},Bh.prototype.getState=function(o,u){var c=String(u),m=St({},(this.state[o]||{})[c],(this.stateChanges[o]||{})[c]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){var b=this.deletedStates[o][u];if(b===null)return{};for(var E in b)delete m[E]}return m},Bh.prototype.initializeTileState=function(o,u){o.setFeatureState(this.state,u)},Bh.prototype.coalesceChanges=function(o,u){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var b={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),St(this.state[m][E],this.stateChanges[m][E]),b[E]=this.state[m][E];c[m]=b}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var M={};if(this.deletedStates[T]===null)for(var B in this.state[T])M[B]={},this.state[T][B]={};else for(var G in this.deletedStates[T]){if(this.deletedStates[T][G]===null)this.state[T][G]={};else for(var Q=0,ee=Object.keys(this.deletedStates[T][G]);Q<ee.length;Q+=1)delete this.state[T][G][ee[Q]];M[G]=this.state[T][G]}c[T]=c[T]||{},St(c[T],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var pe in o)o[pe].setFeatureState(c,u)};var uc=function(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Co(8192,16,0),this.grid3D=new Co(8192,16,0),this.featureIndexArray=new oe,this.promoteId=u};function Xv(o,u,c,m,b){return cr(o,function(E,T){var M=u instanceof bs?u.get(T):null;return M&&M.evaluate?M.evaluate(c,m,b):M})}function hg(o){for(var u=1/0,c=1/0,m=-1/0,b=-1/0,E=0,T=o;E<T.length;E+=1){var M=T[E];u=Math.min(u,M.x),c=Math.min(c,M.y),m=Math.max(m,M.x),b=Math.max(b,M.y)}return{minX:u,minY:c,maxX:m,maxY:b}}function k0(o,u){return u-o}uc.prototype.insert=function(o,u,c,m,b,E){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,b);for(var M=E?this.grid3D:this.grid,B=0;B<u.length;B++){for(var G=u[B],Q=[1/0,1/0,-1/0,-1/0],ee=0;ee<G.length;ee++){var pe=G[ee];Q[0]=Math.min(Q[0],pe.x),Q[1]=Math.min(Q[1],pe.y),Q[2]=Math.max(Q[2],pe.x),Q[3]=Math.max(Q[3],pe.y)}Q[0]<8192&&Q[1]<8192&&Q[2]>=0&&Q[3]>=0&&M.insert(T,Q[0],Q[1],Q[2],Q[3])}},uc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new oc.VectorTile(new rr(this.rawTileData)).layers,this.sourceLayerCoder=new jc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},uc.prototype.query=function(o,u,c,m){var b=this;this.loadVTLayers();for(var E=o.params||{},T=8192/o.tileSize/o.scale,M=ul(E.filter),B=o.queryGeometry,G=o.queryPadding*T,Q=hg(B),ee=this.grid.query(Q.minX-G,Q.minY-G,Q.maxX+G,Q.maxY+G),pe=hg(o.cameraQueryGeometry),_e=this.grid3D.query(pe.minX-G,pe.minY-G,pe.maxX+G,pe.maxY+G,function(ir,ur,xr,Wr){return function(on,Dn,Sn,Gn,An){for(var wi=0,ai=on;wi<ai.length;wi+=1){var Ln=ai[wi];if(Dn<=Ln.x&&Sn<=Ln.y&&Gn>=Ln.x&&An>=Ln.y)return!0}var Fi=[new V(Dn,Sn),new V(Dn,An),new V(Gn,An),new V(Gn,Sn)];if(on.length>2){for(var _i=0,Qi=Fi;_i<Qi.length;_i+=1)if(cu(on,Qi[_i]))return!0}for(var Yn=0;Yn<on.length-1;Yn++)if(dl(on[Yn],on[Yn+1],Fi))return!0;return!1}(o.cameraQueryGeometry,ir-G,ur-G,xr+G,Wr+G)}),Ge=0,Ye=_e;Ge<Ye.length;Ge+=1)ee.push(Ye[Ge]);ee.sort(k0);for(var yt,ot={},Dt=function(ir){var ur=ee[ir];if(ur!==yt){yt=ur;var xr=b.featureIndexArray.get(ur),Wr=null;b.loadMatchingFeature(ot,xr.bucketIndex,xr.sourceLayerIndex,xr.featureIndex,M,E.layers,E.availableImages,u,c,m,function(on,Dn,Sn){return Wr||(Wr=Ka(on)),Dn.queryIntersectsFeature(B,on,Sn,Wr,b.z,o.transform,T,o.pixelPosMatrix)})}},Ht=0;Ht<ee.length;Ht++)Dt(Ht);return ot},uc.prototype.loadMatchingFeature=function(o,u,c,m,b,E,T,M,B,G,Q){var ee=this.bucketLayerIDs[u];if(!E||function(on,Dn){for(var Sn=0;Sn<on.length;Sn++)if(Dn.indexOf(on[Sn])>=0)return!0;return!1}(E,ee)){var pe=this.sourceLayerCoder.decode(c),_e=this.vtLayers[pe].feature(m);if(b.needGeometry){var Ge=io(_e,!0);if(!b.filter(new Le(this.tileID.overscaledZ),Ge,this.tileID.canonical))return}else if(!b.filter(new Le(this.tileID.overscaledZ),_e))return;for(var Ye=this.getId(_e,pe),yt=0;yt<ee.length;yt++){var ot=ee[yt];if(!(E&&E.indexOf(ot)<0)){var Dt=M[ot];if(Dt){var Ht={};Ye!==void 0&&G&&(Ht=G.getState(Dt.sourceLayer||"_geojsonTileLayer",Ye));var ir=St({},B[ot]);ir.paint=Xv(ir.paint,Dt.paint,_e,Ht,T),ir.layout=Xv(ir.layout,Dt.layout,_e,Ht,T);var ur=!Q||Q(_e,Dt,Ht);if(ur){var xr=new ud(_e,this.z,this.x,this.y,Ye);xr.layer=ir;var Wr=o[ot];Wr===void 0&&(Wr=o[ot]=[]),Wr.push({featureIndex:m,feature:xr,intersectionZ:ur})}}}}}},uc.prototype.lookupSymbolFeatures=function(o,u,c,m,b,E,T,M){var B={};this.loadVTLayers();for(var G=ul(b),Q=0,ee=o;Q<ee.length;Q+=1)this.loadMatchingFeature(B,c,m,ee[Q],G,E,T,M,u);return B},uc.prototype.hasLayer=function(o){for(var u=0,c=this.bucketLayerIDs;u<c.length;u+=1)for(var m=0,b=c[u];m<b.length;m+=1)if(o===b[m])return!0;return!1},uc.prototype.getId=function(o,u){var c=o.id;return this.promoteId&&typeof(c=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(c=Number(c)),c},Mn("FeatureIndex",uc,{omit:["rawTileData","sourceLayerCoder"]});var is=function(o,u){this.tileID=o,this.uid=Ze(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};is.prototype.registerFadeDuration=function(o){var u=o+this.timeAdded;u<Vr.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},is.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},is.prototype.loadVectorData=function(o,u,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){for(var m in o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(G,Q){var ee={};if(!Q)return ee;for(var pe=function(){var Ye=Ge[_e],yt=Ye.layerIds.map(function(Ht){return Q.getLayer(Ht)}).filter(Boolean);if(yt.length!==0){Ye.layers=yt,Ye.stateDependentLayerIds&&(Ye.stateDependentLayers=Ye.stateDependentLayerIds.map(function(Ht){return yt.filter(function(ir){return ir.id===Ht})[0]}));for(var ot=0,Dt=yt;ot<Dt.length;ot+=1)ee[Dt[ot].id]=Ye}},_e=0,Ge=G;_e<Ge.length;_e+=1)pe();return ee}(o.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var b=this.buckets[m];if(b instanceof En){if(this.hasSymbolBuckets=!0,!c)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var T=this.buckets[E];if(T instanceof En&&T.hasRTLText){this.hasRTLText=!0,Nt.isLoading()||Nt.isLoaded()||Nf()!=="deferred"||Js();break}}for(var M in this.queryPadding=0,this.buckets){var B=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(M).queryRadius(B))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new v},is.prototype.unloadVectorData=function(){for(var o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},is.prototype.getBucket=function(o){return this.buckets[o.id]},is.prototype.upload=function(o){for(var u in this.buckets){var c=this.buckets[u];c.uploadPending()&&c.upload(o)}var m=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vc(o,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vc(o,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},is.prototype.prepare=function(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)},is.prototype.queryRenderedFeatures=function(o,u,c,m,b,E,T,M,B,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:G,transform:M,params:T,queryPadding:this.queryPadding*B},o,u,c):{}},is.prototype.querySourceFeatures=function(o,u){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),b=u?u.sourceLayer:"",E=m._geojsonTileLayer||m[b];if(E)for(var T=ul(u&&u.filter),M=this.tileID.canonical,B=M.z,G=M.x,Q=M.y,ee={z:B,x:G,y:Q},pe=0;pe<E.length;pe++){var _e=E.feature(pe);if(T.needGeometry){var Ge=io(_e,!0);if(!T.filter(new Le(this.tileID.overscaledZ),Ge,this.tileID.canonical))continue}else if(!T.filter(new Le(this.tileID.overscaledZ),_e))continue;var Ye=c.getId(_e,b),yt=new ud(_e,B,G,Q,Ye);yt.tile=ee,o.push(yt)}}},is.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},is.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},is.prototype.setExpiryData=function(o){var u=this.expirationTime;if(o.cacheControl){var c=j(o.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){var m=Date.now(),b=!1;if(this.expirationTime>m)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{var E=this.expirationTime-u;E?this.expirationTime=m+Math.max(E,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},is.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},is.prototype.setFeatureState=function(o,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(u.style.hasLayer(m)){var b=this.buckets[m],E=b.layers[0].sourceLayer||"_geojsonTileLayer",T=c[E],M=o[E];if(T&&M&&Object.keys(M).length!==0){b.update(M,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var B=u&&u.style&&u.style.getLayer(m);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(b)))}}}},is.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},is.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vr.now()},is.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},is.prototype.setHoldDuration=function(o){this.symbolFadeHoldUntil=Vr.now()+o},is.prototype.setDependencies=function(o,u){for(var c={},m=0,b=u;m<b.length;m+=1)c[b[m]]=!0;this.dependencies[o]=c},is.prototype.hasDependency=function(o,u){for(var c=0,m=o;c<m.length;c+=1){var b=this.dependencies[m[c]];if(b){for(var E=0,T=u;E<T.length;E+=1)if(b[T[E]])return!0}}return!1};var vf=H.performance,pg=function(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},vf.mark(this._marks.start)};pg.prototype.finish=function(){vf.mark(this._marks.end);var o=vf.getEntriesByName(this._marks.measure);return o.length===0&&(vf.measure(this._marks.measure,this._marks.start,this._marks.end),o=vf.getEntriesByName(this._marks.measure),vf.clearMarks(this._marks.start),vf.clearMarks(this._marks.end),vf.clearMeasures(this._marks.measure)),o},y.Actor=Ep,y.AlphaImage=ru,y.CanonicalTileID=df,y.CollisionBoxArray=v,y.Color=Ii,y.DEMData=Ku,y.DataConstantProperty=Zn,y.DictionaryCoder=jc,y.EXTENT=8192,y.ErrorEvent=We,y.EvaluationParameters=Le,y.Event=Me,y.Evented=ut,y.FeatureIndex=uc,y.FillBucket=gl,y.FillExtrusionBucket=Ts,y.ImageAtlas=Sr,y.ImagePosition=ln,y.LineBucket=Is,y.LngLat=za,y.LngLatBounds=No,y.MercatorCoordinate=Fl,y.ONE_EM=24,y.OverscaledTileID=Uo,y.Point=V,y.Point$1=V,y.Properties=Ua,y.Protobuf=rr,y.RGBAImage=Do,y.RequestManager=Lr,y.RequestPerformance=pg,y.ResourceType=z,y.SegmentVector=we,y.SourceFeatureState=Bh,y.StructArrayLayout1ui2=Vf,y.StructArrayLayout2f1f2i16=tc,y.StructArrayLayout2i4=Dl,y.StructArrayLayout3ui6=hs,y.StructArrayLayout4i8=Uf,y.SymbolBucket=En,y.Texture=Vc,y.Tile=is,y.Transitionable=ve,y.Uniform1f=Yr,y.Uniform1i=Tr,y.Uniform2f=Ur,y.Uniform3f=_n,y.Uniform4f=Hn,y.UniformColor=Vn,y.UniformMatrix4f=Wi,y.UnwrappedTileID=fg,y.ValidationError=ne,y.WritingMode=Fn,y.ZoomHistory=Lf,y.add=function(o,u,c){return o[0]=u[0]+c[0],o[1]=u[1]+c[1],o[2]=u[2]+c[2],o},y.addDynamicAttributes=sr,y.asyncAll=function(o,u,c){if(!o.length)return c(null,[]);var m=o.length,b=new Array(o.length),E=null;o.forEach(function(T,M){u(T,function(B,G){B&&(E=B),b[M]=G,--m==0&&c(E,b)})})},y.bezier=Ce,y.bindAll=dr,y.browser=Vr,y.cacheEntryPossiblyAdded=function(o){++he>Gr&&(o.getActor().send("enforceCacheSizeLimit",br),he=0)},y.clamp=ct,y.clearTileCache=function(o){var u=H.caches.delete("mapbox-tiles");o&&u.catch(o).then(function(){return o()})},y.clipLine=yl,y.clone=function(o){var u=new Vi(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},y.clone$1=Pe,y.clone$2=function(o){var u=new Vi(3);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u},y.collisionCircleLayout=X,y.config=Kr,y.create=function(){var o=new Vi(16);return Vi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},y.create$1=function(){var o=new Vi(9);return Vi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},y.create$2=function(){var o=new Vi(4);return Vi!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},y.createCommonjsModule=le,y.createExpression=tf,y.createLayout=_o,y.createStyleLayer=function(o){return o.type==="custom"?new sd(o):new sc[o.type](o)},y.cross=function(o,u,c){var m=u[0],b=u[1],E=u[2],T=c[0],M=c[1],B=c[2];return o[0]=b*B-E*M,o[1]=E*T-m*B,o[2]=m*M-b*T,o},y.deepEqual=function o(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return!1;for(var m=0;m<u.length;m++)if(!o(u[m],c[m]))return!1;return!0}if(typeof u=="object"&&u!==null&&c!==null){if(typeof c!="object"||Object.keys(u).length!==Object.keys(c).length)return!1;for(var b in u)if(!o(u[b],c[b]))return!1;return!0}return u===c},y.dot=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]},y.dot$1=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3]},y.ease=ge,y.emitValidationErrors=Ql,y.endsWith=yr,y.enforceCacheSizeLimit=function(o){rn(),Ni&&Ni.then(function(u){u.keys().then(function(c){for(var m=0;m<c.length-o;m++)u.delete(c[m])})})},y.evaluateSizeForFeature=ds,y.evaluateSizeForZoom=Eo,y.evaluateVariableOffset=At,y.evented=Ic,y.extend=St,y.featureFilter=ul,y.filterObject=ft,y.fromRotation=function(o,u){var c=Math.sin(u),m=Math.cos(u);return o[0]=m,o[1]=c,o[2]=0,o[3]=-c,o[4]=m,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},y.getAnchorAlignment=Oa,y.getAnchorJustification=It,y.getArrayBuffer=Bt,y.getImage=N,y.getJSON=function(o,u){return Lt(St(o,{type:"json"}),u)},y.getRTLTextPluginStatus=Nf,y.getReferrer=Re,y.getVideo=function(o,u){var c,m,b=H.document.createElement("video");b.muted=!0,b.onloadstart=function(){u(null,b)};for(var E=0;E<o.length;E++){var T=H.document.createElement("source");c=o[E],m=void 0,(m=H.document.createElement("a")).href=c,(m.protocol!==H.document.location.protocol||m.host!==H.document.location.host)&&(b.crossOrigin="Anonymous"),T.src=o[E],b.appendChild(T)}return{cancel:function(){}}},y.identity=ts,y.invert=function(o,u){var c=u[0],m=u[1],b=u[2],E=u[3],T=u[4],M=u[5],B=u[6],G=u[7],Q=u[8],ee=u[9],pe=u[10],_e=u[11],Ge=u[12],Ye=u[13],yt=u[14],ot=u[15],Dt=c*M-m*T,Ht=c*B-b*T,ir=c*G-E*T,ur=m*B-b*M,xr=m*G-E*M,Wr=b*G-E*B,on=Q*Ye-ee*Ge,Dn=Q*yt-pe*Ge,Sn=Q*ot-_e*Ge,Gn=ee*yt-pe*Ye,An=ee*ot-_e*Ye,wi=pe*ot-_e*yt,ai=Dt*wi-Ht*An+ir*Gn+ur*Sn-xr*Dn+Wr*on;return ai?(o[0]=(M*wi-B*An+G*Gn)*(ai=1/ai),o[1]=(b*An-m*wi-E*Gn)*ai,o[2]=(Ye*Wr-yt*xr+ot*ur)*ai,o[3]=(pe*xr-ee*Wr-_e*ur)*ai,o[4]=(B*Sn-T*wi-G*Dn)*ai,o[5]=(c*wi-b*Sn+E*Dn)*ai,o[6]=(yt*ir-Ge*Wr-ot*Ht)*ai,o[7]=(Q*Wr-pe*ir+_e*Ht)*ai,o[8]=(T*An-M*Sn+G*on)*ai,o[9]=(m*Sn-c*An-E*on)*ai,o[10]=(Ge*xr-Ye*ir+ot*Dt)*ai,o[11]=(ee*ir-Q*xr-_e*Dt)*ai,o[12]=(M*Dn-T*Gn-B*on)*ai,o[13]=(c*Gn-m*Dn+b*on)*ai,o[14]=(Ye*Ht-Ge*ur-yt*Dt)*ai,o[15]=(Q*ur-ee*Ht+pe*Dt)*ai,o):null},y.isChar=cn,y.isMapboxURL=jn,y.keysDifference=function(o,u){var c=[];for(var m in o)m in u||c.push(m);return c},y.makeRequest=Lt,y.mapObject=cr,y.mercatorXfromLng=lg,y.mercatorYfromLat=cg,y.mercatorZfromAltitude=Ui,y.mul=kc,y.multiply=co,y.mvt=oc,y.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},y.normalize=function(o,u){var c=u[0],m=u[1],b=u[2],E=c*c+m*m+b*b;return E>0&&(E=1/Math.sqrt(E)),o[0]=u[0]*E,o[1]=u[1]*E,o[2]=u[2]*E,o},y.number=ro,y.offscreenCanvasSupported=L,y.ortho=function(o,u,c,m,b,E,T){var M=1/(u-c),B=1/(m-b),G=1/(E-T);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*B,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*G,o[11]=0,o[12]=(u+c)*M,o[13]=(b+m)*B,o[14]=(T+E)*G,o[15]=1,o},y.parseGlyphPBF=function(o){return new rr(o).readFields(Cr,[])},y.pbf=rr,y.performSymbolLayout=function(o,u,c,m,b,E,T){o.createArrays(),o.tilePixelRatio=8192/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;var M=o.layers[0].layout,B=o.layers[0]._unevaluatedLayout._values,G={};if(o.textSizeData.kind==="composite"){var Q=o.textSizeData,ee=Q.maxZoom;G.compositeTextSizes=[B["text-size"].possiblyEvaluate(new Le(Q.minZoom),T),B["text-size"].possiblyEvaluate(new Le(ee),T)]}if(o.iconSizeData.kind==="composite"){var pe=o.iconSizeData,_e=pe.maxZoom;G.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new Le(pe.minZoom),T),B["icon-size"].possiblyEvaluate(new Le(_e),T)]}G.layoutTextSize=B["text-size"].possiblyEvaluate(new Le(o.zoom+1),T),G.layoutIconSize=B["icon-size"].possiblyEvaluate(new Le(o.zoom+1),T),G.textMaxSize=B["text-size"].possiblyEvaluate(new Le(18));for(var Ge=24*M.get("text-line-height"),Ye=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",yt=M.get("text-keep-upright"),ot=M.get("text-size"),Dt=function(){var ur=ir[Ht],xr=M.get("text-font").evaluate(ur,{},T).join(","),Wr=ot.evaluate(ur,{},T),on=G.layoutTextSize.evaluate(ur,{},T),Dn=G.layoutIconSize.evaluate(ur,{},T),Sn={horizontal:{},vertical:void 0},Gn=ur.text,An=[0,0];if(Gn){var wi=Gn.toString(),ai=24*M.get("text-letter-spacing").evaluate(ur,{},T),Ln=function(ji){for(var Ta=0,Ea=ji;Ta<Ea.length;Ta+=1)if(xi=Ea[Ta].charCodeAt(0),cn.Arabic(xi)||cn["Arabic Supplement"](xi)||cn["Arabic Extended-A"](xi)||cn["Arabic Presentation Forms-A"](xi)||cn["Arabic Presentation Forms-B"](xi))return!1;var xi;return!0}(wi)?ai:0,Fi=M.get("text-anchor").evaluate(ur,{},T),_i=M.get("text-variable-anchor");if(!_i){var Qi=M.get("text-radial-offset").evaluate(ur,{},T);An=Qi?At(Fi,[24*Qi,gt]):M.get("text-offset").evaluate(ur,{},T).map(function(ji){return 24*ji})}var Yn=Ye?"center":M.get("text-justify").evaluate(ur,{},T),ua=M.get("symbol-placement"),Za=ua==="point"?24*M.get("text-max-width").evaluate(ur,{},T):0,fo=function(){o.allowVerticalPlacement&&cl(wi)&&(Sn.vertical=Ai(Gn,u,c,b,xr,Za,Ge,Fi,"left",Ln,An,Fn.vertical,!0,ua,on,Wr))};if(!Ye&&_i){for(var oo=Yn==="auto"?_i.map(function(ji){return It(ji)}):[Yn],Va=!1,ja=0;ja<oo.length;ja++){var Go=oo[ja];if(!Sn.horizontal[Go])if(Va)Sn.horizontal[Go]=Sn.horizontal[0];else{var Xo=Ai(Gn,u,c,b,xr,Za,Ge,"center",Go,Ln,An,Fn.horizontal,!1,ua,on,Wr);Xo&&(Sn.horizontal[Go]=Xo,Va=Xo.positionedLines.length===1)}}fo()}else{Yn==="auto"&&(Yn=It(Fi));var Ps=Ai(Gn,u,c,b,xr,Za,Ge,Fi,Yn,Ln,An,Fn.horizontal,!1,ua,on,Wr);Ps&&(Sn.horizontal[Yn]=Ps),fo(),cl(wi)&&Ye&&yt&&(Sn.vertical=Ai(Gn,u,c,b,xr,Za,Ge,Fi,Yn,Ln,An,Fn.vertical,!1,ua,on,Wr))}}var zo=void 0,Gs=!1;if(ur.icon&&ur.icon.name){var go=m[ur.icon.name];go&&(zo=function(ji,Ta,Ea){var xi=Oa(Ea),K=Ta[0]-ji.displaySize[0]*xi.horizontalAlign,Os=Ta[1]-ji.displaySize[1]*xi.verticalAlign;return{image:ji,top:Os,bottom:Os+ji.displaySize[1],left:K,right:K+ji.displaySize[0]}}(b[ur.icon.name],M.get("icon-offset").evaluate(ur,{},T),M.get("icon-anchor").evaluate(ur,{},T)),Gs=go.sdf,o.sdfIcons===void 0?o.sdfIcons=go.sdf:o.sdfIcons!==go.sdf&&Ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(go.pixelRatio!==o.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}var ms=_t(Sn.horizontal)||Sn.vertical;o.iconsInText=!!ms&&ms.iconsInText,(ms||zo)&&function(ji,Ta,Ea,xi,K,Os,Ha,Zo,ks,$i,lc){var Ru=Os.textMaxSize.evaluate(Ta,{});Ru===void 0&&(Ru=Ha);var cc,ho=ji.layers[0].layout,fc=ho.get("icon-offset").evaluate(Ta,{},lc),Nl=_t(Ea.horizontal),Ap=Ha/24,mf=ji.tilePixelRatio*Ap,qf=ji.tilePixelRatio*Ru/24,hc=ji.tilePixelRatio*Zo,gf=ji.tilePixelRatio*ho.get("symbol-spacing"),Fh=ho.get("text-padding")*ji.tilePixelRatio,Kf=ho.get("icon-padding")*ji.tilePixelRatio,Nh=ho.get("text-max-angle")/180*Math.PI,Uh=ho.get("text-rotation-alignment")==="map"&&ho.get("symbol-placement")!=="point",Qf=ho.get("icon-rotation-alignment")==="map"&&ho.get("symbol-placement")!=="point",as=ho.get("symbol-placement"),zh=gf/2,Jf=ho.get("icon-text-fit");xi&&Jf!=="none"&&(ji.allowVerticalPlacement&&Ea.vertical&&(cc=xo(xi,Ea.vertical,Jf,ho.get("icon-text-fit-padding"),fc,Ap)),Nl&&(xi=xo(xi,Nl,Jf,ho.get("icon-text-fit-padding"),fc,Ap)));var Mu=function(vd,nh){nh.x<0||nh.x>=8192||nh.y<0||nh.y>=8192||function(wa,bl,$v,ih,dg,Qd,md,_f,gd,yd,Jd,ev,Yv,vg,Pp,qv,Kv,Qv,Jv,em,Iu,_d,tm,dc,mg){var rm,ah,Vh,jh,Hh,Wh=wa.addToLineVertexArray(bl,$v),nm=0,Ds=0,im=0,am=0,tv=-1,rv=-1,Hc={},om=He(""),nv=0,iv=0;if(_f._unevaluatedLayout.getValue("text-radial-offset")===void 0?(nv=(rm=_f.layout.get("text-offset").evaluate(Iu,{},dc).map(function(kp){return 24*kp}))[0],iv=rm[1]):(nv=24*_f.layout.get("text-radial-offset").evaluate(Iu,{},dc),iv=gt),wa.allowVerticalPlacement&&ih.vertical){var sm=_f.layout.get("text-rotate").evaluate(Iu,{},dc)+90;jh=new ga(gd,bl,yd,Jd,ev,ih.vertical,Yv,vg,Pp,sm),md&&(Hh=new ga(gd,bl,yd,Jd,ev,md,Kv,Qv,Pp,sm))}if(dg){var av=_f.layout.get("icon-rotate").evaluate(Iu,{}),um=_f.layout.get("icon-text-fit")!=="none",lm=Ke(dg,av,tm,um),ov=md?Ke(md,av,tm,um):void 0;Vh=new ga(gd,bl,yd,Jd,ev,dg,Kv,Qv,!1,av),nm=4*lm.length;var cm=wa.iconSizeData,Op=null;cm.kind==="source"?(Op=[128*_f.layout.get("icon-size").evaluate(Iu,{})])[0]>32640&&Ve(wa.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):cm.kind==="composite"&&((Op=[128*_d.compositeIconSizes[0].evaluate(Iu,{},dc),128*_d.compositeIconSizes[1].evaluate(Iu,{},dc)])[0]>32640||Op[1]>32640)&&Ve(wa.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),wa.addSymbols(wa.icon,lm,Op,em,Jv,Iu,!1,bl,Wh.lineStartIndex,Wh.lineLength,-1,dc),tv=wa.icon.placedSymbolArray.length-1,ov&&(Ds=4*ov.length,wa.addSymbols(wa.icon,ov,Op,em,Jv,Iu,Fn.vertical,bl,Wh.lineStartIndex,Wh.lineLength,-1,dc),rv=wa.icon.placedSymbolArray.length-1)}for(var fm in ih.horizontal){var sv=ih.horizontal[fm];if(!ah){om=He(sv.text);var D0=_f.layout.get("text-rotate").evaluate(Iu,{},dc);ah=new ga(gd,bl,yd,Jd,ev,sv,Yv,vg,Pp,D0)}var gg=sv.positionedLines.length===1;if(im+=Je(wa,bl,sv,Qd,_f,Pp,Iu,qv,Wh,ih.vertical?Fn.horizontal:Fn.horizontalOnly,gg?Object.keys(ih.horizontal):[fm],Hc,tv,_d,dc),gg)break}ih.vertical&&(am+=Je(wa,bl,ih.vertical,Qd,_f,Pp,Iu,qv,Wh,Fn.vertical,["vertical"],Hc,rv,_d,dc));var L0=ah?ah.boxStartIndex:wa.collisionBoxArray.length,yg=ah?ah.boxEndIndex:wa.collisionBoxArray.length,_g=jh?jh.boxStartIndex:wa.collisionBoxArray.length,hm=jh?jh.boxEndIndex:wa.collisionBoxArray.length,bg=Vh?Vh.boxStartIndex:wa.collisionBoxArray.length,xg=Vh?Vh.boxEndIndex:wa.collisionBoxArray.length,Eg=Hh?Hh.boxStartIndex:wa.collisionBoxArray.length,B0=Hh?Hh.boxEndIndex:wa.collisionBoxArray.length,vc=-1,uv=function(kp,Sg){return kp&&kp.circleDiameter?Math.max(kp.circleDiameter,Sg):Sg};vc=uv(ah,vc),vc=uv(jh,vc),vc=uv(Vh,vc);var pm=(vc=uv(Hh,vc))>-1?1:0;pm&&(vc*=mg/24),wa.glyphOffsetArray.length>=En.MAX_GLYPHS&&Ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Iu.sortKey!==void 0&&wa.addToSortKeyRanges(wa.symbolInstances.length,Iu.sortKey),wa.symbolInstances.emplaceBack(bl.x,bl.y,Hc.right>=0?Hc.right:-1,Hc.center>=0?Hc.center:-1,Hc.left>=0?Hc.left:-1,Hc.vertical||-1,tv,rv,om,L0,yg,_g,hm,bg,xg,Eg,B0,yd,im,am,nm,Ds,pm,0,Yv,nv,iv,vc)}(ji,nh,vd,Ea,xi,K,cc,ji.layers[0],ji.collisionBoxArray,Ta.index,Ta.sourceLayerIndex,ji.index,mf,Fh,Uh,ks,hc,Kf,Qf,fc,Ta,Os,$i,lc,Ha)};if(as==="line")for(var Tp=0,$d=yl(Ta.geometry,0,0,8192,8192);Tp<$d.length;Tp+=1)for(var Yd=$d[Tp],wp=0,Cp=So(Yd,gf,Nh,Ea.vertical||Nl,xi,24,qf,ji.overscaling,8192);wp<Cp.length;wp+=1){var eh=Cp[wp];Nl&&Be(ji,Nl.text,zh,eh)||Mu(Yd,eh)}else if(as==="line-center")for(var ld=0,cd=Ta.geometry;ld<cd.length;ld+=1){var fd=cd[ld];if(fd.length>1){var hd=Ki(fd,Nh,Ea.vertical||Nl,xi,24,qf);hd&&Mu(fd,hd)}}else if(Ta.type==="Polygon")for(var Rp=0,qd=mp(Ta.geometry,0);Rp<qd.length;Rp+=1){var Mp=qd[Rp],pc=nt(Mp,16);Mu(Mp[0],new Ja(pc.x,pc.y,0))}else if(Ta.type==="LineString")for(var yf=0,th=Ta.geometry;yf<th.length;yf+=1){var rh=th[yf];Mu(rh,new Ja(rh[0].x,rh[0].y,0))}else if(Ta.type==="Point")for(var Zh=0,Kd=Ta.geometry;Zh<Kd.length;Zh+=1)for(var pd=0,Ip=Kd[Zh];pd<Ip.length;pd+=1){var dd=Ip[pd];Mu([dd],new Ja(dd.x,dd.y,0))}}(o,ur,Sn,zo,m,G,on,Dn,An,Gs,T)},Ht=0,ir=o.features;Ht<ir.length;Ht+=1)Dt();E&&o.generateCollisionDebugBuffers()},y.perspective=function(o,u,c,m,b){var E,T=1/Math.tan(u/2);return o[0]=T/c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,b!=null&&b!==1/0?(o[10]=(b+m)*(E=1/(m-b)),o[14]=2*b*m*E):(o[10]=-1,o[14]=-2*m),o},y.pick=function(o,u){for(var c={},m=0;m<u.length;m++){var b=u[m];b in o&&(c[b]=o[b])}return c},y.plugin=Nt,y.polygonIntersectsPolygon=hl,y.postMapLoadEvent=Gt,y.postTurnstileEvent=po,y.potpack=li,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Mn,y.registerForPluginStateChange=function(o){return o({pluginStatus:_s,pluginURL:_u}),Ic.on("pluginStateChange",o),o},y.renderColorRamp=nc,y.rotate=function(o,u,c){var m=u[0],b=u[1],E=u[2],T=u[3],M=Math.sin(c),B=Math.cos(c);return o[0]=m*B+E*M,o[1]=b*B+T*M,o[2]=m*-M+E*B,o[3]=b*-M+T*B,o},y.rotateX=function(o,u,c){var m=Math.sin(c),b=Math.cos(c),E=u[4],T=u[5],M=u[6],B=u[7],G=u[8],Q=u[9],ee=u[10],pe=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=E*b+G*m,o[5]=T*b+Q*m,o[6]=M*b+ee*m,o[7]=B*b+pe*m,o[8]=G*b-E*m,o[9]=Q*b-T*m,o[10]=ee*b-M*m,o[11]=pe*b-B*m,o},y.rotateZ=function(o,u,c){var m=Math.sin(c),b=Math.cos(c),E=u[0],T=u[1],M=u[2],B=u[3],G=u[4],Q=u[5],ee=u[6],pe=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=E*b+G*m,o[1]=T*b+Q*m,o[2]=M*b+ee*m,o[3]=B*b+pe*m,o[4]=G*b-E*m,o[5]=Q*b-T*m,o[6]=ee*b-M*m,o[7]=pe*b-B*m,o},y.scale=function(o,u,c){var m=c[0],b=c[1],E=c[2];return o[0]=u[0]*m,o[1]=u[1]*m,o[2]=u[2]*m,o[3]=u[3]*m,o[4]=u[4]*b,o[5]=u[5]*b,o[6]=u[6]*b,o[7]=u[7]*b,o[8]=u[8]*E,o[9]=u[9]*E,o[10]=u[10]*E,o[11]=u[11]*E,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},y.scale$1=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o[3]=u[3]*c,o},y.scale$2=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o},y.setCacheLimits=function(o,u){br=o,Gr=u},y.setRTLTextPlugin=function(o,u,c){if(c===void 0&&(c=!1),_s==="deferred"||_s==="loading"||_s==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");_u=Vr.resolveURL(o),_s="deferred",Ff=u,Mc(),c||Js()},y.sphericalToCartesian=function(o){var u=o[0],c=o[1],m=o[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:u*Math.cos(c)*Math.sin(m),y:u*Math.sin(c)*Math.sin(m),z:u*Math.cos(m)}},y.sqrLen=function(o){var u=o[0],c=o[1];return u*u+c*c},y.styleSpec=W,y.sub=function(o,u,c){return o[0]=u[0]-c[0],o[1]=u[1]-c[1],o[2]=u[2]-c[2],o},y.symbolSize=Si,y.transformMat3=function(o,u,c){var m=u[0],b=u[1],E=u[2];return o[0]=m*c[0]+b*c[3]+E*c[6],o[1]=m*c[1]+b*c[4]+E*c[7],o[2]=m*c[2]+b*c[5]+E*c[8],o},y.transformMat4=$u,y.translate=function(o,u,c){var m,b,E,T,M,B,G,Q,ee,pe,_e,Ge,Ye=c[0],yt=c[1],ot=c[2];return u===o?(o[12]=u[0]*Ye+u[4]*yt+u[8]*ot+u[12],o[13]=u[1]*Ye+u[5]*yt+u[9]*ot+u[13],o[14]=u[2]*Ye+u[6]*yt+u[10]*ot+u[14],o[15]=u[3]*Ye+u[7]*yt+u[11]*ot+u[15]):(b=u[1],E=u[2],T=u[3],M=u[4],B=u[5],G=u[6],Q=u[7],ee=u[8],pe=u[9],_e=u[10],Ge=u[11],o[0]=m=u[0],o[1]=b,o[2]=E,o[3]=T,o[4]=M,o[5]=B,o[6]=G,o[7]=Q,o[8]=ee,o[9]=pe,o[10]=_e,o[11]=Ge,o[12]=m*Ye+M*yt+ee*ot+u[12],o[13]=b*Ye+B*yt+pe*ot+u[13],o[14]=E*Ye+G*yt+_e*ot+u[14],o[15]=T*Ye+Q*yt+Ge*ot+u[15]),o},y.triggerPluginCompletionEvent=hp,y.uniqueId=Ze,y.validateCustomStyleLayer=function(o){var u=[],c=o.id;return c===void 0&&u.push({message:"layers."+c+': missing required property "id"'}),o.render===void 0&&u.push({message:"layers."+c+': missing required method "render"'}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&u.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),u},y.validateLight=fp,y.validateStyle=Qs,y.values=function(o){var u=[];for(var c in o)u.push(o[c]);return u},y.vectorTile=oc,y.version="1.13.3",y.warnOnce=Ve,y.webpSupported=Ir,y.window=H,y.wrap=ye}),de(["./shared"],function(y){"use strict";function le(U){var N=typeof U;if(N==="number"||N==="boolean"||N==="string"||U==null)return JSON.stringify(U);if(Array.isArray(U)){for(var q="[",se=0,Me=U;se<Me.length;se+=1)q+=le(Me[se])+",";return q+"]"}for(var We=Object.keys(U).sort(),ut="{",W=0;W<We.length;W++)ut+=JSON.stringify(We[W])+":"+le(U[We[W]])+",";return ut+"}"}function P(U){for(var N="",q=0,se=y.refProperties;q<se.length;q+=1)N+="/"+le(U[se[q]]);return N}var Y=function(U){this.keyCache={},U&&this.replace(U)};Y.prototype.replace=function(U){this._layerConfigs={},this._layers={},this.update(U,[])},Y.prototype.update=function(U,N){for(var q=this,se=0,Me=U;se<Me.length;se+=1){var We=Me[se];this._layerConfigs[We.id]=We;var ut=this._layers[We.id]=y.createStyleLayer(We);ut._featureFilter=y.featureFilter(ut.filter),this.keyCache[We.id]&&delete this.keyCache[We.id]}for(var W=0,ne=N;W<ne.length;W+=1){var je=ne[W];delete this.keyCache[je],delete this._layerConfigs[je],delete this._layers[je]}this.familiesBySource={};for(var lt=0,Ie=function(Hr,$r){for(var oi={},pn=0;pn<Hr.length;pn++){var mi=$r&&$r[Hr[pn].id]||P(Hr[pn]);$r&&($r[Hr[pn].id]=mi);var Gi=oi[mi];Gi||(Gi=oi[mi]=[]),Gi.push(Hr[pn])}var di=[];for(var zi in oi)di.push(oi[zi]);return di}(y.values(this._layerConfigs),this.keyCache);lt<Ie.length;lt+=1){var Kt=Ie[lt].map(function(Hr){return q._layers[Hr.id]}),Er=Kt[0];if(Er.visibility!=="none"){var sn=Er.source||"",un=this.familiesBySource[sn];un||(un=this.familiesBySource[sn]={});var nr=Er.sourceLayer||"_geojsonTileLayer",Qr=un[nr];Qr||(Qr=un[nr]=[]),Qr.push(Kt)}}};var V=function(U){var N={},q=[];for(var se in U){var Me=U[se],We=N[se]={};for(var ut in Me){var W=Me[+ut];if(W&&W.bitmap.width!==0&&W.bitmap.height!==0){var ne={x:0,y:0,w:W.bitmap.width+2,h:W.bitmap.height+2};q.push(ne),We[ut]={rect:ne,metrics:W.metrics}}}}var je=y.potpack(q),lt=new y.AlphaImage({width:je.w||1,height:je.h||1});for(var Ie in U){var Kt=U[Ie];for(var Er in Kt){var sn=Kt[+Er];if(sn&&sn.bitmap.width!==0&&sn.bitmap.height!==0){var un=N[Ie][Er].rect;y.AlphaImage.copy(sn.bitmap,lt,{x:0,y:0},{x:un.x+1,y:un.y+1},sn.bitmap)}}}this.image=lt,this.positions=N};y.register("GlyphAtlas",V);var ue=function(U){this.tileID=new y.OverscaledTileID(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId};function H(U,N,q){for(var se=new y.EvaluationParameters(N),Me=0,We=U;Me<We.length;Me+=1)We[Me].recalculate(se,q)}function Ae(U,N){var q=y.getArrayBuffer(U.request,function(se,Me,We,ut){se?N(se):Me&&N(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Me)),rawData:Me,cacheControl:We,expires:ut})});return function(){q.cancel(),N()}}ue.prototype.parse=function(U,N,q,se,Me){var We=this;this.status="parsing",this.data=U,this.collisionBoxArray=new y.CollisionBoxArray;var ut=new y.DictionaryCoder(Object.keys(U.layers).sort()),W=new y.FeatureIndex(this.tileID,this.promoteId);W.bucketLayerIDs=[];var ne,je,lt,Ie,Kt={},Er={featureIndex:W,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},sn=N.familiesBySource[this.source];for(var un in sn){var nr=U.layers[un];if(nr){nr.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Qr=ut.encode(un),Hr=[],$r=0;$r<nr.length;$r++){var oi=nr.feature($r),pn=W.getId(oi,un);Hr.push({feature:oi,id:pn,index:$r,sourceLayerIndex:Qr})}for(var mi=0,Gi=sn[un];mi<Gi.length;mi+=1){var di=Gi[mi],zi=di[0];zi.minzoom&&this.zoom<Math.floor(zi.minzoom)||zi.maxzoom&&this.zoom>=zi.maxzoom||zi.visibility!=="none"&&(H(di,this.zoom,q),(Kt[zi.id]=zi.createBucket({index:W.bucketLayerIDs.length,layers:di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qr,sourceID:this.source})).populate(Hr,Er,this.tileID.canonical),W.bucketLayerIDs.push(di.map(function(Mi){return Mi.id})))}}}var Ri=y.mapObject(Er.glyphDependencies,function(Mi){return Object.keys(Mi).map(Number)});Object.keys(Ri).length?se.send("getGlyphs",{uid:this.uid,stacks:Ri},function(Mi,yi){ne||(ne=Mi,je=yi,La.call(We))}):je={};var ss=Object.keys(Er.iconDependencies);ss.length?se.send("getImages",{icons:ss,source:this.source,tileID:this.tileID,type:"icons"},function(Mi,yi){ne||(ne=Mi,lt=yi,La.call(We))}):lt={};var oa=Object.keys(Er.patternDependencies);function La(){if(ne)return Me(ne);if(je&&lt&&Ie){var Mi=new V(je),yi=new y.ImageAtlas(lt,Ie);for(var Ii in Kt){var Ba=Kt[Ii];Ba instanceof y.SymbolBucket?(H(Ba.layers,this.zoom,q),y.performSymbolLayout(Ba,je,Mi.positions,lt,yi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ba.hasPattern&&(Ba instanceof y.LineBucket||Ba instanceof y.FillBucket||Ba instanceof y.FillExtrusionBucket)&&(H(Ba.layers,this.zoom,q),Ba.addFeatures(Er,this.tileID.canonical,yi.patternPositions))}this.status="done",Me(null,{buckets:y.values(Kt).filter(function(vu){return!vu.isEmpty()}),featureIndex:W,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mi.image,imageAtlas:yi,glyphMap:this.returnDependencies?je:null,iconMap:this.returnDependencies?lt:null,glyphPositions:this.returnDependencies?Mi.positions:null})}}oa.length?se.send("getImages",{icons:oa,source:this.source,tileID:this.tileID,type:"patterns"},function(Mi,yi){ne||(ne=Mi,Ie=yi,La.call(We))}):Ie={},La.call(this)};var Ce=function(U,N,q,se){this.actor=U,this.layerIndex=N,this.availableImages=q,this.loadVectorData=se||Ae,this.loading={},this.loaded={}};Ce.prototype.loadTile=function(U,N){var q=this,se=U.uid;this.loading||(this.loading={});var Me=!!(U&&U.request&&U.request.collectResourceTiming)&&new y.RequestPerformance(U.request),We=this.loading[se]=new ue(U);We.abort=this.loadVectorData(U,function(ut,W){if(delete q.loading[se],ut||!W)return We.status="done",q.loaded[se]=We,N(ut);var ne=W.rawData,je={};W.expires&&(je.expires=W.expires),W.cacheControl&&(je.cacheControl=W.cacheControl);var lt={};if(Me){var Ie=Me.finish();Ie&&(lt.resourceTiming=JSON.parse(JSON.stringify(Ie)))}We.vectorTile=W.vectorTile,We.parse(W.vectorTile,q.layerIndex,q.availableImages,q.actor,function(Kt,Er){if(Kt||!Er)return N(Kt);N(null,y.extend({rawTileData:ne.slice(0)},Er,je,lt))}),q.loaded=q.loaded||{},q.loaded[se]=We})},Ce.prototype.reloadTile=function(U,N){var q=this,se=this.loaded,Me=U.uid,We=this;if(se&&se[Me]){var ut=se[Me];ut.showCollisionBoxes=U.showCollisionBoxes;var W=function(ne,je){var lt=ut.reloadCallback;lt&&(delete ut.reloadCallback,ut.parse(ut.vectorTile,We.layerIndex,q.availableImages,We.actor,lt)),N(ne,je)};ut.status==="parsing"?ut.reloadCallback=W:ut.status==="done"&&(ut.vectorTile?ut.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor,W):W())}},Ce.prototype.abortTile=function(U,N){var q=this.loading,se=U.uid;q&&q[se]&&q[se].abort&&(q[se].abort(),delete q[se]),N()},Ce.prototype.removeTile=function(U,N){var q=this.loaded,se=U.uid;q&&q[se]&&delete q[se],N()};var ge=y.window.ImageBitmap,ct=function(){this.loaded={}};function ye(U,N){if(U.length!==0){St(U[0],N);for(var q=1;q<U.length;q++)St(U[q],!N)}}function St(U,N){for(var q=0,se=0,Me=0,We=U.length,ut=We-1;Me<We;ut=Me++){var W=(U[Me][0]-U[ut][0])*(U[ut][1]+U[Me][1]),ne=q+W;se+=Math.abs(q)>=Math.abs(W)?q-ne+W:W-ne+q,q=ne}q+se>=0!=!!N&&U.reverse()}ct.prototype.loadTile=function(U,N){var q=U.uid,se=U.encoding,Me=U.rawImageData,We=ge&&Me instanceof ge?this.getImageData(Me):Me,ut=new y.DEMData(q,We,se);this.loaded=this.loaded||{},this.loaded[q]=ut,N(null,ut)},ct.prototype.getImageData=function(U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);var N=this.offscreenCanvasContext.getImageData(-1,-1,U.width+2,U.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:N.width,height:N.height},N.data)},ct.prototype.removeTile=function(U){var N=this.loaded,q=U.uid;N&&N[q]&&delete N[q]};var mt=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ze=function(U){this._feature=U,this.extent=y.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))};Ze.prototype.loadGeometry=function(){if(this._feature.type===1){for(var U=[],N=0,q=this._feature.geometry;N<q.length;N+=1){var se=q[N];U.push([new y.Point$1(se[0],se[1])])}return U}for(var Me=[],We=0,ut=this._feature.geometry;We<ut.length;We+=1){for(var W=[],ne=0,je=ut[We];ne<je.length;ne+=1){var lt=je[ne];W.push(new y.Point$1(lt[0],lt[1]))}Me.push(W)}return Me},Ze.prototype.toGeoJSON=function(U,N,q){return mt.call(this,U,N,q)};var ht=function(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=U.length,this._features=U};ht.prototype.feature=function(U){return new Ze(this._features[U])};var it=y.vectorTile.VectorTileFeature,dr=yr;function yr(U,N){this.options=N||{},this.features=U,this.length=U.length}function cr(U,N){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=N||4096}yr.prototype.feature=function(U){return new cr(this.features[U],this.options.extent)},cr.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var N=0;N<U.length;N++){for(var q=U[N],se=[],Me=0;Me<q.length;Me++)se.push(new y.Point$1(q[Me][0],q[Me][1]));this.geometry.push(se)}return this.geometry},cr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,N=1/0,q=-1/0,se=1/0,Me=-1/0,We=0;We<U.length;We++)for(var ut=U[We],W=0;W<ut.length;W++){var ne=ut[W];N=Math.min(N,ne.x),q=Math.max(q,ne.x),se=Math.min(se,ne.y),Me=Math.max(Me,ne.y)}return[N,se,q,Me]},cr.prototype.toGeoJSON=it.prototype.toGeoJSON;var ft=Rt,Pe=dr;function Rt(U){var N=new y.pbf;return function(q,se){for(var Me in q.layers)se.writeMessage(3,Ve,q.layers[Me])}(U,N),N.finish()}function Ve(U,N){var q;N.writeVarintField(15,U.version||1),N.writeStringField(1,U.name||""),N.writeVarintField(5,U.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<U.length;q++)se.feature=U.feature(q),N.writeMessage(2,Vt,se);var Me=se.keys;for(q=0;q<Me.length;q++)N.writeStringField(3,Me[q]);var We=se.values;for(q=0;q<We.length;q++)N.writeMessage(4,ke,We[q])}function Vt(U,N){var q=U.feature;q.id!==void 0&&N.writeVarintField(1,q.id),N.writeMessage(2,mr,U),N.writeVarintField(3,q.type),N.writeMessage(4,re,q)}function mr(U,N){var q=U.feature,se=U.keys,Me=U.values,We=U.keycache,ut=U.valuecache;for(var W in q.properties){var ne=We[W];ne===void 0&&(se.push(W),We[W]=ne=se.length-1),N.writeVarint(ne);var je=q.properties[W],lt=typeof je;lt!=="string"&&lt!=="boolean"&&lt!=="number"&&(je=JSON.stringify(je));var Ie=lt+":"+je,Kt=ut[Ie];Kt===void 0&&(Me.push(je),ut[Ie]=Kt=Me.length-1),N.writeVarint(Kt)}}function ie(U,N){return(N<<3)+(7&U)}function j(U){return U<<1^U>>31}function re(U,N){for(var q=U.loadGeometry(),se=U.type,Me=0,We=0,ut=q.length,W=0;W<ut;W++){var ne=q[W],je=1;se===1&&(je=ne.length),N.writeVarint(ie(1,je));for(var lt=se===3?ne.length-1:ne.length,Ie=0;Ie<lt;Ie++){Ie===1&&se!==1&&N.writeVarint(ie(2,lt-1));var Kt=ne[Ie].x-Me,Er=ne[Ie].y-We;N.writeVarint(j(Kt)),N.writeVarint(j(Er)),Me+=Kt,We+=Er}se===3&&N.writeVarint(ie(7,1))}}function ke(U,N){var q=typeof U;q==="string"?N.writeStringField(1,U):q==="boolean"?N.writeBooleanField(7,U):q==="number"&&(U%1!=0?N.writeDoubleField(3,U):U<0?N.writeSVarintField(6,U):N.writeVarintField(5,U))}function Te(U,N,q,se){st(U,q,se),st(N,2*q,2*se),st(N,2*q+1,2*se+1)}function st(U,N,q){var se=U[N];U[N]=U[q],U[q]=se}function ze(U,N,q,se){var Me=U-q,We=N-se;return Me*Me+We*We}ft.fromVectorTileJs=Rt,ft.fromGeojsonVt=function(U,N){N=N||{};var q={};for(var se in U)q[se]=new dr(U[se].features,N),q[se].name=se,q[se].version=N.version,q[se].extent=N.extent;return Rt({layers:q})},ft.GeoJSONWrapper=Pe;var Qe=function(U){return U[0]},at=function(U){return U[1]},Mt=function(U,N,q,se,Me){N===void 0&&(N=Qe),q===void 0&&(q=at),se===void 0&&(se=64),Me===void 0&&(Me=Float64Array),this.nodeSize=se,this.points=U;for(var We=U.length<65536?Uint16Array:Uint32Array,ut=this.ids=new We(U.length),W=this.coords=new Me(2*U.length),ne=0;ne<U.length;ne++)ut[ne]=ne,W[2*ne]=N(U[ne]),W[2*ne+1]=q(U[ne]);(function je(lt,Ie,Kt,Er,sn,un){if(!(sn-Er<=Kt)){var nr=Er+sn>>1;(function Qr(Hr,$r,oi,pn,mi,Gi){for(;mi>pn;){if(mi-pn>600){var di=mi-pn+1,zi=oi-pn+1,Ri=Math.log(di),ss=.5*Math.exp(2*Ri/3),oa=.5*Math.sqrt(Ri*ss*(di-ss)/di)*(zi-di/2<0?-1:1);Qr(Hr,$r,oi,Math.max(pn,Math.floor(oi-zi*ss/di+oa)),Math.min(mi,Math.floor(oi+(di-zi)*ss/di+oa)),Gi)}var La=$r[2*oi+Gi],Mi=pn,yi=mi;for(Te(Hr,$r,pn,oi),$r[2*mi+Gi]>La&&Te(Hr,$r,pn,mi);Mi<yi;){for(Te(Hr,$r,Mi,yi),Mi++,yi--;$r[2*Mi+Gi]<La;)Mi++;for(;$r[2*yi+Gi]>La;)yi--}$r[2*pn+Gi]===La?Te(Hr,$r,pn,yi):Te(Hr,$r,++yi,mi),yi<=oi&&(pn=yi+1),oi<=yi&&(mi=yi-1)}})(lt,Ie,nr,Er,sn,un%2),je(lt,Ie,Kt,Er,nr-1,un+1),je(lt,Ie,Kt,nr+1,sn,un+1)}})(ut,W,se,0,ut.length-1,0)};Mt.prototype.range=function(U,N,q,se){return function(Me,We,ut,W,ne,je,lt){for(var Ie,Kt,Er=[0,Me.length-1,0],sn=[];Er.length;){var un=Er.pop(),nr=Er.pop(),Qr=Er.pop();if(nr-Qr<=lt)for(var Hr=Qr;Hr<=nr;Hr++)Kt=We[2*Hr+1],(Ie=We[2*Hr])>=ut&&Ie<=ne&&Kt>=W&&Kt<=je&&sn.push(Me[Hr]);else{var $r=Math.floor((Qr+nr)/2);Kt=We[2*$r+1],(Ie=We[2*$r])>=ut&&Ie<=ne&&Kt>=W&&Kt<=je&&sn.push(Me[$r]);var oi=(un+1)%2;(un===0?ut<=Ie:W<=Kt)&&(Er.push(Qr),Er.push($r-1),Er.push(oi)),(un===0?ne>=Ie:je>=Kt)&&(Er.push($r+1),Er.push(nr),Er.push(oi))}}return sn}(this.ids,this.coords,U,N,q,se,this.nodeSize)},Mt.prototype.within=function(U,N,q){return function(se,Me,We,ut,W,ne){for(var je=[0,se.length-1,0],lt=[],Ie=W*W;je.length;){var Kt=je.pop(),Er=je.pop(),sn=je.pop();if(Er-sn<=ne)for(var un=sn;un<=Er;un++)ze(Me[2*un],Me[2*un+1],We,ut)<=Ie&&lt.push(se[un]);else{var nr=Math.floor((sn+Er)/2),Qr=Me[2*nr],Hr=Me[2*nr+1];ze(Qr,Hr,We,ut)<=Ie&&lt.push(se[nr]);var $r=(Kt+1)%2;(Kt===0?We-W<=Qr:ut-W<=Hr)&&(je.push(sn),je.push(nr-1),je.push($r)),(Kt===0?We+W>=Qr:ut+W>=Hr)&&(je.push(nr+1),je.push(Er),je.push($r))}}return lt}(this.ids,this.coords,U,N,q,this.nodeSize)};var vr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(U){return U}},kt=function(U){this.options=hi(Object.create(vr),U),this.trees=new Array(this.options.maxZoom+1)};function Vr(U,N,q,se,Me){return{x:U,y:N,zoom:1/0,id:q,parentId:-1,numPoints:se,properties:Me}}function Kr(U,N){var q=U.geometry.coordinates,se=q[1];return{x:gn(q[0]),y:nn(se),zoom:1/0,index:N,parentId:-1}}function Ir(U){return{type:"Feature",id:U.id,properties:In(U),geometry:{type:"Point",coordinates:[(se=U.x,360*(se-.5)),(N=U.y,q=(180-360*N)*Math.PI/180,360*Math.atan(Math.exp(q))/Math.PI-90)]}};var N,q,se}function In(U){var N=U.numPoints,q=N>=1e4?Math.round(N/1e3)+"k":N>=1e3?Math.round(N/100)/10+"k":N;return hi(hi({},U.properties),{cluster:!0,cluster_id:U.id,point_count:N,point_count_abbreviated:q})}function gn(U){return U/360+.5}function nn(U){var N=Math.sin(U*Math.PI/180),q=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return q<0?0:q>1?1:q}function hi(U,N){for(var q in N)U[q]=N[q];return U}function Lr(U){return U.x}function jn(U){return U.y}function jr(U,N,q,se,Me,We){var ut=Me-q,W=We-se;if(ut!==0||W!==0){var ne=((U-q)*ut+(N-se)*W)/(ut*ut+W*W);ne>1?(q=Me,se=We):ne>0&&(q+=ut*ne,se+=W*ne)}return(ut=U-q)*ut+(W=N-se)*W}function hn(U,N,q,se){var Me={id:U===void 0?null:U,type:N,geometry:q,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(We){var ut=We.geometry,W=We.type;if(W==="Point"||W==="MultiPoint"||W==="LineString")qi(We,ut);else if(W==="Polygon"||W==="MultiLineString")for(var ne=0;ne<ut.length;ne++)qi(We,ut[ne]);else if(W==="MultiPolygon")for(ne=0;ne<ut.length;ne++)for(var je=0;je<ut[ne].length;je++)qi(We,ut[ne][je])}(Me),Me}function qi(U,N){for(var q=0;q<N.length;q+=3)U.minX=Math.min(U.minX,N[q]),U.minY=Math.min(U.minY,N[q+1]),U.maxX=Math.max(U.maxX,N[q]),U.maxY=Math.max(U.maxY,N[q+1])}function Ei(U,N,q,se){if(N.geometry){var Me=N.geometry.coordinates,We=N.geometry.type,ut=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),W=[],ne=N.id;if(q.promoteId?ne=N.properties[q.promoteId]:q.generateId&&(ne=se||0),We==="Point")ia(Me,W);else if(We==="MultiPoint")for(var je=0;je<Me.length;je++)ia(Me[je],W);else if(We==="LineString")ta(Me,W,ut,!1);else if(We==="MultiLineString"){if(q.lineMetrics){for(je=0;je<Me.length;je++)ta(Me[je],W=[],ut,!1),U.push(hn(ne,"LineString",W,N.properties));return}Se(Me,W,ut,!1)}else if(We==="Polygon")Se(Me,W,ut,!0);else{if(We!=="MultiPolygon"){if(We==="GeometryCollection"){for(je=0;je<N.geometry.geometries.length;je++)Ei(U,{id:ne,geometry:N.geometry.geometries[je],properties:N.properties},q,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(je=0;je<Me.length;je++){var lt=[];Se(Me[je],lt,ut,!0),W.push(lt)}}U.push(hn(ne,We,W,N.properties))}}function ia(U,N){N.push(Ni(U[0])),N.push(aa(U[1])),N.push(0)}function ta(U,N,q,se){for(var Me,We,ut=0,W=0;W<U.length;W++){var ne=Ni(U[W][0]),je=aa(U[W][1]);N.push(ne),N.push(je),N.push(0),W>0&&(ut+=se?(Me*je-ne*We)/2:Math.sqrt(Math.pow(ne-Me,2)+Math.pow(je-We,2))),Me=ne,We=je}var lt=N.length-3;N[2]=1,function Ie(Kt,Er,sn,un){for(var nr,Qr=un,Hr=sn-Er>>1,$r=sn-Er,oi=Kt[Er],pn=Kt[Er+1],mi=Kt[sn],Gi=Kt[sn+1],di=Er+3;di<sn;di+=3){var zi=jr(Kt[di],Kt[di+1],oi,pn,mi,Gi);if(zi>Qr)nr=di,Qr=zi;else if(zi===Qr){var Ri=Math.abs(di-Hr);Ri<$r&&(nr=di,$r=Ri)}}Qr>un&&(nr-Er>3&&Ie(Kt,Er,nr,un),Kt[nr+2]=Qr,sn-nr>3&&Ie(Kt,nr,sn,un))}(N,0,lt,q),N[lt+2]=1,N.size=Math.abs(ut),N.start=0,N.end=N.size}function Se(U,N,q,se){for(var Me=0;Me<U.length;Me++){var We=[];ta(U[Me],We,q,se),N.push(We)}}function Ni(U){return U/360+.5}function aa(U){var N=Math.sin(U*Math.PI/180),q=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return q<0?0:q>1?1:q}function da(U,N,q,se,Me,We,ut,W){if(se/=N,We>=(q/=N)&&ut<se)return U;if(ut<q||We>=se)return null;for(var ne=[],je=0;je<U.length;je++){var lt=U[je],Ie=lt.geometry,Kt=lt.type,Er=Me===0?lt.minX:lt.minY,sn=Me===0?lt.maxX:lt.maxY;if(Er>=q&&sn<se)ne.push(lt);else if(!(sn<q||Er>=se)){var un=[];if(Kt==="Point"||Kt==="MultiPoint")so(Ie,un,q,se,Me);else if(Kt==="LineString")po(Ie,un,q,se,Me,!1,W.lineMetrics);else if(Kt==="MultiLineString")Gt(Ie,un,q,se,Me,!1);else if(Kt==="Polygon")Gt(Ie,un,q,se,Me,!0);else if(Kt==="MultiPolygon")for(var nr=0;nr<Ie.length;nr++){var Qr=[];Gt(Ie[nr],Qr,q,se,Me,!0),Qr.length&&un.push(Qr)}if(un.length){if(W.lineMetrics&&Kt==="LineString"){for(nr=0;nr<un.length;nr++)ne.push(hn(lt.id,Kt,un[nr],lt.tags));continue}Kt!=="LineString"&&Kt!=="MultiLineString"||(un.length===1?(Kt="LineString",un=un[0]):Kt="MultiLineString"),Kt!=="Point"&&Kt!=="MultiPoint"||(Kt=un.length===3?"Point":"MultiPoint"),ne.push(hn(lt.id,Kt,un,lt.tags))}}}return ne.length?ne:null}function so(U,N,q,se,Me){for(var We=0;We<U.length;We+=3){var ut=U[We+Me];ut>=q&&ut<=se&&(N.push(U[We]),N.push(U[We+1]),N.push(U[We+2]))}}function po(U,N,q,se,Me,We,ut){for(var W,ne,je=To(U),lt=Me===0?Gr:rn,Ie=U.start,Kt=0;Kt<U.length-3;Kt+=3){var Er=U[Kt],sn=U[Kt+1],un=U[Kt+2],nr=U[Kt+3],Qr=U[Kt+4],Hr=Me===0?Er:sn,$r=Me===0?nr:Qr,oi=!1;ut&&(W=Math.sqrt(Math.pow(Er-nr,2)+Math.pow(sn-Qr,2))),Hr<q?$r>q&&(ne=lt(je,Er,sn,nr,Qr,q),ut&&(je.start=Ie+W*ne)):Hr>se?$r<se&&(ne=lt(je,Er,sn,nr,Qr,se),ut&&(je.start=Ie+W*ne)):br(je,Er,sn,un),$r<q&&Hr>=q&&(ne=lt(je,Er,sn,nr,Qr,q),oi=!0),$r>se&&Hr<=se&&(ne=lt(je,Er,sn,nr,Qr,se),oi=!0),!We&&oi&&(ut&&(je.end=Ie+W*ne),N.push(je),je=To(U)),ut&&(Ie+=W)}var pn=U.length-3;Er=U[pn],sn=U[pn+1],un=U[pn+2],(Hr=Me===0?Er:sn)>=q&&Hr<=se&&br(je,Er,sn,un),pn=je.length-3,We&&pn>=3&&(je[pn]!==je[0]||je[pn+1]!==je[1])&&br(je,je[0],je[1],je[2]),je.length&&N.push(je)}function To(U){var N=[];return N.size=U.size,N.start=U.start,N.end=U.end,N}function Gt(U,N,q,se,Me,We){for(var ut=0;ut<U.length;ut++)po(U[ut],N,q,se,Me,We,!1)}function br(U,N,q,se){U.push(N),U.push(q),U.push(se)}function Gr(U,N,q,se,Me,We){var ut=(We-N)/(se-N);return U.push(We),U.push(q+(Me-q)*ut),U.push(1),ut}function rn(U,N,q,se,Me,We){var ut=(We-q)/(Me-q);return U.push(N+(se-N)*ut),U.push(We),U.push(1),ut}function yn(U,N){for(var q=[],se=0;se<U.length;se++){var Me,We=U[se],ut=We.type;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")Me=Ci(We.geometry,N);else if(ut==="MultiLineString"||ut==="Polygon"){Me=[];for(var W=0;W<We.geometry.length;W++)Me.push(Ci(We.geometry[W],N))}else if(ut==="MultiPolygon")for(Me=[],W=0;W<We.geometry.length;W++){for(var ne=[],je=0;je<We.geometry[W].length;je++)ne.push(Ci(We.geometry[W][je],N));Me.push(ne)}q.push(hn(We.id,ut,Me,We.tags))}return q}function Ci(U,N){var q=[];q.size=U.size,U.start!==void 0&&(q.start=U.start,q.end=U.end);for(var se=0;se<U.length;se+=3)q.push(U[se]+N,U[se+1],U[se+2]);return q}function he(U,N){if(U.transformed)return U;var q,se,Me,We=1<<U.z,ut=U.x,W=U.y;for(q=0;q<U.features.length;q++){var ne=U.features[q],je=ne.geometry,lt=ne.type;if(ne.geometry=[],lt===1)for(se=0;se<je.length;se+=2)ne.geometry.push(L(je[se],je[se+1],N,We,ut,W));else for(se=0;se<je.length;se++){var Ie=[];for(Me=0;Me<je[se].length;Me+=2)Ie.push(L(je[se][Me],je[se][Me+1],N,We,ut,W));ne.geometry.push(Ie)}}return U.transformed=!0,U}function L(U,N,q,se,Me,We){return[Math.round(q*(U*se-Me)),Math.round(q*(N*se-We))]}function z(U,N,q,se,Me){for(var We=N===Me.maxZoom?0:Me.tolerance/((1<<N)*Me.extent),ut={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:se,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},W=0;W<U.length;W++){ut.numFeatures++,fe(ut,U[W],We,Me);var ne=U[W].minX,je=U[W].minY,lt=U[W].maxX,Ie=U[W].maxY;ne<ut.minX&&(ut.minX=ne),je<ut.minY&&(ut.minY=je),lt>ut.maxX&&(ut.maxX=lt),Ie>ut.maxY&&(ut.maxY=Ie)}return ut}function fe(U,N,q,se){var Me=N.geometry,We=N.type,ut=[];if(We==="Point"||We==="MultiPoint")for(var W=0;W<Me.length;W+=3)ut.push(Me[W]),ut.push(Me[W+1]),U.numPoints++,U.numSimplified++;else if(We==="LineString")Re(ut,Me,U,q,!1,!1);else if(We==="MultiLineString"||We==="Polygon")for(W=0;W<Me.length;W++)Re(ut,Me[W],U,q,We==="Polygon",W===0);else if(We==="MultiPolygon")for(var ne=0;ne<Me.length;ne++){var je=Me[ne];for(W=0;W<je.length;W++)Re(ut,je[W],U,q,!0,W===0)}if(ut.length){var lt=N.tags||null;if(We==="LineString"&&se.lineMetrics){for(var Ie in lt={},N.tags)lt[Ie]=N.tags[Ie];lt.mapbox_clip_start=Me.start/Me.size,lt.mapbox_clip_end=Me.end/Me.size}var Kt={geometry:ut,type:We==="Polygon"||We==="MultiPolygon"?3:We==="LineString"||We==="MultiLineString"?2:1,tags:lt};N.id!==null&&(Kt.id=N.id),U.features.push(Kt)}}function Re(U,N,q,se,Me,We){var ut=se*se;if(se>0&&N.size<(Me?ut:se))q.numPoints+=N.length/3;else{for(var W=[],ne=0;ne<N.length;ne+=3)(se===0||N[ne+2]>ut)&&(q.numSimplified++,W.push(N[ne]),W.push(N[ne+1])),q.numPoints++;Me&&function(je,lt){for(var Ie=0,Kt=0,Er=je.length,sn=Er-2;Kt<Er;sn=Kt,Kt+=2)Ie+=(je[Kt]-je[sn])*(je[Kt+1]+je[sn+1]);if(Ie>0===lt)for(Kt=0,Er=je.length;Kt<Er/2;Kt+=2){var un=je[Kt],nr=je[Kt+1];je[Kt]=je[Er-2-Kt],je[Kt+1]=je[Er-1-Kt],je[Er-2-Kt]=un,je[Er-1-Kt]=nr}}(W,We),U.push(W)}}function Ue(U,N){var q=(N=this.options=function(Me,We){for(var ut in We)Me[ut]=We[ut];return Me}(Object.create(this.options),N)).debug;if(q&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var se=function(Me,We){var ut=[];if(Me.type==="FeatureCollection")for(var W=0;W<Me.features.length;W++)Ei(ut,Me.features[W],We,W);else Ei(ut,Me.type==="Feature"?Me:{geometry:Me},We);return ut}(U,N);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(se=function(Me,We){var ut=We.buffer/We.extent,W=Me,ne=da(Me,1,-1-ut,ut,0,-1,2,We),je=da(Me,1,1-ut,2+ut,0,-1,2,We);return(ne||je)&&(W=da(Me,1,-ut,1+ut,0,-1,2,We)||[],ne&&(W=yn(ne,1).concat(W)),je&&(W=W.concat(yn(je,-1)))),W}(se,N)).length&&this.splitTile(se,0,0,0),q&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $t(U,N,q){return 32*((1<<U)*q+N)+U}function Lt(U,N){var q=U.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);var se=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!se)return N(null,null);var Me=new ht(se.features),We=ft(Me);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),N(null,{vectorTile:Me,rawData:We.buffer})}kt.prototype.load=function(U){var N=this.options,q=N.log,se=N.minZoom,Me=N.maxZoom,We=N.nodeSize;q&&console.time("total time");var ut="prepare "+U.length+" points";q&&console.time(ut),this.points=U;for(var W=[],ne=0;ne<U.length;ne++)U[ne].geometry&&W.push(Kr(U[ne],ne));this.trees[Me+1]=new Mt(W,Lr,jn,We,Float32Array),q&&console.timeEnd(ut);for(var je=Me;je>=se;je--){var lt=+Date.now();W=this._cluster(W,je),this.trees[je]=new Mt(W,Lr,jn,We,Float32Array),q&&console.log("z%d: %d clusters in %dms",je,W.length,+Date.now()-lt)}return q&&console.timeEnd("total time"),this},kt.prototype.getClusters=function(U,N){var q=((U[0]+180)%360+360)%360-180,se=Math.max(-90,Math.min(90,U[1])),Me=U[2]===180?180:((U[2]+180)%360+360)%360-180,We=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)q=-180,Me=180;else if(q>Me){var ut=this.getClusters([q,se,180,We],N),W=this.getClusters([-180,se,Me,We],N);return ut.concat(W)}for(var ne=this.trees[this._limitZoom(N)],je=[],lt=0,Ie=ne.range(gn(q),nn(We),gn(Me),nn(se));lt<Ie.length;lt+=1){var Kt=ne.points[Ie[lt]];je.push(Kt.numPoints?Ir(Kt):this.points[Kt.index])}return je},kt.prototype.getChildren=function(U){var N=this._getOriginId(U),q=this._getOriginZoom(U),se="No cluster with the specified id.",Me=this.trees[q];if(!Me)throw new Error(se);var We=Me.points[N];if(!We)throw new Error(se);for(var ut=this.options.radius/(this.options.extent*Math.pow(2,q-1)),W=[],ne=0,je=Me.within(We.x,We.y,ut);ne<je.length;ne+=1){var lt=Me.points[je[ne]];lt.parentId===U&&W.push(lt.numPoints?Ir(lt):this.points[lt.index])}if(W.length===0)throw new Error(se);return W},kt.prototype.getLeaves=function(U,N,q){var se=[];return this._appendLeaves(se,U,N=N||10,q=q||0,0),se},kt.prototype.getTile=function(U,N,q){var se=this.trees[this._limitZoom(U)],Me=Math.pow(2,U),We=this.options,ut=We.radius/We.extent,W=(q-ut)/Me,ne=(q+1+ut)/Me,je={features:[]};return this._addTileFeatures(se.range((N-ut)/Me,W,(N+1+ut)/Me,ne),se.points,N,q,Me,je),N===0&&this._addTileFeatures(se.range(1-ut/Me,W,1,ne),se.points,Me,q,Me,je),N===Me-1&&this._addTileFeatures(se.range(0,W,ut/Me,ne),se.points,-1,q,Me,je),je.features.length?je:null},kt.prototype.getClusterExpansionZoom=function(U){for(var N=this._getOriginZoom(U)-1;N<=this.options.maxZoom;){var q=this.getChildren(U);if(N++,q.length!==1)break;U=q[0].properties.cluster_id}return N},kt.prototype._appendLeaves=function(U,N,q,se,Me){for(var We=0,ut=this.getChildren(N);We<ut.length;We+=1){var W=ut[We],ne=W.properties;if(ne&&ne.cluster?Me+ne.point_count<=se?Me+=ne.point_count:Me=this._appendLeaves(U,ne.cluster_id,q,se,Me):Me<se?Me++:U.push(W),U.length===q)break}return Me},kt.prototype._addTileFeatures=function(U,N,q,se,Me,We){for(var ut=0,W=U;ut<W.length;ut+=1){var ne=N[W[ut]],je=ne.numPoints,lt={type:1,geometry:[[Math.round(this.options.extent*(ne.x*Me-q)),Math.round(this.options.extent*(ne.y*Me-se))]],tags:je?In(ne):this.points[ne.index].properties},Ie=void 0;je?Ie=ne.id:this.options.generateId?Ie=ne.index:this.points[ne.index].id&&(Ie=this.points[ne.index].id),Ie!==void 0&&(lt.id=Ie),We.features.push(lt)}},kt.prototype._limitZoom=function(U){return Math.max(this.options.minZoom,Math.min(+U,this.options.maxZoom+1))},kt.prototype._cluster=function(U,N){for(var q=[],se=this.options,Me=se.reduce,We=se.minPoints,ut=se.radius/(se.extent*Math.pow(2,N)),W=0;W<U.length;W++){var ne=U[W];if(!(ne.zoom<=N)){ne.zoom=N;for(var je=this.trees[N+1],lt=je.within(ne.x,ne.y,ut),Ie=ne.numPoints||1,Kt=Ie,Er=0,sn=lt;Er<sn.length;Er+=1){var un=je.points[sn[Er]];un.zoom>N&&(Kt+=un.numPoints||1)}if(Kt>=We){for(var nr=ne.x*Ie,Qr=ne.y*Ie,Hr=Me&&Ie>1?this._map(ne,!0):null,$r=(W<<5)+(N+1)+this.points.length,oi=0,pn=lt;oi<pn.length;oi+=1){var mi=je.points[pn[oi]];if(!(mi.zoom<=N)){mi.zoom=N;var Gi=mi.numPoints||1;nr+=mi.x*Gi,Qr+=mi.y*Gi,mi.parentId=$r,Me&&(Hr||(Hr=this._map(ne,!0)),Me(Hr,this._map(mi)))}}ne.parentId=$r,q.push(Vr(nr/Kt,Qr/Kt,$r,Kt,Hr))}else if(q.push(ne),Kt>1)for(var di=0,zi=lt;di<zi.length;di+=1){var Ri=je.points[zi[di]];Ri.zoom<=N||(Ri.zoom=N,q.push(Ri))}}}return q},kt.prototype._getOriginId=function(U){return U-this.points.length>>5},kt.prototype._getOriginZoom=function(U){return(U-this.points.length)%32},kt.prototype._map=function(U,N){if(U.numPoints)return N?hi({},U.properties):U.properties;var q=this.points[U.index].properties,se=this.options.map(q);return N&&se===q?hi({},se):se},Ue.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ue.prototype.splitTile=function(U,N,q,se,Me,We,ut){for(var W=[U,N,q,se],ne=this.options,je=ne.debug;W.length;){se=W.pop(),q=W.pop(),N=W.pop(),U=W.pop();var lt=1<<N,Ie=$t(N,q,se),Kt=this.tiles[Ie];if(!Kt&&(je>1&&console.time("creation"),Kt=this.tiles[Ie]=z(U,N,q,se,ne),this.tileCoords.push({z:N,x:q,y:se}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,q,se,Kt.numFeatures,Kt.numPoints,Kt.numSimplified),console.timeEnd("creation"));var Er="z"+N;this.stats[Er]=(this.stats[Er]||0)+1,this.total++}if(Kt.source=U,Me){if(N===ne.maxZoom||N===Me)continue;var sn=1<<Me-N;if(q!==Math.floor(We/sn)||se!==Math.floor(ut/sn))continue}else if(N===ne.indexMaxZoom||Kt.numPoints<=ne.indexMaxPoints)continue;if(Kt.source=null,U.length!==0){je>1&&console.time("clipping");var un,nr,Qr,Hr,$r,oi,pn=.5*ne.buffer/ne.extent,mi=.5-pn,Gi=.5+pn,di=1+pn;un=nr=Qr=Hr=null,$r=da(U,lt,q-pn,q+Gi,0,Kt.minX,Kt.maxX,ne),oi=da(U,lt,q+mi,q+di,0,Kt.minX,Kt.maxX,ne),U=null,$r&&(un=da($r,lt,se-pn,se+Gi,1,Kt.minY,Kt.maxY,ne),nr=da($r,lt,se+mi,se+di,1,Kt.minY,Kt.maxY,ne),$r=null),oi&&(Qr=da(oi,lt,se-pn,se+Gi,1,Kt.minY,Kt.maxY,ne),Hr=da(oi,lt,se+mi,se+di,1,Kt.minY,Kt.maxY,ne),oi=null),je>1&&console.timeEnd("clipping"),W.push(un||[],N+1,2*q,2*se),W.push(nr||[],N+1,2*q,2*se+1),W.push(Qr||[],N+1,2*q+1,2*se),W.push(Hr||[],N+1,2*q+1,2*se+1)}}},Ue.prototype.getTile=function(U,N,q){var se=this.options,Me=se.extent,We=se.debug;if(U<0||U>24)return null;var ut=1<<U,W=$t(U,N=(N%ut+ut)%ut,q);if(this.tiles[W])return he(this.tiles[W],Me);We>1&&console.log("drilling down to z%d-%d-%d",U,N,q);for(var ne,je=U,lt=N,Ie=q;!ne&&je>0;)je--,lt=Math.floor(lt/2),Ie=Math.floor(Ie/2),ne=this.tiles[$t(je,lt,Ie)];return ne&&ne.source?(We>1&&console.log("found parent tile z%d-%d-%d",je,lt,Ie),We>1&&console.time("drilling down"),this.splitTile(ne.source,je,lt,Ie,U,N,q),We>1&&console.timeEnd("drilling down"),this.tiles[W]?he(this.tiles[W],Me):null):null};var Bt=function(U){function N(q,se,Me,We){U.call(this,q,se,Me,Lt),We&&(this.loadGeoJSON=We)}return U&&(N.__proto__=U),(N.prototype=Object.create(U&&U.prototype)).constructor=N,N.prototype.loadData=function(q,se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=se,this._pendingLoadDataParams=q,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},N.prototype._loadData=function(){var q=this;if(this._pendingCallback&&this._pendingLoadDataParams){var se=this._pendingCallback,Me=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var We=!!(Me&&Me.request&&Me.request.collectResourceTiming)&&new y.RequestPerformance(Me.request);this.loadGeoJSON(Me,function(ut,W){if(ut||!W)return se(ut);if(typeof W!="object")return se(new Error("Input data given to '"+Me.source+"' is not a valid GeoJSON object."));(function Kt(Er,sn){var un,nr=Er&&Er.type;if(nr==="FeatureCollection")for(un=0;un<Er.features.length;un++)Kt(Er.features[un],sn);else if(nr==="GeometryCollection")for(un=0;un<Er.geometries.length;un++)Kt(Er.geometries[un],sn);else if(nr==="Feature")Kt(Er.geometry,sn);else if(nr==="Polygon")ye(Er.coordinates,sn);else if(nr==="MultiPolygon")for(un=0;un<Er.coordinates.length;un++)ye(Er.coordinates[un],sn);return Er})(W,!0);try{if(Me.filter){var ne=y.createExpression(Me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(function(Kt){return Kt.key+": "+Kt.message}).join(", "));var je=W.features.filter(function(Kt){return ne.value.evaluate({zoom:0},Kt)});W={type:"FeatureCollection",features:je}}q._geoJSONIndex=Me.cluster?new kt(function(Kt){var Er=Kt.superclusterOptions,sn=Kt.clusterProperties;if(!sn||!Er)return Er;for(var un={},nr={},Qr={accumulated:null,zoom:0},Hr={properties:null},$r=Object.keys(sn),oi=0,pn=$r;oi<pn.length;oi+=1){var mi=pn[oi],Gi=sn[mi],di=Gi[0],zi=y.createExpression(Gi[1]),Ri=y.createExpression(typeof di=="string"?[di,["accumulated"],["get",mi]]:di);un[mi]=zi.value,nr[mi]=Ri.value}return Er.map=function(ss){Hr.properties=ss;for(var oa={},La=0,Mi=$r;La<Mi.length;La+=1){var yi=Mi[La];oa[yi]=un[yi].evaluate(Qr,Hr)}return oa},Er.reduce=function(ss,oa){Hr.properties=oa;for(var La=0,Mi=$r;La<Mi.length;La+=1){var yi=Mi[La];Qr.accumulated=ss[yi],ss[yi]=nr[yi].evaluate(Qr,Hr)}},Er}(Me)).load(W.features):function(Kt,Er){return new Ue(Kt,Er)}(W,Me.geojsonVtOptions)}catch(Kt){return se(Kt)}q.loaded={};var lt={};if(We){var Ie=We.finish();Ie&&(lt.resourceTiming={},lt.resourceTiming[Me.source]=JSON.parse(JSON.stringify(Ie)))}se(null,lt)})}},N.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},N.prototype.reloadTile=function(q,se){var Me=this.loaded;return Me&&Me[q.uid]?U.prototype.reloadTile.call(this,q,se):this.loadTile(q,se)},N.prototype.loadGeoJSON=function(q,se){if(q.request)y.getJSON(q.request,se);else{if(typeof q.data!="string")return se(new Error("Input data given to '"+q.source+"' is not a valid GeoJSON object."));try{return se(null,JSON.parse(q.data))}catch(Me){return se(new Error("Input data given to '"+q.source+"' is not a valid GeoJSON object."))}}},N.prototype.removeSource=function(q,se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),se()},N.prototype.getClusterExpansionZoom=function(q,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(Me){se(Me)}},N.prototype.getClusterChildren=function(q,se){try{se(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(Me){se(Me)}},N.prototype.getClusterLeaves=function(q,se){try{se(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(Me){se(Me)}},N}(Ce),xt=function(U){var N=this;this.self=U,this.actor=new y.Actor(U,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ce,geojson:Bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(q,se){if(N.workerSourceTypes[q])throw new Error('Worker source with name "'+q+'" already registered.');N.workerSourceTypes[q]=se},this.self.registerRTLTextPlugin=function(q){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=q.applyArabicShaping,y.plugin.processBidirectionalText=q.processBidirectionalText,y.plugin.processStyledBidirectionalText=q.processStyledBidirectionalText}};return xt.prototype.setReferrer=function(U,N){this.referrer=N},xt.prototype.setImages=function(U,N,q){for(var se in this.availableImages[U]=N,this.workerSources[U]){var Me=this.workerSources[U][se];for(var We in Me)Me[We].availableImages=N}q()},xt.prototype.setLayers=function(U,N,q){this.getLayerIndex(U).replace(N),q()},xt.prototype.updateLayers=function(U,N,q){this.getLayerIndex(U).update(N.layers,N.removedIds),q()},xt.prototype.loadTile=function(U,N,q){this.getWorkerSource(U,N.type,N.source).loadTile(N,q)},xt.prototype.loadDEMTile=function(U,N,q){this.getDEMWorkerSource(U,N.source).loadTile(N,q)},xt.prototype.reloadTile=function(U,N,q){this.getWorkerSource(U,N.type,N.source).reloadTile(N,q)},xt.prototype.abortTile=function(U,N,q){this.getWorkerSource(U,N.type,N.source).abortTile(N,q)},xt.prototype.removeTile=function(U,N,q){this.getWorkerSource(U,N.type,N.source).removeTile(N,q)},xt.prototype.removeDEMTile=function(U,N){this.getDEMWorkerSource(U,N.source).removeTile(N)},xt.prototype.removeSource=function(U,N,q){if(this.workerSources[U]&&this.workerSources[U][N.type]&&this.workerSources[U][N.type][N.source]){var se=this.workerSources[U][N.type][N.source];delete this.workerSources[U][N.type][N.source],se.removeSource!==void 0?se.removeSource(N,q):q()}},xt.prototype.loadWorkerSource=function(U,N,q){try{this.self.importScripts(N.url),q()}catch(se){q(se.toString())}},xt.prototype.syncRTLPluginState=function(U,N,q){try{y.plugin.setState(N);var se=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&se!=null){this.self.importScripts(se);var Me=y.plugin.isParsed();q(Me?void 0:new Error("RTL Text Plugin failed to import scripts from "+se),Me)}}catch(We){q(We.toString())}},xt.prototype.getAvailableImages=function(U){var N=this.availableImages[U];return N||(N=[]),N},xt.prototype.getLayerIndex=function(U){var N=this.layerIndexes[U];return N||(N=this.layerIndexes[U]=new Y),N},xt.prototype.getWorkerSource=function(U,N,q){var se=this;return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][N]||(this.workerSources[U][N]={}),this.workerSources[U][N][q]||(this.workerSources[U][N][q]=new this.workerSourceTypes[N]({send:function(Me,We,ut){se.actor.send(Me,We,ut,U)}},this.getLayerIndex(U),this.getAvailableImages(U))),this.workerSources[U][N][q]},xt.prototype.getDEMWorkerSource=function(U,N){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][N]||(this.demWorkerSources[U][N]=new ct),this.demWorkerSources[U][N]},xt.prototype.enforceCacheSizeLimit=function(U,N){y.enforceCacheSizeLimit(N)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xt(self)),xt}),de(["./shared"],function(y){"use strict";var le=y.createCommonjsModule(function(h){function v(S){return!p(S)}function p(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,k,$=new Blob([""],{type:"text/javascript"}),oe=URL.createObjectURL($);try{k=new Worker(oe),R=!0}catch(be){R=!1}return k&&k.terminate(),URL.revokeObjectURL(oe),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var k=R.getContext("2d");if(!k)return!1;var $=k.getImageData(0,0,1,1);return $&&$.width===R.width}()?(g[w=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[w]=function(R){var k=function(oe){var be=document.createElement("canvas"),we=Object.create(v.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=oe,be.probablySupportsContext?be.probablySupportsContext("webgl",we)||be.probablySupportsContext("experimental-webgl",we):be.supportsContext?be.supportsContext("webgl",we)||be.supportsContext("experimental-webgl",we):be.getContext("webgl",we)||be.getContext("experimental-webgl",we)}(R);if(!k)return!1;var $=k.createShader(k.VERTEX_SHADER);return!(!$||k.isContextLost())&&(k.shaderSource($,"void main() {}"),k.compileShader($),k.getShaderParameter($,k.COMPILE_STATUS)===!0)}(w)),g[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}h.exports?h.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=p);var g={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),P={create:function(h,v,p){var g=y.window.document.createElement(h);return v!==void 0&&(g.className=v),p&&p.appendChild(g),g},createNS:function(h,v){return y.window.document.createElementNS(h,v)}},Y=y.window.document&&y.window.document.documentElement.style;function V(h){if(!Y)return h[0];for(var v=0;v<h.length;v++)if(h[v]in Y)return h[v];return h[0]}var ue,H=V(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);P.disableDrag=function(){Y&&H&&(ue=Y[H],Y[H]="none")},P.enableDrag=function(){Y&&H&&(Y[H]=ue)};var Ae=V(["transform","WebkitTransform"]);P.setTransform=function(h,v){h.style[Ae]=v};var Ce=!1;try{var ge=Object.defineProperty({},"passive",{get:function(){Ce=!0}});y.window.addEventListener("test",ge,ge),y.window.removeEventListener("test",ge,ge)}catch(h){Ce=!1}P.addEventListener=function(h,v,p,g){g===void 0&&(g={}),h.addEventListener(v,p,"passive"in g&&Ce?g:g.capture)},P.removeEventListener=function(h,v,p,g){g===void 0&&(g={}),h.removeEventListener(v,p,"passive"in g&&Ce?g:g.capture)};var ct=function(h){h.preventDefault(),h.stopPropagation(),y.window.removeEventListener("click",ct,!0)};function ye(h){var v=h.userImage;return!!(v&&v.render&&v.render())&&(h.data.replace(new Uint8Array(v.data.buffer)),!0)}P.suppressClick=function(){y.window.addEventListener("click",ct,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",ct,!0)},0)},P.mousePos=function(h,v){var p=h.getBoundingClientRect();return new y.Point(v.clientX-p.left-h.clientLeft,v.clientY-p.top-h.clientTop)},P.touchPos=function(h,v){for(var p=h.getBoundingClientRect(),g=[],S=0;S<v.length;S++)g.push(new y.Point(v[S].clientX-p.left-h.clientLeft,v[S].clientY-p.top-h.clientTop));return g},P.mouseButton=function(h){return y.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},P.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var St=function(h){function v(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(p){if(this.loaded!==p&&(this.loaded=p,p)){for(var g=0,S=this.requestors;g<S.length;g+=1){var w=S[g];this._notify(w.ids,w.callback)}this.requestors=[]}},v.prototype.getImage=function(p){return this.images[p]},v.prototype.addImage=function(p,g){this._validate(p,g)&&(this.images[p]=g)},v.prototype._validate=function(p,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "content" value'))),S=!1),S},v.prototype._validateStretch=function(p,g){if(!p)return!0;for(var S=0,w=0,R=p;w<R.length;w+=1){var k=R[w];if(k[0]<S||k[1]<k[0]||g<k[1])return!1;S=k[1]}return!0},v.prototype._validateContent=function(p,g){return!(p&&(p.length!==4||p[0]<0||g.data.width<p[0]||p[1]<0||g.data.height<p[1]||p[2]<0||g.data.width<p[2]||p[3]<0||g.data.height<p[3]||p[2]<p[0]||p[3]<p[1]))},v.prototype.updateImage=function(p,g){g.version=this.images[p].version+1,this.images[p]=g,this.updatedImages[p]=!0},v.prototype.removeImage=function(p){var g=this.images[p];delete this.images[p],delete this.patterns[p],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(p,g){var S=!0;if(!this.isLoaded())for(var w=0,R=p;w<R.length;w+=1)this.images[R[w]]||(S=!1);this.isLoaded()||S?this._notify(p,g):this.requestors.push({ids:p,callback:g})},v.prototype._notify=function(p,g){for(var S={},w=0,R=p;w<R.length;w+=1){var k=R[w];this.images[k]||this.fire(new y.Event("styleimagemissing",{id:k}));var $=this.images[k];$?S[k]={data:$.data.clone(),pixelRatio:$.pixelRatio,sdf:$.sdf,version:$.version,stretchX:$.stretchX,stretchY:$.stretchY,content:$.content,hasRenderCallback:!!($.userImage&&$.userImage.render)}:y.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},v.prototype.getPixelSize=function(){var p=this.atlasImage;return{width:p.width,height:p.height}},v.prototype.getPattern=function(p){var g=this.patterns[p],S=this.getImage(p);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var w={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new y.ImagePosition(w,S);this.patterns[p]={bin:w,position:R}}return this._updatePatternAtlas(),this.patterns[p].position},v.prototype.bind=function(p){var g=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(p,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var p=[];for(var g in this.patterns)p.push(this.patterns[g].bin);var S=y.potpack(p),w=S.w,R=S.h,k=this.atlasImage;for(var $ in k.resize({width:w||1,height:R||1}),this.patterns){var oe=this.patterns[$].bin,be=oe.x+1,we=oe.y+1,Oe=this.images[$].data,qe=Oe.width,$e=Oe.height;y.RGBAImage.copy(Oe,k,{x:0,y:0},{x:be,y:we},{width:qe,height:$e}),y.RGBAImage.copy(Oe,k,{x:0,y:$e-1},{x:be,y:we-1},{width:qe,height:1}),y.RGBAImage.copy(Oe,k,{x:0,y:0},{x:be,y:we+$e},{width:qe,height:1}),y.RGBAImage.copy(Oe,k,{x:qe-1,y:0},{x:be-1,y:we},{width:1,height:$e}),y.RGBAImage.copy(Oe,k,{x:0,y:0},{x:be+qe,y:we},{width:1,height:$e})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(p){for(var g=0,S=p;g<S.length;g+=1){var w=S[g];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var R=this.images[w];ye(R)&&this.updateImage(w,R)}}},v}(y.Evented),mt=it,Ze=it,ht=1e20;function it(h,v,p,g,S,w){this.fontSize=h||24,this.buffer=v===void 0?3:v,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=w||"normal",this.radius=p||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function dr(h,v,p,g,S,w,R){for(var k=0;k<v;k++){for(var $=0;$<p;$++)g[$]=h[$*v+k];for(yr(g,S,w,R,p),$=0;$<p;$++)h[$*v+k]=S[$]}for($=0;$<p;$++){for(k=0;k<v;k++)g[k]=h[$*v+k];for(yr(g,S,w,R,v),k=0;k<v;k++)h[$*v+k]=Math.sqrt(S[k])}}function yr(h,v,p,g,S){p[0]=0,g[0]=-ht,g[1]=+ht;for(var w=1,R=0;w<S;w++){for(var k=(h[w]+w*w-(h[p[R]]+p[R]*p[R]))/(2*w-2*p[R]);k<=g[R];)R--,k=(h[w]+w*w-(h[p[R]]+p[R]*p[R]))/(2*w-2*p[R]);p[++R]=w,g[R]=k,g[R+1]=+ht}for(w=0,R=0;w<S;w++){for(;g[R+1]<w;)R++;v[w]=(w-p[R])*(w-p[R])+h[p[R]]}}it.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),p=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=v.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?ht:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?ht:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(dr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),dr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)p[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return p},mt.default=Ze;var cr=function(h,v){this.requestManager=h,this.localIdeographFontFamily=v,this.entries={}};cr.prototype.setURL=function(h){this.url=h},cr.prototype.getGlyphs=function(h,v){var p=this,g=[];for(var S in h)for(var w=0,R=h[S];w<R.length;w+=1)g.push({stack:S,id:R[w]});y.asyncAll(g,function(k,$){var oe=k.stack,be=k.id,we=p.entries[oe];we||(we=p.entries[oe]={glyphs:{},requests:{},ranges:{}});var Oe=we.glyphs[be];if(Oe===void 0){if(Oe=p._tinySDF(we,oe,be))return we.glyphs[be]=Oe,void $(null,{stack:oe,id:be,glyph:Oe});var qe=Math.floor(be/256);if(256*qe>65535)$(new Error("glyphs > 65535 not supported"));else if(we.ranges[qe])$(null,{stack:oe,id:be,glyph:Oe});else{var $e=we.requests[qe];$e||($e=we.requests[qe]=[],cr.loadGlyphRange(oe,qe,p.url,p.requestManager,function(vt,He){if(He){for(var dt in He)p._doesCharSupportLocalGlyph(+dt)||(we.glyphs[+dt]=He[+dt]);we.ranges[qe]=!0}for(var wt=0,zt=$e;wt<zt.length;wt+=1)(0,zt[wt])(vt,He);delete we.requests[qe]})),$e.push(function(vt,He){vt?$(vt):He&&$(null,{stack:oe,id:be,glyph:He[be]||null})})}}else $(null,{stack:oe,id:be,glyph:Oe})},function(k,$){if(k)v(k);else if($){for(var oe={},be=0,we=$;be<we.length;be+=1){var Oe=we[be],qe=Oe.stack,$e=Oe.id,vt=Oe.glyph;(oe[qe]||(oe[qe]={}))[$e]=vt&&{id:vt.id,bitmap:vt.bitmap.clone(),metrics:vt.metrics}}v(null,oe)}})},cr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](h)||y.isChar["Hangul Syllables"](h)||y.isChar.Hiragana(h)||y.isChar.Katakana(h))},cr.prototype._tinySDF=function(h,v,p){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(p)){var S=h.tinySDF;if(!S){var w="400";/bold/i.test(v)?w="900":/medium/i.test(v)?w="500":/light/i.test(v)&&(w="200"),S=h.tinySDF=new cr.TinySDF(24,3,8,.25,g,w)}return{id:p,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(p))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},cr.loadGlyphRange=function(h,v,p,g,S){var w=256*v,R=w+255,k=g.transformRequest(g.normalizeGlyphsURL(p).replace("{fontstack}",h).replace("{range}",w+"-"+R),y.ResourceType.Glyphs);y.getArrayBuffer(k,function($,oe){if($)S($);else if(oe){for(var be={},we=0,Oe=y.parseGlyphPBF(oe);we<Oe.length;we+=1){var qe=Oe[we];be[qe.id]=qe}S(null,be)}})},cr.TinySDF=mt;var ft=function(){this.specification=y.styleSpec.light.position};ft.prototype.possiblyEvaluate=function(h,v){return y.sphericalToCartesian(h.expression.evaluate(v))},ft.prototype.interpolate=function(h,v,p){return{x:y.number(h.x,v.x,p),y:y.number(h.y,v.y,p),z:y.number(h.z,v.z,p)}};var Pe=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new ft,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Rt=function(h){function v(p){h.call(this),this._transitionable=new y.Transitionable(Pe),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(p,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,p,g))for(var S in p){var w=p[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),w):this._transitionable.setValue(S,w)}},v.prototype.updateTransitions=function(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(p){this.properties=this._transitioning.possiblyEvaluate(p)},v.prototype._validate=function(p,g,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,p.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},v}(y.Evented),Ve=function(h,v){this.width=h,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ve.prototype.getDash=function(h,v){var p=h.join(",")+String(v);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(h,v)),this.dashEntry[p]},Ve.prototype.getDashRanges=function(h,v,p){var g=[],S=h.length%2==1?-h[h.length-1]*p:0,w=h[0]*p,R=!0;g.push({left:S,right:w,isDash:R,zeroLength:h[0]===0});for(var k=h[0],$=1;$<h.length;$++){var oe=h[$];g.push({left:S=k*p,right:w=(k+=oe)*p,isDash:R=!R,zeroLength:oe===0})}return g},Ve.prototype.addRoundDash=function(h,v,p){for(var g=v/2,S=-p;S<=p;S++)for(var w=this.width*(this.nextRow+p+S),R=0,k=h[R],$=0;$<this.width;$++){$/k.right>1&&(k=h[++R]);var oe=Math.abs($-k.left),be=Math.abs($-k.right),we=Math.min(oe,be),Oe=void 0,qe=S/p*(g+1);if(k.isDash){var $e=g-Math.abs(qe);Oe=Math.sqrt(we*we+$e*$e)}else Oe=g-Math.sqrt(we*we+qe*qe);this.data[w+$]=Math.max(0,Math.min(255,Oe+128))}},Ve.prototype.addRegularDash=function(h){for(var v=h.length-1;v>=0;--v){var p=h[v],g=h[v+1];p.zeroLength?h.splice(v,1):g&&g.isDash===p.isDash&&(g.left=p.left,h.splice(v,1))}var S=h[0],w=h[h.length-1];S.isDash===w.isDash&&(S.left=w.left-this.width,w.right=S.right+this.width);for(var R=this.width*this.nextRow,k=0,$=h[k],oe=0;oe<this.width;oe++){oe/$.right>1&&($=h[++k]);var be=Math.abs(oe-$.left),we=Math.abs(oe-$.right),Oe=Math.min(be,we);this.data[R+oe]=Math.max(0,Math.min(255,($.isDash?Oe:-Oe)+128))}},Ve.prototype.addDash=function(h,v){var p=v?7:0,g=2*p+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,w=0;w<h.length;w++)S+=h[w];if(S!==0){var R=this.width/S,k=this.getDashRanges(h,this.width,R);v?this.addRoundDash(k,R,p):this.addRegularDash(k)}var $={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:S};return this.nextRow+=g,this.dirty=!0,$},Ve.prototype.bind=function(h){var v=h.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var Vt=function h(v,p){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var w=new h.Actor(g[S],p,this.id);w.name="Worker "+S,this.actors.push(w)}};function mr(h,v,p){var g=function(S,w){if(S)return p(S);if(w){var R=y.pick(y.extend(w,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(R.vectorLayers=w.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(k){return k.id})),R.tiles=v.canonicalizeTileset(R,h.url),p(null,R)}};return h.url?y.getJSON(v.transformRequest(v.normalizeSourceURL(h.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,h)})}Vt.prototype.broadcast=function(h,v,p){y.asyncAll(this.actors,function(g,S){g.send(h,v,S)},p=p||function(){})},Vt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Vt.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},Vt.Actor=y.Actor;var ie=function(h,v,p){this.bounds=y.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=v||0,this.maxzoom=p||24};ie.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},ie.prototype.contains=function(h){var v=Math.pow(2,h.z),p=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*v),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*v),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*v),w=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*v);return h.x>=p&&h.x<S&&h.y>=g&&h.y<w};var j=function(h){function v(p,g,S,w){if(h.call(this),this.id=p,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new y.ErrorEvent(g)):S&&(y.extend(p,S),S.bounds&&(p.tileBounds=new ie(S.bounds,p.minzoom,p.maxzoom)),y.postTurnstileEvent(S.tiles,p.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken,p.map._requestManager._customAccessToken),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setSourceProperty=function(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(p){var g=this;return this.setSourceProperty(function(){g._options.tiles=p}),this},v.prototype.setUrl=function(p){var g=this;return this.setSourceProperty(function(){g.url=p,g._options.url=p}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(k,$){return delete p.request,p.aborted?g(null):k&&k.status!==404?g(k):($&&$.resourceTiming&&(p.resourceTiming=$.resourceTiming),this.map._refreshExpiredTiles&&$&&p.setExpiryData($),p.loadVectorData($,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired"?p.state==="loading"?p.reloadCallback=g:p.request=p.actor.send("reloadTile",w,R.bind(this)):(p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",w,R.bind(this)))},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v}(y.Evented),re=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new y.ErrorEvent(g)):S&&(y.extend(p,S),S.bounds&&(p.tileBounds=new ie(S.bounds,p.minzoom,p.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.loadTile=function(p,g){var S=this,w=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);p.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(R,k){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(R)p.state="errored",g(R);else if(k){S.map._refreshExpiredTiles&&p.setExpiryData(k),delete k.cacheControl,delete k.expires;var $=S.map.painter.context,oe=$.gl;p.texture=S.map.painter.getTileTexture(k.width),p.texture?p.texture.update(k,{useMipmap:!0}):(p.texture=new y.Texture($,k,oe.RGBA,{useMipmap:!0}),p.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE,oe.LINEAR_MIPMAP_NEAREST),$.extTextureFilterAnisotropic&&oe.texParameterf(oe.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax)),p.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},v.prototype.abortTile=function(p,g){p.request&&(p.request.cancel(),delete p.request),g()},v.prototype.unloadTile=function(p,g){p.texture&&this.map.painter.saveTileTexture(p.texture),g()},v.prototype.hasTransition=function(){return!1},v}(y.Evented),ke=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(R,k){R&&(p.state="errored",g(R)),k&&(p.dem=k,p.needsHillshadePrepare=!0,p.state="loaded",g(null))}p.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(R,k){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(R)p.state="errored",g(R);else if(k){this.map._refreshExpiredTiles&&p.setExpiryData(k),delete k.cacheControl,delete k.expires;var $=y.window.ImageBitmap&&k instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?k:y.browser.getImageData(k,1),oe={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:$,encoding:this.encoding};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",oe,w.bind(this)))}}.bind(this)),p.neighboringTiles=this._getNeighboringTiles(p.tileID)},v.prototype._getNeighboringTiles=function(p){var g=p.canonical,S=Math.pow(2,g.z),w=(g.x-1+S)%S,R=g.x===0?p.wrap-1:p.wrap,k=(g.x+1+S)%S,$=g.x+1===S?p.wrap+1:p.wrap,oe={};return oe[new y.OverscaledTileID(p.overscaledZ,R,g.z,w,g.y).key]={backfilled:!1},oe[new y.OverscaledTileID(p.overscaledZ,$,g.z,k,g.y).key]={backfilled:!1},g.y>0&&(oe[new y.OverscaledTileID(p.overscaledZ,R,g.z,w,g.y-1).key]={backfilled:!1},oe[new y.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},oe[new y.OverscaledTileID(p.overscaledZ,$,g.z,k,g.y-1).key]={backfilled:!1}),g.y+1<S&&(oe[new y.OverscaledTileID(p.overscaledZ,R,g.z,w,g.y+1).key]={backfilled:!1},oe[new y.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},oe[new y.OverscaledTileID(p.overscaledZ,$,g.z,k,g.y+1).key]={backfilled:!1}),oe},v.prototype.unloadTile=function(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded",p.actor&&p.actor.send("removeDEMTile",{uid:p.uid,source:this.id})},v}(re),Te=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(w),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)p.fire(new y.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(S.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new y.Event("data",S))}})},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setData=function(p){var g=this;return this._data=p,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new y.ErrorEvent(S));else{var w={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(w.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",w))}}),this},v.prototype.getClusterExpansionZoom=function(p,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},g),this},v.prototype.getClusterChildren=function(p,g){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},g),this},v.prototype.getClusterLeaves=function(p,g,S,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:g,offset:S},w),this},v.prototype._updateWorkerData=function(p){var g=this;this._loaded=!1;var S=y.extend({},this.workerOptions),w=this._data;typeof w=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(w),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(w),this.actor.send(this.type+".loadData",S,function(R,k){g._removed||k&&k.abandoned||(g._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[g.id]&&(g._resourceTiming=k.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),p(R))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(p,g){var S=this,w=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(w,{type:this.type,uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,k){return delete p.request,p.unloadVectorData(),p.aborted?g(null):R?g(R):(p.loadVectorData(k,S.map.painter,w==="reloadTile"),g(null))})},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0},v.prototype.unloadTile=function(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v}(y.Evented),st=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ze=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(p,g){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(w,R){S._loaded=!0,w?S.fire(new y.ErrorEvent(w)):R&&(S.image=R,p&&(S.coordinates=p),g&&g(),S._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(p){var g=this;return this.image&&p.url?(this.options.url=p.url,this.load(p.coordinates,function(){g.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setCoordinates=function(p){var g=this;this.coordinates=p;var S=p.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var k=1/0,$=1/0,oe=-1/0,be=-1/0,we=0,Oe=R;we<Oe.length;we+=1){var qe=Oe[we];k=Math.min(k,qe.x),$=Math.min($,qe.y),oe=Math.max(oe,qe.x),be=Math.max(be,qe.y)}var $e=Math.max(oe-k,be-$),vt=Math.max(0,Math.floor(-Math.log($e)/Math.LN2)),He=Math.pow(2,vt);return new y.CanonicalTileID(vt,Math.floor((k+oe)/2*He),Math.floor(($+be)/2*He))}(S),this.minzoom=this.maxzoom=this.tileID.z;var w=S.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(p,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},v.prototype.loadTile=function(p,g){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},g(null)):(p.state="errored",g(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v}(y.Evented),Qe=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),this.roundZoom=!0,this.type="video",this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,w=g.urls;S<w.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(w[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(R,k){p._loaded=!0,R?p.fire(new y.ErrorEvent(R)):k&&(p.video=k,p.video.loop=!0,p.video.setAttribute("playsinline",""),p.video.addEventListener("playing",function(){p.map.triggerRepaint()}),p.map&&p.video.play(),p._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(p){if(this.video){var g=this.video.seekable;p<g.start(0)||p>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=p}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(p,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v}(ze),at=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(k){return typeof k!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,st.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[w];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var p=0,g=[this.canvas.width,this.canvas.height];p<g.length;p+=1){var S=g[p];if(isNaN(S)||S<=0)return!0}return!1},v}(ze),Mt={vector:j,raster:re,"raster-dem":ke,geojson:Te,video:Qe,image:ze,canvas:at};function vr(h,v){var p=y.identity([]);return y.translate(p,p,[1,1,0]),y.scale(p,p,[.5*h.width,.5*h.height,1]),y.multiply(p,p,h.calculatePosMatrix(v.toUnwrapped()))}function kt(h,v,p,g,S,w){var R=function(vt,He,dt){if(vt)for(var wt=0,zt=vt;wt<zt.length;wt+=1){var ar=He[zt[wt]];if(ar&&ar.source===dt&&ar.type==="fill-extrusion")return!0}else for(var Qt in He){var hr=He[Qt];if(hr.source===dt&&hr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,v,h.id),k=w.maxPitchScaleFactor(),$=h.tilesIn(g,k,R);$.sort(Vr);for(var oe=[],be=0,we=$;be<we.length;be+=1){var Oe=we[be];oe.push({wrappedTileID:Oe.tileID.wrapped().key,queryResults:Oe.tile.queryRenderedFeatures(v,p,h._state,Oe.queryGeometry,Oe.cameraQueryGeometry,Oe.scale,S,w,k,vr(h.transform,Oe.tileID))})}var qe=function(vt){for(var He={},dt={},wt=0,zt=vt;wt<zt.length;wt+=1){var ar=zt[wt],Qt=ar.queryResults,hr=ar.wrappedTileID,Tr=dt[hr]=dt[hr]||{};for(var Yr in Qt)for(var Ur=Qt[Yr],_n=Tr[Yr]=Tr[Yr]||{},Hn=He[Yr]=He[Yr]||[],Vn=0,Wn=Ur;Vn<Wn.length;Vn+=1){var Wi=Wn[Vn];_n[Wi.featureIndex]||(_n[Wi.featureIndex]=!0,Hn.push(Wi))}}return He}(oe);for(var $e in qe)qe[$e].forEach(function(vt){var He=vt.feature,dt=h.getFeatureState(He.layer["source-layer"],He.id);He.source=He.layer.source,He.layer["source-layer"]&&(He.sourceLayer=He.layer["source-layer"]),He.state=dt});return qe}function Vr(h,v){var p=h.tileID,g=v.tileID;return p.overscaledZ-g.overscaledZ||p.canonical.y-g.canonical.y||p.wrap-g.wrap||p.canonical.x-g.canonical.x}var Kr=function(h,v){this.max=h,this.onRemove=v,this.reset()};Kr.prototype.reset=function(){for(var h in this.data)for(var v=0,p=this.data[h];v<p.length;v+=1){var g=p[v];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Kr.prototype.add=function(h,v,p){var g=this,S=h.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var w={value:v,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(function(){g.remove(h,w)},p)),this.data[S].push(w),this.order.push(S),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Kr.prototype.has=function(h){return h.wrapped().key in this.data},Kr.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},Kr.prototype._getAndRemoveByKey=function(h){var v=this.data[h].shift();return v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),v.value},Kr.prototype.getByKey=function(h){var v=this.data[h];return v?v[0].value:null},Kr.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},Kr.prototype.remove=function(h,v){if(!this.has(h))return this;var p=h.wrapped().key,g=v===void 0?0:this.data[p].indexOf(v),S=this.data[p][g];return this.data[p].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this},Kr.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},Kr.prototype.filter=function(h){var v=[];for(var p in this.data)for(var g=0,S=this.data[p];g<S.length;g+=1){var w=S[g];h(w.value)||v.push(w)}for(var R=0,k=v;R<k.length;R+=1){var $=k[R];this.remove($.value.tileID,$)}};var Ir=function(h,v,p){this.context=h;var g=h.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Ir.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Ir.prototype.updateData=function(h){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},Ir.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var In={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},gn=function(h,v,p,g){this.length=v.length,this.attributes=p,this.itemSize=v.bytesPerElement,this.dynamicDraw=g,this.context=h;var S=h.gl;this.buffer=S.createBuffer(),h.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};gn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},gn.prototype.updateData=function(h){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,h.arrayBuffer)},gn.prototype.enableAttributes=function(h,v){for(var p=0;p<this.attributes.length;p++){var g=v.attributes[this.attributes[p].name];g!==void 0&&h.enableVertexAttribArray(g)}},gn.prototype.setVertexAttribPointers=function(h,v,p){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],w=v.attributes[S.name];w!==void 0&&h.vertexAttribPointer(w,S.components,h[In[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}},gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var nn=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};nn.prototype.get=function(){return this.current},nn.prototype.set=function(h){},nn.prototype.getDefault=function(){return this.default},nn.prototype.setDefault=function(){this.set(this.default)};var hi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(nn),Lr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)},v}(nn),jn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)},v}(nn),jr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(nn),hn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)},v}(nn),qi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)},v}(nn),Ei=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(p){var g=this.current;(p.func!==g.func||p.ref!==g.ref||p.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)},v}(nn),ia=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)},v}(nn),ta=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=p,this.dirty=!1}},v}(nn),Se=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)},v}(nn),Ni=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=p,this.dirty=!1}},v}(nn),aa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)},v}(nn),da=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.BLEND):g.disable(g.BLEND),this.current=p,this.dirty=!1}},v}(nn),so=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.ONE,p.ZERO]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)},v}(nn),po=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(nn),To=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)},v}(nn),Gt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=p,this.dirty=!1}},v}(nn),br=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)},v}(nn),Gr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)},v}(nn),rn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)},v}(nn),yn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)},v}(nn),Ci=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(nn),he=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,p),this.current=p,this.dirty=!1}},v}(nn),L=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(nn),z=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,p),this.current=p,this.dirty=!1}},v}(nn),fe=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}},v}(nn),Re=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1},v}(nn),Ue=function(h){function v(p){h.call(this,p),this.vao=p.extVertexArrayObject}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)},v}(nn),$t=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}},v}(nn),Lt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}},v}(nn),Bt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}},v}(nn),xt=function(h){function v(p,g){h.call(this,p),this.context=p,this.parent=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v}(nn),U=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}},v}(xt),N=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(xt),q=function(h,v,p,g){this.context=h,this.width=v,this.height=p;var S=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new U(h,S),g&&(this.depthAttachment=new N(h,S))};q.prototype.destroy=function(){var h=this.context.gl,v=this.colorAttachment.get();if(v&&h.deleteTexture(v),this.depthAttachment){var p=this.depthAttachment.get();p&&h.deleteRenderbuffer(p)}h.deleteFramebuffer(this.framebuffer)};var se=function(h,v,p){this.func=h,this.mask=v,this.range=p};se.ReadOnly=!1,se.ReadWrite=!0,se.disabled=new se(519,se.ReadOnly,[0,1]);var Me=function(h,v,p,g,S,w){this.test=h,this.ref=v,this.mask=p,this.fail=g,this.depthFail=S,this.pass=w};Me.disabled=new Me({func:519,mask:0},0,0,7680,7680,7680);var We=function(h,v,p){this.blendFunction=h,this.blendColor=v,this.mask=p};We.disabled=new We(We.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),We.unblended=new We(We.Replace,y.Color.transparent,[!0,!0,!0,!0]),We.alphaBlended=new We([1,771],y.Color.transparent,[!0,!0,!0,!0]);var ut=function(h,v,p){this.enable=h,this.mode=v,this.frontFace=p};ut.disabled=new ut(!1,1029,2305),ut.backCCW=new ut(!0,1029,2305);var W=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new hi(this),this.clearDepth=new Lr(this),this.clearStencil=new jn(this),this.colorMask=new jr(this),this.depthMask=new hn(this),this.stencilMask=new qi(this),this.stencilFunc=new Ei(this),this.stencilOp=new ia(this),this.stencilTest=new ta(this),this.depthRange=new Se(this),this.depthTest=new Ni(this),this.depthFunc=new aa(this),this.blend=new da(this),this.blendFunc=new so(this),this.blendColor=new po(this),this.blendEquation=new To(this),this.cullFace=new Gt(this),this.cullFaceSide=new br(this),this.frontFace=new Gr(this),this.program=new rn(this),this.activeTexture=new yn(this),this.viewport=new Ci(this),this.bindFramebuffer=new he(this),this.bindRenderbuffer=new L(this),this.bindTexture=new z(this),this.bindVertexBuffer=new fe(this),this.bindElementBuffer=new Re(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ue(this),this.pixelStoreUnpack=new $t(this),this.pixelStoreUnpackPremultiplyAlpha=new Lt(this),this.pixelStoreUnpackFlipY=new Bt(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)};W.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},W.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},W.prototype.createIndexBuffer=function(h,v){return new Ir(this,h,v)},W.prototype.createVertexBuffer=function(h,v,p){return new gn(this,h,v,p)},W.prototype.createRenderbuffer=function(h,v,p){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,h,v,p),this.bindRenderbuffer.set(null),S},W.prototype.createFramebuffer=function(h,v,p){return new q(this,h,v,p)},W.prototype.clear=function(h){var v=h.color,p=h.depth,g=this.gl,S=0;v&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),g.clear(S)},W.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},W.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},W.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},W.prototype.setColorMode=function(h){y.deepEqual(h.blendFunction,We.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},W.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ne=function(h){function v(p,g,S){var w=this;h.call(this),this.id=p,this.dispatcher=S,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(R,k,$,oe){var be=new Mt[k.type](R,k,$,oe);if(be.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+be.id);return y.bindAll(["load","abort","unload","serialize","prepare"],be),be}(p,g,S,this),this._tiles={},this._cache=new Kr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){this.map=p,this._maxTileCacheSize=p?p._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(p)},v.prototype.onRemove=function(p){this._source&&this._source.onRemove&&this._source.onRemove(p)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var p in this._tiles){var g=this._tiles[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var p=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,p&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(p,g){return this._source.loadTile(p,g)},v.prototype._unloadTile=function(p){if(this._source.unloadTile)return this._source.unloadTile(p,function(){})},v.prototype._abortTile=function(p){if(this._source.abortTile)return this._source.abortTile(p,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(p){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(p),S.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return y.values(this._tiles).map(function(p){return p.tileID}).sort(je).map(function(p){return p.key})},v.prototype.getRenderableIds=function(p){var g=this,S=[];for(var w in this._tiles)this._isIdRenderable(w,p)&&S.push(this._tiles[w]);return p?S.sort(function(R,k){var $=R.tileID,oe=k.tileID,be=new y.Point($.canonical.x,$.canonical.y)._rotate(g.transform.angle),we=new y.Point(oe.canonical.x,oe.canonical.y)._rotate(g.transform.angle);return $.overscaledZ-oe.overscaledZ||we.y-be.y||we.x-be.x}).map(function(R){return R.tileID.key}):S.map(function(R){return R.tileID}).sort(je).map(function(R){return R.key})},v.prototype.hasRenderableParent=function(p){var g=this.findLoadedParent(p,0);return!!g&&this._isIdRenderable(g.tileID.key)},v.prototype._isIdRenderable=function(p,g){return this._tiles[p]&&this._tiles[p].hasData()&&!this._coveredTiles[p]&&(g||!this._tiles[p].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var p in this._cache.reset(),this._tiles)this._tiles[p].state!=="errored"&&this._reloadTile(p,"reloading")},v.prototype._reloadTile=function(p,g){var S=this._tiles[p];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,p,g)))},v.prototype._tileLoaded=function(p,g,S,w){if(w)return p.state="errored",void(w.status!==404?this._source.fire(new y.ErrorEvent(w,{tile:p})):this.update(this.transform));p.timeAdded=y.browser.now(),S==="expired"&&(p.refreshedUponExpiration=!0),this._setTileReloadTimer(g,p),this.getSource().type==="raster-dem"&&p.dem&&this._backfillDEM(p),this._state.initializeTileState(p,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:p,coord:p.tileID}))},v.prototype._backfillDEM=function(p){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var w=g[S];if(p.neighboringTiles&&p.neighboringTiles[w]){var R=this.getTileByID(w);k(p,R),k(R,p)}}function k($,oe){$.needsHillshadePrepare=!0;var be=oe.tileID.canonical.x-$.tileID.canonical.x,we=oe.tileID.canonical.y-$.tileID.canonical.y,Oe=Math.pow(2,$.tileID.canonical.z),qe=oe.tileID.key;be===0&&we===0||Math.abs(we)>1||(Math.abs(be)>1&&(Math.abs(be+Oe)===1?be+=Oe:Math.abs(be-Oe)===1&&(be-=Oe)),oe.dem&&$.dem&&($.dem.backfillBorder(oe.dem,be,we),$.neighboringTiles&&$.neighboringTiles[qe]&&($.neighboringTiles[qe].backfilled=!0)))}},v.prototype.getTile=function(p){return this.getTileByID(p.key)},v.prototype.getTileByID=function(p){return this._tiles[p]},v.prototype._retainLoadedChildren=function(p,g,S,w){for(var R in this._tiles){var k=this._tiles[R];if(!(w[R]||!k.hasData()||k.tileID.overscaledZ<=g||k.tileID.overscaledZ>S)){for(var $=k.tileID;k&&k.tileID.overscaledZ>g+1;){var oe=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[oe.key])&&k.hasData()&&($=oe)}for(var be=$;be.overscaledZ>g;)if(p[(be=be.scaledTo(be.overscaledZ-1)).key]){w[$.key]=$;break}}}},v.prototype.findLoadedParent=function(p,g){if(p.key in this._loadedParentTiles){var S=this._loadedParentTiles[p.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var w=p.overscaledZ-1;w>=g;w--){var R=p.scaledTo(w),k=this._getLoadedTile(R);if(k)return k}},v.prototype._getLoadedTile=function(p){var g=this._tiles[p.key];return g&&g.hasData()?g:this._cache.getByKey(p.wrapped().key)},v.prototype.updateCacheSize=function(p){var g=Math.ceil(p.width/this._source.tileSize)+1,S=Math.ceil(p.height/this._source.tileSize)+1,w=Math.floor(g*S*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(R)},v.prototype.handleWrapJump=function(p){var g=Math.round((p-(this._prevLng===void 0?p:this._prevLng))/360);if(this._prevLng=p,g){var S={};for(var w in this._tiles){var R=this._tiles[w];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),S[R.tileID.key]=R}for(var k in this._tiles=S,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var $ in this._tiles)this._setTileReloadTimer($,this._tiles[$])}},v.prototype.update=function(p){var g=this;if(this.transform=p,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=p.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Tr){return new y.OverscaledTileID(Tr.canonical.z,Tr.wrap,Tr.canonical.z,Tr.canonical.x,Tr.canonical.y)}):(S=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Tr){return g._source.hasTile(Tr)}))):S=[];var w=p.coveringZoomLevel(this._source),R=Math.max(w-v.maxOverzooming,this._source.minzoom),k=Math.max(w+v.maxUnderzooming,this._source.minzoom),$=this._updateRetainedTiles(S,w);if(lt(this._source.type)){for(var oe={},be={},we=0,Oe=Object.keys($);we<Oe.length;we+=1){var qe=Oe[we],$e=$[qe],vt=this._tiles[qe];if(vt&&!(vt.fadeEndTime&&vt.fadeEndTime<=y.browser.now())){var He=this.findLoadedParent($e,R);He&&(this._addTile(He.tileID),oe[He.tileID.key]=He.tileID),be[qe]=$e}}for(var dt in this._retainLoadedChildren(be,w,k,$),oe)$[dt]||(this._coveredTiles[dt]=!0,$[dt]=oe[dt])}for(var wt in $)this._tiles[wt].clearFadeHold();for(var zt=0,ar=y.keysDifference(this._tiles,$);zt<ar.length;zt+=1){var Qt=ar[zt],hr=this._tiles[Qt];hr.hasSymbolBuckets&&!hr.holdingForFade()?hr.setHoldDuration(this.map._fadeDuration):hr.hasSymbolBuckets&&!hr.symbolFadeFinished()||this._removeTile(Qt)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var p in this._tiles)this._tiles[p].holdingForFade()&&this._removeTile(p)},v.prototype._updateRetainedTiles=function(p,g){for(var S={},w={},R=Math.max(g-v.maxOverzooming,this._source.minzoom),k=Math.max(g+v.maxUnderzooming,this._source.minzoom),$={},oe=0,be=p;oe<be.length;oe+=1){var we=be[oe],Oe=this._addTile(we);S[we.key]=we,Oe.hasData()||g<this._source.maxzoom&&($[we.key]=we)}this._retainLoadedChildren($,g,k,S);for(var qe=0,$e=p;qe<$e.length;qe+=1){var vt=$e[qe],He=this._tiles[vt.key];if(!He.hasData()){if(g+1>this._source.maxzoom){var dt=vt.children(this._source.maxzoom)[0],wt=this.getTile(dt);if(wt&&wt.hasData()){S[dt.key]=dt;continue}}else{var zt=vt.children(this._source.maxzoom);if(S[zt[0].key]&&S[zt[1].key]&&S[zt[2].key]&&S[zt[3].key])continue}for(var ar=He.wasRequested(),Qt=vt.overscaledZ-1;Qt>=R;--Qt){var hr=vt.scaledTo(Qt);if(w[hr.key]||(w[hr.key]=!0,!(He=this.getTile(hr))&&ar&&(He=this._addTile(hr)),He&&(S[hr.key]=hr,ar=He.wasRequested(),He.hasData())))break}}}return S},v.prototype._updateLoadedParentTileCache=function(){for(var p in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,w=this._tiles[p].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){S=this._loadedParentTiles[w.key];break}g.push(w.key);var R=w.scaledTo(w.overscaledZ-1);if(S=this._getLoadedTile(R))break;w=R}for(var k=0,$=g;k<$.length;k+=1)this._loadedParentTiles[$[k]]=S}},v.prototype._addTile=function(p){var g=this._tiles[p.key];if(g)return g;(g=this._cache.getAndRemove(p))&&(this._setTileReloadTimer(p.key,g),g.tileID=p,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[p.key]&&(clearTimeout(this._cacheTimers[p.key]),delete this._cacheTimers[p.key],this._setTileReloadTimer(p.key,g)));var S=!!g;return S||(g=new y.Tile(p,this._source.tileSize*p.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,p.key,g.state))),g?(g.uses++,this._tiles[p.key]=g,S||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},v.prototype._setTileReloadTimer=function(p,g){var S=this;p in this._timers&&(clearTimeout(this._timers[p]),delete this._timers[p]);var w=g.getExpiryTimeout();w&&(this._timers[p]=setTimeout(function(){S._reloadTile(p,"expired"),delete S._timers[p]},w))},v.prototype._removeTile=function(p){var g=this._tiles[p];g&&(g.uses--,delete this._tiles[p],this._timers[p]&&(clearTimeout(this._timers[p]),delete this._timers[p]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},v.prototype.clearTiles=function(){for(var p in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(p);this._cache.reset()},v.prototype.tilesIn=function(p,g,S){var w=this,R=[],k=this.transform;if(!k)return R;for(var $=S?k.getCameraQueryGeometry(p):p,oe=p.map(function(Qt){return k.pointCoordinate(Qt)}),be=$.map(function(Qt){return k.pointCoordinate(Qt)}),we=this.getIds(),Oe=1/0,qe=1/0,$e=-1/0,vt=-1/0,He=0,dt=be;He<dt.length;He+=1){var wt=dt[He];Oe=Math.min(Oe,wt.x),qe=Math.min(qe,wt.y),$e=Math.max($e,wt.x),vt=Math.max(vt,wt.y)}for(var zt=function(Qt){var hr=w._tiles[we[Qt]];if(!hr.holdingForFade()){var Tr=hr.tileID,Yr=Math.pow(2,k.zoom-hr.tileID.overscaledZ),Ur=g*hr.queryPadding*y.EXTENT/hr.tileSize/Yr,_n=[Tr.getTilePoint(new y.MercatorCoordinate(Oe,qe)),Tr.getTilePoint(new y.MercatorCoordinate($e,vt))];if(_n[0].x-Ur<y.EXTENT&&_n[0].y-Ur<y.EXTENT&&_n[1].x+Ur>=0&&_n[1].y+Ur>=0){var Hn=oe.map(function(Wn){return Tr.getTilePoint(Wn)}),Vn=be.map(function(Wn){return Tr.getTilePoint(Wn)});R.push({tile:hr,tileID:Tr,queryGeometry:Hn,cameraQueryGeometry:Vn,scale:Yr})}}},ar=0;ar<we.length;ar++)zt(ar);return R},v.prototype.getVisibleCoordinates=function(p){for(var g=this,S=this.getRenderableIds(p).map(function($){return g._tiles[$].tileID}),w=0,R=S;w<R.length;w+=1){var k=R[w];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return S},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(lt(this._source.type))for(var p in this._tiles){var g=this._tiles[p];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},v.prototype.setFeatureState=function(p,g,S){this._state.updateState(p=p||"_geojsonTileLayer",g,S)},v.prototype.removeFeatureState=function(p,g,S){this._state.removeFeatureState(p=p||"_geojsonTileLayer",g,S)},v.prototype.getFeatureState=function(p,g){return this._state.getState(p=p||"_geojsonTileLayer",g)},v.prototype.setDependencies=function(p,g,S){var w=this._tiles[p];w&&w.setDependencies(g,S)},v.prototype.reloadTilesForDependencies=function(p,g){for(var S in this._tiles)this._tiles[S].hasDependency(p,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(w){return!w.hasDependency(p,g)})},v}(y.Evented);function je(h,v){var p=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*v.wrap)-+(v.wrap<0);return h.overscaledZ-v.overscaledZ||g-p||v.canonical.y-h.canonical.y||v.canonical.x-h.canonical.x}function lt(h){return h==="raster"||h==="image"||h==="video"}function Ie(){return new y.window.Worker(Rh.workerUrl)}ne.maxOverzooming=10,ne.maxUnderzooming=3;var Kt="mapboxgl_preloaded_worker_pool",Er=function(){this.active={}};Er.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<Er.workerCount;)this.workers.push(new Ie);return this.active[h]=!0,this.workers.slice()},Er.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},Er.prototype.isPreloaded=function(){return!!this.active[Kt]},Er.prototype.numActive=function(){return Object.keys(this.active).length};var sn,un=Math.floor(y.browser.hardwareConcurrency/2);function nr(){return sn||(sn=new Er),sn}function Qr(h,v){var p={};for(var g in h)g!=="ref"&&(p[g]=h[g]);return y.refProperties.forEach(function(S){S in v&&(p[S]=v[S])}),p}function Hr(h){h=h.slice();for(var v=Object.create(null),p=0;p<h.length;p++)v[h[p].id]=h[p];for(var g=0;g<h.length;g++)"ref"in h[g]&&(h[g]=Qr(h[g],v[h[g].ref]));return h}Er.workerCount=Math.max(Math.min(un,6),1);var $r={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function oi(h,v,p){p.push({command:$r.addSource,args:[h,v[h]]})}function pn(h,v,p){v.push({command:$r.removeSource,args:[h]}),p[h]=!0}function mi(h,v,p,g){pn(h,p,g),oi(h,v,p)}function Gi(h,v,p){var g;for(g in h[p])if(h[p].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[p][g],v[p][g]))return!1;for(g in v[p])if(v[p].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[p][g],v[p][g]))return!1;return!0}function di(h,v,p,g,S,w){var R;for(R in v=v||{},h=h||{})h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||p.push({command:w,args:[g,R,v[R],S]}));for(R in v)v.hasOwnProperty(R)&&!h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||p.push({command:w,args:[g,R,v[R],S]}))}function zi(h){return h.id}function Ri(h,v){return h[v.id]=v,h}var ss=function(h,v){this.reset(h,v)};ss.prototype.reset=function(h,v){this.points=h||[],this._distances=[0];for(var p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ss.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=y.clamp(h,0,1);for(var v=1,p=this._distances[v],g=h*this.paddedLength+this.padding;p<g&&v<this._distances.length;)p=this._distances[++v];var S=v-1,w=this._distances[S],R=p-w,k=R>0?(g-w)/R:0;return this.points[S].mult(1-k).add(this.points[v].mult(k))};var oa=function(h,v,p){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(h/p),this.yCellCount=Math.ceil(v/p);for(var w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=v,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function La(h,v,p,g,S){var w=y.create();return v?(y.scale(w,w,[1/S,1/S,1]),p||y.rotateZ(w,w,g.angle)):y.multiply(w,g.labelPlaneMatrix,h),w}function Mi(h,v,p,g,S){if(v){var w=y.clone(h);return y.scale(w,w,[S,S,1]),p||y.rotateZ(w,w,-g.angle),w}return g.glCoordMatrix}function yi(h,v){var p=[h.x,h.y,0,1];ca(p,p,v);var g=p[3];return{point:new y.Point(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function Ii(h,v){return .5+h/v*.5}function Ba(h,v){var p=h[0]/h[3],g=h[1]/h[3];return p>=-v[0]&&p<=v[0]&&g>=-v[1]&&g<=v[1]}function vu(h,v,p,g,S,w,R,k){var $=g?h.textSizeData:h.iconSizeData,oe=y.evaluateSizeForZoom($,p.transform.zoom),be=[256/p.width*2+1,256/p.height*2+1],we=g?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;we.clear();for(var Oe=h.lineVertexArray,qe=g?h.text.placedSymbolArray:h.icon.placedSymbolArray,$e=p.transform.width/p.transform.height,vt=!1,He=0;He<qe.length;He++){var dt=qe.get(He);if(dt.hidden||dt.writingMode===y.WritingMode.vertical&&!vt)Fa(dt.numGlyphs,we);else{vt=!1;var wt=[dt.anchorX,dt.anchorY,0,1];if(y.transformMat4(wt,wt,v),Ba(wt,be)){var zt=Ii(p.transform.cameraToCenterDistance,wt[3]),ar=y.evaluateSizeForFeature($,oe,dt),Qt=R?ar/zt:ar*zt,hr=new y.Point(dt.anchorX,dt.anchorY),Tr=yi(hr,S).point,Yr={},Ur=Hl(dt,Qt,!1,k,v,S,w,h.glyphOffsetArray,Oe,we,Tr,hr,Yr,$e);vt=Ur.useVertical,(Ur.notEnoughRoom||vt||Ur.needsFlipping&&Hl(dt,Qt,!0,k,v,S,w,h.glyphOffsetArray,Oe,we,Tr,hr,Yr,$e).notEnoughRoom)&&Fa(dt.numGlyphs,we)}else Fa(dt.numGlyphs,we)}}g?h.text.dynamicLayoutVertexBuffer.updateData(we):h.icon.dynamicLayoutVertexBuffer.updateData(we)}function _a(h,v,p,g,S,w,R,k,$,oe,be){var we=k.glyphStartIndex+k.numGlyphs,Oe=k.lineStartIndex,qe=k.lineStartIndex+k.lineLength,$e=v.getoffsetX(k.glyphStartIndex),vt=v.getoffsetX(we-1),He=Pa(h*$e,p,g,S,w,R,k.segment,Oe,qe,$,oe,be);if(!He)return null;var dt=Pa(h*vt,p,g,S,w,R,k.segment,Oe,qe,$,oe,be);return dt?{first:He,last:dt}:null}function Ia(h,v,p,g){return h===y.WritingMode.horizontal&&Math.abs(p.y-v.y)>Math.abs(p.x-v.x)*g?{useVertical:!0}:(h===y.WritingMode.vertical?v.y<p.y:v.x>p.x)?{needsFlipping:!0}:null}function Hl(h,v,p,g,S,w,R,k,$,oe,be,we,Oe,qe){var $e,vt=v/24,He=h.lineOffsetX*vt,dt=h.lineOffsetY*vt;if(h.numGlyphs>1){var wt=h.glyphStartIndex+h.numGlyphs,zt=h.lineStartIndex,ar=h.lineStartIndex+h.lineLength,Qt=_a(vt,k,He,dt,p,be,we,h,$,w,Oe);if(!Qt)return{notEnoughRoom:!0};var hr=yi(Qt.first.point,R).point,Tr=yi(Qt.last.point,R).point;if(g&&!p){var Yr=Ia(h.writingMode,hr,Tr,qe);if(Yr)return Yr}$e=[Qt.first];for(var Ur=h.glyphStartIndex+1;Ur<wt-1;Ur++)$e.push(Pa(vt*k.getoffsetX(Ur),He,dt,p,be,we,h.segment,zt,ar,$,w,Oe));$e.push(Qt.last)}else{if(g&&!p){var _n=yi(we,S).point,Hn=h.lineStartIndex+h.segment+1,Vn=new y.Point($.getx(Hn),$.gety(Hn)),Wn=yi(Vn,S),Wi=Wn.signedDistanceFromCamera>0?Wn.point:Ho(we,Vn,_n,1,S),Tn=Ia(h.writingMode,_n,Wi,qe);if(Tn)return Tn}var ui=Pa(vt*k.getoffsetX(h.glyphStartIndex),He,dt,p,be,we,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,$,w,Oe);if(!ui)return{notEnoughRoom:!0};$e=[ui]}for(var gi=0,si=$e;gi<si.length;gi+=1){var ni=si[gi];y.addDynamicAttributes(oe,ni.point,ni.angle)}return{}}function Ho(h,v,p,g,S){var w=yi(h.add(h.sub(v)._unit()),S).point,R=p.sub(w);return p.add(R._mult(g/R.mag()))}function Pa(h,v,p,g,S,w,R,k,$,oe,be,we){var Oe=g?h-v:h+v,qe=Oe>0?1:-1,$e=0;g&&(qe*=-1,$e=Math.PI),qe<0&&($e+=Math.PI);for(var vt=qe>0?k+R:k+R+1,He=S,dt=S,wt=0,zt=0,ar=Math.abs(Oe),Qt=[];wt+zt<=ar;){if((vt+=qe)<k||vt>=$)return null;if(dt=He,Qt.push(He),(He=we[vt])===void 0){var hr=new y.Point(oe.getx(vt),oe.gety(vt)),Tr=yi(hr,be);if(Tr.signedDistanceFromCamera>0)He=we[vt]=Tr.point;else{var Yr=vt-qe;He=Ho(wt===0?w:new y.Point(oe.getx(Yr),oe.gety(Yr)),hr,dt,ar-wt+1,be)}}wt+=zt,zt=dt.dist(He)}var Ur=(ar-wt)/zt,_n=He.sub(dt),Hn=_n.mult(Ur)._add(dt);Hn._add(_n._unit()._perp()._mult(p*qe));var Vn=$e+Math.atan2(He.y-dt.y,He.x-dt.x);return Qt.push(Hn),{point:Hn,angle:Vn,path:Qt}}oa.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},oa.prototype.insert=function(h,v,p,g,S){this._forEachCell(v,p,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(v),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(S)},oa.prototype.insertCircle=function(h,v,p,g){this._forEachCell(v-g,p-g,v+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(v),this.circles.push(p),this.circles.push(g)},oa.prototype._insertBoxCell=function(h,v,p,g,S,w){this.boxCells[S].push(w)},oa.prototype._insertCircleCell=function(h,v,p,g,S,w){this.circleCells[S].push(w)},oa.prototype._query=function(h,v,p,g,S,w){if(p<0||h>this.width||g<0||v>this.height)return!S&&[];var R=[];if(h<=0&&v<=0&&this.width<=p&&this.height<=g){if(S)return!0;for(var k=0;k<this.boxKeys.length;k++)R.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var $=0;$<this.circleKeys.length;$++){var oe=this.circles[3*$],be=this.circles[3*$+1],we=this.circles[3*$+2];R.push({key:this.circleKeys[$],x1:oe-we,y1:be-we,x2:oe+we,y2:be+we})}return w?R.filter(w):R}return this._forEachCell(h,v,p,g,this._queryCell,R,{hitTest:S,seenUids:{box:{},circle:{}}},w),S?R.length>0:R},oa.prototype._queryCircle=function(h,v,p,g,S){var w=h-p,R=h+p,k=v-p,$=v+p;if(R<0||w>this.width||$<0||k>this.height)return!g&&[];var oe=[];return this._forEachCell(w,k,R,$,this._queryCellCircle,oe,{hitTest:g,circle:{x:h,y:v,radius:p},seenUids:{box:{},circle:{}}},S),g?oe.length>0:oe},oa.prototype.query=function(h,v,p,g,S){return this._query(h,v,p,g,!1,S)},oa.prototype.hitTest=function(h,v,p,g,S){return this._query(h,v,p,g,!0,S)},oa.prototype.hitTestCircle=function(h,v,p,g){return this._queryCircle(h,v,p,!0,g)},oa.prototype._queryCell=function(h,v,p,g,S,w,R,k){var $=R.seenUids,oe=this.boxCells[S];if(oe!==null)for(var be=this.bboxes,we=0,Oe=oe;we<Oe.length;we+=1){var qe=Oe[we];if(!$.box[qe]){$.box[qe]=!0;var $e=4*qe;if(h<=be[$e+2]&&v<=be[$e+3]&&p>=be[$e+0]&&g>=be[$e+1]&&(!k||k(this.boxKeys[qe]))){if(R.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[qe],x1:be[$e],y1:be[$e+1],x2:be[$e+2],y2:be[$e+3]})}}}var vt=this.circleCells[S];if(vt!==null)for(var He=this.circles,dt=0,wt=vt;dt<wt.length;dt+=1){var zt=wt[dt];if(!$.circle[zt]){$.circle[zt]=!0;var ar=3*zt;if(this._circleAndRectCollide(He[ar],He[ar+1],He[ar+2],h,v,p,g)&&(!k||k(this.circleKeys[zt]))){if(R.hitTest)return w.push(!0),!0;var Qt=He[ar],hr=He[ar+1],Tr=He[ar+2];w.push({key:this.circleKeys[zt],x1:Qt-Tr,y1:hr-Tr,x2:Qt+Tr,y2:hr+Tr})}}}},oa.prototype._queryCellCircle=function(h,v,p,g,S,w,R,k){var $=R.circle,oe=R.seenUids,be=this.boxCells[S];if(be!==null)for(var we=this.bboxes,Oe=0,qe=be;Oe<qe.length;Oe+=1){var $e=qe[Oe];if(!oe.box[$e]){oe.box[$e]=!0;var vt=4*$e;if(this._circleAndRectCollide($.x,$.y,$.radius,we[vt+0],we[vt+1],we[vt+2],we[vt+3])&&(!k||k(this.boxKeys[$e])))return w.push(!0),!0}}var He=this.circleCells[S];if(He!==null)for(var dt=this.circles,wt=0,zt=He;wt<zt.length;wt+=1){var ar=zt[wt];if(!oe.circle[ar]){oe.circle[ar]=!0;var Qt=3*ar;if(this._circlesCollide(dt[Qt],dt[Qt+1],dt[Qt+2],$.x,$.y,$.radius)&&(!k||k(this.circleKeys[ar])))return w.push(!0),!0}}},oa.prototype._forEachCell=function(h,v,p,g,S,w,R,k){for(var $=this._convertToXCellCoord(h),oe=this._convertToYCellCoord(v),be=this._convertToXCellCoord(p),we=this._convertToYCellCoord(g),Oe=$;Oe<=be;Oe++)for(var qe=oe;qe<=we;qe++)if(S.call(this,h,v,p,g,this.xCellCount*qe+Oe,w,R,k))return},oa.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},oa.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},oa.prototype._circlesCollide=function(h,v,p,g,S,w){var R=g-h,k=S-v,$=p+w;return $*$>R*R+k*k},oa.prototype._circleAndRectCollide=function(h,v,p,g,S,w,R){var k=(w-g)/2,$=Math.abs(h-(g+k));if($>k+p)return!1;var oe=(R-S)/2,be=Math.abs(v-(S+oe));if(be>oe+p)return!1;if($<=k||be<=oe)return!0;var we=$-k,Oe=be-oe;return we*we+Oe*Oe<=p*p};var bi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fa(h,v){for(var p=0;p<h;p++){var g=v.length;v.resize(g+4),v.float32.set(bi,3*g)}}function ca(h,v,p){var g=v[0],S=v[1];return h[0]=p[0]*g+p[4]*S+p[12],h[1]=p[1]*g+p[5]*S+p[13],h[3]=p[3]*g+p[7]*S+p[15],h}var Wo=function(h,v,p){v===void 0&&(v=new oa(h.width+200,h.height+200,25)),p===void 0&&(p=new oa(h.width+200,h.height+200,25)),this.transform=h,this.grid=v,this.ignoredGrid=p,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function ma(h,v,p){return v*(y.EXTENT/(h.tileSize*Math.pow(2,p-h.tileID.overscaledZ)))}Wo.prototype.placeCollisionBox=function(h,v,p,g,S){var w=this.projectAndGetPerspectiveRatio(g,h.anchorPointX,h.anchorPointY),R=p*w.perspectiveRatio,k=h.x1*R+w.point.x,$=h.y1*R+w.point.y,oe=h.x2*R+w.point.x,be=h.y2*R+w.point.y;return!this.isInsideGrid(k,$,oe,be)||!v&&this.grid.hitTest(k,$,oe,be,S)?{box:[],offscreen:!1}:{box:[k,$,oe,be],offscreen:this.isOffscreen(k,$,oe,be)}},Wo.prototype.placeCollisionCircles=function(h,v,p,g,S,w,R,k,$,oe,be,we,Oe){var qe=[],$e=new y.Point(v.anchorX,v.anchorY),vt=yi($e,w),He=Ii(this.transform.cameraToCenterDistance,vt.signedDistanceFromCamera),dt=(oe?S/He:S*He)/y.ONE_EM,wt=yi($e,R).point,zt=_a(dt,g,v.lineOffsetX*dt,v.lineOffsetY*dt,!1,wt,$e,v,p,R,{}),ar=!1,Qt=!1,hr=!0;if(zt){for(var Tr=.5*we*He+Oe,Yr=new y.Point(-100,-100),Ur=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),_n=new ss,Hn=zt.first,Vn=zt.last,Wn=[],Wi=Hn.path.length-1;Wi>=1;Wi--)Wn.push(Hn.path[Wi]);for(var Tn=1;Tn<Vn.path.length;Tn++)Wn.push(Vn.path[Tn]);var ui=2.5*Tr;if(k){var gi=Wn.map(function(Vs){return yi(Vs,k)});Wn=gi.some(function(Vs){return Vs.signedDistanceFromCamera<=0})?[]:gi.map(function(Vs){return Vs.point})}var si=[];if(Wn.length>0){for(var ni=Wn[0].clone(),vi=Wn[0].clone(),ii=1;ii<Wn.length;ii++)ni.x=Math.min(ni.x,Wn[ii].x),ni.y=Math.min(ni.y,Wn[ii].y),vi.x=Math.max(vi.x,Wn[ii].x),vi.y=Math.max(vi.y,Wn[ii].y);si=ni.x>=Yr.x&&vi.x<=Ur.x&&ni.y>=Yr.y&&vi.y<=Ur.y?[Wn]:vi.x<Yr.x||ni.x>Ur.x||vi.y<Yr.y||ni.y>Ur.y?[]:y.clipLine([Wn],Yr.x,Yr.y,Ur.x,Ur.y)}for(var Jn=0,Mo=si;Jn<Mo.length;Jn+=1){var no;_n.reset(Mo[Jn],.25*Tr),no=_n.length<=.5*Tr?1:Math.ceil(_n.paddedLength/ui)+1;for(var Io=0;Io<no;Io++){var bo=Io/Math.max(no-1,1),Ka=_n.lerp(bo),io=Ka.x+100,Es=Ka.y+100;qe.push(io,Es,Tr,0);var Ss=io-Tr,hl=Es-Tr,As=io+Tr,lu=Es+Tr;if(hr=hr&&this.isOffscreen(Ss,hl,As,lu),Qt=Qt||this.isInsideGrid(Ss,hl,As,lu),!h&&this.grid.hitTestCircle(io,Es,Tr,be)&&(ar=!0,!$))return{circles:[],offscreen:!1,collisionDetected:ar}}}}return{circles:!$&&ar||!Qt?[]:qe,offscreen:hr,collisionDetected:ar}},Wo.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],p=1/0,g=1/0,S=-1/0,w=-1/0,R=0,k=h;R<k.length;R+=1){var $=k[R],oe=new y.Point($.x+100,$.y+100);p=Math.min(p,oe.x),g=Math.min(g,oe.y),S=Math.max(S,oe.x),w=Math.max(w,oe.y),v.push(oe)}for(var be={},we={},Oe=0,qe=this.grid.query(p,g,S,w).concat(this.ignoredGrid.query(p,g,S,w));Oe<qe.length;Oe+=1){var $e=qe[Oe],vt=$e.key;if(be[vt.bucketInstanceId]===void 0&&(be[vt.bucketInstanceId]={}),!be[vt.bucketInstanceId][vt.featureIndex]){var He=[new y.Point($e.x1,$e.y1),new y.Point($e.x2,$e.y1),new y.Point($e.x2,$e.y2),new y.Point($e.x1,$e.y2)];y.polygonIntersectsPolygon(v,He)&&(be[vt.bucketInstanceId][vt.featureIndex]=!0,we[vt.bucketInstanceId]===void 0&&(we[vt.bucketInstanceId]=[]),we[vt.bucketInstanceId].push(vt.featureIndex))}}return we},Wo.prototype.insertCollisionBox=function(h,v,p,g,S){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:S},h[0],h[1],h[2],h[3])},Wo.prototype.insertCollisionCircles=function(h,v,p,g,S){for(var w=v?this.ignoredGrid:this.grid,R={bucketInstanceId:p,featureIndex:g,collisionGroupID:S},k=0;k<h.length;k+=4)w.insertCircle(R,h[k],h[k+1],h[k+2])},Wo.prototype.projectAndGetPerspectiveRatio=function(h,v,p){var g=[v,p,0,1];return ca(g,g,h),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Wo.prototype.isOffscreen=function(h,v,p,g){return p<100||h>=this.screenRightBoundary||g<100||v>this.screenBottomBoundary},Wo.prototype.isInsideGrid=function(h,v,p,g){return p>=0&&h<this.gridRightBoundary&&g>=0&&v<this.gridBottomBoundary},Wo.prototype.getViewportMatrix=function(){var h=y.identity([]);return y.translate(h,h,[-100,-100,0]),h};var us=function(h,v,p,g){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?v:-v))):g&&p?1:0,this.placed=p};us.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Qo=function(h,v,p,g,S){this.text=new us(h?h.text:null,v,p,S),this.icon=new us(h?h.icon:null,v,g,S)};Qo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Bu=function(h,v,p){this.text=h,this.icon=v,this.skipFade=p},gs=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},xc=function(h,v,p,g,S){this.bucketInstanceId=h,this.featureIndex=v,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=S},Ra=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function sa(h,v,p,g,S){var w=y.getAnchorAlignment(h),R=-(w.horizontalAlign-.5)*v,k=-(w.verticalAlign-.5)*p,$=y.evaluateVariableOffset(h,g);return new y.Point(R+$[0]*S,k+$[1]*S)}function er(h,v,p,g,S,w){var R=h.x1,k=h.x2,$=h.y1,oe=h.y2,be=h.anchorPointX,we=h.anchorPointY,Oe=new y.Point(v,p);return g&&Oe._rotate(S?w:-w),{x1:R+Oe.x,y1:$+Oe.y,x2:k+Oe.x,y2:oe+Oe.y,anchorPointX:be,anchorPointY:we}}Ra.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var v=++this.maxGroupID;this.collisionGroups[h]={ID:v,predicate:function(p){return p.collisionGroupID===v}}}return this.collisionGroups[h]};var Rn=function(h,v,p,g){this.transform=h.clone(),this.collisionIndex=new Wo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new Ra(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function Ee(h,v,p,g,S){h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0)}Rn.prototype.getBucketParts=function(h,v,p,g){var S=p.getBucket(v),w=p.latestFeatureIndex;if(S&&w&&v.id===S.layerIds[0]){var R=p.collisionBoxArray,k=S.layers[0].layout,$=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),oe=p.tileSize/y.EXTENT,be=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),we=k.get("text-pitch-alignment")==="map",Oe=k.get("text-rotation-alignment")==="map",qe=ma(p,1,this.transform.zoom),$e=La(be,we,Oe,this.transform,qe),vt=null;if(we){var He=Mi(be,we,Oe,this.transform,qe);vt=y.multiply([],this.transform.labelPlaneMatrix,He)}this.retainedQueryData[S.bucketInstanceId]=new xc(S.bucketInstanceId,w,S.sourceLayerIndex,S.index,p.tileID);var dt={bucket:S,layout:k,posMatrix:be,textLabelPlaneMatrix:$e,labelToScreenMatrix:vt,scale:$,textPixelRatio:oe,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var wt=0,zt=S.sortKeyRanges;wt<zt.length;wt+=1){var ar=zt[wt];h.push({sortKey:ar.sortKey,symbolInstanceStart:ar.symbolInstanceStart,symbolInstanceEnd:ar.symbolInstanceEnd,parameters:dt})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:dt})}},Rn.prototype.attemptAnchorPlacement=function(h,v,p,g,S,w,R,k,$,oe,be,we,Oe,qe,$e){var vt,He=[we.textOffset0,we.textOffset1],dt=sa(h,p,g,He,S),wt=this.collisionIndex.placeCollisionBox(er(v,dt.x,dt.y,w,R,this.transform.angle),be,k,$,oe.predicate);if(!$e||this.collisionIndex.placeCollisionBox(er($e,dt.x,dt.y,w,R,this.transform.angle),be,k,$,oe.predicate).box.length!==0)return wt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(vt=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:He,width:p,height:g,anchor:h,textBoxScale:S,prevAnchor:vt},this.markUsedJustification(Oe,h,we,qe),Oe.allowVerticalPlacement&&(this.markUsedOrientation(Oe,qe,we),this.placedOrientations[we.crossTileID]=qe),{shift:dt,placedGlyphBoxes:wt}):void 0},Rn.prototype.placeLayerBucketPart=function(h,v,p){var g=this,S=h.parameters,w=S.bucket,R=S.layout,k=S.posMatrix,$=S.textLabelPlaneMatrix,oe=S.labelToScreenMatrix,be=S.textPixelRatio,we=S.holdingForFade,Oe=S.collisionBoxArray,qe=S.partiallyEvaluatedTextSize,$e=S.collisionGroup,vt=R.get("text-optional"),He=R.get("icon-optional"),dt=R.get("text-allow-overlap"),wt=R.get("icon-allow-overlap"),zt=R.get("text-rotation-alignment")==="map",ar=R.get("text-pitch-alignment")==="map",Qt=R.get("icon-text-fit")!=="none",hr=R.get("symbol-z-order")==="viewport-y",Tr=dt&&(wt||!w.hasIconData()||He),Yr=wt&&(dt||!w.hasTextData()||vt);!w.collisionArrays&&Oe&&w.deserializeCollisionBoxes(Oe);var Ur=function(Tn,ui){if(!v[Tn.crossTileID])if(we)g.placements[Tn.crossTileID]=new Bu(!1,!1,!1);else{var gi,si=!1,ni=!1,vi=!0,ii=null,Jn={box:null,offscreen:null},Mo={box:null,offscreen:null},no=null,Io=null,bo=0,Ka=0,io=0;ui.textFeatureIndex?bo=ui.textFeatureIndex:Tn.useRuntimeCollisionCircles&&(bo=Tn.featureIndex),ui.verticalTextFeatureIndex&&(Ka=ui.verticalTextFeatureIndex);var Es=ui.textBox;if(Es){var Ss=function(Vi){var ts=y.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Vi&&g.prevPlacement){var co=g.prevPlacement.placedOrientations[Tn.crossTileID];co&&(g.placedOrientations[Tn.crossTileID]=co,g.markUsedOrientation(w,ts=co,Tn))}return ts},hl=function(Vi,ts){if(w.allowVerticalPlacement&&Tn.numVerticalGlyphVertices>0&&ui.verticalTextBox)for(var co=0,hu=w.writingModes;co<hu.length&&(hu[co]===y.WritingMode.vertical?(Jn=ts(),Mo=Jn):Jn=Vi(),!(Jn&&Jn.box&&Jn.box.length));co+=1);else Jn=Vi()};if(R.get("text-variable-anchor")){var As=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[Tn.crossTileID]){var lu=g.prevPlacement.variableOffsets[Tn.crossTileID];As.indexOf(lu.anchor)>0&&(As=As.filter(function(Vi){return Vi!==lu.anchor})).unshift(lu.anchor)}var Vs=function(Vi,ts,co){for(var hu=Vi.x2-Vi.x1,kc=Vi.y2-Vi.y1,$u=Tn.textBoxScale,Mh=Qt&&!wt?ts:null,Oo={box:[],offscreen:!1},Br=dt?2*As.length:As.length,js=0;js<Br;++js){var Ih=g.attemptAnchorPlacement(As[js%As.length],Vi,hu,kc,$u,zt,ar,be,k,$e,js>=As.length,Tn,w,co,Mh);if(Ih&&(Oo=Ih.placedGlyphBoxes)&&Oo.box&&Oo.box.length){si=!0,ii=Ih.shift;break}}return Oo};hl(function(){return Vs(Es,ui.iconBox,y.WritingMode.horizontal)},function(){var Vi=ui.verticalTextBox;return w.allowVerticalPlacement&&!(Jn&&Jn.box&&Jn.box.length)&&Tn.numVerticalGlyphVertices>0&&Vi?Vs(Vi,ui.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),Jn&&(si=Jn.box,vi=Jn.offscreen);var Oc=Ss(Jn&&Jn.box);if(!si&&g.prevPlacement){var Xu=g.prevPlacement.variableOffsets[Tn.crossTileID];Xu&&(g.variableOffsets[Tn.crossTileID]=Xu,g.markUsedJustification(w,Xu.anchor,Tn,Oc))}}else{var Tu=function(Vi,ts){var co=g.collisionIndex.placeCollisionBox(Vi,dt,be,k,$e.predicate);return co&&co.box&&co.box.length&&(g.markUsedOrientation(w,ts,Tn),g.placedOrientations[Tn.crossTileID]=ts),co};hl(function(){return Tu(Es,y.WritingMode.horizontal)},function(){var Vi=ui.verticalTextBox;return w.allowVerticalPlacement&&Tn.numVerticalGlyphVertices>0&&Vi?Tu(Vi,y.WritingMode.vertical):{box:null,offscreen:null}}),Ss(Jn&&Jn.box&&Jn.box.length)}}if(si=(gi=Jn)&&gi.box&&gi.box.length>0,vi=gi&&gi.offscreen,Tn.useRuntimeCollisionCircles){var rc=w.text.placedSymbolArray.get(Tn.centerJustifiedTextSymbolIndex),pl=y.evaluateSizeForFeature(w.textSizeData,qe,rc),cu=R.get("text-padding");no=g.collisionIndex.placeCollisionCircles(dt,rc,w.lineVertexArray,w.glyphOffsetArray,pl,k,$,oe,p,ar,$e.predicate,Tn.collisionCircleDiameter,cu),si=dt||no.circles.length>0&&!no.collisionDetected,vi=vi&&no.offscreen}if(ui.iconFeatureIndex&&(io=ui.iconFeatureIndex),ui.iconBox){var dl=function(Vi){var ts=Qt&&ii?er(Vi,ii.x,ii.y,zt,ar,g.transform.angle):Vi;return g.collisionIndex.placeCollisionBox(ts,wt,be,k,$e.predicate)};ni=Mo&&Mo.box&&Mo.box.length&&ui.verticalIconBox?(Io=dl(ui.verticalIconBox)).box.length>0:(Io=dl(ui.iconBox)).box.length>0,vi=vi&&Io.offscreen}var Po=vt||Tn.numHorizontalGlyphVertices===0&&Tn.numVerticalGlyphVertices===0,lo=He||Tn.numIconVertices===0;if(Po||lo?lo?Po||(ni=ni&&si):si=ni&&si:ni=si=ni&&si,si&&gi&&gi.box&&g.collisionIndex.insertCollisionBox(gi.box,R.get("text-ignore-placement"),w.bucketInstanceId,Mo&&Mo.box&&Ka?Ka:bo,$e.ID),ni&&Io&&g.collisionIndex.insertCollisionBox(Io.box,R.get("icon-ignore-placement"),w.bucketInstanceId,io,$e.ID),no&&(si&&g.collisionIndex.insertCollisionCircles(no.circles,R.get("text-ignore-placement"),w.bucketInstanceId,bo,$e.ID),p)){var Ms=w.bucketInstanceId,fu=g.collisionCircleArrays[Ms];fu===void 0&&(fu=g.collisionCircleArrays[Ms]=new gs);for(var wu=0;wu<no.circles.length;wu+=4)fu.circles.push(no.circles[wu+0]),fu.circles.push(no.circles[wu+1]),fu.circles.push(no.circles[wu+2]),fu.circles.push(no.collisionDetected?1:0)}g.placements[Tn.crossTileID]=new Bu(si||Tr,ni||Yr,vi||w.justReloaded),v[Tn.crossTileID]=!0}};if(hr)for(var _n=w.getSortedSymbolIndexes(this.transform.angle),Hn=_n.length-1;Hn>=0;--Hn){var Vn=_n[Hn];Ur(w.symbolInstances.get(Vn),w.collisionArrays[Vn])}else for(var Wn=h.symbolInstanceStart;Wn<h.symbolInstanceEnd;Wn++)Ur(w.symbolInstances.get(Wn),w.collisionArrays[Wn]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){var Wi=this.collisionCircleArrays[w.bucketInstanceId];y.invert(Wi.invProjMatrix,k),Wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Rn.prototype.markUsedJustification=function(h,v,p,g){var S;S=g===y.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(v)];for(var w=0,R=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];w<R.length;w+=1){var k=R[w];k>=0&&(h.text.placedSymbolArray.get(k).crossTileID=S>=0&&k!==S?0:p.crossTileID)}},Rn.prototype.markUsedOrientation=function(h,v,p){for(var g=v===y.WritingMode.horizontal||v===y.WritingMode.horizontalOnly?v:0,S=v===y.WritingMode.vertical?v:0,w=0,R=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];w<R.length;w+=1)h.text.placedSymbolArray.get(R[w]).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=S)},Rn.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,p=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var g=v?v.symbolFadeChange(h):1,S=v?v.opacities:{},w=v?v.variableOffsets:{},R=v?v.placedOrientations:{};for(var k in this.placements){var $=this.placements[k],oe=S[k];oe?(this.opacities[k]=new Qo(oe,g,$.text,$.icon),p=p||$.text!==oe.text.placed||$.icon!==oe.icon.placed):(this.opacities[k]=new Qo(null,g,$.text,$.icon,$.skipFade),p=p||$.text||$.icon)}for(var be in S){var we=S[be];if(!this.opacities[be]){var Oe=new Qo(we,g,!1,!1);Oe.isHidden()||(this.opacities[be]=Oe,p=p||we.text.placed||we.icon.placed)}}for(var qe in w)this.variableOffsets[qe]||!this.opacities[qe]||this.opacities[qe].isHidden()||(this.variableOffsets[qe]=w[qe]);for(var $e in R)this.placedOrientations[$e]||!this.opacities[$e]||this.opacities[$e].isHidden()||(this.placedOrientations[$e]=R[$e]);p?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:h)},Rn.prototype.updateLayerOpacities=function(h,v){for(var p={},g=0,S=v;g<S.length;g+=1){var w=S[g],R=w.getBucket(h);R&&w.latestFeatureIndex&&h.id===R.layerIds[0]&&this.updateBucketOpacities(R,p,w.collisionBoxArray)}},Rn.prototype.updateBucketOpacities=function(h,v,p){var g=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var S=h.layers[0].layout,w=new Qo(null,0,!1,!1,!0),R=S.get("text-allow-overlap"),k=S.get("icon-allow-overlap"),$=S.get("text-variable-anchor"),oe=S.get("text-rotation-alignment")==="map",be=S.get("text-pitch-alignment")==="map",we=S.get("icon-text-fit")!=="none",Oe=new Qo(null,0,R&&(k||!h.hasIconData()||S.get("icon-optional")),k&&(R||!h.hasTextData()||S.get("text-optional")),!0);!h.collisionArrays&&p&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(p);for(var qe=function(dt,wt,zt){for(var ar=0;ar<wt/4;ar++)dt.opacityVertexArray.emplaceBack(zt)},$e=function(dt){var wt=h.symbolInstances.get(dt),zt=wt.numHorizontalGlyphVertices,ar=wt.numVerticalGlyphVertices,Qt=wt.crossTileID,hr=g.opacities[Qt];v[Qt]?hr=w:hr||(g.opacities[Qt]=hr=Oe),v[Qt]=!0;var Tr=wt.numIconVertices>0,Yr=g.placedOrientations[wt.crossTileID],Ur=Yr===y.WritingMode.vertical,_n=Yr===y.WritingMode.horizontal||Yr===y.WritingMode.horizontalOnly;if(zt>0||ar>0){var Hn=wo(hr.text);qe(h.text,zt,Ur?vo:Hn),qe(h.text,ar,_n?vo:Hn);var Vn=hr.text.isHidden();[wt.rightJustifiedTextSymbolIndex,wt.centerJustifiedTextSymbolIndex,wt.leftJustifiedTextSymbolIndex].forEach(function(Jn){Jn>=0&&(h.text.placedSymbolArray.get(Jn).hidden=Vn||Ur?1:0)}),wt.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(wt.verticalPlacedTextSymbolIndex).hidden=Vn||_n?1:0);var Wn=g.variableOffsets[wt.crossTileID];Wn&&g.markUsedJustification(h,Wn.anchor,wt,Yr);var Wi=g.placedOrientations[wt.crossTileID];Wi&&(g.markUsedJustification(h,"left",wt,Wi),g.markUsedOrientation(h,Wi,wt))}if(Tr){var Tn=wo(hr.icon),ui=!(we&&wt.verticalPlacedIconSymbolIndex&&Ur);wt.placedIconSymbolIndex>=0&&(qe(h.icon,wt.numIconVertices,ui?Tn:vo),h.icon.placedSymbolArray.get(wt.placedIconSymbolIndex).hidden=hr.icon.isHidden()),wt.verticalPlacedIconSymbolIndex>=0&&(qe(h.icon,wt.numVerticalIconVertices,ui?vo:Tn),h.icon.placedSymbolArray.get(wt.verticalPlacedIconSymbolIndex).hidden=hr.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var gi=h.collisionArrays[dt];if(gi){var si=new y.Point(0,0);if(gi.textBox||gi.verticalTextBox){var ni=!0;if($){var vi=g.variableOffsets[Qt];vi?(si=sa(vi.anchor,vi.width,vi.height,vi.textOffset,vi.textBoxScale),oe&&si._rotate(be?g.transform.angle:-g.transform.angle)):ni=!1}gi.textBox&&Ee(h.textCollisionBox.collisionVertexArray,hr.text.placed,!ni||Ur,si.x,si.y),gi.verticalTextBox&&Ee(h.textCollisionBox.collisionVertexArray,hr.text.placed,!ni||_n,si.x,si.y)}var ii=!!(!_n&&gi.verticalIconBox);gi.iconBox&&Ee(h.iconCollisionBox.collisionVertexArray,hr.icon.placed,ii,we?si.x:0,we?si.y:0),gi.verticalIconBox&&Ee(h.iconCollisionBox.collisionVertexArray,hr.icon.placed,!ii,we?si.x:0,we?si.y:0)}}},vt=0;vt<h.symbolInstances.length;vt++)$e(vt);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var He=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=He.invProjMatrix,h.placementViewportMatrix=He.viewportMatrix,h.collisionCircleArray=He.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},Rn.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Rn.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},Rn.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},Rn.prototype.stillRecent=function(h,v){var p=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*p>h},Rn.prototype.setStale=function(){this.stale=!0};var Ne=Math.pow(2,25),Tt=Math.pow(2,24),fr=Math.pow(2,17),tn=Math.pow(2,16),Bn=Math.pow(2,9),Xi=Math.pow(2,8),yo=Math.pow(2,1);function wo(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var v=h.placed?1:0,p=Math.floor(127*h.opacity);return p*Ne+v*Tt+p*fr+v*tn+p*Bn+v*Xi+p*yo+v}var vo=0,Bs=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Bs.prototype.continuePlacement=function(h,v,p,g,S){for(var w=this._bucketParts;this._currentTileIndex<h.length;)if(v.getBucketParts(w,g,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(R,k){return R.sortKey-k.sortKey}));this._currentPartIndex<w.length;)if(v.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,S())return!0;return!1};var Rs=function(h,v,p,g,S,w,R){this.placement=new Rn(h,S,w,R),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1};Rs.prototype.isDone=function(){return this._done},Rs.prototype.continuePlacement=function(h,v,p){for(var g=this,S=y.browser.now(),w=function(){var $=y.browser.now()-S;return!g._forceFullPlacement&&$>2};this._currentPlacementIndex>=0;){var R=v[h[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=k)&&(!R.maxzoom||R.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Bs(R)),this._inProgressLayer.continuePlacement(p[R.source],this.placement,this._showCollisionBoxes,R,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Rs.prototype.commit=function(h){return this.placement.commit(h),this.placement};var ep=512/y.EXTENT/2,Sf=function(h,v,p){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(var g=0;g<v.length;g++){var S=v.get(g),w=S.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,h)})}};Sf.prototype.getScaledCoordinates=function(h,v){var p=ep/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*y.EXTENT+h.anchorX)*p),y:Math.floor((v.canonical.y*y.EXTENT+h.anchorY)*p)}},Sf.prototype.findMatches=function(h,v,p){for(var g=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),S=0;S<h.length;S++){var w=h.get(S);if(!w.crossTileID){var R=this.indexedSymbolInstances[w.key];if(R)for(var k=this.getScaledCoordinates(w,v),$=0,oe=R;$<oe.length;$+=1){var be=oe[$];if(Math.abs(be.coord.x-k.x)<=g&&Math.abs(be.coord.y-k.y)<=g&&!p[be.crossTileID]){p[be.crossTileID]=!0,w.crossTileID=be.crossTileID;break}}}}};var Jo=function(){this.maxCrossTileID=0};Jo.prototype.generate=function(){return++this.maxCrossTileID};var Tl=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Tl.prototype.handleWrapJump=function(h){var v=Math.round((h-this.lng)/360);if(v!==0)for(var p in this.indexes){var g=this.indexes[p],S={};for(var w in g){var R=g[w];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+v),S[R.tileID.key]=R}this.indexes[p]=S}this.lng=h},Tl.prototype.addBucket=function(h,v,p){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var g=0;g<v.symbolInstances.length;g++)v.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var S=this.usedCrossTileIDs[h.overscaledZ];for(var w in this.indexes){var R=this.indexes[w];if(Number(w)>h.overscaledZ)for(var k in R){var $=R[k];$.tileID.isChildOf(h)&&$.findMatches(v.symbolInstances,h,S)}else{var oe=R[h.scaledTo(Number(w)).key];oe&&oe.findMatches(v.symbolInstances,h,S)}}for(var be=0;be<v.symbolInstances.length;be++){var we=v.symbolInstances.get(be);we.crossTileID||(we.crossTileID=p.generate(),S[we.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Sf(h,v.symbolInstances,v.bucketInstanceId),!0},Tl.prototype.removeBucketCrossTileIDs=function(h,v){for(var p in v.indexedSymbolInstances)for(var g=0,S=v.indexedSymbolInstances[p];g<S.length;g+=1)delete this.usedCrossTileIDs[h][S[g].crossTileID]},Tl.prototype.removeStaleBuckets=function(h){var v=!1;for(var p in this.indexes){var g=this.indexes[p];for(var S in g)h[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[S]),delete g[S],v=!0)}return v};var wl=function(){this.layerIndexes={},this.crossTileIDs=new Jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};wl.prototype.addLayer=function(h,v,p){var g=this.layerIndexes[h.id];g===void 0&&(g=this.layerIndexes[h.id]=new Tl);var S=!1,w={};g.handleWrapJump(p);for(var R=0,k=v;R<k.length;R+=1){var $=k[R],oe=$.getBucket(h);oe&&h.id===oe.layerIds[0]&&(oe.bucketInstanceId||(oe.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket($.tileID,oe,this.crossTileIDs)&&(S=!0),w[oe.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(S=!0),S},wl.prototype.pruneUnusedLayers=function(h){var v={};for(var p in h.forEach(function(g){v[g]=!0}),this.layerIndexes)v[p]||delete this.layerIndexes[p]};var Fu=function(h,v){return y.emitValidationErrors(h,v&&v.filter(function(p){return p.identifier!=="source.canvas"}))},Nu=y.pick($r,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),el=y.pick($r,["setCenter","setZoom","setBearing","setPitch"]),qc=function(){var h={},v=y.styleSpec.$version;for(var p in y.styleSpec.$root){var g,S=y.styleSpec.$root[p];S.required&&(g=p==="version"?v:S.type==="array"?[]:{})!=null&&(h[p]=g)}return h}(),Fs=function(h){function v(p,g){var S=this;g===void 0&&(g={}),h.call(this),this.map=p,this.dispatcher=new Vt(nr(),this),this.imageManager=new St,this.imageManager.setEventedParent(this),this.glyphManager=new cr(p._requestManager,g.localIdeographFontFamily),this.lineAtlas=new Ve(256,512),this.crossTileSymbolIndex=new wl,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var w=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(R){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(k,$){if(y.triggerPluginCompletionEvent(k),$&&$.every(function(be){return be}))for(var oe in w.sourceCaches)w.sourceCaches[oe].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var k=S.sourceCaches[R.sourceId];if(k){var $=k.getSource();if($&&$.vectorLayerIds)for(var oe in S._layers){var be=S._layers[oe];be.source===$.id&&S._validateLayer(be)}}}})}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.loadURL=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var w=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,g.accessToken);var R=this.map._requestManager.transformRequest(p,y.ResourceType.Style);this._request=y.getJSON(R,function(k,$){S._request=null,k?S.fire(new y.ErrorEvent(k)):$&&S._load($,w)})},v.prototype.loadJSON=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(p,g.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(qc,!1)},v.prototype._load=function(p,g){if(!g||!Fu(this,y.validateStyle(p))){for(var S in this._loaded=!0,this.stylesheet=p,p.sources)this.addSource(S,p.sources[S],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs);var w=Hr(this.stylesheet.layers);this._order=w.map(function(oe){return oe.id}),this._layers={},this._serializedLayers={};for(var R=0,k=w;R<k.length;R+=1){var $=k[R];($=y.createStyleLayer($)).setEventedParent(this,{layer:{id:$.id}}),this._layers[$.id]=$,this._serializedLayers[$.id]=$.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Rt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},v.prototype._loadSprite=function(p){var g=this;this._spriteRequest=function(S,w,R){var k,$,oe,be=y.browser.devicePixelRatio>1?"@2x":"",we=y.getJSON(w.transformRequest(w.normalizeSpriteURL(S,be,".json"),y.ResourceType.SpriteJSON),function($e,vt){we=null,oe||(oe=$e,k=vt,qe())}),Oe=y.getImage(w.transformRequest(w.normalizeSpriteURL(S,be,".png"),y.ResourceType.SpriteImage),function($e,vt){Oe=null,oe||(oe=$e,$=vt,qe())});function qe(){if(oe)R(oe);else if(k&&$){var $e=y.browser.getImageData($),vt={};for(var He in k){var dt=k[He],wt=dt.width,zt=dt.height,ar=dt.x,Qt=dt.y,hr=dt.sdf,Tr=dt.pixelRatio,Yr=dt.stretchX,Ur=dt.stretchY,_n=dt.content,Hn=new y.RGBAImage({width:wt,height:zt});y.RGBAImage.copy($e,Hn,{x:ar,y:Qt},{x:0,y:0},{width:wt,height:zt}),vt[He]={data:Hn,pixelRatio:Tr,sdf:hr,stretchX:Yr,stretchY:Ur,content:_n}}R(null,vt)}}return{cancel:function(){we&&(we.cancel(),we=null),Oe&&(Oe.cancel(),Oe=null)}}}(p,this.map._requestManager,function(S,w){if(g._spriteRequest=null,S)g.fire(new y.ErrorEvent(S));else if(w)for(var R in w)g.imageManager.addImage(R,w[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(p){var g=this.sourceCaches[p.source];if(g){var S=p.sourceLayer;if(S){var w=g.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+w.id+'" as specified by style layer "'+p.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var p in this.sourceCaches)if(!this.sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(p){for(var g=[],S=0,w=p;S<w.length;S+=1){var R=this._layers[w[S]];R.type!=="custom"&&g.push(R.serialize())}return g},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(p){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var R in(S.length||w.length)&&this._updateWorkerLayers(S,w),this._updatedSources){var k=this._updatedSources[R];k==="reload"?this._reloadSource(R):k==="clear"&&this._clearSource(R)}for(var $ in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[$].updateTransitions(p);this.light.updateTransitions(p),this._resetUpdates()}var oe={};for(var be in this.sourceCaches){var we=this.sourceCaches[be];oe[be]=we.used,we.used=!1}for(var Oe=0,qe=this._order;Oe<qe.length;Oe+=1){var $e=this._layers[qe[Oe]];$e.recalculate(p,this._availableImages),!$e.isHidden(p.zoom)&&$e.source&&(this.sourceCaches[$e.source].used=!0)}for(var vt in oe){var He=this.sourceCaches[vt];oe[vt]!==He.used&&He.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:vt}))}this.light.recalculate(p),this.z=p.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var p=Object.keys(this._changedImages);if(p.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}},v.prototype._updateWorkerLayers=function(p,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:g})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(p){var g=this;if(this._checkLoaded(),Fu(this,y.validateStyle(p)))return!1;(p=y.clone$1(p)).layers=Hr(p.layers);var S=function(R,k){if(!R)return[{command:$r.setStyle,args:[k]}];var $=[];try{if(!y.deepEqual(R.version,k.version))return[{command:$r.setStyle,args:[k]}];y.deepEqual(R.center,k.center)||$.push({command:$r.setCenter,args:[k.center]}),y.deepEqual(R.zoom,k.zoom)||$.push({command:$r.setZoom,args:[k.zoom]}),y.deepEqual(R.bearing,k.bearing)||$.push({command:$r.setBearing,args:[k.bearing]}),y.deepEqual(R.pitch,k.pitch)||$.push({command:$r.setPitch,args:[k.pitch]}),y.deepEqual(R.sprite,k.sprite)||$.push({command:$r.setSprite,args:[k.sprite]}),y.deepEqual(R.glyphs,k.glyphs)||$.push({command:$r.setGlyphs,args:[k.glyphs]}),y.deepEqual(R.transition,k.transition)||$.push({command:$r.setTransition,args:[k.transition]}),y.deepEqual(R.light,k.light)||$.push({command:$r.setLight,args:[k.light]});var oe={},be=[];(function(Oe,qe,$e,vt){var He;for(He in qe=qe||{},Oe=Oe||{})Oe.hasOwnProperty(He)&&(qe.hasOwnProperty(He)||pn(He,$e,vt));for(He in qe)qe.hasOwnProperty(He)&&(Oe.hasOwnProperty(He)?y.deepEqual(Oe[He],qe[He])||(Oe[He].type==="geojson"&&qe[He].type==="geojson"&&Gi(Oe,qe,He)?$e.push({command:$r.setGeoJSONSourceData,args:[He,qe[He].data]}):mi(He,qe,$e,vt)):oi(He,qe,$e))})(R.sources,k.sources,be,oe);var we=[];R.layers&&R.layers.forEach(function(Oe){oe[Oe.source]?$.push({command:$r.removeLayer,args:[Oe.id]}):we.push(Oe)}),$=$.concat(be),function(Oe,qe,$e){qe=qe||[];var vt,He,dt,wt,zt,ar,Qt,hr=(Oe=Oe||[]).map(zi),Tr=qe.map(zi),Yr=Oe.reduce(Ri,{}),Ur=qe.reduce(Ri,{}),_n=hr.slice(),Hn=Object.create(null);for(vt=0,He=0;vt<hr.length;vt++)Ur.hasOwnProperty(dt=hr[vt])?He++:($e.push({command:$r.removeLayer,args:[dt]}),_n.splice(_n.indexOf(dt,He),1));for(vt=0,He=0;vt<Tr.length;vt++)_n[_n.length-1-vt]!==(dt=Tr[Tr.length-1-vt])&&(Yr.hasOwnProperty(dt)?($e.push({command:$r.removeLayer,args:[dt]}),_n.splice(_n.lastIndexOf(dt,_n.length-He),1)):He++,$e.push({command:$r.addLayer,args:[Ur[dt],ar=_n[_n.length-vt]]}),_n.splice(_n.length-vt,0,dt),Hn[dt]=!0);for(vt=0;vt<Tr.length;vt++)if(wt=Yr[dt=Tr[vt]],zt=Ur[dt],!Hn[dt]&&!y.deepEqual(wt,zt))if(y.deepEqual(wt.source,zt.source)&&y.deepEqual(wt["source-layer"],zt["source-layer"])&&y.deepEqual(wt.type,zt.type)){for(Qt in di(wt.layout,zt.layout,$e,dt,null,$r.setLayoutProperty),di(wt.paint,zt.paint,$e,dt,null,$r.setPaintProperty),y.deepEqual(wt.filter,zt.filter)||$e.push({command:$r.setFilter,args:[dt,zt.filter]}),y.deepEqual(wt.minzoom,zt.minzoom)&&y.deepEqual(wt.maxzoom,zt.maxzoom)||$e.push({command:$r.setLayerZoomRange,args:[dt,zt.minzoom,zt.maxzoom]}),wt)wt.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?di(wt[Qt],zt[Qt],$e,dt,Qt.slice(6),$r.setPaintProperty):y.deepEqual(wt[Qt],zt[Qt])||$e.push({command:$r.setLayerProperty,args:[dt,Qt,zt[Qt]]}));for(Qt in zt)zt.hasOwnProperty(Qt)&&!wt.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?di(wt[Qt],zt[Qt],$e,dt,Qt.slice(6),$r.setPaintProperty):y.deepEqual(wt[Qt],zt[Qt])||$e.push({command:$r.setLayerProperty,args:[dt,Qt,zt[Qt]]}))}else $e.push({command:$r.removeLayer,args:[dt]}),ar=_n[_n.lastIndexOf(dt)+1],$e.push({command:$r.addLayer,args:[zt,ar]})}(we,k.layers,$)}catch(Oe){console.warn("Unable to compute style diff:",Oe),$=[{command:$r.setStyle,args:[k]}]}return $}(this.serialize(),p).filter(function(R){return!(R.command in el)});if(S.length===0)return!1;var w=S.filter(function(R){return!(R.command in Nu)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(R){return R.command}).join(", ")+".");return S.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=p,!0},v.prototype.addImage=function(p,g){if(this.getImage(p))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(p,g),this._afterImageUpdated(p)},v.prototype.updateImage=function(p,g){this.imageManager.updateImage(p,g)},v.prototype.getImage=function(p){return this.imageManager.getImage(p)},v.prototype.removeImage=function(p){if(!this.getImage(p))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(p),this._afterImageUpdated(p)},v.prototype._afterImageUpdated=function(p){this._availableImages=this.imageManager.listImages(),this._changedImages[p]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(p,g,S){var w=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[p]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+p,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[p]=new ne(p,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:R.serialize(),sourceId:p}}),R.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(p){if(this._checkLoaded(),this.sourceCaches[p]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===p)return this.fire(new y.ErrorEvent(new Error('Source "'+p+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[p];delete this.sourceCaches[p],delete this._updatedSources[p],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(p,g){this._checkLoaded(),this.sourceCaches[p].getSource().setData(g),this._changed=!0},v.prototype.getSource=function(p){return this.sourceCaches[p]&&this.sourceCaches[p].getSource()},v.prototype.addLayer=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=p.id;if(this.getLayer(w))this.fire(new y.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var R;if(p.type==="custom"){if(Fu(this,y.validateCustomStyleLayer(p)))return;R=y.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(w,p.source),p=y.clone$1(p),p=y.extend(p,{source:w})),this._validate(y.validateStyle.layer,"layers."+w,p,{arrayIndex:-1},S))return;R=y.createStyleLayer(p),this._validateLayer(R),R.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[R.id]=R.serialize()}var k=g?this._order.indexOf(g):this._order.length;if(g&&k===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(k,0,w),this._layerOrderChanged=!0,this._layers[w]=R,this._removedLayers[w]&&R.source&&R.type!=="custom"){var $=this._removedLayers[w];delete this._removedLayers[w],$.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},v.prototype.moveLayer=function(p,g){if(this._checkLoaded(),this._changed=!0,this._layers[p]){if(p!==g){var S=this._order.indexOf(p);this._order.splice(S,1);var w=g?this._order.indexOf(g):this._order.length;g&&w===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(w,0,p),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(p){this._checkLoaded();var g=this._layers[p];if(g){g.setEventedParent(null);var S=this._order.indexOf(p);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=g,delete this._layers[p],delete this._serializedLayers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(p){return this._layers[p]},v.prototype.hasLayer=function(p){return p in this._layers},v.prototype.setLayerZoomRange=function(p,g,S){this._checkLoaded();var w=this.getLayer(p);w?w.minzoom===g&&w.maxzoom===S||(g!=null&&(w.minzoom=g),S!=null&&(w.maxzoom=S),this._updateLayer(w)):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=this.getLayer(p);if(w){if(!y.deepEqual(w.filter,g))return g==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(y.validateStyle.filter,"layers."+w.id+".filter",g,null,S)||(w.filter=y.clone$1(g),this._updateLayer(w)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(p){return y.clone$1(this.getLayer(p).filter)},v.prototype.setLayoutProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var R=this.getLayer(p);R?y.deepEqual(R.getLayoutProperty(g),S)||(R.setLayoutProperty(g,S,w),this._updateLayer(R)):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(p,g){var S=this.getLayer(p);if(S)return S.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var R=this.getLayer(p);R?y.deepEqual(R.getPaintProperty(g),S)||(R.setPaintProperty(g,S,w)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(p,g){return this.getLayer(p).getPaintProperty(g)},v.prototype.setFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=p.sourceLayer,R=this.sourceCaches[S];if(R!==void 0){var k=R.getSource().type;k==="geojson"&&w?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||w?(p.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(w,p.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=this.sourceCaches[S];if(w!==void 0){var R=w.getSource().type,k=R==="vector"?p.sourceLayer:void 0;R!=="vector"||k?g&&typeof p.id!="string"&&typeof p.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(k,p.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(p){this._checkLoaded();var g=p.source,S=p.sourceLayer,w=this.sourceCaches[g];if(w!==void 0){if(w.getSource().type!=="vector"||S)return p.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(S,p.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(p){return p.serialize()}),layers:this._serializeLayers(this._order)},function(p){return p!==void 0})},v.prototype._updateLayer=function(p){this._updatedLayers[p.id]=!0,p.source&&!this._updatedSources[p.source]&&this.sourceCaches[p.source].getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(p){for(var g=this,S=function(Yr){return g._layers[Yr].type==="fill-extrusion"},w={},R=[],k=this._order.length-1;k>=0;k--){var $=this._order[k];if(S($)){w[$]=k;for(var oe=0,be=p;oe<be.length;oe+=1){var we=be[oe][$];if(we)for(var Oe=0,qe=we;Oe<qe.length;Oe+=1)R.push(qe[Oe])}}}R.sort(function(Yr,Ur){return Ur.intersectionZ-Yr.intersectionZ});for(var $e=[],vt=this._order.length-1;vt>=0;vt--){var He=this._order[vt];if(S(He))for(var dt=R.length-1;dt>=0;dt--){var wt=R[dt].feature;if(w[wt.layer.id]<vt)break;$e.push(wt),R.pop()}else for(var zt=0,ar=p;zt<ar.length;zt+=1){var Qt=ar[zt][He];if(Qt)for(var hr=0,Tr=Qt;hr<Tr.length;hr+=1)$e.push(Tr[hr].feature)}}return $e},v.prototype.queryRenderedFeatures=function(p,g,S){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var w={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,k=g.layers;R<k.length;R+=1){var $=k[R],oe=this._layers[$];if(!oe)return this.fire(new y.ErrorEvent(new Error("The layer '"+$+"' does not exist in the map's style and cannot be queried for features."))),[];w[oe.source]=!0}}var be=[];for(var we in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!w[we]||be.push(kt(this.sourceCaches[we],this._layers,this._serializedLayers,p,g,S));return this.placement&&be.push(function(Oe,qe,$e,vt,He,dt,wt){for(var zt={},ar=dt.queryRenderedSymbols(vt),Qt=[],hr=0,Tr=Object.keys(ar).map(Number);hr<Tr.length;hr+=1)Qt.push(wt[Tr[hr]]);Qt.sort(Vr);for(var Yr=function(){var Wn=_n[Ur],Wi=Wn.featureIndex.lookupSymbolFeatures(ar[Wn.bucketInstanceId],qe,Wn.bucketIndex,Wn.sourceLayerIndex,He.filter,He.layers,He.availableImages,Oe);for(var Tn in Wi){var ui=zt[Tn]=zt[Tn]||[],gi=Wi[Tn];gi.sort(function(vi,ii){var Jn=Wn.featureSortOrder;if(Jn){var Mo=Jn.indexOf(vi.featureIndex);return Jn.indexOf(ii.featureIndex)-Mo}return ii.featureIndex-vi.featureIndex});for(var si=0,ni=gi;si<ni.length;si+=1)ui.push(ni[si])}},Ur=0,_n=Qt;Ur<_n.length;Ur+=1)Yr();var Hn=function(Wn){zt[Wn].forEach(function(Wi){var Tn=Wi.feature,ui=$e[Oe[Wn].source].getFeatureState(Tn.layer["source-layer"],Tn.id);Tn.source=Tn.layer.source,Tn.layer["source-layer"]&&(Tn.sourceLayer=Tn.layer["source-layer"]),Tn.state=ui})};for(var Vn in zt)Hn(Vn);return zt}(this._layers,this._serializedLayers,this.sourceCaches,p,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(be)},v.prototype.querySourceFeatures=function(p,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[p];return S?function(w,R){for(var k=w.getRenderableIds().map(function(qe){return w.getTileByID(qe)}),$=[],oe={},be=0;be<k.length;be++){var we=k[be],Oe=we.tileID.canonical.key;oe[Oe]||(oe[Oe]=!0,we.querySourceFeatures($,R))}return $}(S,g):[]},v.prototype.addSourceType=function(p,g,S){return v.getSourceType(p)?S(new Error('A source type called "'+p+'" already exists.')):(v.setSourceType(p,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:g.workerSourceURL},S):S(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(p,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),w=!1;for(var R in p)if(!y.deepEqual(p[R],S[R])){w=!0;break}if(w){var k={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(p,g),this.light.updateTransitions(k)}},v.prototype._validate=function(p,g,S,w,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Fu(this,p.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:S,styleSpec:y.styleSpec},w)))},v.prototype._remove=function(){for(var p in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[p].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(p){this.sourceCaches[p].clearTiles()},v.prototype._reloadSource=function(p){this.sourceCaches[p].resume(),this.sourceCaches[p].reload()},v.prototype._updateSources=function(p){for(var g in this.sourceCaches)this.sourceCaches[g].update(p)},v.prototype._generateCollisionBoxes=function(){for(var p in this.sourceCaches)this._reloadSource(p)},v.prototype._updatePlacement=function(p,g,S,w,R){R===void 0&&(R=!1);for(var k=!1,$=!1,oe={},be=0,we=this._order;be<we.length;be+=1){var Oe=this._layers[we[be]];if(Oe.type==="symbol"){if(!oe[Oe.source]){var qe=this.sourceCaches[Oe.source];oe[Oe.source]=qe.getRenderableIds(!0).map(function(wt){return qe.getTileByID(wt)}).sort(function(wt,zt){return zt.tileID.overscaledZ-wt.tileID.overscaledZ||(wt.tileID.isLessThan(zt.tileID)?-1:1)})}var $e=this.crossTileSymbolIndex.addLayer(Oe,oe[Oe.source],p.center.lng);k=k||$e}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),p.zoom))&&(this.pauseablePlacement=new Rs(p,this._order,R,g,S,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,oe),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),$=!0),k&&this.pauseablePlacement.placement.setStale()),$||k)for(var vt=0,He=this._order;vt<He.length;vt+=1){var dt=this._layers[He[vt]];dt.type==="symbol"&&this.placement.updateLayerOpacities(dt,oe[dt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var p in this.sourceCaches)this.sourceCaches[p].releaseSymbolFadeTiles()},v.prototype.getImages=function(p,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var w=this.sourceCaches[g.source];w&&w.setDependencies(g.tileID.key,g.type,g.icons)},v.prototype.getGlyphs=function(p,g,S){this.glyphManager.getGlyphs(g.stacks,S)},v.prototype.getResource=function(p,g,S){return y.makeRequest(g,S)},v}(y.Evented);Fs.getSourceType=function(h){return Mt[h]},Fs.setSourceType=function(h,v){Mt[h]=v},Fs.registerForPluginStateChange=y.registerForPluginStateChange;var ro=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Cl=ki(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),tl=ki(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Af=ki(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),tp=ki(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Tf=ki("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),dh=ki(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),vh=ki(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),mh=ki("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),rp=ki("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),np=ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Gp=ki(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Kc=ki(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Uu=ki(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ip=ki(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),es=ki(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Wl=ki(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Rl=ki(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ks=ki(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ml=ki(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),pi=ki(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),rl=ki(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ns=ki(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),zu=ki(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),nl=ki(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ap=ki(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ra=ki(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ki(h,v){var p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=v.match(/attribute ([\w]+) ([\w]+)/g),S=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=w?w.concat(S):S,k={};return{fragmentSource:h=h.replace(p,function($,oe,be,we,Oe){return k[Oe]=!0,oe==="define"?`
#ifndef HAS_UNIFORM_u_`+Oe+`
varying `+be+" "+we+" "+Oe+`;
#else
uniform `+be+" "+we+" u_"+Oe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Oe+`
    `+be+" "+we+" "+Oe+" = u_"+Oe+`;
#endif
`}),vertexSource:v=v.replace(p,function($,oe,be,we,Oe){var qe=we==="float"?"vec2":"vec4",$e=Oe.match(/color/)?"color":qe;return k[Oe]?oe==="define"?`
#ifndef HAS_UNIFORM_u_`+Oe+`
uniform lowp float u_`+Oe+`_t;
attribute `+be+" "+qe+" a_"+Oe+`;
varying `+be+" "+we+" "+Oe+`;
#else
uniform `+be+" "+we+" u_"+Oe+`;
#endif
`:$e==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Oe+`
    `+Oe+" = a_"+Oe+`;
#else
    `+be+" "+we+" "+Oe+" = u_"+Oe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Oe+`
    `+Oe+" = unpack_mix_"+$e+"(a_"+Oe+", u_"+Oe+`_t);
#else
    `+be+" "+we+" "+Oe+" = u_"+Oe+`;
#endif
`:oe==="define"?`
#ifndef HAS_UNIFORM_u_`+Oe+`
uniform lowp float u_`+Oe+`_t;
attribute `+be+" "+qe+" a_"+Oe+`;
#else
uniform `+be+" "+we+" u_"+Oe+`;
#endif
`:$e==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Oe+`
    `+be+" "+we+" "+Oe+" = a_"+Oe+`;
#else
    `+be+" "+we+" "+Oe+" = u_"+Oe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Oe+`
    `+be+" "+we+" "+Oe+" = unpack_mix_"+$e+"(a_"+Oe+", u_"+Oe+`_t);
#else
    `+be+" "+we+" "+Oe+" = u_"+Oe+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var au=Object.freeze({__proto__:null,prelude:Cl,background:tl,backgroundPattern:Af,circle:tp,clippingMask:Tf,heatmap:dh,heatmapTexture:vh,collisionBox:mh,collisionCircle:rp,debug:np,fill:Gp,fillOutline:Kc,fillOutlinePattern:Uu,fillPattern:ip,fillExtrusion:es,fillExtrusionPattern:Wl,hillshadePrepare:Rl,hillshade:Ks,line:Ml,lineGradient:pi,linePattern:rl,lineSDF:Ns,raster:zu,symbolIcon:nl,symbolSDF:ap,symbolTextAndIcon:ra}),mu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function wf(h){for(var v=[],p=0;p<h.length;p++)if(h[p]!==null){var g=h[p].split(" ");v.push(g.pop())}return v}mu.prototype.bind=function(h,v,p,g,S,w,R,k){this.context=h;for(var $=this.boundPaintVertexBuffers.length!==g.length,oe=0;!$&&oe<g.length;oe++)this.boundPaintVertexBuffers[oe]!==g[oe]&&($=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===p&&!$&&this.boundIndexBuffer===S&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===k?(h.bindVertexArrayOES.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),k&&k.bind()):this.freshBind(v,p,g,S,w,R,k)},mu.prototype.freshBind=function(h,v,p,g,S,w,R){var k,$=h.numAttributes,oe=this.context,be=oe.gl;if(oe.extVertexArrayObject)this.vao&&this.destroy(),this.vao=oe.extVertexArrayObject.createVertexArrayOES(),oe.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=h,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=R;else{k=oe.currentNumAttributes||0;for(var we=$;we<k;we++)be.disableVertexAttribArray(we)}v.enableAttributes(be,h);for(var Oe=0,qe=p;Oe<qe.length;Oe+=1)qe[Oe].enableAttributes(be,h);w&&w.enableAttributes(be,h),R&&R.enableAttributes(be,h),v.bind(),v.setVertexAttribPointers(be,h,S);for(var $e=0,vt=p;$e<vt.length;$e+=1){var He=vt[$e];He.bind(),He.setVertexAttribPointers(be,h,S)}w&&(w.bind(),w.setVertexAttribPointers(be,h,S)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(be,h,S)),oe.currentNumAttributes=$},mu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var $a=function(h,v,p,g,S,w){var R=h.gl;this.program=R.createProgram();for(var k=wf(p.staticAttributes),$=g?g.getBinderAttributes():[],oe=k.concat($),be=p.staticUniforms?wf(p.staticUniforms):[],we=g?g.getBinderUniforms():[],Oe=[],qe=0,$e=be.concat(we);qe<$e.length;qe+=1){var vt=$e[qe];Oe.indexOf(vt)<0&&Oe.push(vt)}var He=g?g.defines():[];w&&He.push("#define OVERDRAW_INSPECTOR;");var dt=He.concat(Cl.fragmentSource,p.fragmentSource).join(`
`),wt=He.concat(Cl.vertexSource,p.vertexSource).join(`
`),zt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(zt,dt),R.compileShader(zt),R.attachShader(this.program,zt);var ar=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(ar,wt),R.compileShader(ar),R.attachShader(this.program,ar),this.attributes={};var Qt={};this.numAttributes=oe.length;for(var hr=0;hr<this.numAttributes;hr++)oe[hr]&&(R.bindAttribLocation(this.program,hr,oe[hr]),this.attributes[oe[hr]]=hr);R.linkProgram(this.program),R.deleteShader(ar),R.deleteShader(zt);for(var Tr=0;Tr<Oe.length;Tr++){var Yr=Oe[Tr];if(Yr&&!Qt[Yr]){var Ur=R.getUniformLocation(this.program,Yr);Ur&&(Qt[Yr]=Ur)}}this.fixedUniforms=S(h,Qt),this.binderUniforms=g?g.getUniforms(h,Qt):[]}}};function gh(h,v,p){var g=1/ma(p,1,v.transform.tileZoom),S=Math.pow(2,p.tileID.overscaledZ),w=p.tileSize*Math.pow(2,v.transform.tileZoom)/S,R=w*(p.tileID.canonical.x+p.tileID.wrap*S),k=w*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[g,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[R>>16,k>>16],u_pixel_coord_lower:[65535&R,65535&k]}}$a.prototype.draw=function(h,v,p,g,S,w,R,k,$,oe,be,we,Oe,qe,$e,vt){var He,dt=h.gl;if(!this.failedToCreate){for(var wt in h.program.set(this.program),h.setDepthMode(p),h.setStencilMode(g),h.setColorMode(S),h.setCullFace(w),this.fixedUniforms)this.fixedUniforms[wt].set(R[wt]);qe&&qe.setUniforms(h,this.binderUniforms,we,{zoom:Oe});for(var zt=(He={},He[dt.LINES]=2,He[dt.TRIANGLES]=3,He[dt.LINE_STRIP]=1,He)[v],ar=0,Qt=be.get();ar<Qt.length;ar+=1){var hr=Qt[ar],Tr=hr.vaos||(hr.vaos={});(Tr[k]||(Tr[k]=new mu)).bind(h,this,$,qe?qe.getPaintVertexBuffers():[],oe,hr.vertexOffset,$e,vt),dt.drawElements(v,hr.primitiveLength*zt,dt.UNSIGNED_SHORT,hr.primitiveOffset*zt*2)}}};var Cf=function(h,v,p,g){var S=v.style.light,w=S.properties.get("position"),R=[w.x,w.y,w.z],k=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(k,-v.transform.angle),y.transformMat3(R,R,k);var $=S.properties.get("color");return{u_matrix:h,u_lightpos:R,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+p,u_opacity:g}},Us=function(h,v,p,g,S,w,R){return y.extend(Cf(h,v,p,g),gh(w,v,R),{u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8})},il=function(h){return{u_matrix:h}},gu=function(h,v,p,g){return y.extend(il(h),gh(p,v,g))},Gl=function(h,v){return{u_matrix:h,u_world:v}},yh=function(h,v,p,g,S){return y.extend(gu(h,v,p,g),{u_world:S})},Ec=function(h,v,p,g){var S,w,R=h.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var k=ma(p,1,R.zoom);S=!0,w=[k,k]}else S=!1,w=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(v.posMatrix,p,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:w}},va=function(h,v,p){var g=ma(p,1,v.zoom),S=Math.pow(2,v.zoom-p.tileID.overscaledZ),w=p.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[v.pixelsToGLUnits[0]/(g*S),v.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:w}},Sc=function(h,v,p){return{u_matrix:h,u_inv_matrix:v,u_camera_to_center_distance:p.cameraToCenterDistance,u_viewport_size:[p.width,p.height]}},al=function(h,v,p){return p===void 0&&(p=1),{u_matrix:h,u_color:v,u_overlay:0,u_overlay_scale:p}},Il=function(h){return{u_matrix:h}},_h=function(h,v,p,g){return{u_matrix:h,u_extrude_scale:ma(v,1,p),u_intensity:g}},Qc=function(h,v,p){var g=h.transform;return{u_matrix:Jc(h,v,p),u_ratio:1/ma(v,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ba=function(h,v,p,g){return y.extend(Qc(h,v,p),{u_image:0,u_image_height:g})},Pl=function(h,v,p,g){var S=h.transform,w=ol(v,S);return{u_matrix:Jc(h,v,p),u_texsize:v.imageAtlasTexture.size,u_ratio:1/ma(v,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[w,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},op=function(h,v,p,g,S){var w=h.lineAtlas,R=ol(v,h.transform),k=p.layout.get("line-cap")==="round",$=w.getDash(g.from,k),oe=w.getDash(g.to,k),be=$.width*S.fromScale,we=oe.width*S.toScale;return y.extend(Qc(h,v,p),{u_patternscale_a:[R/be,-$.height/2],u_patternscale_b:[R/we,-oe.height/2],u_sdfgamma:w.width/(256*Math.min(be,we)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:$.y,u_tex_y_b:oe.y,u_mix:S.t})};function ol(h,v){return 1/ma(h,1,v.tileZoom)}function Jc(h,v,p){return h.translatePosMatrix(v.tileID.posMatrix,v,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}var ef=function(h,v,p,g,S){return{u_matrix:h,u_tl_parent:v,u_scale_parent:p,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(R=S.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(w=S.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Rf(S.paint.get("raster-hue-rotate"))};var w,R};function Rf(h){h*=Math.PI/180;var v=Math.sin(h),p=Math.cos(h);return[(2*p+1)/3,(-Math.sqrt(3)*v-p+1)/3,(Math.sqrt(3)*v-p+1)/3]}var sl,Xl=function(h,v,p,g,S,w,R,k,$,oe){var be=S.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:be.cameraToCenterDistance,u_pitch:be.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:be.width/be.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:R,u_coord_matrix:k,u_is_text:+$,u_pitch_with_map:+g,u_texsize:oe,u_texture:0}},Zu=function(h,v,p,g,S,w,R,k,$,oe,be){var we=S.transform;return y.extend(Xl(h,v,p,g,S,w,R,k,$,oe),{u_gamma_scale:g?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+be})},tf=function(h,v,p,g,S,w,R,k,$,oe){return y.extend(Zu(h,v,p,g,S,w,R,k,!0,$,!0),{u_texsize_icon:oe,u_texture_icon:1})},Ac=function(h,v,p){return{u_matrix:h,u_opacity:v,u_color:p}},$l=function(h,v,p,g,S,w){return y.extend(function(R,k,$,oe){var be=$.imageManager.getPattern(R.from.toString()),we=$.imageManager.getPattern(R.to.toString()),Oe=$.imageManager.getPixelSize(),qe=Oe.width,$e=Oe.height,vt=Math.pow(2,oe.tileID.overscaledZ),He=oe.tileSize*Math.pow(2,$.transform.tileZoom)/vt,dt=He*(oe.tileID.canonical.x+oe.tileID.wrap*vt),wt=He*oe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:be.tl,u_pattern_br_a:be.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[qe,$e],u_mix:k.t,u_pattern_size_a:be.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/ma(oe,1,$.transform.tileZoom),u_pixel_coord_upper:[dt>>16,wt>>16],u_pixel_coord_lower:[65535&dt,65535&wt]}}(g,w,p,S),{u_matrix:h,u_opacity:v})},bh={fillExtrusion:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fillExtrusionPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_height_factor:new y.Uniform1f(h,v.u_height_factor),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fill:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},fillPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},fillOutline:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world)}},fillOutlinePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},circle:function(h,v){return{u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(h,v.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},collisionBox:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(h,v.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_overscale_factor:new y.Uniform1f(h,v.u_overscale_factor)}},collisionCircle:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_inv_matrix:new y.UniformMatrix4f(h,v.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(h,v.u_viewport_size)}},debug:function(h,v){return{u_color:new y.UniformColor(h,v.u_color),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_overlay:new y.Uniform1i(h,v.u_overlay),u_overlay_scale:new y.Uniform1f(h,v.u_overlay_scale)}},clippingMask:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmap:function(h,v){return{u_extrude_scale:new y.Uniform1f(h,v.u_extrude_scale),u_intensity:new y.Uniform1f(h,v.u_intensity),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmapTexture:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_color_ramp:new y.Uniform1i(h,v.u_color_ramp),u_opacity:new y.Uniform1f(h,v.u_opacity)}},hillshade:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_latrange:new y.Uniform2f(h,v.u_latrange),u_light:new y.Uniform2f(h,v.u_light),u_shadow:new y.UniformColor(h,v.u_shadow),u_highlight:new y.UniformColor(h,v.u_highlight),u_accent:new y.UniformColor(h,v.u_accent)}},hillshadePrepare:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_dimension:new y.Uniform2f(h,v.u_dimension),u_zoom:new y.Uniform1f(h,v.u_zoom),u_unpack:new y.Uniform4f(h,v.u_unpack)}},line:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels)}},lineGradient:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_image:new y.Uniform1i(h,v.u_image),u_image_height:new y.Uniform1f(h,v.u_image_height)}},linePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_texsize:new y.Uniform2f(h,v.u_texsize),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_image:new y.Uniform1i(h,v.u_image),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},lineSDF:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(h,v.u_patternscale_a),u_patternscale_b:new y.Uniform2f(h,v.u_patternscale_b),u_sdfgamma:new y.Uniform1f(h,v.u_sdfgamma),u_image:new y.Uniform1i(h,v.u_image),u_tex_y_a:new y.Uniform1f(h,v.u_tex_y_a),u_tex_y_b:new y.Uniform1f(h,v.u_tex_y_b),u_mix:new y.Uniform1f(h,v.u_mix)}},raster:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_tl_parent:new y.Uniform2f(h,v.u_tl_parent),u_scale_parent:new y.Uniform1f(h,v.u_scale_parent),u_buffer_scale:new y.Uniform1f(h,v.u_buffer_scale),u_fade_t:new y.Uniform1f(h,v.u_fade_t),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image0:new y.Uniform1i(h,v.u_image0),u_image1:new y.Uniform1i(h,v.u_image1),u_brightness_low:new y.Uniform1f(h,v.u_brightness_low),u_brightness_high:new y.Uniform1f(h,v.u_brightness_high),u_saturation_factor:new y.Uniform1f(h,v.u_saturation_factor),u_contrast_factor:new y.Uniform1f(h,v.u_contrast_factor),u_spin_weights:new y.Uniform3f(h,v.u_spin_weights)}},symbolIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture)}},symbolSDF:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},symbolTextAndIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texsize_icon:new y.Uniform2f(h,v.u_texsize_icon),u_texture:new y.Uniform1i(h,v.u_texture),u_texture_icon:new y.Uniform1i(h,v.u_texture_icon),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},background:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_color:new y.UniformColor(h,v.u_color)}},backgroundPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image:new y.Uniform1i(h,v.u_image),u_pattern_tl_a:new y.Uniform2f(h,v.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(h,v.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(h,v.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(h,v.u_pattern_br_b),u_texsize:new y.Uniform2f(h,v.u_texsize),u_mix:new y.Uniform1f(h,v.u_mix),u_pattern_size_a:new y.Uniform2f(h,v.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(h,v.u_pattern_size_b),u_scale_a:new y.Uniform1f(h,v.u_scale_a),u_scale_b:new y.Uniform1f(h,v.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(h,v.u_tile_units_to_pixels)}}};function Tc(h,v,p,g,S,w,R){for(var k=h.context,$=k.gl,oe=h.useProgram("collisionBox"),be=[],we=0,Oe=0,qe=0;qe<g.length;qe++){var $e=g[qe],vt=v.getTile($e),He=vt.getBucket(p);if(He){var dt=$e.posMatrix;S[0]===0&&S[1]===0||(dt=h.translatePosMatrix($e.posMatrix,vt,S,w));var wt=R?He.textCollisionBox:He.iconCollisionBox,zt=He.collisionCircleArray;if(zt.length>0){var ar=y.create(),Qt=dt;y.mul(ar,He.placementInvProjMatrix,h.transform.glCoordMatrix),y.mul(ar,ar,He.placementViewportMatrix),be.push({circleArray:zt,circleOffset:Oe,transform:Qt,invTransform:ar}),Oe=we+=zt.length/4}wt&&oe.draw(k,$.LINES,se.disabled,Me.disabled,h.colorModeForRenderPass(),ut.disabled,va(dt,h.transform,vt),p.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,null,h.transform.zoom,null,null,wt.collisionVertexBuffer)}}if(R&&be.length){var hr=h.useProgram("collisionCircle"),Tr=new y.StructArrayLayout2f1f2i16;Tr.resize(4*we),Tr._trim();for(var Yr=0,Ur=0,_n=be;Ur<_n.length;Ur+=1)for(var Hn=_n[Ur],Vn=0;Vn<Hn.circleArray.length/4;Vn++){var Wn=4*Vn,Wi=Hn.circleArray[Wn+0],Tn=Hn.circleArray[Wn+1],ui=Hn.circleArray[Wn+2],gi=Hn.circleArray[Wn+3];Tr.emplace(Yr++,Wi,Tn,ui,gi,0),Tr.emplace(Yr++,Wi,Tn,ui,gi,1),Tr.emplace(Yr++,Wi,Tn,ui,gi,2),Tr.emplace(Yr++,Wi,Tn,ui,gi,3)}(!sl||sl.length<2*we)&&(sl=function(no){var Io=2*no,bo=new y.StructArrayLayout3ui6;bo.resize(Io),bo._trim();for(var Ka=0;Ka<Io;Ka++){var io=6*Ka;bo.uint16[io+0]=4*Ka+0,bo.uint16[io+1]=4*Ka+1,bo.uint16[io+2]=4*Ka+2,bo.uint16[io+3]=4*Ka+2,bo.uint16[io+4]=4*Ka+3,bo.uint16[io+5]=4*Ka+0}return bo}(we));for(var si=k.createIndexBuffer(sl,!0),ni=k.createVertexBuffer(Tr,y.collisionCircleLayout.members,!0),vi=0,ii=be;vi<ii.length;vi+=1){var Jn=ii[vi],Mo=Sc(Jn.transform,Jn.invTransform,h.transform);hr.draw(k,$.TRIANGLES,se.disabled,Me.disabled,h.colorModeForRenderPass(),ut.disabled,Mo,p.id,ni,si,y.SegmentVector.simpleSegment(0,2*Jn.circleOffset,Jn.circleArray.length,Jn.circleArray.length/2),null,h.transform.zoom,null,null,null)}ni.destroy(),si.destroy()}}var zs=y.identity(new Float32Array(16));function xh(h,v,p,g,S,w){var R=y.getAnchorAlignment(h),k=-(R.horizontalAlign-.5)*v,$=-(R.verticalAlign-.5)*p,oe=y.evaluateVariableOffset(h,g);return new y.Point((k/S+oe[0])*w,($/S+oe[1])*w)}function rf(h,v,p,g,S,w,R,k,$,oe,be){var we=h.text.placedSymbolArray,Oe=h.text.dynamicLayoutVertexArray,qe=h.icon.dynamicLayoutVertexArray,$e={};Oe.clear();for(var vt=0;vt<we.length;vt++){var He=we.get(vt),dt=He.hidden||!He.crossTileID||h.allowVerticalPlacement&&!He.placedOrientation?null:g[He.crossTileID];if(dt){var wt=new y.Point(He.anchorX,He.anchorY),zt=yi(wt,p?k:R),ar=Ii(w.cameraToCenterDistance,zt.signedDistanceFromCamera),Qt=S.evaluateSizeForFeature(h.textSizeData,oe,He)*ar/y.ONE_EM;p&&(Qt*=h.tilePixelRatio/$);for(var hr=xh(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale,Qt),Tr=p?yi(wt.add(hr),R).point:zt.point.add(v?hr.rotate(-w.angle):hr),Yr=h.allowVerticalPlacement&&He.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,Ur=0;Ur<He.numGlyphs;Ur++)y.addDynamicAttributes(Oe,Tr,Yr);be&&He.associatedIconIndex>=0&&($e[He.associatedIconIndex]={shiftedAnchor:Tr,angle:Yr})}else Fa(He.numGlyphs,Oe)}if(be){qe.clear();for(var _n=h.icon.placedSymbolArray,Hn=0;Hn<_n.length;Hn++){var Vn=_n.get(Hn);if(Vn.hidden)Fa(Vn.numGlyphs,qe);else{var Wn=$e[Hn];if(Wn)for(var Wi=0;Wi<Vn.numGlyphs;Wi++)y.addDynamicAttributes(qe,Wn.shiftedAnchor,Wn.angle);else Fa(Vn.numGlyphs,qe)}}h.icon.dynamicLayoutVertexBuffer.updateData(qe)}h.text.dynamicLayoutVertexBuffer.updateData(Oe)}function wc(h,v,p){return p.iconsInText&&v?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ol(h,v,p,g,S,w,R,k,$,oe,be,we){for(var Oe=h.context,qe=Oe.gl,$e=h.transform,vt=k==="map",He=$==="map",dt=vt&&p.layout.get("symbol-placement")!=="point",wt=vt&&!He&&!dt,zt=p.layout.get("symbol-sort-key").constantOr(1)!==void 0,ar=!1,Qt=h.depthModeForSublayer(0,se.ReadOnly),hr=p.layout.get("text-variable-anchor"),Tr=[],Yr=0,Ur=g;Yr<Ur.length;Yr+=1){var _n=Ur[Yr],Hn=v.getTile(_n),Vn=Hn.getBucket(p);if(Vn){var Wn=S?Vn.text:Vn.icon;if(Wn&&Wn.segments.get().length){var Wi=Wn.programConfigurations.get(p.id),Tn=S||Vn.sdfIcons,ui=S?Vn.textSizeData:Vn.iconSizeData,gi=He||$e.pitch!==0,si=h.useProgram(wc(Tn,S,Vn),Wi),ni=y.evaluateSizeForZoom(ui,$e.zoom),vi=void 0,ii=[0,0],Jn=void 0,Mo=void 0,no=null,Io=void 0;if(S)Jn=Hn.glyphAtlasTexture,Mo=qe.LINEAR,vi=Hn.glyphAtlasTexture.size,Vn.iconsInText&&(ii=Hn.imageAtlasTexture.size,no=Hn.imageAtlasTexture,Io=gi||h.options.rotating||h.options.zooming||ui.kind==="composite"||ui.kind==="camera"?qe.LINEAR:qe.NEAREST);else{var bo=p.layout.get("icon-size").constantOr(0)!==1||Vn.iconsNeedLinear;Jn=Hn.imageAtlasTexture,Mo=Tn||h.options.rotating||h.options.zooming||bo||gi?qe.LINEAR:qe.NEAREST,vi=Hn.imageAtlasTexture.size}var Ka=ma(Hn,1,h.transform.zoom),io=La(_n.posMatrix,He,vt,h.transform,Ka),Es=Mi(_n.posMatrix,He,vt,h.transform,Ka),Ss=hr&&Vn.hasTextData(),hl=p.layout.get("icon-text-fit")!=="none"&&Ss&&Vn.hasIconData();dt&&vu(Vn,_n.posMatrix,h,S,io,Es,He,oe);var As=h.translatePosMatrix(_n.posMatrix,Hn,w,R),lu=dt||S&&hr||hl?zs:io,Vs=h.translatePosMatrix(Es,Hn,w,R,!0),Oc=Tn&&p.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Xu={program:si,buffers:Wn,uniformValues:Tn?Vn.iconsInText?tf(ui.kind,ni,wt,He,h,As,lu,Vs,vi,ii):Zu(ui.kind,ni,wt,He,h,As,lu,Vs,S,vi,!0):Xl(ui.kind,ni,wt,He,h,As,lu,Vs,S,vi),atlasTexture:Jn,atlasTextureIcon:no,atlasInterpolation:Mo,atlasInterpolationIcon:Io,isSDF:Tn,hasHalo:Oc};if(zt&&Vn.canOverlap){ar=!0;for(var Tu=0,rc=Wn.segments.get();Tu<rc.length;Tu+=1){var pl=rc[Tu];Tr.push({segments:new y.SegmentVector([pl]),sortKey:pl.sortKey,state:Xu})}}else Tr.push({segments:Wn.segments,sortKey:0,state:Xu})}}}ar&&Tr.sort(function(fu,wu){return fu.sortKey-wu.sortKey});for(var cu=0,dl=Tr;cu<dl.length;cu+=1){var Po=dl[cu],lo=Po.state;if(Oe.activeTexture.set(qe.TEXTURE0),lo.atlasTexture.bind(lo.atlasInterpolation,qe.CLAMP_TO_EDGE),lo.atlasTextureIcon&&(Oe.activeTexture.set(qe.TEXTURE1),lo.atlasTextureIcon&&lo.atlasTextureIcon.bind(lo.atlasInterpolationIcon,qe.CLAMP_TO_EDGE)),lo.isSDF){var Ms=lo.uniformValues;lo.hasHalo&&(Ms.u_is_halo=1,Vu(lo.buffers,Po.segments,p,h,lo.program,Qt,be,we,Ms)),Ms.u_is_halo=0}Vu(lo.buffers,Po.segments,p,h,lo.program,Qt,be,we,lo.uniformValues)}}function Vu(h,v,p,g,S,w,R,k,$){var oe=g.context;S.draw(oe,oe.gl.TRIANGLES,w,R,k,ut.disabled,$,p.id,h.layoutVertexBuffer,h.indexBuffer,v,p.paint,g.transform.zoom,h.programConfigurations.get(p.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Yl(h,v,p,g,S,w,R){var k,$,oe,be,we,Oe=h.context.gl,qe=p.paint.get("fill-pattern"),$e=qe&&qe.constantOr(1),vt=p.getCrossfadeParameters();R?($=$e&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=Oe.LINES):($=$e?"fillPattern":"fill",k=Oe.TRIANGLES);for(var He=0,dt=g;He<dt.length;He+=1){var wt=dt[He],zt=v.getTile(wt);if(!$e||zt.patternsLoaded()){var ar=zt.getBucket(p);if(ar){var Qt=ar.programConfigurations.get(p.id),hr=h.useProgram($,Qt);$e&&(h.context.activeTexture.set(Oe.TEXTURE0),zt.imageAtlasTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),Qt.updatePaintBuffers(vt));var Tr=qe.constantOr(null);if(Tr&&zt.imageAtlas){var Yr=zt.imageAtlas,Ur=Yr.patternPositions[Tr.to.toString()],_n=Yr.patternPositions[Tr.from.toString()];Ur&&_n&&Qt.setConstantPatternPositions(Ur,_n)}var Hn=h.translatePosMatrix(wt.posMatrix,zt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(R){be=ar.indexBuffer2,we=ar.segments2;var Vn=[Oe.drawingBufferWidth,Oe.drawingBufferHeight];oe=$==="fillOutlinePattern"&&$e?yh(Hn,h,vt,zt,Vn):Gl(Hn,Vn)}else be=ar.indexBuffer,we=ar.segments,oe=$e?gu(Hn,h,vt,zt):il(Hn);hr.draw(h.context,k,S,h.stencilModeForClipping(wt),w,ut.disabled,oe,p.id,ar.layoutVertexBuffer,be,we,p.paint,h.transform.zoom,Qt)}}}}function Mf(h,v,p,g,S,w,R){for(var k=h.context,$=k.gl,oe=p.paint.get("fill-extrusion-pattern"),be=oe.constantOr(1),we=p.getCrossfadeParameters(),Oe=p.paint.get("fill-extrusion-opacity"),qe=0,$e=g;qe<$e.length;qe+=1){var vt=$e[qe],He=v.getTile(vt),dt=He.getBucket(p);if(dt){var wt=dt.programConfigurations.get(p.id),zt=h.useProgram(be?"fillExtrusionPattern":"fillExtrusion",wt);be&&(h.context.activeTexture.set($.TEXTURE0),He.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),wt.updatePaintBuffers(we));var ar=oe.constantOr(null);if(ar&&He.imageAtlas){var Qt=He.imageAtlas,hr=Qt.patternPositions[ar.to.toString()],Tr=Qt.patternPositions[ar.from.toString()];hr&&Tr&&wt.setConstantPatternPositions(hr,Tr)}var Yr=h.translatePosMatrix(vt.posMatrix,He,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Ur=p.paint.get("fill-extrusion-vertical-gradient"),_n=be?Us(Yr,h,Ur,Oe,vt,we,He):Cf(Yr,h,Ur,Oe);zt.draw(k,k.gl.TRIANGLES,S,w,R,ut.backCCW,_n,p.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,p.paint,h.transform.zoom,wt)}}}function ul(h,v,p,g,S,w){var R=h.context,k=R.gl,$=v.fbo;if($){var oe=h.useProgram("hillshade");R.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,$.colorAttachment.get());var be=function(we,Oe,qe){var $e=qe.paint.get("hillshade-shadow-color"),vt=qe.paint.get("hillshade-highlight-color"),He=qe.paint.get("hillshade-accent-color"),dt=qe.paint.get("hillshade-illumination-direction")*(Math.PI/180);qe.paint.get("hillshade-illumination-anchor")==="viewport"&&(dt-=we.transform.angle);var wt,zt,ar,Qt=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Oe.tileID.toUnwrapped(),Qt),u_image:0,u_latrange:(wt=Oe.tileID,zt=Math.pow(2,wt.canonical.z),ar=wt.canonical.y,[new y.MercatorCoordinate(0,ar/zt).toLngLat().lat,new y.MercatorCoordinate(0,(ar+1)/zt).toLngLat().lat]),u_light:[qe.paint.get("hillshade-exaggeration"),dt],u_shadow:$e,u_highlight:vt,u_accent:He}}(h,v,p);oe.draw(R,k.TRIANGLES,g,S,w,ut.disabled,be,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function Eh(h,v,p,g,S,w){var R=h.context,k=R.gl,$=v.dem;if($&&$.data){var oe=$.dim,be=$.stride,we=$.getPixels();if(R.activeTexture.set(k.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||h.getTileTexture(be),v.demTexture){var Oe=v.demTexture;Oe.update(we,{premultiply:!1}),Oe.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else v.demTexture=new y.Texture(R,we,k.RGBA,{premultiply:!1}),v.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);R.activeTexture.set(k.TEXTURE0);var qe=v.fbo;if(!qe){var $e=new y.Texture(R,{width:oe,height:oe,data:null},k.RGBA);$e.bind(k.LINEAR,k.CLAMP_TO_EDGE),(qe=v.fbo=R.createFramebuffer(oe,oe,!0)).colorAttachment.set($e.texture)}R.bindFramebuffer.set(qe.framebuffer),R.viewport.set([0,0,oe,oe]),h.useProgram("hillshadePrepare").draw(R,k.TRIANGLES,g,S,w,ut.disabled,function(vt,He){var dt=He.stride,wt=y.create();return y.ortho(wt,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(wt,wt,[0,-y.EXTENT,0]),{u_matrix:wt,u_image:1,u_dimension:[dt,dt],u_zoom:vt.overscaledZ,u_unpack:He.getUnpackVector()}}(v.tileID,$),p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function Sh(h,v,p,g,S){var w=g.paint.get("raster-fade-duration");if(w>0){var R=y.browser.now(),k=(R-h.timeAdded)/w,$=v?(R-v.timeAdded)/w:-1,oe=p.getSource(),be=S.coveringZoomLevel({tileSize:oe.tileSize,roundZoom:oe.roundZoom}),we=!v||Math.abs(v.tileID.overscaledZ-be)>Math.abs(h.tileID.overscaledZ-be),Oe=we&&h.refreshedUponExpiration?1:y.clamp(we?k:1-$,0,1);return h.refreshedUponExpiration&&k>=1&&(h.refreshedUponExpiration=!1),v?{opacity:1,mix:1-Oe}:{opacity:Oe,mix:0}}return{opacity:1,mix:0}}var Ah=new y.Color(1,0,0,1),If=new y.Color(0,1,0,1),sp=new y.Color(0,0,1,1),Ya=new y.Color(1,0,1,1),up=new y.Color(0,1,1,1);function Pf(h,v,p,g){ql(h,0,v+p/2,h.transform.width,p,g)}function lp(h,v,p,g){ql(h,v-p/2,0,p,h.transform.height,g)}function ql(h,v,p,g,S,w){var R=h.context,k=R.gl;k.enable(k.SCISSOR_TEST),k.scissor(v*y.browser.devicePixelRatio,p*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),R.clear({color:w}),k.disable(k.SCISSOR_TEST)}function cp(h,v,p){var g=h.context,S=g.gl,w=p.posMatrix,R=h.useProgram("debug"),k=se.disabled,$=Me.disabled,oe=h.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R.draw(g,S.LINE_STRIP,k,$,oe,ut.disabled,al(w,y.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var be=v.getTileByID(p.key).latestRawTileData,we=Math.floor((be&&be.byteLength||0)/1024),Oe=v.getTile(p).tileSize,qe=512/Math.min(Oe,512)*(p.overscaledZ/h.transform.zoom)*.5,$e=p.canonical.toString();p.overscaledZ!==p.canonical.z&&($e+=" => "+p.overscaledZ),function(vt,He){vt.initDebugOverlayCanvas();var dt=vt.debugOverlayCanvas,wt=vt.context.gl,zt=vt.debugOverlayCanvas.getContext("2d");zt.clearRect(0,0,dt.width,dt.height),zt.shadowColor="white",zt.shadowBlur=2,zt.lineWidth=1.5,zt.strokeStyle="white",zt.textBaseline="top",zt.font="bold 36px Open Sans, sans-serif",zt.fillText(He,5,5),zt.strokeText(He,5,5),vt.debugOverlayTexture.update(dt),vt.debugOverlayTexture.bind(wt.LINEAR,wt.CLAMP_TO_EDGE)}(h,$e+" "+we+"kb"),R.draw(g,S.TRIANGLES,k,$,We.alphaBlended,ut.disabled,al(w,y.Color.transparent,qe),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var ju={symbol:function(h,v,p,g,S){if(h.renderPass==="translucent"){var w=Me.disabled,R=h.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(k,$,oe,be,we,Oe,qe){for(var $e=$.transform,vt=we==="map",He=Oe==="map",dt=0,wt=k;dt<wt.length;dt+=1){var zt=wt[dt],ar=be.getTile(zt),Qt=ar.getBucket(oe);if(Qt&&Qt.text&&Qt.text.segments.get().length){var hr=y.evaluateSizeForZoom(Qt.textSizeData,$e.zoom),Tr=ma(ar,1,$.transform.zoom),Yr=La(zt.posMatrix,He,vt,$.transform,Tr),Ur=oe.layout.get("icon-text-fit")!=="none"&&Qt.hasIconData();if(hr){var _n=Math.pow(2,$e.zoom-ar.tileID.overscaledZ);rf(Qt,vt,He,qe,y.symbolSize,$e,Yr,zt.posMatrix,_n,hr,Ur)}}}}(g,h,p,v,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),S),p.paint.get("icon-opacity").constantOr(1)!==0&&Ol(h,v,p,g,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),w,R),p.paint.get("text-opacity").constantOr(1)!==0&&Ol(h,v,p,g,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),w,R),v.map.showCollisionBoxes&&(Tc(h,v,p,g,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Tc(h,v,p,g,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))}},circle:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("circle-opacity"),w=p.paint.get("circle-stroke-width"),R=p.paint.get("circle-stroke-opacity"),k=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||w.constantOr(1)!==0&&R.constantOr(1)!==0){for(var $=h.context,oe=$.gl,be=h.depthModeForSublayer(0,se.ReadOnly),we=Me.disabled,Oe=h.colorModeForRenderPass(),qe=[],$e=0;$e<g.length;$e++){var vt=g[$e],He=v.getTile(vt),dt=He.getBucket(p);if(dt){var wt=dt.programConfigurations.get(p.id),zt={programConfiguration:wt,program:h.useProgram("circle",wt),layoutVertexBuffer:dt.layoutVertexBuffer,indexBuffer:dt.indexBuffer,uniformValues:Ec(h,vt,He,p)};if(k)for(var ar=0,Qt=dt.segments.get();ar<Qt.length;ar+=1){var hr=Qt[ar];qe.push({segments:new y.SegmentVector([hr]),sortKey:hr.sortKey,state:zt})}else qe.push({segments:dt.segments,sortKey:0,state:zt})}}k&&qe.sort(function(Hn,Vn){return Hn.sortKey-Vn.sortKey});for(var Tr=0,Yr=qe;Tr<Yr.length;Tr+=1){var Ur=Yr[Tr],_n=Ur.state;_n.program.draw($,oe.TRIANGLES,be,we,Oe,ut.disabled,_n.uniformValues,p.id,_n.layoutVertexBuffer,_n.indexBuffer,Ur.segments,p.paint,h.transform.zoom,_n.programConfiguration)}}}},heatmap:function(h,v,p,g){if(p.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var S=h.context,w=S.gl,R=Me.disabled,k=new We([w.ONE,w.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(qe,$e,vt){var He=qe.gl;qe.activeTexture.set(He.TEXTURE1),qe.viewport.set([0,0,$e.width/4,$e.height/4]);var dt=vt.heatmapFbo;if(dt)He.bindTexture(He.TEXTURE_2D,dt.colorAttachment.get()),qe.bindFramebuffer.set(dt.framebuffer);else{var wt=He.createTexture();He.bindTexture(He.TEXTURE_2D,wt),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_WRAP_S,He.CLAMP_TO_EDGE),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_WRAP_T,He.CLAMP_TO_EDGE),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_MIN_FILTER,He.LINEAR),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_MAG_FILTER,He.LINEAR),dt=vt.heatmapFbo=qe.createFramebuffer($e.width/4,$e.height/4,!1),function(zt,ar,Qt,hr){var Tr=zt.gl;Tr.texImage2D(Tr.TEXTURE_2D,0,Tr.RGBA,ar.width/4,ar.height/4,0,Tr.RGBA,zt.extRenderToTextureHalfFloat?zt.extTextureHalfFloat.HALF_FLOAT_OES:Tr.UNSIGNED_BYTE,null),hr.colorAttachment.set(Qt)}(qe,$e,wt,dt)}})(S,h,p),S.clear({color:y.Color.transparent});for(var $=0;$<g.length;$++){var oe=g[$];if(!v.hasRenderableParent(oe)){var be=v.getTile(oe),we=be.getBucket(p);if(we){var Oe=we.programConfigurations.get(p.id);h.useProgram("heatmap",Oe).draw(S,w.TRIANGLES,se.disabled,R,k,ut.disabled,_h(oe.posMatrix,be,h.transform.zoom,p.paint.get("heatmap-intensity")),p.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,p.paint,h.transform.zoom,Oe)}}}S.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(qe,$e){var vt=qe.context,He=vt.gl,dt=$e.heatmapFbo;if(dt){vt.activeTexture.set(He.TEXTURE0),He.bindTexture(He.TEXTURE_2D,dt.colorAttachment.get()),vt.activeTexture.set(He.TEXTURE1);var wt=$e.colorRampTexture;wt||(wt=$e.colorRampTexture=new y.Texture(vt,$e.colorRamp,He.RGBA)),wt.bind(He.LINEAR,He.CLAMP_TO_EDGE),qe.useProgram("heatmapTexture").draw(vt,He.TRIANGLES,se.disabled,Me.disabled,qe.colorModeForRenderPass(),ut.disabled,function(zt,ar,Qt,hr){var Tr=y.create();y.ortho(Tr,0,zt.width,zt.height,0,0,1);var Yr=zt.context.gl;return{u_matrix:Tr,u_world:[Yr.drawingBufferWidth,Yr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ar.paint.get("heatmap-opacity")}}(qe,$e),$e.id,qe.viewportBuffer,qe.quadTriangleIndexBuffer,qe.viewportSegments,$e.paint,qe.transform.zoom)}}(h,p))},line:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("line-opacity"),w=p.paint.get("line-width");if(S.constantOr(1)!==0&&w.constantOr(1)!==0)for(var R=h.depthModeForSublayer(0,se.ReadOnly),k=h.colorModeForRenderPass(),$=p.paint.get("line-dasharray"),oe=p.paint.get("line-pattern"),be=oe.constantOr(1),we=p.paint.get("line-gradient"),Oe=p.getCrossfadeParameters(),qe=be?"linePattern":$?"lineSDF":we?"lineGradient":"line",$e=h.context,vt=$e.gl,He=!0,dt=0,wt=g;dt<wt.length;dt+=1){var zt=wt[dt],ar=v.getTile(zt);if(!be||ar.patternsLoaded()){var Qt=ar.getBucket(p);if(Qt){var hr=Qt.programConfigurations.get(p.id),Tr=h.context.program.get(),Yr=h.useProgram(qe,hr),Ur=He||Yr.program!==Tr,_n=oe.constantOr(null);if(_n&&ar.imageAtlas){var Hn=ar.imageAtlas,Vn=Hn.patternPositions[_n.to.toString()],Wn=Hn.patternPositions[_n.from.toString()];Vn&&Wn&&hr.setConstantPatternPositions(Vn,Wn)}var Wi=be?Pl(h,ar,p,Oe):$?op(h,ar,p,$,Oe):we?ba(h,ar,p,Qt.lineClipsArray.length):Qc(h,ar,p);if(be)$e.activeTexture.set(vt.TEXTURE0),ar.imageAtlasTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),hr.updatePaintBuffers(Oe);else if($&&(Ur||h.lineAtlas.dirty))$e.activeTexture.set(vt.TEXTURE0),h.lineAtlas.bind($e);else if(we){var Tn=Qt.gradients[p.id],ui=Tn.texture;if(p.gradientVersion!==Tn.version){var gi=256;if(p.stepInterpolant){var si=v.getSource().maxzoom,ni=zt.canonical.z===si?Math.ceil(1<<h.transform.maxZoom-zt.canonical.z):1;gi=y.clamp(y.nextPowerOfTwo(Qt.maxLineLength/y.EXTENT*1024*ni),256,$e.maxTextureSize)}Tn.gradient=y.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:gi,image:Tn.gradient||void 0,clips:Qt.lineClipsArray}),Tn.texture?Tn.texture.update(Tn.gradient):Tn.texture=new y.Texture($e,Tn.gradient,vt.RGBA),Tn.version=p.gradientVersion,ui=Tn.texture}$e.activeTexture.set(vt.TEXTURE0),ui.bind(p.stepInterpolant?vt.NEAREST:vt.LINEAR,vt.CLAMP_TO_EDGE)}Yr.draw($e,vt.TRIANGLES,R,h.stencilModeForClipping(zt),k,ut.disabled,Wi,p.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,p.paint,h.transform.zoom,hr,Qt.layoutVertexBuffer2),He=!1}}}}},fill:function(h,v,p,g){var S=p.paint.get("fill-color"),w=p.paint.get("fill-opacity");if(w.constantOr(1)!==0){var R=h.colorModeForRenderPass(),k=p.paint.get("fill-pattern"),$=h.opaquePassEnabledForLayer()&&!k.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===$){var oe=h.depthModeForSublayer(1,h.renderPass==="opaque"?se.ReadWrite:se.ReadOnly);Yl(h,v,p,g,oe,R,!1)}if(h.renderPass==="translucent"&&p.paint.get("fill-antialias")){var be=h.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,se.ReadOnly);Yl(h,v,p,g,be,R,!0)}}},"fill-extrusion":function(h,v,p,g){var S=p.paint.get("fill-extrusion-opacity");if(S!==0&&h.renderPass==="translucent"){var w=new se(h.context.gl.LEQUAL,se.ReadWrite,h.depthRangeFor3D);if(S!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))Mf(h,v,p,g,w,Me.disabled,We.disabled),Mf(h,v,p,g,w,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var R=h.colorModeForRenderPass();Mf(h,v,p,g,w,Me.disabled,R)}}},hillshade:function(h,v,p,g){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var S=h.context,w=h.depthModeForSublayer(0,se.ReadOnly),R=h.colorModeForRenderPass(),k=h.renderPass==="translucent"?h.stencilConfigForOverlap(g):[{},g],$=k[0],oe=0,be=k[1];oe<be.length;oe+=1){var we=be[oe],Oe=v.getTile(we);Oe.needsHillshadePrepare&&h.renderPass==="offscreen"?Eh(h,Oe,p,w,Me.disabled,R):h.renderPass==="translucent"&&ul(h,Oe,p,w,$[we.overscaledZ],R)}S.viewport.set([0,0,h.width,h.height])}},raster:function(h,v,p,g){if(h.renderPass==="translucent"&&p.paint.get("raster-opacity")!==0&&g.length)for(var S=h.context,w=S.gl,R=v.getSource(),k=h.useProgram("raster"),$=h.colorModeForRenderPass(),oe=R instanceof ze?[{},g]:h.stencilConfigForOverlap(g),be=oe[0],we=oe[1],Oe=we[we.length-1].overscaledZ,qe=!h.options.moving,$e=0,vt=we;$e<vt.length;$e+=1){var He=vt[$e],dt=h.depthModeForSublayer(He.overscaledZ-Oe,p.paint.get("raster-opacity")===1?se.ReadWrite:se.ReadOnly,w.LESS),wt=v.getTile(He),zt=h.transform.calculatePosMatrix(He.toUnwrapped(),qe);wt.registerFadeDuration(p.paint.get("raster-fade-duration"));var ar=v.findLoadedParent(He,0),Qt=Sh(wt,ar,v,p,h.transform),hr=void 0,Tr=void 0,Yr=p.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;S.activeTexture.set(w.TEXTURE0),wt.texture.bind(Yr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(w.TEXTURE1),ar?(ar.texture.bind(Yr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),hr=Math.pow(2,ar.tileID.overscaledZ-wt.tileID.overscaledZ),Tr=[wt.tileID.canonical.x*hr%1,wt.tileID.canonical.y*hr%1]):wt.texture.bind(Yr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Ur=ef(zt,Tr||[0,0],hr||1,Qt,p);R instanceof ze?k.draw(S,w.TRIANGLES,dt,Me.disabled,$,ut.disabled,Ur,p.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments):k.draw(S,w.TRIANGLES,dt,be[He.overscaledZ],$,ut.disabled,Ur,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,v,p){var g=p.paint.get("background-color"),S=p.paint.get("background-opacity");if(S!==0){var w=h.context,R=w.gl,k=h.transform,$=k.tileSize,oe=p.paint.get("background-pattern");if(!h.isPatternMissing(oe)){var be=!oe&&g.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===be){var we=Me.disabled,Oe=h.depthModeForSublayer(0,be==="opaque"?se.ReadWrite:se.ReadOnly),qe=h.colorModeForRenderPass(),$e=h.useProgram(oe?"backgroundPattern":"background"),vt=k.coveringTiles({tileSize:$});oe&&(w.activeTexture.set(R.TEXTURE0),h.imageManager.bind(h.context));for(var He=p.getCrossfadeParameters(),dt=0,wt=vt;dt<wt.length;dt+=1){var zt=wt[dt],ar=h.transform.calculatePosMatrix(zt.toUnwrapped()),Qt=oe?$l(ar,S,h,oe,{tileID:zt,tileSize:$},He):Ac(ar,S,g);$e.draw(w,R.TRIANGLES,Oe,we,qe,ut.disabled,Qt,p.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,v,p){for(var g=0;g<p.length;g++)cp(h,v,p[g])},custom:function(h,v,p){var g=h.context,S=p.implementation;if(h.renderPass==="offscreen"){var w=S.prerender;w&&(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),w.call(S,g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Me.disabled);var R=S.renderingMode==="3d"?new se(h.context.gl.LEQUAL,se.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,se.ReadOnly);g.setDepthMode(R),S.render(g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}},Sa=function(h,v){this.context=new W(h),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=ne.maxUnderzooming+ne.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wl,this.gpuTimers={}};Sa.prototype.resize=function(h,v){if(this.width=h*y.browser.devicePixelRatio,this.height=v*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var p=0,g=this.style._order;p<g.length;p+=1)this.style._layers[g[p]].resize()},Sa.prototype.setup=function(){var h=this.context,v=new y.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(y.EXTENT,0),v.emplaceBack(0,y.EXTENT),v.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(v,ro.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var p=new y.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(y.EXTENT,0),p.emplaceBack(0,y.EXTENT),p.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=h.createVertexBuffer(p,ro.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(g,st.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(S,ro.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(w);var R=new y.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(R),this.emptyTexture=new y.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new Me({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},Sa.prototype.clearStencil=function(){var h=this.context,v=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var p=y.create();y.ortho(p,0,this.width,this.height,0,0,1),y.scale(p,p,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,v.TRIANGLES,se.disabled,this.stencilClearMode,We.disabled,ut.disabled,Il(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Sa.prototype._renderTileClippingMasks=function(h,v){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&v&&v.length){this.currentStencilSource=h.source;var p=this.context,g=p.gl;this.nextStencilID+v.length>256&&this.clearStencil(),p.setColorMode(We.disabled),p.setDepthMode(se.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,R=v;w<R.length;w+=1){var k=R[w],$=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;S.draw(p,g.TRIANGLES,se.disabled,new Me({func:g.ALWAYS,mask:0},$,255,g.KEEP,g.KEEP,g.REPLACE),We.disabled,ut.disabled,Il(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Sa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,v=this.context.gl;return new Me({func:v.NOTEQUAL,mask:255},h,255,v.KEEP,v.KEEP,v.REPLACE)},Sa.prototype.stencilModeForClipping=function(h){var v=this.context.gl;return new Me({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,v.KEEP,v.KEEP,v.REPLACE)},Sa.prototype.stencilConfigForOverlap=function(h){var v,p=this.context.gl,g=h.sort(function($,oe){return oe.overscaledZ-$.overscaledZ}),S=g[g.length-1].overscaledZ,w=g[0].overscaledZ-S+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var R={},k=0;k<w;k++)R[k+S]=new Me({func:p.GEQUAL,mask:255},k+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=w,[R,g]}return[(v={},v[S]=Me.disabled,v),g]},Sa.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new We([h.CONSTANT_COLOR,h.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?We.unblended:We.alphaBlended},Sa.prototype.depthModeForSublayer=function(h,v,p){if(!this.opaquePassEnabledForLayer())return se.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new se(p||this.context.gl.LEQUAL,v,[g,g])},Sa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Sa.prototype.render=function(h,v){var p=this;this.style=h,this.options=v,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var w in S){var R=S[w];R.used&&R.prepare(this.context)}var k,$,oe={},be={},we={};for(var Oe in S){var qe=S[Oe];oe[Oe]=qe.getVisibleCoordinates(),be[Oe]=oe[Oe].slice().reverse(),we[Oe]=qe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var $e=0;$e<g.length;$e++)if(this.style._layers[g[$e]].is3D()){this.opaquePassCutoff=$e;break}this.renderPass="offscreen";for(var vt=0,He=g;vt<He.length;vt+=1){var dt=this.style._layers[He[vt]];if(dt.hasOffscreenPass()&&!dt.isHidden(this.transform.zoom)){var wt=be[dt.source];(dt.type==="custom"||wt.length)&&this.renderLayer(this,S[dt.source],dt,wt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var zt=this.style._layers[g[this.currentLayer]],ar=S[zt.source],Qt=oe[zt.source];this._renderTileClippingMasks(zt,Qt),this.renderLayer(this,ar,zt,Qt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var hr=this.style._layers[g[this.currentLayer]],Tr=S[hr.source],Yr=(hr.type==="symbol"?we:be)[hr.source];this._renderTileClippingMasks(hr,oe[hr.source]),this.renderLayer(this,Tr,hr,Yr)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(Ur){Ur.source&&!Ur.isHidden(p.transform.zoom)&&(Ur.source!==($&&$.id)&&($=p.style.sourceCaches[Ur.source]),(!k||k.getSource().maxzoom<$.getSource().maxzoom)&&(k=$))}),k&&ju.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function(Ur){var _n=Ur.transform.padding;Pf(Ur,Ur.transform.height-(_n.top||0),3,Ah),Pf(Ur,_n.bottom||0,3,If),lp(Ur,_n.left||0,3,sp),lp(Ur,Ur.transform.width-(_n.right||0),3,Ya);var Hn=Ur.transform.centerPoint;(function(Vn,Wn,Wi,Tn){ql(Vn,Wn-1,Wi-10,2,20,Tn),ql(Vn,Wn-10,Wi-1,20,2,Tn)})(Ur,Hn.x,Ur.transform.height-Hn.y,up)}(this),this.context.setDefault()},Sa.prototype.renderLayer=function(h,v,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||g.length)&&(this.id=p.id,this.gpuTimingStart(p),ju[p.type](h,v,p,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Sa.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var v=this.context.extTimerQuery,p=this.gpuTimers[h.id];p||(p=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),p.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,p.query)}},Sa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},Sa.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},Sa.prototype.queryGpuTimers=function(h){var v={};for(var p in h){var g=h[p],S=this.context.extTimerQuery,w=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),v[p]=w}return v},Sa.prototype.translatePosMatrix=function(h,v,p,g,S){if(!p[0]&&!p[1])return h;var w=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){var R=Math.sin(w),k=Math.cos(w);p=[p[0]*k-p[1]*R,p[0]*R+p[1]*k]}var $=[S?p[0]:ma(v,p[0],this.transform.zoom),S?p[1]:ma(v,p[1],this.transform.zoom),0],oe=new Float32Array(16);return y.translate(oe,h,$),oe},Sa.prototype.saveTileTexture=function(h){var v=this._tileTextures[h.size[0]];v?v.push(h):this._tileTextures[h.size[0]]=[h]},Sa.prototype.getTileTexture=function(h){var v=this._tileTextures[h];return v&&v.length>0?v.pop():null},Sa.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var v=this.imageManager.getPattern(h.from.toString()),p=this.imageManager.getPattern(h.to.toString());return!v||!p},Sa.prototype.useProgram=function(h,v){this.cache=this.cache||{};var p=""+h+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[p]||(this.cache[p]=new $a(this.context,h,au[h],v,bh[h],this._showOverdrawInspector)),this.cache[p]},Sa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Sa.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},Sa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Sa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Kl=function(h,v){this.points=h,this.planes=v};Kl.fromInvProjectionMatrix=function(h,v,p){var g=Math.pow(2,p),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return y.transformMat4([],R,h)}).map(function(R){return y.scale$1([],R,1/R[3]/v*g)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var k=y.sub([],S[R[0]],S[R[1]]),$=y.sub([],S[R[2]],S[R[1]]),oe=y.normalize([],y.cross([],k,$)),be=-y.dot(oe,S[R[1]]);return oe.concat(be)});return new Kl(S,w)};var Hu=function(h,v){this.min=h,this.max=v,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Hu.prototype.quadrant=function(h){for(var v=[h%2==0,h<2],p=y.clone$2(this.min),g=y.clone$2(this.max),S=0;S<v.length;S++)p[S]=v[S]?this.min[S]:this.center[S],g[S]=v[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new Hu(p,g)},Hu.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},Hu.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},Hu.prototype.intersects=function(h){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],p=!0,g=0;g<h.planes.length;g++){for(var S=h.planes[g],w=0,R=0;R<v.length;R++)w+=y.dot$1(S,v[R])>=0;if(w===0)return 0;w!==v.length&&(p=!1)}if(p)return 2;for(var k=0;k<3;k++){for(var $=Number.MAX_VALUE,oe=-Number.MAX_VALUE,be=0;be<h.points.length;be++){var we=h.points[be][k]-this.min[k];$=Math.min($,we),oe=Math.max(oe,we)}if(oe<0||$>this.max[k]-this.min[k])return 0}return 1};var ll=function(h,v,p,g){if(h===void 0&&(h=0),v===void 0&&(v=0),p===void 0&&(p=0),g===void 0&&(g=0),isNaN(h)||h<0||isNaN(v)||v<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=v,this.left=p,this.right=g};ll.prototype.interpolate=function(h,v,p){return v.top!=null&&h.top!=null&&(this.top=y.number(h.top,v.top,p)),v.bottom!=null&&h.bottom!=null&&(this.bottom=y.number(h.bottom,v.bottom,p)),v.left!=null&&h.left!=null&&(this.left=y.number(h.left,v.left,p)),v.right!=null&&h.right!=null&&(this.right=y.number(h.right,v.right,p)),this},ll.prototype.getCenter=function(h,v){var p=y.clamp((this.left+h-this.right)/2,0,h),g=y.clamp((this.top+v-this.bottom)/2,0,v);return new y.Point(p,g)},ll.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},ll.prototype.clone=function(){return new ll(this.top,this.bottom,this.left,this.right)},ll.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Zi=function(h,v,p,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=h||0,this._maxZoom=v||22,this._minPitch=p==null?0:p,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ll,this._posMatrixCache={},this._alignedPosMatrixCache={}},Aa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Zi.prototype.clone=function(){var h=new Zi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},Aa.minZoom.get=function(){return this._minZoom},Aa.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},Aa.maxZoom.get=function(){return this._maxZoom},Aa.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},Aa.minPitch.get=function(){return this._minPitch},Aa.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},Aa.maxPitch.get=function(){return this._maxPitch},Aa.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},Aa.renderWorldCopies.get=function(){return this._renderWorldCopies},Aa.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},Aa.worldSize.get=function(){return this.tileSize*this.scale},Aa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Aa.size.get=function(){return new y.Point(this.width,this.height)},Aa.bearing.get=function(){return-this.angle/Math.PI*180},Aa.bearing.set=function(h){var v=-y.wrap(h,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Aa.pitch.get=function(){return this._pitch/Math.PI*180},Aa.pitch.set=function(h){var v=y.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},Aa.fov.get=function(){return this._fov/Math.PI*180},Aa.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},Aa.zoom.get=function(){return this._zoom},Aa.zoom.set=function(h){var v=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},Aa.center.get=function(){return this._center},Aa.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},Aa.padding.get=function(){return this._edgeInsets.toJSON()},Aa.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},Aa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Zi.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},Zi.prototype.interpolatePadding=function(h,v,p){this._unmodified=!1,this._edgeInsets.interpolate(h,v,p),this._constrain(),this._calcMatrices()},Zi.prototype.coveringZoomLevel=function(h){var v=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,v)},Zi.prototype.getVisibleUnwrappedCoordinates=function(h){var v=[new y.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var p=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),w=this.pointCoordinate(new y.Point(0,this.height)),R=Math.floor(Math.min(p.x,g.x,S.x,w.x)),k=Math.floor(Math.max(p.x,g.x,S.x,w.x)),$=R-1;$<=k+1;$++)$!==0&&v.push(new y.UnwrappedTileID($,h));return v},Zi.prototype.coveringTiles=function(h){var v=this.coveringZoomLevel(h),p=v;if(h.minzoom!==void 0&&v<h.minzoom)return[];h.maxzoom!==void 0&&v>h.maxzoom&&(v=h.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,v),w=[S*g.x,S*g.y,0],R=Kl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),k=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=v);var $=function(Ur){return{aabb:new Hu([Ur*S,0,0],[(Ur+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Ur,fullyVisible:!1}},oe=[],be=[],we=v,Oe=h.reparseOverscaled?p:v;if(this._renderWorldCopies)for(var qe=1;qe<=3;qe++)oe.push($(-qe)),oe.push($(qe));for(oe.push($(0));oe.length>0;){var $e=oe.pop(),vt=$e.x,He=$e.y,dt=$e.fullyVisible;if(!dt){var wt=$e.aabb.intersects(R);if(wt===0)continue;dt=wt===2}var zt=$e.aabb.distanceX(w),ar=$e.aabb.distanceY(w),Qt=Math.max(Math.abs(zt),Math.abs(ar));if($e.zoom===we||Qt>3+(1<<we-$e.zoom)-2&&$e.zoom>=k)be.push({tileID:new y.OverscaledTileID($e.zoom===we?Oe:$e.zoom,$e.wrap,$e.zoom,vt,He),distanceSq:y.sqrLen([w[0]-.5-vt,w[1]-.5-He])});else for(var hr=0;hr<4;hr++){var Tr=(vt<<1)+hr%2,Yr=(He<<1)+(hr>>1);oe.push({aabb:$e.aabb.quadrant(hr),zoom:$e.zoom+1,x:Tr,y:Yr,wrap:$e.wrap,fullyVisible:dt})}}return be.sort(function(Ur,_n){return Ur.distanceSq-_n.distanceSq}).map(function(Ur){return Ur.tileID})},Zi.prototype.resize=function(h,v){this.width=h,this.height=v,this.pixelsToGLUnits=[2/h,-2/v],this._constrain(),this._calcMatrices()},Aa.unmodified.get=function(){return this._unmodified},Zi.prototype.zoomScale=function(h){return Math.pow(2,h)},Zi.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},Zi.prototype.project=function(h){var v=y.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(h.lng)*this.worldSize,y.mercatorYfromLat(v)*this.worldSize)},Zi.prototype.unproject=function(h){return new y.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},Aa.point.get=function(){return this.project(this.center)},Zi.prototype.setLocationAtPoint=function(h,v){var p=this.pointCoordinate(v),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(h),w=new y.MercatorCoordinate(S.x-(p.x-g.x),S.y-(p.y-g.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Zi.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},Zi.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},Zi.prototype.locationCoordinate=function(h){return y.MercatorCoordinate.fromLngLat(h)},Zi.prototype.coordinateLocation=function(h){return h.toLngLat()},Zi.prototype.pointCoordinate=function(h){var v=[h.x,h.y,0,1],p=[h.x,h.y,1,1];y.transformMat4(v,v,this.pixelMatrixInverse),y.transformMat4(p,p,this.pixelMatrixInverse);var g=v[3],S=p[3],w=v[1]/g,R=p[1]/S,k=v[2]/g,$=p[2]/S,oe=k===$?0:(0-k)/($-k);return new y.MercatorCoordinate(y.number(v[0]/g,p[0]/S,oe)/this.worldSize,y.number(w,R,oe)/this.worldSize)},Zi.prototype.coordinatePoint=function(h){var v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix),new y.Point(v[0]/v[3],v[1]/v[3])},Zi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Zi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Zi.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Zi.prototype.calculatePosMatrix=function(h,v){v===void 0&&(v=!1);var p=h.key,g=v?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];var S=h.canonical,w=this.worldSize/this.zoomScale(S.z),R=S.x+Math.pow(2,S.z)*h.wrap,k=y.identity(new Float64Array(16));return y.translate(k,k,[R*w,S.y*w,0]),y.scale(k,k,[w/y.EXTENT,w/y.EXTENT,1]),y.multiply(k,v?this.alignedProjMatrix:this.projMatrix,k),g[p]=new Float32Array(k),g[p]},Zi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Zi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,v,p,g,S=-90,w=90,R=-180,k=180,$=this.size,oe=this._unmodified;if(this.latRange){var be=this.latRange;S=y.mercatorYfromLat(be[1])*this.worldSize,h=(w=y.mercatorYfromLat(be[0])*this.worldSize)-S<$.y?$.y/(w-S):0}if(this.lngRange){var we=this.lngRange;R=y.mercatorXfromLng(we[0])*this.worldSize,v=(k=y.mercatorXfromLng(we[1])*this.worldSize)-R<$.x?$.x/(k-R):0}var Oe=this.point,qe=Math.max(v||0,h||0);if(qe)return this.center=this.unproject(new y.Point(v?(k+R)/2:Oe.x,h?(w+S)/2:Oe.y)),this.zoom+=this.scaleZoom(qe),this._unmodified=oe,void(this._constraining=!1);if(this.latRange){var $e=Oe.y,vt=$.y/2;$e-vt<S&&(g=S+vt),$e+vt>w&&(g=w-vt)}if(this.lngRange){var He=Oe.x,dt=$.x/2;He-dt<R&&(p=R+dt),He+dt>k&&(p=k-dt)}p===void 0&&g===void 0||(this.center=this.unproject(new y.Point(p!==void 0?p:Oe.x,g!==void 0?g:Oe.y))),this._unmodified=oe,this._constraining=!1}},Zi.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,p=this._fov*(.5+h.y/this.height),g=Math.sin(p)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-v-p,.01,Math.PI-.01)),S=this.point,w=S.x,R=S.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),$=this.height/50,oe=new Float64Array(16);y.perspective(oe,this._fov,this.width/this.height,$,k),oe[8]=2*-h.x/this.width,oe[9]=2*h.y/this.height,y.scale(oe,oe,[1,-1,1]),y.translate(oe,oe,[0,0,-this.cameraToCenterDistance]),y.rotateX(oe,oe,this._pitch),y.rotateZ(oe,oe,this.angle),y.translate(oe,oe,[-w,-R,0]),this.mercatorMatrix=y.scale([],oe,[this.worldSize,this.worldSize,this.worldSize]),y.scale(oe,oe,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=oe,this.invProjMatrix=y.invert([],this.projMatrix);var be=this.width%2/2,we=this.height%2/2,Oe=Math.cos(this.angle),qe=Math.sin(this.angle),$e=w-Math.round(w)+Oe*be+qe*we,vt=R-Math.round(R)+Oe*we+qe*be,He=new Float64Array(oe);if(y.translate(He,He,[$e>.5?$e-1:$e,vt>.5?vt-1:vt,0]),this.alignedProjMatrix=He,oe=y.create(),y.scale(oe,oe,[this.width/2,-this.height/2,1]),y.translate(oe,oe,[1,-1,0]),this.labelPlaneMatrix=oe,oe=y.create(),y.scale(oe,oe,[1,-1,1]),y.translate(oe,oe,[-1,-1,0]),y.scale(oe,oe,[2/this.width,2/this.height,1]),this.glCoordMatrix=oe,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(oe=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=oe,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Zi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new y.Point(0,0)),v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},Zi.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,h))},Zi.prototype.getCameraQueryGeometry=function(h){var v=this.getCameraPoint();if(h.length===1)return[h[0],v];for(var p=v.x,g=v.y,S=v.x,w=v.y,R=0,k=h;R<k.length;R+=1){var $=k[R];p=Math.min(p,$.x),g=Math.min(g,$.y),S=Math.max(S,$.x),w=Math.max(w,$.y)}return[new y.Point(p,g),new y.Point(S,g),new y.Point(S,w),new y.Point(p,w),new y.Point(p,g)]},Object.defineProperties(Zi.prototype,Aa);var ou=function(h){var v,p,g,S;this._hashName=h&&encodeURIComponent(h),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),p=!1,g=null,S=function(){g=null,p&&(v(),g=setTimeout(S,300),p=!1)},function(){return p=!0,g||S(),g})};ou.prototype.addTo=function(h){return this._map=h,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ou.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ou.prototype.getHashString=function(h){var v=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),w=Math.round(v.lng*S)/S,R=Math.round(v.lat*S)/S,k=this._map.getBearing(),$=this._map.getPitch(),oe="";if(oe+=h?"/"+w+"/"+R+"/"+p:p+"/"+R+"/"+w,(k||$)&&(oe+="/"+Math.round(10*k)/10),$&&(oe+="/"+Math.round($)),this._hashName){var be=this._hashName,we=!1,Oe=y.window.location.hash.slice(1).split("&").map(function(qe){var $e=qe.split("=")[0];return $e===be?(we=!0,$e+"="+oe):qe}).filter(function(qe){return qe});return we||Oe.push(be+"="+oe),"#"+Oe.join("&")}return"#"+oe},ou.prototype._getCurrentHash=function(){var h,v=this,p=y.window.location.hash.replace("#","");return this._hashName?(p.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===v._hashName&&(h=g)}),(h&&h[1]||"").split("/")):p.split("/")},ou.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(p){return isNaN(p)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1},ou.prototype._updateHashUnthrottled=function(){var h=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,h)}catch(v){}};var nf={linearity:.3,easing:y.bezier(0,0,.3,1)},af=y.extend({deceleration:2500,maxSpeed:1400},nf),Qs=y.extend({deceleration:20,maxSpeed:1400},nf),fp=y.extend({deceleration:1e3,maxSpeed:360},nf),Of=y.extend({deceleration:1e3,maxSpeed:90},nf),kf=function(h){this._map=h,this.clear()};function Ql(h,v){(!h.duration||h.duration<v.duration)&&(h.duration=v.duration,h.easing=v.easing)}function Co(h,v,p){var g=p.maxSpeed,S=p.linearity,w=p.deceleration,R=y.clamp(h*S/(v/1e3),-g,g),k=Math.abs(R)/(w*S);return{easing:p.easing,duration:1e3*k,amount:R*(k/2)}}kf.prototype.clear=function(){this._inertiaBuffer=[]},kf.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:h})},kf.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,v=y.browser.now();h.length>0&&v-h[0].time>160;)h.shift()},kf.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},p=0,g=this._inertiaBuffer;p<g.length;p+=1){var S=g[p].settings;v.zoom+=S.zoomDelta||0,v.bearing+=S.bearingDelta||0,v.pitch+=S.pitchDelta||0,S.panDelta&&v.pan._add(S.panDelta),S.around&&(v.around=S.around),S.pinchAround&&(v.pinchAround=S.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(v.pan.mag()){var k=Co(v.pan.mag(),w,y.extend({},af,h||{}));R.offset=v.pan.mult(k.amount/v.pan.mag()),R.center=this._map.transform.center,Ql(R,k)}if(v.zoom){var $=Co(v.zoom,w,Qs);R.zoom=this._map.transform.zoom+$.amount,Ql(R,$)}if(v.bearing){var oe=Co(v.bearing,w,fp);R.bearing=this._map.transform.bearing+y.clamp(oe.amount,-179,179),Ql(R,oe)}if(v.pitch){var be=Co(v.pitch,w,Of);R.pitch=this._map.transform.pitch+be.amount,Ql(R,be)}if(R.zoom||R.bearing){var we=v.pinchAround===void 0?v.around:v.pinchAround;R.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),y.extend(R,{noMoveStart:!0})}};var qa=function(h){function v(g,S,w,R){R===void 0&&(R={});var k=P.mousePos(S.getCanvasContainer(),w),$=S.unproject(k);h.call(this,g,y.extend({point:k,lngLat:$,originalEvent:w},R)),this._defaultPrevented=!1,this.target=S}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),of=function(h){function v(g,S,w){var R=g==="touchend"?w.changedTouches:w.touches,k=P.touchPos(S.getCanvasContainer(),R),$=k.map(function(we){return S.unproject(we)}),oe=k.reduce(function(we,Oe,qe,$e){return we.add(Oe.div($e.length))},new y.Point(0,0)),be=S.unproject(oe);h.call(this,g,{points:k,point:oe,lngLats:$,lngLat:be,originalEvent:w}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),Cc=function(h){function v(g,S,w){h.call(this,g,{originalEvent:w}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),uo=function(h,v){this._map=h,this._clickTolerance=v.clickTolerance};uo.prototype.reset=function(){delete this._mousedownPos},uo.prototype.wheel=function(h){return this._firePreventable(new Cc(h.type,this._map,h))},uo.prototype.mousedown=function(h,v){return this._mousedownPos=v,this._firePreventable(new qa(h.type,this._map,h))},uo.prototype.mouseup=function(h){this._map.fire(new qa(h.type,this._map,h))},uo.prototype.click=function(h,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new qa(h.type,this._map,h))},uo.prototype.dblclick=function(h){return this._firePreventable(new qa(h.type,this._map,h))},uo.prototype.mouseover=function(h){this._map.fire(new qa(h.type,this._map,h))},uo.prototype.mouseout=function(h){this._map.fire(new qa(h.type,this._map,h))},uo.prototype.touchstart=function(h){return this._firePreventable(new of(h.type,this._map,h))},uo.prototype.touchmove=function(h){this._map.fire(new of(h.type,this._map,h))},uo.prototype.touchend=function(h){this._map.fire(new of(h.type,this._map,h))},uo.prototype.touchcancel=function(h){this._map.fire(new of(h.type,this._map,h))},uo.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},uo.prototype.isEnabled=function(){return!0},uo.prototype.isActive=function(){return!1},uo.prototype.enable=function(){},uo.prototype.disable=function(){};var Mn=function(h){this._map=h};Mn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Mn.prototype.mousemove=function(h){this._map.fire(new qa(h.type,this._map,h))},Mn.prototype.mousedown=function(){this._delayContextMenu=!0},Mn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Mn.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new qa(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},Mn.prototype.isEnabled=function(){return!0},Mn.prototype.isActive=function(){return!1},Mn.prototype.enable=function(){},Mn.prototype.disable=function(){};var ys=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=v.clickTolerance||1};function Df(h,v){for(var p={},g=0;g<h.length;g++)p[h[g].identifier]=v[g];return p}ys.prototype.isEnabled=function(){return!!this._enabled},ys.prototype.isActive=function(){return!!this._active},ys.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ys.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ys.prototype.mousedown=function(h,v){this.isEnabled()&&h.shiftKey&&h.button===0&&(P.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},ys.prototype.mousemoveWindow=function(h,v){if(this._active){var p=v;if(!(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=p,this._box||(this._box=P.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var S=Math.min(g.x,p.x),w=Math.max(g.x,p.x),R=Math.min(g.y,p.y),k=Math.max(g.y,p.y);P.setTransform(this._box,"translate("+S+"px,"+R+"px)"),this._box.style.width=w-S+"px",this._box.style.height=k-R+"px"}}},ys.prototype.mouseupWindow=function(h,v){var p=this;if(this._active&&h.button===0){var g=this._startPos,S=v;if(this.reset(),P.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(w){return w.fitScreenCoordinates(g,S,p._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},ys.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},ys.prototype.blur=function(){this.reset()},ys.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos},ys.prototype._fireEvent=function(h,v){return this._map.fire(new y.Event(h,{originalEvent:v}))};var Rc=function(h){this.reset(),this.numTouches=h.numTouches};Rc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Rc.prototype.touchstart=function(h,v,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){for(var S=new y.Point(0,0),w=0,R=g;w<R.length;w+=1)S._add(R[w]);return S.div(g.length)}(v),this.touches=Df(p,v)))},Rc.prototype.touchmove=function(h,v,p){if(!this.aborted&&this.centroid){var g=Df(p,v);for(var S in this.touches){var w=g[S];(!w||w.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Rc.prototype.touchend=function(h,v,p){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var ls=function(h){this.singleTap=new Rc(h),this.numTaps=h.numTaps,this.reset()};ls.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ls.prototype.touchstart=function(h,v,p){this.singleTap.touchstart(h,v,p)},ls.prototype.touchmove=function(h,v,p){this.singleTap.touchmove(h,v,p)},ls.prototype.touchend=function(h,v,p){var g=this.singleTap.touchend(h,v,p);if(g){var S=h.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(S&&w||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var xa=function(){this._zoomIn=new ls({numTouches:1,numTaps:2}),this._zoomOut=new ls({numTouches:2,numTaps:1}),this.reset()};xa.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},xa.prototype.touchstart=function(h,v,p){this._zoomIn.touchstart(h,v,p),this._zoomOut.touchstart(h,v,p)},xa.prototype.touchmove=function(h,v,p){this._zoomIn.touchmove(h,v,p),this._zoomOut.touchmove(h,v,p)},xa.prototype.touchend=function(h,v,p){var g=this,S=this._zoomIn.touchend(h,v,p),w=this._zoomOut.touchend(h,v,p);return S?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:h})}}):w?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(w)},{originalEvent:h})}}):void 0},xa.prototype.touchcancel=function(){this.reset()},xa.prototype.enable=function(){this._enabled=!0},xa.prototype.disable=function(){this._enabled=!1,this.reset()},xa.prototype.isEnabled=function(){return this._enabled},xa.prototype.isActive=function(){return this._active};var Lf={0:1,2:2},cn=function(h){this.reset(),this._clickTolerance=h.clickTolerance||1};cn.prototype.blur=function(){this.reset()},cn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},cn.prototype._correctButton=function(h,v){return!1},cn.prototype._move=function(h,v){return{}},cn.prototype.mousedown=function(h,v){if(!this._lastPoint){var p=P.mouseButton(h);this._correctButton(h,p)&&(this._lastPoint=v,this._eventButton=p)}},cn.prototype.mousemoveWindow=function(h,v){var p=this._lastPoint;if(p){if(h.preventDefault(),function(g,S){var w=Lf[S];return g.buttons===void 0||(g.buttons&w)!==w}(h,this._eventButton))this.reset();else if(this._moved||!(v.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(p,v)}},cn.prototype.mouseupWindow=function(h){this._lastPoint&&P.mouseButton(h)===this._eventButton&&(this._moved&&P.suppressClick(),this.reset())},cn.prototype.enable=function(){this._enabled=!0},cn.prototype.disable=function(){this._enabled=!1,this.reset()},cn.prototype.isEnabled=function(){return this._enabled},cn.prototype.isActive=function(){return this._active};var cl=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.mousedown=function(p,g){h.prototype.mousedown.call(this,p,g),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(p,g){return g===0&&!p.ctrlKey},v.prototype._move=function(p,g){return{around:g,panDelta:g.sub(p)}},v}(cn),sf=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=.8*(g.x-p.x);if(S)return this._active=!0,{bearingDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(cn),uf=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=-.5*(g.y-p.y);if(S)return this._active=!0,{pitchDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(cn),yu=function(h){this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset()};yu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},yu.prototype.touchstart=function(h,v,p){return this._calculateTransform(h,v,p)},yu.prototype.touchmove=function(h,v,p){if(this._active&&!(p.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,v,p)},yu.prototype.touchend=function(h,v,p){this._calculateTransform(h,v,p),this._active&&p.length<this._minTouches&&this.reset()},yu.prototype.touchcancel=function(){this.reset()},yu.prototype._calculateTransform=function(h,v,p){p.length>0&&(this._active=!0);var g=Df(p,v),S=new y.Point(0,0),w=new y.Point(0,0),R=0;for(var k in g){var $=g[k],oe=this._touches[k];oe&&(S._add($),w._add($.sub(oe)),R++,g[k]=$)}if(this._touches=g,!(R<this._minTouches)&&w.mag()){var be=w.div(R);if(this._sum._add(be),!(this._sum.mag()<this._clickTolerance))return{around:S.div(R),panDelta:be}}},yu.prototype.enable=function(){this._enabled=!0},yu.prototype.disable=function(){this._enabled=!1,this.reset()},yu.prototype.isEnabled=function(){return this._enabled},yu.prototype.isActive=function(){return this._active};var Zs=function(){this.reset()};function Bf(h,v,p){for(var g=0;g<h.length;g++)if(h[g].identifier===p)return v[g]}function Ff(h,v){return Math.log(h/v)/Math.LN2}Zs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Zs.prototype._start=function(h){},Zs.prototype._move=function(h,v,p){return{}},Zs.prototype.touchstart=function(h,v,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([v[0],v[1]]))},Zs.prototype.touchmove=function(h,v,p){if(this._firstTwoTouches){h.preventDefault();var g=this._firstTwoTouches,S=g[1],w=Bf(p,v,g[0]),R=Bf(p,v,S);if(w&&R){var k=this._aroundCenter?null:w.add(R).div(2);return this._move([w,R],k,h)}}},Zs.prototype.touchend=function(h,v,p){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],w=Bf(p,v,g[0]),R=Bf(p,v,S);w&&R||(this._active&&P.suppressClick(),this.reset())}},Zs.prototype.touchcancel=function(){this.reset()},Zs.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},Zs.prototype.disable=function(){this._enabled=!1,this.reset()},Zs.prototype.isEnabled=function(){return this._enabled},Zs.prototype.isActive=function(){return this._active};var _s=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(p){this._startDistance=this._distance=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._distance;if(this._distance=p[0].dist(p[1]),this._active||!(Math.abs(Ff(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ff(this._distance,S),pinchAround:g}},v}(Zs);function _u(h,v){return 180*h.angleWith(v)/Math.PI}var hp=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(p){this._startVector=this._vector=p[0].sub(p[1]),this._minDiameter=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._vector;if(this._vector=p[0].sub(p[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_u(this._vector,S),pinchAround:g}},v.prototype._isBelowThreshold=function(p){this._minDiameter=Math.min(this._minDiameter,p.mag());var g=25/(Math.PI*this._minDiameter)*360,S=_u(p,this._startVector);return Math.abs(S)<g},v}(Zs);function Mc(h){return Math.abs(h.y)>Math.abs(h.x)}var Ic=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(p){this._lastPoints=p,Mc(p[0].sub(p[1]))&&(this._valid=!1)},v.prototype._move=function(p,g,S){var w=p[0].sub(this._lastPoints[0]),R=p[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,R,S.timeStamp),this._valid)return this._lastPoints=p,this._active=!0,{pitchDelta:(w.y+R.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(p,g,S){if(this._valid!==void 0)return this._valid;var w=p.mag()>=2,R=g.mag()>=2;if(w||R){if(!w||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var k=p.y>0==g.y>0;return Mc(p)&&Mc(g)&&k}},v}(Zs),Nf={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var h=Nf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1};function Nt(h){return h*(2-h)}Js.prototype.blur=function(){this.reset()},Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(h){var v=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var p=0,g=0,S=0,w=0,R=0;switch(h.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:h.shiftKey?g=-1:(h.preventDefault(),w=-1);break;case 39:h.shiftKey?g=1:(h.preventDefault(),w=1);break;case 38:h.shiftKey?S=1:(h.preventDefault(),R=-1);break;case 40:h.shiftKey?S=-1:(h.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(k){var $=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Nt,zoom:p?Math.round($)+p*(h.shiftKey?2:1):$,bearing:k.getBearing()+g*v._bearingStep,pitch:k.getPitch()+S*v._pitchStep,offset:[-w*v._panStep,-R*v._panStep],center:k.getCenter()},{originalEvent:h})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var Le=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Le.prototype.setZoomRate=function(h){this._defaultZoomRate=h},Le.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},Le.prototype.isEnabled=function(){return!!this._enabled},Le.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Le.prototype.isZooming=function(){return!!this._zooming},Le.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},Le.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Le.prototype.wheel=function(h){if(this.isEnabled()){var v=h.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,p=y.browser.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(g*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),h.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=h,this._delta-=v,this._active||this._start(h)),h.preventDefault()}},Le.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},Le.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=P.mousePos(this._el,h);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Le.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var p=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,R=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,k=this._startZoom,$=this._easing,oe=!1;if(this._type==="wheel"&&k&&$){var be=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),we=$(be);w=y.number(k,R,we),be<1?this._frameId||(this._frameId=!0):oe=!0}else w=R,oe=!0;return this._active=!0,oe&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!oe,zoomDelta:w-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Le.prototype._smoothOutEasing=function(h){var v=y.ease;if(this._prevEase){var p=this._prevEase,g=(y.browser.now()-p.start)/p.duration,S=p.easing(g+.01)-p.easing(g),w=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-w*w);v=y.bezier(w,R,.25,1)}return this._prevEase={start:y.browser.now(),duration:h,easing:v},v},Le.prototype.blur=function(){this.reset()},Le.prototype.reset=function(){this._active=!1};var F=function(h,v){this._clickZoom=h,this._tapZoom=v};F.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},F.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},F.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},F.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var eu=function(){this.reset()};eu.prototype.reset=function(){this._active=!1},eu.prototype.blur=function(){this.reset()},eu.prototype.dblclick=function(h,v){return h.preventDefault(),{cameraAnimation:function(p){p.easeTo({duration:300,zoom:p.getZoom()+(h.shiftKey?-1:1),around:p.unproject(v)},{originalEvent:h})}}},eu.prototype.enable=function(){this._enabled=!0},eu.prototype.disable=function(){this._enabled=!1,this.reset()},eu.prototype.isEnabled=function(){return this._enabled},eu.prototype.isActive=function(){return this._active};var ve=function(){this._tap=new ls({numTouches:1,numTaps:1}),this.reset()};ve.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ve.prototype.touchstart=function(h,v,p){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=v[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(h,v,p))},ve.prototype.touchmove=function(h,v,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;var g=v[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,h.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(h,v,p)},ve.prototype.touchend=function(h,v,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(h,v,p)&&(this._tapTime=h.timeStamp)},ve.prototype.touchcancel=function(){this.reset()},ve.prototype.enable=function(){this._enabled=!0},ve.prototype.disable=function(){this._enabled=!1,this.reset()},ve.prototype.isEnabled=function(){return this._enabled},ve.prototype.isActive=function(){return this._active};var kl=function(h,v,p){this._el=h,this._mousePan=v,this._touchPan=p};kl.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},kl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},kl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},kl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Wu=function(h,v,p){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=v,this._mousePitch=p};Wu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Wu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Wu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Wu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var su=function(h,v,p,g){this._el=h,this._touchZoom=v,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};su.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},su.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},su.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},su.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},su.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},su.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ro=function(h){return h.zoom||h.drag||h.pitch||h.rotate},bs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v}(y.Event);function Zn(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var Pn=function(h,v){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kf(h),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),y.bindAll(["handleEvent","handleWindowEvent"],this);var p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var w=S[g],R=w[0];P.addEventListener(R,w[1],R===y.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Pn.prototype.destroy=function(){for(var h=0,v=this._listeners;h<v.length;h+=1){var p=v[h],g=p[0];P.removeEventListener(g,p[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,p[2])}},Pn.prototype._addDefaultHandlers=function(h){var v=this._map,p=v.getCanvasContainer();this._add("mapEvent",new uo(v,h));var g=v.boxZoom=new ys(v,h);this._add("boxZoom",g);var S=new xa,w=new eu;v.doubleClickZoom=new F(w,S),this._add("tapZoom",S),this._add("clickZoom",w);var R=new ve;this._add("tapDragZoom",R);var k=v.touchPitch=new Ic;this._add("touchPitch",k);var $=new sf(h),oe=new uf(h);v.dragRotate=new Wu(h,$,oe),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",oe,["mouseRotate"]);var be=new cl(h),we=new yu(h);v.dragPan=new kl(p,be,we),this._add("mousePan",be),this._add("touchPan",we,["touchZoom","touchRotate"]);var Oe=new hp,qe=new _s;v.touchZoomRotate=new su(p,qe,Oe,R),this._add("touchRotate",Oe,["touchPan","touchZoom"]),this._add("touchZoom",qe,["touchPan","touchRotate"]);var $e=v.scrollZoom=new Le(v,this);this._add("scrollZoom",$e,["mousePan"]);var vt=v.keyboard=new Js;this._add("keyboard",vt),this._add("blockableMapEvent",new Mn(v));for(var He=0,dt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];He<dt.length;He+=1){var wt=dt[He];h.interactive&&h[wt]&&v[wt].enable(h[wt])}},Pn.prototype._add=function(h,v,p){this._handlers.push({handlerName:h,handler:v,allowed:p}),this._handlersById[h]=v},Pn.prototype.stop=function(h){if(!this._updatingCamera){for(var v=0,p=this._handlers;v<p.length;v+=1)p[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},Pn.prototype.isActive=function(){for(var h=0,v=this._handlers;h<v.length;h+=1)if(v[h].handler.isActive())return!0;return!1},Pn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Pn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Pn.prototype.isMoving=function(){return!!Ro(this._eventsInProgress)||this.isZooming()},Pn.prototype._blockedByActive=function(h,v,p){for(var g in h)if(g!==p&&(!v||v.indexOf(g)<0))return!0;return!1},Pn.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},Pn.prototype._getMapTouches=function(h){for(var v=[],p=0,g=h;p<g.length;p+=1){var S=g[p];this._el.contains(S.target)&&v.push(S)}return v},Pn.prototype.handleEvent=function(h,v){this._updatingCamera=!0;for(var p=h.type==="renderFrame"?void 0:h,g={needsRenderFrame:!1},S={},w={},R=h.touches?this._getMapTouches(h.touches):void 0,k=R?P.touchPos(this._el,R):P.mousePos(this._el,h),$=0,oe=this._handlers;$<oe.length;$+=1){var be=oe[$],we=be.handlerName,Oe=be.handler,qe=be.allowed;if(Oe.isEnabled()){var $e=void 0;this._blockedByActive(w,qe,we)?Oe.reset():Oe[v||h.type]&&($e=Oe[v||h.type](h,k,R),this.mergeHandlerResult(g,S,$e,we,p),$e&&$e.needsRenderFrame&&this._triggerRenderFrame()),($e||Oe.isActive())&&(w[we]=Oe)}}var vt={};for(var He in this._previousActiveHandlers)w[He]||(vt[He]=p);this._previousActiveHandlers=w,(Object.keys(vt).length||Zn(g))&&(this._changes.push([g,S,vt]),this._triggerRenderFrame()),(Object.keys(w).length||Zn(g))&&this._map._stop(!0),this._updatingCamera=!1;var dt=g.cameraAnimation;dt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],dt(this._map))},Pn.prototype.mergeHandlerResult=function(h,v,p,g,S){if(p){y.extend(h,p);var w={handlerName:g,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(v.zoom=w),p.panDelta!==void 0&&(v.drag=w),p.pitchDelta!==void 0&&(v.pitch=w),p.bearingDelta!==void 0&&(v.rotate=w)}},Pn.prototype._applyChanges=function(){for(var h={},v={},p={},g=0,S=this._changes;g<S.length;g+=1){var w=S[g],R=w[0],k=w[1],$=w[2];R.panDelta&&(h.panDelta=(h.panDelta||new y.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(h.around=R.around),R.pinchAround!==void 0&&(h.pinchAround=R.pinchAround),R.noInertia&&(h.noInertia=R.noInertia),y.extend(v,k),y.extend(p,$)}this._updateMapTransform(h,v,p),this._changes=[]},Pn.prototype._updateMapTransform=function(h,v,p){var g=this._map,S=g.transform;if(!Zn(h))return this._fireEvents(v,p,!0);var w=h.panDelta,R=h.zoomDelta,k=h.bearingDelta,$=h.pitchDelta,oe=h.around,be=h.pinchAround;be!==void 0&&(oe=be),g._stop(!0),oe=oe||g.transform.centerPoint;var we=S.pointLocation(w?oe.sub(w):oe);k&&(S.bearing+=k),$&&(S.pitch+=$),R&&(S.zoom+=R),S.setLocationAtPoint(we,oe),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(v,p,!0)},Pn.prototype._fireEvents=function(h,v,p){var g=this,S=Ro(this._eventsInProgress),w=Ro(h),R={};for(var k in h)this._eventsInProgress[k]||(R[k+"start"]=h[k].originalEvent),this._eventsInProgress[k]=h[k];for(var $ in!S&&w&&this._fireEvent("movestart",w.originalEvent),R)this._fireEvent($,R[$]);for(var oe in w&&this._fireEvent("move",w.originalEvent),h)this._fireEvent(oe,h[oe].originalEvent);var be,we={};for(var Oe in this._eventsInProgress){var qe=this._eventsInProgress[Oe],$e=qe.handlerName,vt=qe.originalEvent;this._handlersById[$e].isActive()||(delete this._eventsInProgress[Oe],we[Oe+"end"]=be=v[$e]||vt)}for(var He in we)this._fireEvent(He,we[He]);var dt=Ro(this._eventsInProgress);if(p&&(S||w)&&!dt){this._updatingCamera=!0;var wt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),zt=function(ar){return ar!==0&&-g._bearingSnap<ar&&ar<g._bearingSnap};wt?(zt(wt.bearing||this._map.getBearing())&&(wt.bearing=0),this._map.easeTo(wt,{originalEvent:be})):(this._map.fire(new y.Event("moveend",{originalEvent:be})),zt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Pn.prototype._fireEvent=function(h,v){this._map.fire(new y.Event(h,v?{originalEvent:v}:{}))},Pn.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete h._frameId,h.handleEvent(new bs("renderFrame",{timeStamp:v})),h._applyChanges()})},Pn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var cs=function(h){function v(p,g){h.call(this),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(p,g){return this.jumpTo({center:p},g)},v.prototype.panBy=function(p,g,S){return p=y.Point.convert(p).mult(-1),this.panTo(this.transform.center,y.extend({offset:p},g),S)},v.prototype.panTo=function(p,g,S){return this.easeTo(y.extend({center:p},g),S)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(p,g){return this.jumpTo({zoom:p},g),this},v.prototype.zoomTo=function(p,g,S){return this.easeTo(y.extend({zoom:p},g),S)},v.prototype.zoomIn=function(p,g){return this.zoomTo(this.getZoom()+1,p,g),this},v.prototype.zoomOut=function(p,g){return this.zoomTo(this.getZoom()-1,p,g),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(p,g){return this.jumpTo({bearing:p},g),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(p,g){return this.jumpTo({padding:p},g),this},v.prototype.rotateTo=function(p,g,S){return this.easeTo(y.extend({bearing:p},g),S)},v.prototype.resetNorth=function(p,g){return this.rotateTo(0,y.extend({duration:1e3},p),g),this},v.prototype.resetNorthPitch=function(p,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},p),g),this},v.prototype.snapToNorth=function(p,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,g):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(p,g){return this.jumpTo({pitch:p},g),this},v.prototype.cameraForBounds=function(p,g){p=y.LngLatBounds.convert(p);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(p.getNorthWest(),p.getSouthEast(),S,g)},v.prototype._cameraForBoxAndBearing=function(p,g,S,w){var R={top:0,bottom:0,right:0,left:0};if(typeof(w=y.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var k=w.padding;w.padding={top:k,bottom:k,right:k,left:k}}w.padding=y.extend(R,w.padding);var $=this.transform,oe=$.padding,be=$.project(y.LngLat.convert(p)),we=$.project(y.LngLat.convert(g)),Oe=be.rotate(-S*Math.PI/180),qe=we.rotate(-S*Math.PI/180),$e=new y.Point(Math.max(Oe.x,qe.x),Math.max(Oe.y,qe.y)),vt=new y.Point(Math.min(Oe.x,qe.x),Math.min(Oe.y,qe.y)),He=$e.sub(vt),dt=($.width-(oe.left+oe.right+w.padding.left+w.padding.right))/He.x,wt=($.height-(oe.top+oe.bottom+w.padding.top+w.padding.bottom))/He.y;if(!(wt<0||dt<0)){var zt=Math.min($.scaleZoom($.scale*Math.min(dt,wt)),w.maxZoom),ar=typeof w.offset.x=="number"?new y.Point(w.offset.x,w.offset.y):y.Point.convert(w.offset),Qt=new y.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(S*Math.PI/180),hr=ar.add(Qt).mult($.scale/$.zoomScale(zt));return{center:$.unproject(be.add(we).div(2).sub(hr)),zoom:zt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(p,g,S){return this._fitInternal(this.cameraForBounds(p,g),g,S)},v.prototype.fitScreenCoordinates=function(p,g,S,w,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(p)),this.transform.pointLocation(y.Point.convert(g)),S,w),w,R)},v.prototype._fitInternal=function(p,g,S){return p?(delete(g=y.extend(p,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},v.prototype.jumpTo=function(p,g){this.stop();var S=this.transform,w=!1,R=!1,k=!1;return"zoom"in p&&S.zoom!==+p.zoom&&(w=!0,S.zoom=+p.zoom),p.center!==void 0&&(S.center=y.LngLat.convert(p.center)),"bearing"in p&&S.bearing!==+p.bearing&&(R=!0,S.bearing=+p.bearing),"pitch"in p&&S.pitch!==+p.pitch&&(k=!0,S.pitch=+p.pitch),p.padding==null||S.isPaddingEqual(p.padding)||(S.padding=p.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),w&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),R&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),k&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},v.prototype.easeTo=function(p,g){var S=this;this._stop(!1,p.easeId),((p=y.extend({offset:[0,0],duration:500,easing:y.ease},p)).animate===!1||!p.essential&&y.browser.prefersReducedMotion)&&(p.duration=0);var w=this.transform,R=this.getZoom(),k=this.getBearing(),$=this.getPitch(),oe=this.getPadding(),be="zoom"in p?+p.zoom:R,we="bearing"in p?this._normalizeBearing(p.bearing,k):k,Oe="pitch"in p?+p.pitch:$,qe="padding"in p?p.padding:w.padding,$e=y.Point.convert(p.offset),vt=w.centerPoint.add($e),He=w.pointLocation(vt),dt=y.LngLat.convert(p.center||He);this._normalizeCenter(dt);var wt,zt,ar=w.project(He),Qt=w.project(dt).sub(ar),hr=w.zoomScale(be-R);p.around&&(wt=y.LngLat.convert(p.around),zt=w.locationPoint(wt));var Tr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==R,this._rotating=this._rotating||k!==we,this._pitching=this._pitching||Oe!==$,this._padding=!w.isPaddingEqual(qe),this._easeId=p.easeId,this._prepareEase(g,p.noMoveStart,Tr),this._ease(function(Yr){if(S._zooming&&(w.zoom=y.number(R,be,Yr)),S._rotating&&(w.bearing=y.number(k,we,Yr)),S._pitching&&(w.pitch=y.number($,Oe,Yr)),S._padding&&(w.interpolatePadding(oe,qe,Yr),vt=w.centerPoint.add($e)),wt)w.setLocationAtPoint(wt,zt);else{var Ur=w.zoomScale(w.zoom-R),_n=be>R?Math.min(2,hr):Math.max(.5,hr),Hn=Math.pow(_n,1-Yr),Vn=w.unproject(ar.add(Qt.mult(Yr*Hn)).mult(Ur));w.setLocationAtPoint(w.renderWorldCopies?Vn.wrap():Vn,vt)}S._fireMoveEvents(g)},function(Yr){S._afterEase(g,Yr)},p),this},v.prototype._prepareEase=function(p,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new y.Event("movestart",p)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",p)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",p)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",p))},v.prototype._fireMoveEvents=function(p){this.fire(new y.Event("move",p)),this._zooming&&this.fire(new y.Event("zoom",p)),this._rotating&&this.fire(new y.Event("rotate",p)),this._pitching&&this.fire(new y.Event("pitch",p))},v.prototype._afterEase=function(p,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,w=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",p)),w&&this.fire(new y.Event("rotateend",p)),R&&this.fire(new y.Event("pitchend",p)),this.fire(new y.Event("moveend",p))}},v.prototype.flyTo=function(p,g){var S=this;if(!p.essential&&y.browser.prefersReducedMotion){var w=y.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,g)}this.stop(),p=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},p);var R=this.transform,k=this.getZoom(),$=this.getBearing(),oe=this.getPitch(),be=this.getPadding(),we="zoom"in p?y.clamp(+p.zoom,R.minZoom,R.maxZoom):k,Oe="bearing"in p?this._normalizeBearing(p.bearing,$):$,qe="pitch"in p?+p.pitch:oe,$e="padding"in p?p.padding:R.padding,vt=R.zoomScale(we-k),He=y.Point.convert(p.offset),dt=R.centerPoint.add(He),wt=R.pointLocation(dt),zt=y.LngLat.convert(p.center||wt);this._normalizeCenter(zt);var ar=R.project(wt),Qt=R.project(zt).sub(ar),hr=p.curve,Tr=Math.max(R.width,R.height),Yr=Tr/vt,Ur=Qt.mag();if("minZoom"in p){var _n=y.clamp(Math.min(p.minZoom,k,we),R.minZoom,R.maxZoom),Hn=Tr/R.zoomScale(_n-k);hr=Math.sqrt(Hn/Ur*2)}var Vn=hr*hr;function Wn(ii){var Jn=(Yr*Yr-Tr*Tr+(ii?-1:1)*Vn*Vn*Ur*Ur)/(2*(ii?Yr:Tr)*Vn*Ur);return Math.log(Math.sqrt(Jn*Jn+1)-Jn)}function Wi(ii){return(Math.exp(ii)-Math.exp(-ii))/2}function Tn(ii){return(Math.exp(ii)+Math.exp(-ii))/2}var ui=Wn(0),gi=function(ii){return Tn(ui)/Tn(ui+hr*ii)},si=function(ii){return Tr*((Tn(ui)*(Wi(Jn=ui+hr*ii)/Tn(Jn))-Wi(ui))/Vn)/Ur;var Jn},ni=(Wn(1)-ui)/hr;if(Math.abs(Ur)<1e-6||!isFinite(ni)){if(Math.abs(Tr-Yr)<1e-6)return this.easeTo(p,g);var vi=Yr<Tr?-1:1;ni=Math.abs(Math.log(Yr/Tr))/hr,si=function(){return 0},gi=function(ii){return Math.exp(vi*hr*ii)}}return p.duration="duration"in p?+p.duration:1e3*ni/("screenSpeed"in p?+p.screenSpeed/hr:+p.speed),p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0),this._zooming=!0,this._rotating=$!==Oe,this._pitching=qe!==oe,this._padding=!R.isPaddingEqual($e),this._prepareEase(g,!1),this._ease(function(ii){var Jn=ii*ni,Mo=1/gi(Jn);R.zoom=ii===1?we:k+R.scaleZoom(Mo),S._rotating&&(R.bearing=y.number($,Oe,ii)),S._pitching&&(R.pitch=y.number(oe,qe,ii)),S._padding&&(R.interpolatePadding(be,$e,ii),dt=R.centerPoint.add(He));var no=ii===1?zt:R.unproject(ar.add(Qt.mult(si(Jn))).mult(Mo));R.setLocationAtPoint(R.renderWorldCopies?no.wrap():no,dt),S._fireMoveEvents(g)},function(){return S._afterEase(g)},p),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(p,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!p){var w=this.handlers;w&&w.stop(!1)}return this},v.prototype._ease=function(p,g,S){S.animate===!1||S.duration===0?(p(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=p,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var p=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(p,g){p=y.wrap(p,-180,180);var S=Math.abs(p-g);return Math.abs(p-360-g)<S&&(p-=360),Math.abs(p+360-g)<S&&(p+=360),p},v.prototype._normalizeCenter=function(p){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=p.lng-g.center.lng;p.lng+=S>180?-360:S<-180?360:0}},v}(y.Evented),fs=function(h){h===void 0&&(h={}),this.options=h,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};fs.prototype.getDefaultPosition=function(){return"bottom-right"},fs.prototype.onAdd=function(h){var v=this.options&&this.options.compact;return this._map=h,this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},fs.prototype.onRemove=function(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},fs.prototype._setElementTitle=function(h,v){var p=this._map._getUIString("AttributionControl."+v);h.title=p,h.setAttribute("aria-label",p)},fs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},fs.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(h){var p=v.reduce(function(g,S,w){return S.value&&(g+=S.key+"="+S.value+(w<v.length-1?"&":"")),g},"?");h.href=y.config.FEEDBACK_URL+"/"+p+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},fs.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},fs.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var p=this._map.style.sourceCaches;for(var g in p){var S=p[g];if(S.used){var w=S.getSource();w.attribution&&h.indexOf(w.attribution)<0&&h.push(w.attribution)}}h.sort(function(k,$){return k.length-$.length});var R=(h=h.filter(function(k,$){for(var oe=$+1;oe<h.length;oe++)if(h[oe].indexOf(k)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,h.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},fs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};bu.prototype.onAdd=function(h){this._map=h,this._container=P.create("div","mapboxgl-ctrl");var v=P.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bu.prototype.onRemove=function(){P.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bu.prototype.getDefaultPosition=function(){return"bottom-left"},bu.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},bu.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var v in h)if(h[v].getSource().mapbox_logo)return!0;return!1}},bu.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var v=h[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Ua=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ua.prototype.add=function(h){var v=++this._id;return this._queue.push({callback:h,id:v,cancelled:!1}),v},Ua.prototype.remove=function(h){for(var v=this._currentlyRunning,p=0,g=v?this._queue.concat(v):this._queue;p<g.length;p+=1){var S=g[p];if(S.id===h)return void(S.cancelled=!0)}},Ua.prototype.run=function(h){h===void 0&&(h=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var p=0,g=v;p<g.length;p+=1){var S=g[p];if(!S.cancelled&&(S.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ua.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var tu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},xu=y.window.HTMLImageElement,Eu=y.window.HTMLElement,pa=y.window.ImageBitmap,_o={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Th=function(h){function v(g){var S=this;if((g=y.extend({},_o,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Zi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(h.call(this,w,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Ua,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},tu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Eu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Pn(this,g),this._hash=g.hash&&new ou(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new fs({customAttribution:g.customAttribution})),this.addControl(new bu,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(R){S._update(R.dataType==="style"),S.fire(new y.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){S.fire(new y.Event(R.dataType+"dataloading",R))})}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[S];return S.indexOf("bottom")!==-1?R.insertBefore(w,R.firstChild):R.appendChild(w),this},v.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},v.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},v.prototype.resize=function(g){var S=this._containerDimensions(),w=S[0],R=S[1];if(w===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(w,R),this.transform.resize(w,R),this.painter.resize(w,R);var k=!this._moving;return k&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),k&&this.fire(new y.Event("moveend",g)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},v.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},v.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},v.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(g,S,w){var R,k=this;if(g==="mouseenter"||g==="mouseover"){var $=!1;return{layer:S,listener:w,delegates:{mousemove:function(be){var we=k.getLayer(S)?k.queryRenderedFeatures(be.point,{layers:[S]}):[];we.length?$||($=!0,w.call(k,new qa(g,k,be.originalEvent,{features:we}))):$=!1},mouseout:function(){$=!1}}}}if(g==="mouseleave"||g==="mouseout"){var oe=!1;return{layer:S,listener:w,delegates:{mousemove:function(be){(k.getLayer(S)?k.queryRenderedFeatures(be.point,{layers:[S]}):[]).length?oe=!0:oe&&(oe=!1,w.call(k,new qa(g,k,be.originalEvent)))},mouseout:function(be){oe&&(oe=!1,w.call(k,new qa(g,k,be.originalEvent)))}}}}return{layer:S,listener:w,delegates:(R={},R[g]=function(be){var we=k.getLayer(S)?k.queryRenderedFeatures(be.point,{layers:[S]}):[];we.length&&(be.features=we,w.call(k,be),delete be.features)},R)}},v.prototype.on=function(g,S,w){if(w===void 0)return h.prototype.on.call(this,g,S);var R=this._createDelegatedListener(g,S,w);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(k,R.delegates[k]);return this},v.prototype.once=function(g,S,w){if(w===void 0)return h.prototype.once.call(this,g,S);var R=this._createDelegatedListener(g,S,w);for(var k in R.delegates)this.once(k,R.delegates[k]);return this},v.prototype.off=function(g,S,w){var R=this;return w===void 0?h.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(k){for(var $=k[g],oe=0;oe<$.length;oe++){var be=$[oe];if(be.layer===S&&be.listener===w){for(var we in be.delegates)R.off(we,be.delegates[we]);return $.splice(oe,1),R}}}(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var w;if(S!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")w=[y.Point.convert(g)];else{var R=y.Point.convert(g[0]),k=y.Point.convert(g[1]);w=[R,new y.Point(k.x,R.y),k,new y.Point(R.x,k.y),R]}return this.style.queryRenderedFeatures(w,S,this.transform)},v.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},v.prototype.setStyle=function(g,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},v.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},v.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Fs(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Fs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(g,S){var w=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),k=this._requestManager.transformRequest(R,y.ResourceType.Style);y.getJSON(k,function($,oe){$?w.fire(new y.ErrorEvent($)):oe&&w._updateDiff(oe,S)})}else typeof g=="object"&&this._updateDiff(g,S)},v.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(w){y.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},v.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},v.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var w=g[S]._tiles;for(var R in w){var k=w[R];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(g,S,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,w)},v.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},v.prototype.getSource=function(g){return this.style.getSource(g)},v.prototype.addImage=function(g,S,w){w===void 0&&(w={});var R=w.pixelRatio;R===void 0&&(R=1);var k=w.sdf;k===void 0&&(k=!1);var $=w.stretchX,oe=w.stretchY,be=w.content;if(this._lazyInitEmptyStyle(),S instanceof xu||pa&&S instanceof pa){var we=y.browser.getImageData(S);this.style.addImage(g,{data:new y.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:R,stretchX:$,stretchY:oe,content:be,sdf:k,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Oe=S;this.style.addImage(g,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:R,stretchX:$,stretchY:oe,content:be,sdf:k,version:0,userImage:Oe}),Oe.onAdd&&Oe.onAdd(this,g)}},v.prototype.updateImage=function(g,S){var w=this.style.getImage(g);if(!w)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=S instanceof xu||pa&&S instanceof pa?y.browser.getImageData(S):S,k=R.width,$=R.height,oe=R.data;return k===void 0||$===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==w.data.width||$!==w.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(oe,!(S instanceof xu||pa&&S instanceof pa)),void this.style.updateImage(g,w))},v.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(g){this.style.removeImage(g)},v.prototype.loadImage=function(g,S){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),S)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},v.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},v.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},v.prototype.getLayer=function(g){return this.style.getLayer(g)},v.prototype.setLayerZoomRange=function(g,S,w){return this.style.setLayerZoomRange(g,S,w),this._update(!0)},v.prototype.setFilter=function(g,S,w){return w===void 0&&(w={}),this.style.setFilter(g,S,w),this._update(!0)},v.prototype.getFilter=function(g){return this.style.getFilter(g)},v.prototype.setPaintProperty=function(g,S,w,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,S,w,R),this._update(!0)},v.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},v.prototype.setLayoutProperty=function(g,S,w,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,S,w,R),this._update(!0)},v.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},v.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},v.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},v.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},v.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=P.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=P.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=P.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var R=this._controlContainer=P.create("div","mapboxgl-control-container",g),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function($){k[$]=P.create("div","mapboxgl-ctrl-"+$,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(g,S){var w=y.browser.devicePixelRatio||1;this._canvas.width=w*g,this._canvas.height=w*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},v.prototype._setupPainter=function(){var g=y.extend({},le.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new Sa(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},v.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},v.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},v.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},v.prototype._render=function(g){var S,w=this,R=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,S),R=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var $=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var oe=this.transform.zoom,be=y.browser.now();this.style.zoomHistory.update(oe,be);var we=new y.EvaluationParameters(oe,{now:be,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Oe=we.crossFadingFactor();Oe===1&&Oe===this._crossFadingFactor||($=!0,this._crossFadingFactor=Oe),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||$)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var qe=y.browser.now()-R;k.endQueryEXT(k.TIME_ELAPSED_EXT,S),setTimeout(function(){var He=k.getQueryObjectEXT(S,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(S),w.fire(new y.Event("gpu-timing-frame",{cpuTime:qe,gpuTime:He}))},50)}if(this.listens("gpu-timing-layer")){var $e=this.painter.collectGpuTimers();setTimeout(function(){var He=w.painter.queryGpuTimers($e);w.fire(new y.Event("gpu-timing-layer",{layerTimes:He}))},50)}var vt=this._sourcesDirty||this._styleDirty||this._placementDirty;return vt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||vt||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Dl(this._canvasContainer),Dl(this._controlContainer),Dl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},v.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){g._frame=null,g._render(S)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},p.showTileBoundaries.get=function(){return!!this._showTileBoundaries},p.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},p.showPadding.get=function(){return!!this._showPadding},p.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},p.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},p.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},p.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},p.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},p.repaint.get=function(){return!!this._repaint},p.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},p.vertices.get=function(){return!!this._vertices},p.vertices.set=function(g){this._vertices=g,this._update()},v.prototype._setCacheLimits=function(g,S){y.setCacheLimits(g,S)},p.version.get=function(){return y.version},Object.defineProperties(v.prototype,p),v}(cs);function Dl(h){h.parentNode&&h.parentNode.removeChild(h)}var Uf={showCompass:!0,showZoom:!0,visualizePitch:!1},fl=function(h){var v=this;this.options=y.extend({},Uf,h),this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(p){return p.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(p){return v._map.zoomIn({},{originalEvent:p})}),P.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(p){return v._map.zoomOut({},{originalEvent:p})}),P.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(p){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:p}):v._map.resetNorth({},{originalEvent:p})}),this._compassIcon=P.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};fl.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),v=h===this._map.getMaxZoom(),p=h===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},fl.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},fl.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xs(this._map,this._compass,this.options.visualizePitch)),this._container},fl.prototype.onRemove=function(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},fl.prototype._createButton=function(h,v){var p=P.create("button",h,this._container);return p.type="button",p.addEventListener("click",v),p},fl.prototype._setButtonTitle=function(h,v){var p=this._map._getUIString("NavigationControl."+v);h.title=p,h.setAttribute("aria-label",p)};var xs=function(h,v,p){p===void 0&&(p=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new sf({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,p&&(this.mousePitch=new uf({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),P.addEventListener(v,"mousedown",this.mousedown),P.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(v,"touchmove",this.touchmove),P.addEventListener(v,"touchend",this.touchend),P.addEventListener(v,"touchcancel",this.reset)};function Jl(h,v,p){if(h=new y.LngLat(h.lng,h.lat),v){var g=new y.LngLat(h.lng-360,h.lat),S=new y.LngLat(h.lng+360,h.lat),w=p.locationPoint(h).distSqr(v);p.locationPoint(g).distSqr(v)<w?h=g:p.locationPoint(S).distSqr(v)<w&&(h=S)}for(;Math.abs(h.lng-p.center.lng)>180;){var R=p.locationPoint(h);if(R.x>=0&&R.y>=0&&R.x<=p.width&&R.y<=p.height)break;h.lng>p.center.lng?h.lng-=360:h.lng+=360}return h}xs.prototype.down=function(h,v){this.mouseRotate.mousedown(h,v),this.mousePitch&&this.mousePitch.mousedown(h,v),P.disableDrag()},xs.prototype.move=function(h,v){var p=this.map,g=this.mouseRotate.mousemoveWindow(h,v);if(g&&g.bearingDelta&&p.setBearing(p.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(h,v);S&&S.pitchDelta&&p.setPitch(p.getPitch()+S.pitchDelta)}},xs.prototype.off=function(){var h=this.element;P.removeEventListener(h,"mousedown",this.mousedown),P.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(h,"touchmove",this.touchmove),P.removeEventListener(h,"touchend",this.touchend),P.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},xs.prototype.offTemp=function(){P.enableDrag(),P.removeEventListener(y.window,"mousemove",this.mousemove),P.removeEventListener(y.window,"mouseup",this.mouseup)},xs.prototype.mousedown=function(h){this.down(y.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),P.mousePos(this.element,h)),P.addEventListener(y.window,"mousemove",this.mousemove),P.addEventListener(y.window,"mouseup",this.mouseup)},xs.prototype.mousemove=function(h){this.move(h,P.mousePos(this.element,h))},xs.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},xs.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},xs.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},xs.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},xs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Su={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zf(h,v,p){var g=h.classList;for(var S in Su)g.remove("mapboxgl-"+p+"-anchor-"+S);g.add("mapboxgl-"+p+"-anchor-"+v)}var Pc,lf=function(h){function v(p,g){if(h.call(this),(p instanceof y.window.HTMLElement||g)&&(p=y.extend({element:p},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._scale=p&&p.scale||1,this._draggable=p&&p.draggable||!1,this._clickTolerance=p&&p.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment!=="auto"?p.pitchAlignment:this._rotationAlignment,p&&p.element)this._element=p.element,this._offset=y.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");var S=P.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var w=P.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var R=P.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var k=P.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var $=0,oe=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];$<oe.length;$+=1){var be=oe[$],we=P.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",be.rx),we.setAttributeNS(null,"ry",be.ry),k.appendChild(we)}var Oe=P.createNS("http://www.w3.org/2000/svg","g");Oe.setAttributeNS(null,"fill",this._color);var qe=P.createNS("http://www.w3.org/2000/svg","path");qe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Oe.appendChild(qe);var $e=P.createNS("http://www.w3.org/2000/svg","g");$e.setAttributeNS(null,"opacity","0.25"),$e.setAttributeNS(null,"fill","#000000");var vt=P.createNS("http://www.w3.org/2000/svg","path");vt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$e.appendChild(vt);var He=P.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"transform","translate(6.0, 7.0)"),He.setAttributeNS(null,"fill","#FFFFFF");var dt=P.createNS("http://www.w3.org/2000/svg","g");dt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var wt=P.createNS("http://www.w3.org/2000/svg","circle");wt.setAttributeNS(null,"fill","#000000"),wt.setAttributeNS(null,"opacity","0.25"),wt.setAttributeNS(null,"cx","5.5"),wt.setAttributeNS(null,"cy","5.5"),wt.setAttributeNS(null,"r","5.4999962");var zt=P.createNS("http://www.w3.org/2000/svg","circle");zt.setAttributeNS(null,"fill","#FFFFFF"),zt.setAttributeNS(null,"cx","5.5"),zt.setAttributeNS(null,"cy","5.5"),zt.setAttributeNS(null,"r","5.4999962"),dt.appendChild(wt),dt.appendChild(zt),R.appendChild(k),R.appendChild(Oe),R.appendChild($e),R.appendChild(He),R.appendChild(dt),S.appendChild(R),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(p&&p.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(ar){ar.preventDefault()}),this._element.addEventListener("mousedown",function(ar){ar.preventDefault()}),zf(this._element,this._anchor,"marker"),this._popup=null}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._update),p.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=y.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=p,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(p){var g=p.code,S=p.charCode||p.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},v.prototype._onMapClick=function(p){var g=p.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var p=this._popup;return p?(p.isOpen()?p.remove():p.addTo(this._map),this):this},v.prototype._update=function(p){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Jl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),p&&p.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,Su[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(p){return this._offset=y.Point.convert(p),this._update(),this},v.prototype._onMove=function(p){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(p){this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(p){return this._draggable=!!p,this._map&&(p?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(p){return this._rotation=p||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(p){return this._rotationAlignment=p||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(p){return this._pitchAlignment=p&&p!=="auto"?p:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v}(y.Evented),Zf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ec=0,tc=!1,wh=function(h){function v(p){h.call(this),this.options=y.extend({},Zf,p),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){var g;return this._map=p,this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Pc!==void 0?g(Pc):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(Pc=S.state!=="denied")}):g(Pc=!!y.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ec=0,tc=!1},v.prototype._isOutOfMapMaxBounds=function(p){var g=this._map.getMaxBounds(),S=p.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",p)),this._finish()}},v.prototype._updateCamera=function(p){var g=new y.LngLat(p.coords.longitude,p.coords.latitude),S=p.coords.accuracy,w=this._map.getBearing(),R=y.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),R,{geolocateSource:!0})},v.prototype._updateMarker=function(p){if(p){var g=new y.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var p=this._map._container.clientHeight/2,g=this._map.unproject([0,p]),S=this._map.unproject([1,p]),w=g.distanceTo(S),R=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&tc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",p)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(p){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=P.create("button","mapboxgl-ctrl-geolocate",this._container),P.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new lf(this._dotElement),this._circleElement=P.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ec--,tc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ec>1?(p={maximumAge:6e5,timeout:0},tc=!0):(p=this.options.positionOptions,tc=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v}(y.Evented),hs={maxWidth:100,unit:"metric"},Au=function(h){this.options=y.extend({},hs,h),y.bindAll(["_onMove","setUnit"],this)};function cf(h,v,p){var g=p&&p.maxWidth||100,S=h._container.clientHeight/2,w=h.unproject([0,S]),R=h.unproject([g,S]),k=w.distanceTo(R);if(p&&p.unit==="imperial"){var $=3.2808*k;$>5280?Ll(v,g,$/5280,h._getUIString("ScaleControl.Miles")):Ll(v,g,$,h._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?Ll(v,g,k/1852,h._getUIString("ScaleControl.NauticalMiles")):k>=1e3?Ll(v,g,k/1e3,h._getUIString("ScaleControl.Kilometers")):Ll(v,g,k,h._getUIString("ScaleControl.Meters"))}function Ll(h,v,p,g){var S,w,R,k=(S=p,(w=Math.pow(10,(""+Math.floor(S)).length-1))*(R=(R=S/w)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function($){var oe=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*oe)/oe}(R)));h.style.width=v*(k/p)+"px",h.innerHTML=k+"&nbsp;"+g}Au.prototype.getDefaultPosition=function(){return"bottom-left"},Au.prototype._onMove=function(){cf(this._map,this._container,this.options)},Au.prototype.onAdd=function(h){return this._map=h,this._container=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Au.prototype.onRemove=function(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Au.prototype.setUnit=function(h){this.options.unit=h,cf(this._map,this._container,this.options)};var uu=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof y.window.HTMLElement?this._container=h.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};uu.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},uu.prototype.onRemove=function(){P.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},uu.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},uu.prototype._setupUI=function(){var h=this._fullscreenButton=P.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);P.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},uu.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},uu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},uu.prototype._isFullscreen=function(){return this._fullscreen},uu.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},uu.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ch={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Vf=function(h){function v(p){h.call(this),this.options=y.extend(Object.create(Ch),p),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=y.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(p){return this.setDOMContent(y.window.document.createTextNode(p))},v.prototype.setHTML=function(p){var g,S=y.window.document.createDocumentFragment(),w=y.window.document.createElement("body");for(w.innerHTML=p;g=w.firstChild;)S.appendChild(g);return this.setDOMContent(S)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(p){return this.options.maxWidth=p,this._update(),this},v.prototype.setDOMContent=function(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(p){this._container&&this._container.classList.add(p)},v.prototype.removeClassName=function(p){this._container&&this._container.classList.remove(p)},v.prototype.setOffset=function(p){return this.options.offset=p,this._update(),this},v.prototype.toggleClassName=function(p){if(this._container)return this._container.classList.toggle(p)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=P.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(p){this._update(p.point)},v.prototype._onMouseMove=function(p){this._update(p.point)},v.prototype._onDrag=function(p){this._update(p.point)},v.prototype._update=function(p){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=P.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=P.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return g._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p)){var S=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),w=this.options.anchor,R=function we(Oe){if(Oe){if(typeof Oe=="number"){var qe=Math.round(Math.sqrt(.5*Math.pow(Oe,2)));return{center:new y.Point(0,0),top:new y.Point(0,Oe),"top-left":new y.Point(qe,qe),"top-right":new y.Point(-qe,qe),bottom:new y.Point(0,-Oe),"bottom-left":new y.Point(qe,-qe),"bottom-right":new y.Point(-qe,-qe),left:new y.Point(Oe,0),right:new y.Point(-Oe,0)}}if(Oe instanceof y.Point||Array.isArray(Oe)){var $e=y.Point.convert(Oe);return{center:$e,top:$e,"top-left":$e,"top-right":$e,bottom:$e,"bottom-left":$e,"bottom-right":$e,left:$e,right:$e}}return{center:y.Point.convert(Oe.center||[0,0]),top:y.Point.convert(Oe.top||[0,0]),"top-left":y.Point.convert(Oe["top-left"]||[0,0]),"top-right":y.Point.convert(Oe["top-right"]||[0,0]),bottom:y.Point.convert(Oe.bottom||[0,0]),"bottom-left":y.Point.convert(Oe["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Oe["bottom-right"]||[0,0]),left:y.Point.convert(Oe.left||[0,0]),right:y.Point.convert(Oe.right||[0,0])}}return we(new y.Point(0,0))}(this.options.offset);if(!w){var k,$=this._container.offsetWidth,oe=this._container.offsetHeight;k=S.y+R.bottom.y<oe?["top"]:S.y>this._map.transform.height-oe?["bottom"]:[],S.x<$/2?k.push("left"):S.x>this._map.transform.width-$/2&&k.push("right"),w=k.length===0?"bottom":k.join("-")}var be=S.add(R[w]).round();P.setTransform(this._container,Su[w]+" translate("+be.x+"px,"+be.y+"px)"),zf(this._container,w,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var p=this._container.querySelector(Gu);p&&p.focus()}},v.prototype._onClose=function(){this.remove()},v}(y.Evented),Rh={version:y.version,supported:le,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Th,NavigationControl:fl,GeolocateControl:wh,AttributionControl:fs,ScaleControl:Au,FullscreenControl:uu,Popup:Vf,Marker:lf,Style:Fs,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){nr().acquire(Kt)},clearPrewarmedResources:function(){var h=sn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Kt),sn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(h){y.config.ACCESS_TOKEN=h},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(h){y.config.API_URL=h},get workerCount(){return Er.workerCount},set workerCount(h){Er.workerCount=h},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){y.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){y.clearTileCache(h)},workerUrl:""};return Rh}),te})},3614:function(Ut,ae,O){"use strict";Ut.exports=de;var te=O(80645);function de(ie){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ie)?ie:new Uint8Array(ie||0),this.pos=0,this.type=0,this.length=this.buf.length}de.Varint=0,de.Fixed64=1,de.Bytes=2,de.Fixed32=5;var y=65536*65536,le=1/y,P=12,Y=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");de.prototype={destroy:function(){this.buf=null},readFields:function(ie,j,re){for(re=re||this.length;this.pos<re;){var ke=this.readVarint(),Te=ke>>3,st=this.pos;this.type=ke&7,ie(Te,j,this),this.pos===st&&this.skip(ke)}return j},readMessage:function(ie,j){return this.readFields(ie,j,this.readVarint()+this.pos)},readFixed32:function(){var ie=ft(this.buf,this.pos);return this.pos+=4,ie},readSFixed32:function(){var ie=Rt(this.buf,this.pos);return this.pos+=4,ie},readFixed64:function(){var ie=ft(this.buf,this.pos)+ft(this.buf,this.pos+4)*y;return this.pos+=8,ie},readSFixed64:function(){var ie=ft(this.buf,this.pos)+Rt(this.buf,this.pos+4)*y;return this.pos+=8,ie},readFloat:function(){var ie=te.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ie},readDouble:function(){var ie=te.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ie},readVarint:function(ie){var j=this.buf,re,ke;return ke=j[this.pos++],re=ke&127,ke<128||(ke=j[this.pos++],re|=(ke&127)<<7,ke<128)||(ke=j[this.pos++],re|=(ke&127)<<14,ke<128)||(ke=j[this.pos++],re|=(ke&127)<<21,ke<128)?re:(ke=j[this.pos],re|=(ke&15)<<28,V(re,ie,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ie=this.readVarint();return ie%2===1?(ie+1)/-2:ie/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ie=this.readVarint()+this.pos,j=this.pos;return this.pos=ie,ie-j>=P&&Y?Vt(this.buf,j,ie):Ve(this.buf,j,ie)},readBytes:function(){var ie=this.readVarint()+this.pos,j=this.buf.subarray(this.pos,ie);return this.pos=ie,j},readPackedVarint:function(ie,j){if(this.type!==de.Bytes)return ie.push(this.readVarint(j));var re=ue(this);for(ie=ie||[];this.pos<re;)ie.push(this.readVarint(j));return ie},readPackedSVarint:function(ie){if(this.type!==de.Bytes)return ie.push(this.readSVarint());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readSVarint());return ie},readPackedBoolean:function(ie){if(this.type!==de.Bytes)return ie.push(this.readBoolean());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readBoolean());return ie},readPackedFloat:function(ie){if(this.type!==de.Bytes)return ie.push(this.readFloat());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readFloat());return ie},readPackedDouble:function(ie){if(this.type!==de.Bytes)return ie.push(this.readDouble());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readDouble());return ie},readPackedFixed32:function(ie){if(this.type!==de.Bytes)return ie.push(this.readFixed32());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readFixed32());return ie},readPackedSFixed32:function(ie){if(this.type!==de.Bytes)return ie.push(this.readSFixed32());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readSFixed32());return ie},readPackedFixed64:function(ie){if(this.type!==de.Bytes)return ie.push(this.readFixed64());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readFixed64());return ie},readPackedSFixed64:function(ie){if(this.type!==de.Bytes)return ie.push(this.readSFixed64());var j=ue(this);for(ie=ie||[];this.pos<j;)ie.push(this.readSFixed64());return ie},skip:function(ie){var j=ie&7;if(j===de.Varint)for(;this.buf[this.pos++]>127;);else if(j===de.Bytes)this.pos=this.readVarint()+this.pos;else if(j===de.Fixed32)this.pos+=4;else if(j===de.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+j)},writeTag:function(ie,j){this.writeVarint(ie<<3|j)},realloc:function(ie){for(var j=this.length||16;j<this.pos+ie;)j*=2;if(j!==this.length){var re=new Uint8Array(j);re.set(this.buf),this.buf=re,this.length=j}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ie){this.realloc(4),Pe(this.buf,ie,this.pos),this.pos+=4},writeSFixed32:function(ie){this.realloc(4),Pe(this.buf,ie,this.pos),this.pos+=4},writeFixed64:function(ie){this.realloc(8),Pe(this.buf,ie&-1,this.pos),Pe(this.buf,Math.floor(ie*le),this.pos+4),this.pos+=8},writeSFixed64:function(ie){this.realloc(8),Pe(this.buf,ie&-1,this.pos),Pe(this.buf,Math.floor(ie*le),this.pos+4),this.pos+=8},writeVarint:function(ie){if(ie=+ie||0,ie>268435455||ie<0){Ae(ie,this);return}this.realloc(4),this.buf[this.pos++]=ie&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=(ie>>>=7)&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=(ie>>>=7)&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=ie>>>7&127)))},writeSVarint:function(ie){this.writeVarint(ie<0?-ie*2-1:ie*2)},writeBoolean:function(ie){this.writeVarint(!!ie)},writeString:function(ie){ie=String(ie),this.realloc(ie.length*4),this.pos++;var j=this.pos;this.pos=mr(this.buf,ie,this.pos);var re=this.pos-j;re>=128&&ct(j,re,this),this.pos=j-1,this.writeVarint(re),this.pos+=re},writeFloat:function(ie){this.realloc(4),te.write(this.buf,ie,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ie){this.realloc(8),te.write(this.buf,ie,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ie){var j=ie.length;this.writeVarint(j),this.realloc(j);for(var re=0;re<j;re++)this.buf[this.pos++]=ie[re]},writeRawMessage:function(ie,j){this.pos++;var re=this.pos;ie(j,this);var ke=this.pos-re;ke>=128&&ct(re,ke,this),this.pos=re-1,this.writeVarint(ke),this.pos+=ke},writeMessage:function(ie,j,re){this.writeTag(ie,de.Bytes),this.writeRawMessage(j,re)},writePackedVarint:function(ie,j){j.length&&this.writeMessage(ie,ye,j)},writePackedSVarint:function(ie,j){j.length&&this.writeMessage(ie,St,j)},writePackedBoolean:function(ie,j){j.length&&this.writeMessage(ie,ht,j)},writePackedFloat:function(ie,j){j.length&&this.writeMessage(ie,mt,j)},writePackedDouble:function(ie,j){j.length&&this.writeMessage(ie,Ze,j)},writePackedFixed32:function(ie,j){j.length&&this.writeMessage(ie,it,j)},writePackedSFixed32:function(ie,j){j.length&&this.writeMessage(ie,dr,j)},writePackedFixed64:function(ie,j){j.length&&this.writeMessage(ie,yr,j)},writePackedSFixed64:function(ie,j){j.length&&this.writeMessage(ie,cr,j)},writeBytesField:function(ie,j){this.writeTag(ie,de.Bytes),this.writeBytes(j)},writeFixed32Field:function(ie,j){this.writeTag(ie,de.Fixed32),this.writeFixed32(j)},writeSFixed32Field:function(ie,j){this.writeTag(ie,de.Fixed32),this.writeSFixed32(j)},writeFixed64Field:function(ie,j){this.writeTag(ie,de.Fixed64),this.writeFixed64(j)},writeSFixed64Field:function(ie,j){this.writeTag(ie,de.Fixed64),this.writeSFixed64(j)},writeVarintField:function(ie,j){this.writeTag(ie,de.Varint),this.writeVarint(j)},writeSVarintField:function(ie,j){this.writeTag(ie,de.Varint),this.writeSVarint(j)},writeStringField:function(ie,j){this.writeTag(ie,de.Bytes),this.writeString(j)},writeFloatField:function(ie,j){this.writeTag(ie,de.Fixed32),this.writeFloat(j)},writeDoubleField:function(ie,j){this.writeTag(ie,de.Fixed64),this.writeDouble(j)},writeBooleanField:function(ie,j){this.writeVarintField(ie,!!j)}};function V(ie,j,re){var ke=re.buf,Te,st;if(st=ke[re.pos++],Te=(st&112)>>4,st<128||(st=ke[re.pos++],Te|=(st&127)<<3,st<128)||(st=ke[re.pos++],Te|=(st&127)<<10,st<128)||(st=ke[re.pos++],Te|=(st&127)<<17,st<128)||(st=ke[re.pos++],Te|=(st&127)<<24,st<128)||(st=ke[re.pos++],Te|=(st&1)<<31,st<128))return H(ie,Te,j);throw new Error("Expected varint not more than 10 bytes")}function ue(ie){return ie.type===de.Bytes?ie.readVarint()+ie.pos:ie.pos+1}function H(ie,j,re){return re?j*4294967296+(ie>>>0):(j>>>0)*4294967296+(ie>>>0)}function Ae(ie,j){var re,ke;if(ie>=0?(re=ie%4294967296|0,ke=ie/4294967296|0):(re=~(-ie%4294967296),ke=~(-ie/4294967296),re^4294967295?re=re+1|0:(re=0,ke=ke+1|0)),ie>=18446744073709552e3||ie<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");j.realloc(10),Ce(re,ke,j),ge(ke,j)}function Ce(ie,j,re){re.buf[re.pos++]=ie&127|128,ie>>>=7,re.buf[re.pos++]=ie&127|128,ie>>>=7,re.buf[re.pos++]=ie&127|128,ie>>>=7,re.buf[re.pos++]=ie&127|128,ie>>>=7,re.buf[re.pos]=ie&127}function ge(ie,j){var re=(ie&7)<<4;j.buf[j.pos++]|=re|((ie>>>=3)?128:0),ie&&(j.buf[j.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(j.buf[j.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(j.buf[j.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(j.buf[j.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(j.buf[j.pos++]=ie&127)))))}function ct(ie,j,re){var ke=j<=16383?1:j<=2097151?2:j<=268435455?3:Math.floor(Math.log(j)/(Math.LN2*7));re.realloc(ke);for(var Te=re.pos-1;Te>=ie;Te--)re.buf[Te+ke]=re.buf[Te]}function ye(ie,j){for(var re=0;re<ie.length;re++)j.writeVarint(ie[re])}function St(ie,j){for(var re=0;re<ie.length;re++)j.writeSVarint(ie[re])}function mt(ie,j){for(var re=0;re<ie.length;re++)j.writeFloat(ie[re])}function Ze(ie,j){for(var re=0;re<ie.length;re++)j.writeDouble(ie[re])}function ht(ie,j){for(var re=0;re<ie.length;re++)j.writeBoolean(ie[re])}function it(ie,j){for(var re=0;re<ie.length;re++)j.writeFixed32(ie[re])}function dr(ie,j){for(var re=0;re<ie.length;re++)j.writeSFixed32(ie[re])}function yr(ie,j){for(var re=0;re<ie.length;re++)j.writeFixed64(ie[re])}function cr(ie,j){for(var re=0;re<ie.length;re++)j.writeSFixed64(ie[re])}function ft(ie,j){return(ie[j]|ie[j+1]<<8|ie[j+2]<<16)+ie[j+3]*16777216}function Pe(ie,j,re){ie[re]=j,ie[re+1]=j>>>8,ie[re+2]=j>>>16,ie[re+3]=j>>>24}function Rt(ie,j){return(ie[j]|ie[j+1]<<8|ie[j+2]<<16)+(ie[j+3]<<24)}function Ve(ie,j,re){for(var ke="",Te=j;Te<re;){var st=ie[Te],ze=null,Qe=st>239?4:st>223?3:st>191?2:1;if(Te+Qe>re)break;var at,Mt,vr;Qe===1?st<128&&(ze=st):Qe===2?(at=ie[Te+1],(at&192)===128&&(ze=(st&31)<<6|at&63,ze<=127&&(ze=null))):Qe===3?(at=ie[Te+1],Mt=ie[Te+2],(at&192)===128&&(Mt&192)===128&&(ze=(st&15)<<12|(at&63)<<6|Mt&63,(ze<=2047||ze>=55296&&ze<=57343)&&(ze=null))):Qe===4&&(at=ie[Te+1],Mt=ie[Te+2],vr=ie[Te+3],(at&192)===128&&(Mt&192)===128&&(vr&192)===128&&(ze=(st&15)<<18|(at&63)<<12|(Mt&63)<<6|vr&63,(ze<=65535||ze>=1114112)&&(ze=null))),ze===null?(ze=65533,Qe=1):ze>65535&&(ze-=65536,ke+=String.fromCharCode(ze>>>10&1023|55296),ze=56320|ze&1023),ke+=String.fromCharCode(ze),Te+=Qe}return ke}function Vt(ie,j,re){return Y.decode(ie.subarray(j,re))}function mr(ie,j,re){for(var ke=0,Te,st;ke<j.length;ke++){if(Te=j.charCodeAt(ke),Te>55295&&Te<57344)if(st)if(Te<56320){ie[re++]=239,ie[re++]=191,ie[re++]=189,st=Te;continue}else Te=st-55296<<10|Te-56320|65536,st=null;else{Te>56319||ke+1===j.length?(ie[re++]=239,ie[re++]=191,ie[re++]=189):st=Te;continue}else st&&(ie[re++]=239,ie[re++]=191,ie[re++]=189,st=null);Te<128?ie[re++]=Te:(Te<2048?ie[re++]=Te>>6|192:(Te<65536?ie[re++]=Te>>12|224:(ie[re++]=Te>>18|240,ie[re++]=Te>>12&63|128),ie[re++]=Te>>6&63|128),ie[re++]=Te&63|128)}return re}},32676:function(Ut,ae,O){var te=O(34155);(function(de,y){Ut.exports=y()})(this,function(){"use strict";function de(he,L){var z={label:0,sent:function(){if(Ue[0]&1)throw Ue[1];return Ue[1]},trys:[],ops:[]},fe,Re,Ue,$t;return $t={next:Lt(0),throw:Lt(1),return:Lt(2)},typeof Symbol=="function"&&($t[Symbol.iterator]=function(){return this}),$t;function Lt(xt){return function(U){return Bt([xt,U])}}function Bt(xt){if(fe)throw new TypeError("Generator is already executing.");for(;z;)try{if(fe=1,Re&&(Ue=xt[0]&2?Re.return:xt[0]?Re.throw||((Ue=Re.return)&&Ue.call(Re),0):Re.next)&&!(Ue=Ue.call(Re,xt[1])).done)return Ue;switch(Re=0,Ue&&(xt=[xt[0]&2,Ue.value]),xt[0]){case 0:case 1:Ue=xt;break;case 4:return z.label++,{value:xt[1],done:!1};case 5:z.label++,Re=xt[1],xt=[0];continue;case 7:xt=z.ops.pop(),z.trys.pop();continue;default:if(Ue=z.trys,!(Ue=Ue.length>0&&Ue[Ue.length-1])&&(xt[0]===6||xt[0]===2)){z=0;continue}if(xt[0]===3&&(!Ue||xt[1]>Ue[0]&&xt[1]<Ue[3])){z.label=xt[1];break}if(xt[0]===6&&z.label<Ue[1]){z.label=Ue[1],Ue=xt;break}if(Ue&&z.label<Ue[2]){z.label=Ue[2],z.ops.push(xt);break}Ue[2]&&z.ops.pop(),z.trys.pop();continue}xt=L.call(he,z)}catch(U){xt=[6,U],Re=0}finally{fe=Ue=0}if(xt[0]&5)throw xt[1];return{value:xt[0]?xt[1]:void 0,done:!0}}}var y=function(){function he(L,z){this.next=null,this.key=L,this.data=z,this.left=null,this.right=null}return he}();function le(he,L){return he>L?1:he<L?-1:0}function P(he,L,z){for(var fe=new y(null,null),Re=fe,Ue=fe;;){var $t=z(he,L.key);if($t<0){if(L.left===null)break;if(z(he,L.left.key)<0){var Lt=L.left;if(L.left=Lt.right,Lt.right=L,L=Lt,L.left===null)break}Ue.left=L,Ue=L,L=L.left}else if($t>0){if(L.right===null)break;if(z(he,L.right.key)>0){var Lt=L.right;if(L.right=Lt.left,Lt.left=L,L=Lt,L.right===null)break}Re.right=L,Re=L,L=L.right}else break}return Re.right=L.left,Ue.left=L.right,L.left=fe.right,L.right=fe.left,L}function Y(he,L,z,fe){var Re=new y(he,L);if(z===null)return Re.left=Re.right=null,Re;z=P(he,z,fe);var Ue=fe(he,z.key);return Ue<0?(Re.left=z.left,Re.right=z,z.left=null):Ue>=0&&(Re.right=z.right,Re.left=z,z.right=null),Re}function V(he,L,z){var fe=null,Re=null;if(L){L=P(he,L,z);var Ue=z(L.key,he);Ue===0?(fe=L.left,Re=L.right):Ue<0?(Re=L.right,L.right=null,fe=L):(fe=L.left,L.left=null,Re=L)}return{left:fe,right:Re}}function ue(he,L,z){return L===null?he:(he===null||(L=P(he.key,L,z),L.left=he),L)}function H(he,L,z,fe,Re){if(he){fe(""+L+(z?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Re(he)+`
`);var Ue=L+(z?"    ":"\u2502   ");he.left&&H(he.left,Ue,!1,fe,Re),he.right&&H(he.right,Ue,!0,fe,Re)}}var Ae=function(){function he(L){L===void 0&&(L=le),this._root=null,this._size=0,this._comparator=L}return he.prototype.insert=function(L,z){return this._size++,this._root=Y(L,z,this._root,this._comparator)},he.prototype.add=function(L,z){var fe=new y(L,z);this._root===null&&(fe.left=fe.right=null,this._size++,this._root=fe);var Re=this._comparator,Ue=P(L,this._root,Re),$t=Re(L,Ue.key);return $t===0?this._root=Ue:($t<0?(fe.left=Ue.left,fe.right=Ue,Ue.left=null):$t>0&&(fe.right=Ue.right,fe.left=Ue,Ue.right=null),this._size++,this._root=fe),this._root},he.prototype.remove=function(L){this._root=this._remove(L,this._root,this._comparator)},he.prototype._remove=function(L,z,fe){var Re;if(z===null)return null;z=P(L,z,fe);var Ue=fe(L,z.key);return Ue===0?(z.left===null?Re=z.right:(Re=P(L,z.left,fe),Re.right=z.right),this._size--,Re):z},he.prototype.pop=function(){var L=this._root;if(L){for(;L.left;)L=L.left;return this._root=P(L.key,this._root,this._comparator),this._root=this._remove(L.key,this._root,this._comparator),{key:L.key,data:L.data}}return null},he.prototype.findStatic=function(L){for(var z=this._root,fe=this._comparator;z;){var Re=fe(L,z.key);if(Re===0)return z;Re<0?z=z.left:z=z.right}return null},he.prototype.find=function(L){return this._root&&(this._root=P(L,this._root,this._comparator),this._comparator(L,this._root.key)!==0)?null:this._root},he.prototype.contains=function(L){for(var z=this._root,fe=this._comparator;z;){var Re=fe(L,z.key);if(Re===0)return!0;Re<0?z=z.left:z=z.right}return!1},he.prototype.forEach=function(L,z){for(var fe=this._root,Re=[],Ue=!1;!Ue;)fe!==null?(Re.push(fe),fe=fe.left):Re.length!==0?(fe=Re.pop(),L.call(z,fe),fe=fe.right):Ue=!0;return this},he.prototype.range=function(L,z,fe,Re){for(var Ue=[],$t=this._comparator,Lt=this._root,Bt;Ue.length!==0||Lt;)if(Lt)Ue.push(Lt),Lt=Lt.left;else{if(Lt=Ue.pop(),Bt=$t(Lt.key,z),Bt>0)break;if($t(Lt.key,L)>=0&&fe.call(Re,Lt))return this;Lt=Lt.right}return this},he.prototype.keys=function(){var L=[];return this.forEach(function(z){var fe=z.key;return L.push(fe)}),L},he.prototype.values=function(){var L=[];return this.forEach(function(z){var fe=z.data;return L.push(fe)}),L},he.prototype.min=function(){return this._root?this.minNode(this._root).key:null},he.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},he.prototype.minNode=function(L){if(L===void 0&&(L=this._root),L)for(;L.left;)L=L.left;return L},he.prototype.maxNode=function(L){if(L===void 0&&(L=this._root),L)for(;L.right;)L=L.right;return L},he.prototype.at=function(L){for(var z=this._root,fe=!1,Re=0,Ue=[];!fe;)if(z)Ue.push(z),z=z.left;else if(Ue.length>0){if(z=Ue.pop(),Re===L)return z;Re++,z=z.right}else fe=!0;return null},he.prototype.next=function(L){var z=this._root,fe=null;if(L.right){for(fe=L.right;fe.left;)fe=fe.left;return fe}for(var Re=this._comparator;z;){var Ue=Re(L.key,z.key);if(Ue===0)break;Ue<0?(fe=z,z=z.left):z=z.right}return fe},he.prototype.prev=function(L){var z=this._root,fe=null;if(L.left!==null){for(fe=L.left;fe.right;)fe=fe.right;return fe}for(var Re=this._comparator;z;){var Ue=Re(L.key,z.key);if(Ue===0)break;Ue<0?z=z.left:(fe=z,z=z.right)}return fe},he.prototype.clear=function(){return this._root=null,this._size=0,this},he.prototype.toList=function(){return ct(this._root)},he.prototype.load=function(L,z,fe){z===void 0&&(z=[]),fe===void 0&&(fe=!1);var Re=L.length,Ue=this._comparator;if(fe&&mt(L,z,0,Re-1,Ue),this._root===null)this._root=Ce(L,z,0,Re),this._size=Re;else{var $t=St(this.toList(),ge(L,z),Ue);Re=this._size+Re,this._root=ye({head:$t},0,Re)}return this},he.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(he.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(he.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),he.prototype.toString=function(L){L===void 0&&(L=function(fe){return String(fe.key)});var z=[];return H(this._root,"",!0,function(fe){return z.push(fe)},L),z.join("")},he.prototype.update=function(L,z,fe){var Re=this._comparator,Ue=V(L,this._root,Re),$t=Ue.left,Lt=Ue.right;Re(L,z)<0?Lt=Y(z,fe,Lt,Re):$t=Y(z,fe,$t,Re),this._root=ue($t,Lt,Re)},he.prototype.split=function(L){return V(L,this._root,this._comparator)},he.prototype[Symbol.iterator]=function(){var L,z,fe;return de(this,function(Re){switch(Re.label){case 0:L=this._root,z=[],fe=!1,Re.label=1;case 1:return fe?[3,6]:L===null?[3,2]:(z.push(L),L=L.left,[3,5]);case 2:return z.length===0?[3,4]:(L=z.pop(),[4,L]);case 3:return Re.sent(),L=L.right,[3,5];case 4:fe=!0,Re.label=5;case 5:return[3,1];case 6:return[2]}})},he}();function Ce(he,L,z,fe){var Re=fe-z;if(Re>0){var Ue=z+Math.floor(Re/2),$t=he[Ue],Lt=L[Ue],Bt=new y($t,Lt);return Bt.left=Ce(he,L,z,Ue),Bt.right=Ce(he,L,Ue+1,fe),Bt}return null}function ge(he,L){for(var z=new y(null,null),fe=z,Re=0;Re<he.length;Re++)fe=fe.next=new y(he[Re],L[Re]);return fe.next=null,z.next}function ct(he){for(var L=he,z=[],fe=!1,Re=new y(null,null),Ue=Re;!fe;)L?(z.push(L),L=L.left):z.length>0?(L=Ue=Ue.next=z.pop(),L=L.right):fe=!0;return Ue.next=null,Re.next}function ye(he,L,z){var fe=z-L;if(fe>0){var Re=L+Math.floor(fe/2),Ue=ye(he,L,Re),$t=he.head;return $t.left=Ue,he.head=he.head.next,$t.right=ye(he,Re+1,z),$t}return null}function St(he,L,z){for(var fe=new y(null,null),Re=fe,Ue=he,$t=L;Ue!==null&&$t!==null;)z(Ue.key,$t.key)<0?(Re.next=Ue,Ue=Ue.next):(Re.next=$t,$t=$t.next),Re=Re.next;return Ue!==null?Re.next=Ue:$t!==null&&(Re.next=$t),fe.next}function mt(he,L,z,fe,Re){if(!(z>=fe)){for(var Ue=he[z+fe>>1],$t=z-1,Lt=fe+1;;){do $t++;while(Re(he[$t],Ue)<0);do Lt--;while(Re(he[Lt],Ue)>0);if($t>=Lt)break;var Bt=he[$t];he[$t]=he[Lt],he[Lt]=Bt,Bt=L[$t],L[$t]=L[Lt],L[Lt]=Bt}mt(he,L,z,Lt,Re),mt(he,L,Lt+1,fe,Re)}}const Ze=(he,L)=>he.ll.x<=L.x&&L.x<=he.ur.x&&he.ll.y<=L.y&&L.y<=he.ur.y,ht=(he,L)=>{if(L.ur.x<he.ll.x||he.ur.x<L.ll.x||L.ur.y<he.ll.y||he.ur.y<L.ll.y)return null;const z=he.ll.x<L.ll.x?L.ll.x:he.ll.x,fe=he.ur.x<L.ur.x?he.ur.x:L.ur.x,Re=he.ll.y<L.ll.y?L.ll.y:he.ll.y,Ue=he.ur.y<L.ur.y?he.ur.y:L.ur.y;return{ll:{x:z,y:Re},ur:{x:fe,y:Ue}}};let it=Number.EPSILON;it===void 0&&(it=Math.pow(2,-52));const dr=it*it,yr=(he,L)=>{if(-it<he&&he<it&&-it<L&&L<it)return 0;const z=he-L;return z*z<dr*he*L?0:he<L?-1:1};class cr{constructor(){this.reset()}reset(){this.xRounder=new ft,this.yRounder=new ft}round(L,z){return{x:this.xRounder.round(L),y:this.yRounder.round(z)}}}class ft{constructor(){this.tree=new Ae,this.round(0)}round(L){const z=this.tree.add(L),fe=this.tree.prev(z);if(fe!==null&&yr(z.key,fe.key)===0)return this.tree.remove(L),fe.key;const Re=this.tree.next(z);return Re!==null&&yr(z.key,Re.key)===0?(this.tree.remove(L),Re.key):L}}const Pe=new cr,Rt=11102230246251565e-32,Ve=134217729,Vt=(3+8*Rt)*Rt;function mr(he,L,z,fe,Re){let Ue,$t,Lt,Bt,xt=L[0],U=fe[0],N=0,q=0;U>xt==U>-xt?(Ue=xt,xt=L[++N]):(Ue=U,U=fe[++q]);let se=0;if(N<he&&q<z)for(U>xt==U>-xt?($t=xt+Ue,Lt=Ue-($t-xt),xt=L[++N]):($t=U+Ue,Lt=Ue-($t-U),U=fe[++q]),Ue=$t,Lt!==0&&(Re[se++]=Lt);N<he&&q<z;)U>xt==U>-xt?($t=Ue+xt,Bt=$t-Ue,Lt=Ue-($t-Bt)+(xt-Bt),xt=L[++N]):($t=Ue+U,Bt=$t-Ue,Lt=Ue-($t-Bt)+(U-Bt),U=fe[++q]),Ue=$t,Lt!==0&&(Re[se++]=Lt);for(;N<he;)$t=Ue+xt,Bt=$t-Ue,Lt=Ue-($t-Bt)+(xt-Bt),xt=L[++N],Ue=$t,Lt!==0&&(Re[se++]=Lt);for(;q<z;)$t=Ue+U,Bt=$t-Ue,Lt=Ue-($t-Bt)+(U-Bt),U=fe[++q],Ue=$t,Lt!==0&&(Re[se++]=Lt);return(Ue!==0||se===0)&&(Re[se++]=Ue),se}function ie(he,L){let z=L[0];for(let fe=1;fe<he;fe++)z+=L[fe];return z}function j(he){return new Float64Array(he)}const re=(3+16*Rt)*Rt,ke=(2+12*Rt)*Rt,Te=(9+64*Rt)*Rt*Rt,st=j(4),ze=j(8),Qe=j(12),at=j(16),Mt=j(4);function vr(he,L,z,fe,Re,Ue,$t){let Lt,Bt,xt,U,N,q,se,Me,We,ut,W,ne,je,lt,Ie,Kt,Er,sn;const un=he-Re,nr=z-Re,Qr=L-Ue,Hr=fe-Ue;lt=un*Hr,q=Ve*un,se=q-(q-un),Me=un-se,q=Ve*Hr,We=q-(q-Hr),ut=Hr-We,Ie=Me*ut-(lt-se*We-Me*We-se*ut),Kt=Qr*nr,q=Ve*Qr,se=q-(q-Qr),Me=Qr-se,q=Ve*nr,We=q-(q-nr),ut=nr-We,Er=Me*ut-(Kt-se*We-Me*We-se*ut),W=Ie-Er,N=Ie-W,st[0]=Ie-(W+N)+(N-Er),ne=lt+W,N=ne-lt,je=lt-(ne-N)+(W-N),W=je-Kt,N=je-W,st[1]=je-(W+N)+(N-Kt),sn=ne+W,N=sn-ne,st[2]=ne-(sn-N)+(W-N),st[3]=sn;let $r=ie(4,st),oi=ke*$t;if($r>=oi||-$r>=oi||(N=he-un,Lt=he-(un+N)+(N-Re),N=z-nr,xt=z-(nr+N)+(N-Re),N=L-Qr,Bt=L-(Qr+N)+(N-Ue),N=fe-Hr,U=fe-(Hr+N)+(N-Ue),Lt===0&&Bt===0&&xt===0&&U===0)||(oi=Te*$t+Vt*Math.abs($r),$r+=un*U+Hr*Lt-(Qr*xt+nr*Bt),$r>=oi||-$r>=oi))return $r;lt=Lt*Hr,q=Ve*Lt,se=q-(q-Lt),Me=Lt-se,q=Ve*Hr,We=q-(q-Hr),ut=Hr-We,Ie=Me*ut-(lt-se*We-Me*We-se*ut),Kt=Bt*nr,q=Ve*Bt,se=q-(q-Bt),Me=Bt-se,q=Ve*nr,We=q-(q-nr),ut=nr-We,Er=Me*ut-(Kt-se*We-Me*We-se*ut),W=Ie-Er,N=Ie-W,Mt[0]=Ie-(W+N)+(N-Er),ne=lt+W,N=ne-lt,je=lt-(ne-N)+(W-N),W=je-Kt,N=je-W,Mt[1]=je-(W+N)+(N-Kt),sn=ne+W,N=sn-ne,Mt[2]=ne-(sn-N)+(W-N),Mt[3]=sn;const pn=mr(4,st,4,Mt,ze);lt=un*U,q=Ve*un,se=q-(q-un),Me=un-se,q=Ve*U,We=q-(q-U),ut=U-We,Ie=Me*ut-(lt-se*We-Me*We-se*ut),Kt=Qr*xt,q=Ve*Qr,se=q-(q-Qr),Me=Qr-se,q=Ve*xt,We=q-(q-xt),ut=xt-We,Er=Me*ut-(Kt-se*We-Me*We-se*ut),W=Ie-Er,N=Ie-W,Mt[0]=Ie-(W+N)+(N-Er),ne=lt+W,N=ne-lt,je=lt-(ne-N)+(W-N),W=je-Kt,N=je-W,Mt[1]=je-(W+N)+(N-Kt),sn=ne+W,N=sn-ne,Mt[2]=ne-(sn-N)+(W-N),Mt[3]=sn;const mi=mr(pn,ze,4,Mt,Qe);lt=Lt*U,q=Ve*Lt,se=q-(q-Lt),Me=Lt-se,q=Ve*U,We=q-(q-U),ut=U-We,Ie=Me*ut-(lt-se*We-Me*We-se*ut),Kt=Bt*xt,q=Ve*Bt,se=q-(q-Bt),Me=Bt-se,q=Ve*xt,We=q-(q-xt),ut=xt-We,Er=Me*ut-(Kt-se*We-Me*We-se*ut),W=Ie-Er,N=Ie-W,Mt[0]=Ie-(W+N)+(N-Er),ne=lt+W,N=ne-lt,je=lt-(ne-N)+(W-N),W=je-Kt,N=je-W,Mt[1]=je-(W+N)+(N-Kt),sn=ne+W,N=sn-ne,Mt[2]=ne-(sn-N)+(W-N),Mt[3]=sn;const Gi=mr(mi,Qe,4,Mt,at);return at[Gi-1]}function kt(he,L,z,fe,Re,Ue){const $t=(L-Ue)*(z-Re),Lt=(he-Re)*(fe-Ue),Bt=$t-Lt,xt=Math.abs($t+Lt);return Math.abs(Bt)>=re*xt?Bt:-vr(he,L,z,fe,Re,Ue,xt)}const Vr=(he,L)=>he.x*L.y-he.y*L.x,Kr=(he,L)=>he.x*L.x+he.y*L.y,Ir=(he,L,z)=>{const fe=kt(he.x,he.y,L.x,L.y,z.x,z.y);return fe>0?-1:fe<0?1:0},In=he=>Math.sqrt(Kr(he,he)),gn=(he,L,z)=>{const fe={x:L.x-he.x,y:L.y-he.y},Re={x:z.x-he.x,y:z.y-he.y};return Vr(Re,fe)/In(Re)/In(fe)},nn=(he,L,z)=>{const fe={x:L.x-he.x,y:L.y-he.y},Re={x:z.x-he.x,y:z.y-he.y};return Kr(Re,fe)/In(Re)/In(fe)},hi=(he,L,z)=>L.y===0?null:{x:he.x+L.x/L.y*(z-he.y),y:z},Lr=(he,L,z)=>L.x===0?null:{x:z,y:he.y+L.y/L.x*(z-he.x)},jn=(he,L,z,fe)=>{if(L.x===0)return Lr(z,fe,he.x);if(fe.x===0)return Lr(he,L,z.x);if(L.y===0)return hi(z,fe,he.y);if(fe.y===0)return hi(he,L,z.y);const Re=Vr(L,fe);if(Re==0)return null;const Ue={x:z.x-he.x,y:z.y-he.y},$t=Vr(Ue,L)/Re,Lt=Vr(Ue,fe)/Re,Bt=he.x+Lt*L.x,xt=z.x+$t*fe.x,U=he.y+Lt*L.y,N=z.y+$t*fe.y,q=(Bt+xt)/2,se=(U+N)/2;return{x:q,y:se}};class jr{static compare(L,z){const fe=jr.comparePoints(L.point,z.point);return fe!==0?fe:(L.point!==z.point&&L.link(z),L.isLeft!==z.isLeft?L.isLeft?1:-1:qi.compare(L.segment,z.segment))}static comparePoints(L,z){return L.x<z.x?-1:L.x>z.x?1:L.y<z.y?-1:L.y>z.y?1:0}constructor(L,z){L.events===void 0?L.events=[this]:L.events.push(this),this.point=L,this.isLeft=z}link(L){if(L.point===this.point)throw new Error("Tried to link already linked events");const z=L.point.events;for(let fe=0,Re=z.length;fe<Re;fe++){const Ue=z[fe];this.point.events.push(Ue),Ue.point=this.point}this.checkForConsuming()}checkForConsuming(){const L=this.point.events.length;for(let z=0;z<L;z++){const fe=this.point.events[z];if(fe.segment.consumedBy===void 0)for(let Re=z+1;Re<L;Re++){const Ue=this.point.events[Re];Ue.consumedBy===void 0&&fe.otherSE.point.events===Ue.otherSE.point.events&&fe.segment.consume(Ue.segment)}}}getAvailableLinkedEvents(){const L=[];for(let z=0,fe=this.point.events.length;z<fe;z++){const Re=this.point.events[z];Re!==this&&!Re.segment.ringOut&&Re.segment.isInResult()&&L.push(Re)}return L}getLeftmostComparator(L){const z=new Map,fe=Re=>{const Ue=Re.otherSE;z.set(Re,{sine:gn(this.point,L.point,Ue.point),cosine:nn(this.point,L.point,Ue.point)})};return(Re,Ue)=>{z.has(Re)||fe(Re),z.has(Ue)||fe(Ue);const{sine:$t,cosine:Lt}=z.get(Re),{sine:Bt,cosine:xt}=z.get(Ue);return $t>=0&&Bt>=0?Lt<xt?1:Lt>xt?-1:0:$t<0&&Bt<0?Lt<xt?-1:Lt>xt?1:0:Bt<$t?-1:Bt>$t?1:0}}}let hn=0;class qi{static compare(L,z){const fe=L.leftSE.point.x,Re=z.leftSE.point.x,Ue=L.rightSE.point.x,$t=z.rightSE.point.x;if($t<fe)return 1;if(Ue<Re)return-1;const Lt=L.leftSE.point.y,Bt=z.leftSE.point.y,xt=L.rightSE.point.y,U=z.rightSE.point.y;if(fe<Re){if(Bt<Lt&&Bt<xt)return 1;if(Bt>Lt&&Bt>xt)return-1;const N=L.comparePoint(z.leftSE.point);if(N<0)return 1;if(N>0)return-1;const q=z.comparePoint(L.rightSE.point);return q!==0?q:-1}if(fe>Re){if(Lt<Bt&&Lt<U)return-1;if(Lt>Bt&&Lt>U)return 1;const N=z.comparePoint(L.leftSE.point);if(N!==0)return N;const q=L.comparePoint(z.rightSE.point);return q<0?1:q>0?-1:1}if(Lt<Bt)return-1;if(Lt>Bt)return 1;if(Ue<$t){const N=z.comparePoint(L.rightSE.point);if(N!==0)return N}if(Ue>$t){const N=L.comparePoint(z.rightSE.point);if(N<0)return 1;if(N>0)return-1}if(Ue!==$t){const N=xt-Lt,q=Ue-fe,se=U-Bt,Me=$t-Re;if(N>q&&se<Me)return 1;if(N<q&&se>Me)return-1}return Ue>$t?1:Ue<$t||xt<U?-1:xt>U?1:L.id<z.id?-1:L.id>z.id?1:0}constructor(L,z,fe,Re){this.id=++hn,this.leftSE=L,L.segment=this,L.otherSE=z,this.rightSE=z,z.segment=this,z.otherSE=L,this.rings=fe,this.windings=Re}static fromRing(L,z,fe){let Re,Ue,$t;const Lt=jr.comparePoints(L,z);if(Lt<0)Re=L,Ue=z,$t=1;else if(Lt>0)Re=z,Ue=L,$t=-1;else throw new Error(`Tried to create degenerate segment at [${L.x}, ${L.y}]`);const Bt=new jr(Re,!0),xt=new jr(Ue,!1);return new qi(Bt,xt,[fe],[$t])}replaceRightSE(L){this.rightSE=L,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const L=this.leftSE.point.y,z=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:L<z?L:z},ur:{x:this.rightSE.point.x,y:L>z?L:z}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(L){return L.x===this.leftSE.point.x&&L.y===this.leftSE.point.y||L.x===this.rightSE.point.x&&L.y===this.rightSE.point.y}comparePoint(L){if(this.isAnEndpoint(L))return 0;const z=this.leftSE.point,fe=this.rightSE.point,Re=this.vector();if(z.x===fe.x)return L.x===z.x?0:L.x<z.x?1:-1;const Ue=(L.y-z.y)/Re.y,$t=z.x+Ue*Re.x;if(L.x===$t)return 0;const Lt=(L.x-z.x)/Re.x,Bt=z.y+Lt*Re.y;return L.y===Bt?0:L.y<Bt?-1:1}getIntersection(L){const z=this.bbox(),fe=L.bbox(),Re=ht(z,fe);if(Re===null)return null;const Ue=this.leftSE.point,$t=this.rightSE.point,Lt=L.leftSE.point,Bt=L.rightSE.point,xt=Ze(z,Lt)&&this.comparePoint(Lt)===0,U=Ze(fe,Ue)&&L.comparePoint(Ue)===0,N=Ze(z,Bt)&&this.comparePoint(Bt)===0,q=Ze(fe,$t)&&L.comparePoint($t)===0;if(U&&xt)return q&&!N?$t:!q&&N?Bt:null;if(U)return N&&Ue.x===Bt.x&&Ue.y===Bt.y?null:Ue;if(xt)return q&&$t.x===Lt.x&&$t.y===Lt.y?null:Lt;if(q&&N)return null;if(q)return $t;if(N)return Bt;const se=jn(Ue,this.vector(),Lt,L.vector());return se===null||!Ze(Re,se)?null:Pe.round(se.x,se.y)}split(L){const z=[],fe=L.events!==void 0,Re=new jr(L,!0),Ue=new jr(L,!1),$t=this.rightSE;this.replaceRightSE(Ue),z.push(Ue),z.push(Re);const Lt=new qi(Re,$t,this.rings.slice(),this.windings.slice());return jr.comparePoints(Lt.leftSE.point,Lt.rightSE.point)>0&&Lt.swapEvents(),jr.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),fe&&(Re.checkForConsuming(),Ue.checkForConsuming()),z}swapEvents(){const L=this.rightSE;this.rightSE=this.leftSE,this.leftSE=L,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let z=0,fe=this.windings.length;z<fe;z++)this.windings[z]*=-1}consume(L){let z=this,fe=L;for(;z.consumedBy;)z=z.consumedBy;for(;fe.consumedBy;)fe=fe.consumedBy;const Re=qi.compare(z,fe);if(Re!==0){if(Re>0){const Ue=z;z=fe,fe=Ue}if(z.prev===fe){const Ue=z;z=fe,fe=Ue}for(let Ue=0,$t=fe.rings.length;Ue<$t;Ue++){const Lt=fe.rings[Ue],Bt=fe.windings[Ue],xt=z.rings.indexOf(Lt);xt===-1?(z.rings.push(Lt),z.windings.push(Bt)):z.windings[xt]+=Bt}fe.rings=null,fe.windings=null,fe.consumedBy=z,fe.leftSE.consumedBy=z.leftSE,fe.rightSE.consumedBy=z.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const L=this.prev.consumedBy||this.prev;this._beforeState=L.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const L=this.beforeState();this._afterState={rings:L.rings.slice(0),windings:L.windings.slice(0),multiPolys:[]};const z=this._afterState.rings,fe=this._afterState.windings,Re=this._afterState.multiPolys;for(let Lt=0,Bt=this.rings.length;Lt<Bt;Lt++){const xt=this.rings[Lt],U=this.windings[Lt],N=z.indexOf(xt);N===-1?(z.push(xt),fe.push(U)):fe[N]+=U}const Ue=[],$t=[];for(let Lt=0,Bt=z.length;Lt<Bt;Lt++){if(fe[Lt]===0)continue;const xt=z[Lt],U=xt.poly;if($t.indexOf(U)===-1)if(xt.isExterior)Ue.push(U);else{$t.indexOf(U)===-1&&$t.push(U);const N=Ue.indexOf(xt.poly);N!==-1&&Ue.splice(N,1)}}for(let Lt=0,Bt=Ue.length;Lt<Bt;Lt++){const xt=Ue[Lt].multiPoly;Re.indexOf(xt)===-1&&Re.push(xt)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const L=this.beforeState().multiPolys,z=this.afterState().multiPolys;switch(Gt.type){case"union":{const fe=L.length===0,Re=z.length===0;this._isInResult=fe!==Re;break}case"intersection":{let fe,Re;L.length<z.length?(fe=L.length,Re=z.length):(fe=z.length,Re=L.length),this._isInResult=Re===Gt.numMultiPolys&&fe<Re;break}case"xor":{const fe=Math.abs(L.length-z.length);this._isInResult=fe%2===1;break}case"difference":{const fe=Re=>Re.length===1&&Re[0].isSubject;this._isInResult=fe(L)!==fe(z);break}default:throw new Error(`Unrecognized operation type found ${Gt.type}`)}return this._isInResult}}class Ei{constructor(L,z,fe){if(!Array.isArray(L)||L.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=z,this.isExterior=fe,this.segments=[],typeof L[0][0]!="number"||typeof L[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Re=Pe.round(L[0][0],L[0][1]);this.bbox={ll:{x:Re.x,y:Re.y},ur:{x:Re.x,y:Re.y}};let Ue=Re;for(let $t=1,Lt=L.length;$t<Lt;$t++){if(typeof L[$t][0]!="number"||typeof L[$t][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let Bt=Pe.round(L[$t][0],L[$t][1]);Bt.x===Ue.x&&Bt.y===Ue.y||(this.segments.push(qi.fromRing(Ue,Bt,this)),Bt.x<this.bbox.ll.x&&(this.bbox.ll.x=Bt.x),Bt.y<this.bbox.ll.y&&(this.bbox.ll.y=Bt.y),Bt.x>this.bbox.ur.x&&(this.bbox.ur.x=Bt.x),Bt.y>this.bbox.ur.y&&(this.bbox.ur.y=Bt.y),Ue=Bt)}(Re.x!==Ue.x||Re.y!==Ue.y)&&this.segments.push(qi.fromRing(Ue,Re,this))}getSweepEvents(){const L=[];for(let z=0,fe=this.segments.length;z<fe;z++){const Re=this.segments[z];L.push(Re.leftSE),L.push(Re.rightSE)}return L}}class ia{constructor(L,z){if(!Array.isArray(L))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ei(L[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let fe=1,Re=L.length;fe<Re;fe++){const Ue=new Ei(L[fe],this,!1);Ue.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ue.bbox.ll.x),Ue.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ue.bbox.ll.y),Ue.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ue.bbox.ur.x),Ue.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ue.bbox.ur.y),this.interiorRings.push(Ue)}this.multiPoly=z}getSweepEvents(){const L=this.exteriorRing.getSweepEvents();for(let z=0,fe=this.interiorRings.length;z<fe;z++){const Re=this.interiorRings[z].getSweepEvents();for(let Ue=0,$t=Re.length;Ue<$t;Ue++)L.push(Re[Ue])}return L}}class ta{constructor(L,z){if(!Array.isArray(L))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof L[0][0][0]=="number"&&(L=[L])}catch(fe){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let fe=0,Re=L.length;fe<Re;fe++){const Ue=new ia(L[fe],this);Ue.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ue.bbox.ll.x),Ue.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ue.bbox.ll.y),Ue.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ue.bbox.ur.x),Ue.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ue.bbox.ur.y),this.polys.push(Ue)}this.isSubject=z}getSweepEvents(){const L=[];for(let z=0,fe=this.polys.length;z<fe;z++){const Re=this.polys[z].getSweepEvents();for(let Ue=0,$t=Re.length;Ue<$t;Ue++)L.push(Re[Ue])}return L}}class Se{static factory(L){const z=[];for(let fe=0,Re=L.length;fe<Re;fe++){const Ue=L[fe];if(!Ue.isInResult()||Ue.ringOut)continue;let $t=null,Lt=Ue.leftSE,Bt=Ue.rightSE;const xt=[Lt],U=Lt.point,N=[];for(;$t=Lt,Lt=Bt,xt.push(Lt),Lt.point!==U;)for(;;){const q=Lt.getAvailableLinkedEvents();if(q.length===0){const We=xt[0].point,ut=xt[xt.length-1].point;throw new Error(`Unable to complete output ring starting at [${We.x}, ${We.y}]. Last matching segment found ends at [${ut.x}, ${ut.y}].`)}if(q.length===1){Bt=q[0].otherSE;break}let se=null;for(let We=0,ut=N.length;We<ut;We++)if(N[We].point===Lt.point){se=We;break}if(se!==null){const We=N.splice(se)[0],ut=xt.splice(We.index);ut.unshift(ut[0].otherSE),z.push(new Se(ut.reverse()));continue}N.push({index:xt.length,point:Lt.point});const Me=Lt.getLeftmostComparator($t);Bt=q.sort(Me)[0].otherSE;break}z.push(new Se(xt))}return z}constructor(L){this.events=L;for(let z=0,fe=L.length;z<fe;z++)L[z].segment.ringOut=this;this.poly=null}getGeom(){let L=this.events[0].point;const z=[L];for(let xt=1,U=this.events.length-1;xt<U;xt++){const N=this.events[xt].point,q=this.events[xt+1].point;Ir(N,L,q)!==0&&(z.push(N),L=N)}if(z.length===1)return null;const fe=z[0],Re=z[1];Ir(fe,L,Re)===0&&z.shift(),z.push(z[0]);const Ue=this.isExteriorRing()?1:-1,$t=this.isExteriorRing()?0:z.length-1,Lt=this.isExteriorRing()?z.length:-1,Bt=[];for(let xt=$t;xt!=Lt;xt+=Ue)Bt.push([z[xt].x,z[xt].y]);return Bt}isExteriorRing(){if(this._isExteriorRing===void 0){const L=this.enclosingRing();this._isExteriorRing=L?!L.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let L=this.events[0];for(let Re=1,Ue=this.events.length;Re<Ue;Re++){const $t=this.events[Re];jr.compare(L,$t)>0&&(L=$t)}let z=L.segment.prevInResult(),fe=z?z.prevInResult():null;for(;;){if(!z)return null;if(!fe)return z.ringOut;if(fe.ringOut!==z.ringOut)return fe.ringOut.enclosingRing()!==z.ringOut?z.ringOut:z.ringOut.enclosingRing();z=fe.prevInResult(),fe=z?z.prevInResult():null}}}class Ni{constructor(L){this.exteriorRing=L,L.poly=this,this.interiorRings=[]}addInterior(L){this.interiorRings.push(L),L.poly=this}getGeom(){const L=[this.exteriorRing.getGeom()];if(L[0]===null)return null;for(let z=0,fe=this.interiorRings.length;z<fe;z++){const Re=this.interiorRings[z].getGeom();Re!==null&&L.push(Re)}return L}}class aa{constructor(L){this.rings=L,this.polys=this._composePolys(L)}getGeom(){const L=[];for(let z=0,fe=this.polys.length;z<fe;z++){const Re=this.polys[z].getGeom();Re!==null&&L.push(Re)}return L}_composePolys(L){const z=[];for(let fe=0,Re=L.length;fe<Re;fe++){const Ue=L[fe];if(!Ue.poly)if(Ue.isExteriorRing())z.push(new Ni(Ue));else{const $t=Ue.enclosingRing();$t.poly||z.push(new Ni($t)),$t.poly.addInterior(Ue)}}return z}}class da{constructor(L){let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qi.compare;this.queue=L,this.tree=new Ae(z),this.segments=[]}process(L){const z=L.segment,fe=[];if(L.consumedBy)return L.isLeft?this.queue.remove(L.otherSE):this.tree.remove(z),fe;const Re=L.isLeft?this.tree.add(z):this.tree.find(z);if(!Re)throw new Error(`Unable to find segment #${z.id} [${z.leftSE.point.x}, ${z.leftSE.point.y}] -> [${z.rightSE.point.x}, ${z.rightSE.point.y}] in SweepLine tree.`);let Ue=Re,$t=Re,Lt,Bt;for(;Lt===void 0;)Ue=this.tree.prev(Ue),Ue===null?Lt=null:Ue.key.consumedBy===void 0&&(Lt=Ue.key);for(;Bt===void 0;)$t=this.tree.next($t),$t===null?Bt=null:$t.key.consumedBy===void 0&&(Bt=$t.key);if(L.isLeft){let xt=null;if(Lt){const N=Lt.getIntersection(z);if(N!==null&&(z.isAnEndpoint(N)||(xt=N),!Lt.isAnEndpoint(N))){const q=this._splitSafely(Lt,N);for(let se=0,Me=q.length;se<Me;se++)fe.push(q[se])}}let U=null;if(Bt){const N=Bt.getIntersection(z);if(N!==null&&(z.isAnEndpoint(N)||(U=N),!Bt.isAnEndpoint(N))){const q=this._splitSafely(Bt,N);for(let se=0,Me=q.length;se<Me;se++)fe.push(q[se])}}if(xt!==null||U!==null){let N=null;xt===null?N=U:U===null?N=xt:N=jr.comparePoints(xt,U)<=0?xt:U,this.queue.remove(z.rightSE),fe.push(z.rightSE);const q=z.split(N);for(let se=0,Me=q.length;se<Me;se++)fe.push(q[se])}fe.length>0?(this.tree.remove(z),fe.push(L)):(this.segments.push(z),z.prev=Lt)}else{if(Lt&&Bt){const xt=Lt.getIntersection(Bt);if(xt!==null){if(!Lt.isAnEndpoint(xt)){const U=this._splitSafely(Lt,xt);for(let N=0,q=U.length;N<q;N++)fe.push(U[N])}if(!Bt.isAnEndpoint(xt)){const U=this._splitSafely(Bt,xt);for(let N=0,q=U.length;N<q;N++)fe.push(U[N])}}}this.tree.remove(z)}return fe}_splitSafely(L,z){this.tree.remove(L);const fe=L.rightSE;this.queue.remove(fe);const Re=L.split(z);return Re.push(fe),L.consumedBy===void 0&&this.tree.add(L),Re}}const so=typeof te!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,po=typeof te!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class To{run(L,z,fe){Gt.type=L,Pe.reset();const Re=[new ta(z,!0)];for(let N=0,q=fe.length;N<q;N++)Re.push(new ta(fe[N],!1));if(Gt.numMultiPolys=Re.length,Gt.type==="difference"){const N=Re[0];let q=1;for(;q<Re.length;)ht(Re[q].bbox,N.bbox)!==null?q++:Re.splice(q,1)}if(Gt.type==="intersection")for(let N=0,q=Re.length;N<q;N++){const se=Re[N];for(let Me=N+1,We=Re.length;Me<We;Me++)if(ht(se.bbox,Re[Me].bbox)===null)return[]}const Ue=new Ae(jr.compare);for(let N=0,q=Re.length;N<q;N++){const se=Re[N].getSweepEvents();for(let Me=0,We=se.length;Me<We;Me++)if(Ue.insert(se[Me]),Ue.size>so)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const $t=new da(Ue);let Lt=Ue.size,Bt=Ue.pop();for(;Bt;){const N=Bt.key;if(Ue.size===Lt){const se=N.segment;throw new Error(`Unable to pop() ${N.isLeft?"left":"right"} SweepEvent [${N.point.x}, ${N.point.y}] from segment #${se.id} [${se.leftSE.point.x}, ${se.leftSE.point.y}] -> [${se.rightSE.point.x}, ${se.rightSE.point.y}] from queue.`)}if(Ue.size>so)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if($t.segments.length>po)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const q=$t.process(N);for(let se=0,Me=q.length;se<Me;se++){const We=q[se];We.consumedBy===void 0&&Ue.insert(We)}Lt=Ue.size,Bt=Ue.pop()}Pe.reset();const xt=Se.factory($t.segments);return new aa(xt).getGeom()}}const Gt=new To;var Ci={union:function(he){for(var L=arguments.length,z=new Array(L>1?L-1:0),fe=1;fe<L;fe++)z[fe-1]=arguments[fe];return Gt.run("union",he,z)},intersection:function(he){for(var L=arguments.length,z=new Array(L>1?L-1:0),fe=1;fe<L;fe++)z[fe-1]=arguments[fe];return Gt.run("intersection",he,z)},xor:function(he){for(var L=arguments.length,z=new Array(L>1?L-1:0),fe=1;fe<L;fe++)z[fe-1]=arguments[fe];return Gt.run("xor",he,z)},difference:function(he){for(var L=arguments.length,z=new Array(L>1?L-1:0),fe=1;fe<L;fe++)z[fe-1]=arguments[fe];return Gt.run("difference",he,z)}};return Ci})},81550:function(Ut){(function(ae,O){Ut.exports=O()})(this,function(){"use strict";var ae=function(X){return X instanceof Uint8Array||X instanceof Uint16Array||X instanceof Uint32Array||X instanceof Int8Array||X instanceof Int16Array||X instanceof Int32Array||X instanceof Float32Array||X instanceof Float64Array||X instanceof Uint8ClampedArray},O=function(X,De){for(var rt=Object.keys(De),Jt=0;Jt<rt.length;++Jt)X[rt[Jt]]=De[rt[Jt]];return X},te=`
`;function de(X){return typeof atob!="undefined"?atob(X):"base64:"+X}function y(X){var De=new Error("(regl) "+X);throw console.error(De),De}function le(X,De){X||y(De)}function P(X){return X?": "+X:""}function Y(X,De,rt){X in De||y("unknown parameter ("+X+")"+P(rt)+". possible values: "+Object.keys(De).join())}function V(X,De){ae(X)||y("invalid parameter type"+P(De)+". must be a typed array")}function ue(X,De){switch(De){case"number":return typeof X=="number";case"object":return typeof X=="object";case"string":return typeof X=="string";case"boolean":return typeof X=="boolean";case"function":return typeof X=="function";case"undefined":return typeof X=="undefined";case"symbol":return typeof X=="symbol"}}function H(X,De,rt){ue(X,De)||y("invalid parameter type"+P(rt)+". expected "+De+", got "+typeof X)}function Ae(X,De){X>=0&&(X|0)===X||y("invalid parameter type, ("+X+")"+P(De)+". must be a nonnegative integer")}function Ce(X,De,rt){De.indexOf(X)<0&&y("invalid value"+P(rt)+". must be one of: "+De)}var ge=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function ct(X){Object.keys(X).forEach(function(De){ge.indexOf(De)<0&&y('invalid regl constructor argument "'+De+'". must be one of '+ge)})}function ye(X,De){for(X=X+"";X.length<De;)X=" "+X;return X}function St(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function mt(X,De){this.number=X,this.line=De,this.errors=[]}function Ze(X,De,rt){this.file=X,this.line=De,this.message=rt}function ht(){var X=new Error,De=(X.stack||X).toString(),rt=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(De);if(rt)return rt[1];var Jt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(De);return Jt?Jt[1]:"unknown"}function it(){var X=new Error,De=(X.stack||X).toString(),rt=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(De);if(rt)return rt[1];var Jt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(De);return Jt?Jt[1]:"unknown"}function dr(X,De){var rt=X.split(`
`),Jt=1,_r=0,rr={unknown:new St,0:new St};rr.unknown.name=rr[0].name=De||ht(),rr.unknown.lines.push(new mt(0,""));for(var Xt=0;Xt<rt.length;++Xt){var Nr=rt[Xt],Or=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Nr);if(Or)switch(Or[1]){case"line":var en=/(\d+)(\s+\d+)?/.exec(Or[2]);en&&(Jt=en[1]|0,en[2]&&(_r=en[2]|0,_r in rr||(rr[_r]=new St)));break;case"define":var zr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Or[2]);zr&&(rr[_r].name=zr[1]?de(zr[2]):zr[2]);break}rr[_r].lines.push(new mt(Jt++,Nr))}return Object.keys(rr).forEach(function(qr){var an=rr[qr];an.lines.forEach(function(Dr){an.index[Dr.number]=Dr})}),rr}function yr(X){var De=[];return X.split(`
`).forEach(function(rt){if(!(rt.length<5)){var Jt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(rt);Jt?De.push(new Ze(Jt[1]|0,Jt[2]|0,Jt[3].trim())):rt.length>0&&De.push(new Ze("unknown",0,rt))}}),De}function cr(X,De){De.forEach(function(rt){var Jt=X[rt.file];if(Jt){var _r=Jt.index[rt.line];if(_r){_r.errors.push(rt),Jt.hasErrors=!0;return}}X.unknown.hasErrors=!0,X.unknown.lines[0].errors.push(rt)})}function ft(X,De,rt,Jt,_r){if(!X.getShaderParameter(De,X.COMPILE_STATUS)){var rr=X.getShaderInfoLog(De),Xt=Jt===X.FRAGMENT_SHADER?"fragment":"vertex";j(rt,"string",Xt+" shader source must be a string",_r);var Nr=dr(rt,_r),Or=yr(rr);cr(Nr,Or),Object.keys(Nr).forEach(function(en){var zr=Nr[en];if(!zr.hasErrors)return;var qr=[""],an=[""];function Dr(Jr,Ft){qr.push(Jr),an.push(Ft||"")}Dr("file number "+en+": "+zr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),zr.lines.forEach(function(Jr){if(Jr.errors.length>0){Dr(ye(Jr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Dr(Jr.line+te,"color:red; background-color:yellow; font-weight:bold");var Ft=0;Jr.errors.forEach(function(lr){var Zr=lr.message,dn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Zr);if(dn){var Rr=dn[1];switch(Zr=dn[2],Rr){case"assign":Rr="=";break}Ft=Math.max(Jr.line.indexOf(Rr,Ft),0)}else Ft=0;Dr(ye("| ",6)),Dr(ye("^^^",Ft+3)+te,"font-weight:bold"),Dr(ye("| ",6)),Dr(Zr+te,"font-weight:bold")}),Dr(ye("| ",6)+te)}else Dr(ye(Jr.number,4)+"|  "),Dr(Jr.line+te,"color:red")}),typeof document!="undefined"&&!window.chrome?(an[0]=qr.join("%c"),console.log.apply(console,an)):console.log(qr.join(""))}),le.raise("Error compiling "+Xt+" shader, "+Nr[0].name)}}function Pe(X,De,rt,Jt,_r){if(!X.getProgramParameter(De,X.LINK_STATUS)){var rr=X.getProgramInfoLog(De),Xt=dr(rt,_r),Nr=dr(Jt,_r),Or='Error linking program with vertex shader, "'+Nr[0].name+'", and fragment shader "'+Xt[0].name+'"';typeof document!="undefined"?console.log("%c"+Or+te+"%c"+rr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Or+te+rr),le.raise(Or)}}function Rt(X){X._commandRef=ht()}function Ve(X,De,rt,Jt){Rt(X);function _r(Or){return Or?Jt.id(Or):0}X._fragId=_r(X.static.frag),X._vertId=_r(X.static.vert);function rr(Or,en){Object.keys(en).forEach(function(zr){Or[Jt.id(zr)]=!0})}var Xt=X._uniformSet={};rr(Xt,De.static),rr(Xt,De.dynamic);var Nr=X._attributeSet={};rr(Nr,rt.static),rr(Nr,rt.dynamic),X._hasCount="count"in X.static||"count"in X.dynamic||"elements"in X.static||"elements"in X.dynamic}function Vt(X,De){var rt=it();y(X+" in command "+(De||ht())+(rt==="unknown"?"":" called from "+rt))}function mr(X,De,rt){X||Vt(De,rt||ht())}function ie(X,De,rt,Jt){X in De||Vt("unknown parameter ("+X+")"+P(rt)+". possible values: "+Object.keys(De).join(),Jt||ht())}function j(X,De,rt,Jt){ue(X,De)||Vt("invalid parameter type"+P(rt)+". expected "+De+", got "+typeof X,Jt||ht())}function re(X){X()}function ke(X,De,rt){X.texture?Ce(X.texture._texture.internalformat,De,"unsupported texture format for attachment"):Ce(X.renderbuffer._renderbuffer.format,rt,"unsupported renderbuffer format for attachment")}var Te=33071,st=9728,ze=9984,Qe=9985,at=9986,Mt=9987,vr=5120,kt=5121,Vr=5122,Kr=5123,Ir=5124,In=5125,gn=5126,nn=32819,hi=32820,Lr=33635,jn=34042,jr=36193,hn={};hn[vr]=hn[kt]=1,hn[Vr]=hn[Kr]=hn[jr]=hn[Lr]=hn[nn]=hn[hi]=2,hn[Ir]=hn[In]=hn[gn]=hn[jn]=4;function qi(X,De){return X===hi||X===nn||X===Lr?2:X===jn?4:hn[X]*De}function Ei(X){return!(X&X-1)&&!!X}function ia(X,De,rt){var Jt,_r=De.width,rr=De.height,Xt=De.channels;le(_r>0&&_r<=rt.maxTextureSize&&rr>0&&rr<=rt.maxTextureSize,"invalid texture shape"),(X.wrapS!==Te||X.wrapT!==Te)&&le(Ei(_r)&&Ei(rr),"incompatible wrap mode for texture, both width and height must be power of 2"),De.mipmask===1?_r!==1&&rr!==1&&le(X.minFilter!==ze&&X.minFilter!==at&&X.minFilter!==Qe&&X.minFilter!==Mt,"min filter requires mipmap"):(le(Ei(_r)&&Ei(rr),"texture must be a square power of 2 to support mipmapping"),le(De.mipmask===(_r<<1)-1,"missing or incomplete mipmap data")),De.type===gn&&(rt.extensions.indexOf("oes_texture_float_linear")<0&&le(X.minFilter===st&&X.magFilter===st,"filter not supported, must enable oes_texture_float_linear"),le(!X.genMipmaps,"mipmap generation not supported with float textures"));var Nr=De.images;for(Jt=0;Jt<16;++Jt)if(Nr[Jt]){var Or=_r>>Jt,en=rr>>Jt;le(De.mipmask&1<<Jt,"missing mipmap data");var zr=Nr[Jt];if(le(zr.width===Or&&zr.height===en,"invalid shape for mip images"),le(zr.format===De.format&&zr.internalformat===De.internalformat&&zr.type===De.type,"incompatible type for mip image"),!zr.compressed)if(zr.data){var qr=Math.ceil(qi(zr.type,Xt)*Or/zr.unpackAlignment)*zr.unpackAlignment;le(zr.data.byteLength===qr*en,"invalid data for image, buffer size is inconsistent with image format")}else zr.element||zr.copy}else X.genMipmaps||le((De.mipmask&1<<Jt)===0,"extra mipmap data");De.compressed&&le(!X.genMipmaps,"mipmap generation for compressed images not supported")}function ta(X,De,rt,Jt){var _r=X.width,rr=X.height,Xt=X.channels;le(_r>0&&_r<=Jt.maxTextureSize&&rr>0&&rr<=Jt.maxTextureSize,"invalid texture shape"),le(_r===rr,"cube map must be square"),le(De.wrapS===Te&&De.wrapT===Te,"wrap mode not supported by cube map");for(var Nr=0;Nr<rt.length;++Nr){var Or=rt[Nr];le(Or.width===_r&&Or.height===rr,"inconsistent cube map face shape"),De.genMipmaps&&(le(!Or.compressed,"can not generate mipmap for compressed textures"),le(Or.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var en=Or.images,zr=0;zr<16;++zr){var qr=en[zr];if(qr){var an=_r>>zr,Dr=rr>>zr;le(Or.mipmask&1<<zr,"missing mipmap data"),le(qr.width===an&&qr.height===Dr,"invalid shape for mip images"),le(qr.format===X.format&&qr.internalformat===X.internalformat&&qr.type===X.type,"incompatible type for mip image"),qr.compressed||(qr.data?le(qr.data.byteLength===an*Dr*Math.max(qi(qr.type,Xt),qr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):qr.element||qr.copy)}}}}var Se=O(le,{optional:re,raise:y,commandRaise:Vt,command:mr,parameter:Y,commandParameter:ie,constructor:ct,type:H,commandType:j,isTypedArray:V,nni:Ae,oneOf:Ce,shaderError:ft,linkError:Pe,callSite:it,saveCommandRef:Rt,saveDrawInfo:Ve,framebufferFormat:ke,guessCommand:ht,texture2D:ia,textureCube:ta}),Ni=0,aa=0;function da(X,De){this.id=Ni++,this.type=X,this.data=De}function so(X){return X.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function po(X){if(X.length===0)return[];var De=X.charAt(0),rt=X.charAt(X.length-1);if(X.length>1&&De===rt&&(De==='"'||De==="'"))return['"'+so(X.substr(1,X.length-2))+'"'];var Jt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(X);if(Jt)return po(X.substr(0,Jt.index)).concat(po(Jt[1])).concat(po(X.substr(Jt.index+Jt[0].length)));var _r=X.split(".");if(_r.length===1)return['"'+so(X)+'"'];for(var rr=[],Xt=0;Xt<_r.length;++Xt)rr=rr.concat(po(_r[Xt]));return rr}function To(X){return"["+po(X).join("][")+"]"}function Gt(X,De){return new da(X,To(De+""))}function br(X){return typeof X=="function"&&!X._reglType||X instanceof da}function Gr(X,De){return typeof X=="function"?new da(aa,X):X}var rn={DynamicVariable:da,define:Gt,isDynamic:br,unbox:Gr,accessor:To},yn={next:typeof requestAnimationFrame=="function"?function(X){return requestAnimationFrame(X)}:function(X){return setTimeout(X,16)},cancel:typeof cancelAnimationFrame=="function"?function(X){return cancelAnimationFrame(X)}:clearTimeout},Ci=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function he(){var X={"":0},De=[""];return{id:function(rt){var Jt=X[rt];return Jt||(Jt=X[rt]=De.length,De.push(rt),Jt)},str:function(rt){return De[rt]}}}function L(X,De,rt){var Jt=document.createElement("canvas");O(Jt.style,{border:0,margin:0,padding:0,top:0,left:0}),X.appendChild(Jt),X===document.body&&(Jt.style.position="absolute",O(X.style,{margin:0,padding:0}));function _r(){var Nr=window.innerWidth,Or=window.innerHeight;if(X!==document.body){var en=X.getBoundingClientRect();Nr=en.right-en.left,Or=en.bottom-en.top}Jt.width=rt*Nr,Jt.height=rt*Or,O(Jt.style,{width:Nr+"px",height:Or+"px"})}var rr;X!==document.body&&typeof ResizeObserver=="function"?(rr=new ResizeObserver(function(){setTimeout(_r)}),rr.observe(X)):window.addEventListener("resize",_r,!1);function Xt(){rr?rr.disconnect():window.removeEventListener("resize",_r),X.removeChild(Jt)}return _r(),{canvas:Jt,onDestroy:Xt}}function z(X,De){function rt(Jt){try{return X.getContext(Jt,De)}catch(_r){return null}}return rt("webgl")||rt("experimental-webgl")||rt("webgl-experimental")}function fe(X){return typeof X.nodeName=="string"&&typeof X.appendChild=="function"&&typeof X.getBoundingClientRect=="function"}function Re(X){return typeof X.drawArrays=="function"||typeof X.drawElements=="function"}function Ue(X){return typeof X=="string"?X.split():(Se(Array.isArray(X),"invalid extension array"),X)}function $t(X){return typeof X=="string"?(Se(typeof document!="undefined","not supported outside of DOM"),document.querySelector(X)):X}function Lt(X){var De=X||{},rt,Jt,_r,rr,Xt={},Nr=[],Or=[],en=typeof window=="undefined"?1:window.devicePixelRatio,zr=!1,qr=function(Jr){Jr&&Se.raise(Jr)},an=function(){};if(typeof De=="string"?(Se(typeof document!="undefined","selector queries only supported in DOM enviroments"),rt=document.querySelector(De),Se(rt,"invalid query string for element")):typeof De=="object"?fe(De)?rt=De:Re(De)?(rr=De,_r=rr.canvas):(Se.constructor(De),"gl"in De?rr=De.gl:"canvas"in De?_r=$t(De.canvas):"container"in De&&(Jt=$t(De.container)),"attributes"in De&&(Xt=De.attributes,Se.type(Xt,"object","invalid context attributes")),"extensions"in De&&(Nr=Ue(De.extensions)),"optionalExtensions"in De&&(Or=Ue(De.optionalExtensions)),"onDone"in De&&(Se.type(De.onDone,"function","invalid or missing onDone callback"),qr=De.onDone),"profile"in De&&(zr=!!De.profile),"pixelRatio"in De&&(en=+De.pixelRatio,Se(en>0,"invalid pixel ratio"))):Se.raise("invalid arguments to regl"),rt&&(rt.nodeName.toLowerCase()==="canvas"?_r=rt:Jt=rt),!rr){if(!_r){Se(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Dr=L(Jt||document.body,qr,en);if(!Dr)return null;_r=Dr.canvas,an=Dr.onDestroy}Xt.premultipliedAlpha===void 0&&(Xt.premultipliedAlpha=!0),rr=z(_r,Xt)}return rr?{gl:rr,canvas:_r,container:Jt,extensions:Nr,optionalExtensions:Or,pixelRatio:en,profile:zr,onDone:qr,onDestroy:an}:(an(),qr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Bt(X,De){var rt={};function Jt(Xt){Se.type(Xt,"string","extension name must be string");var Nr=Xt.toLowerCase(),Or;try{Or=rt[Nr]=X.getExtension(Nr)}catch(en){}return!!Or}for(var _r=0;_r<De.extensions.length;++_r){var rr=De.extensions[_r];if(!Jt(rr))return De.onDestroy(),De.onDone('"'+rr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return De.optionalExtensions.forEach(Jt),{extensions:rt,restore:function(){Object.keys(rt).forEach(function(Xt){if(rt[Xt]&&!Jt(Xt))throw new Error("(regl): error restoring extension "+Xt)})}}}function xt(X,De){for(var rt=Array(X),Jt=0;Jt<X;++Jt)rt[Jt]=De(Jt);return rt}var U=5120,N=5121,q=5122,se=5123,Me=5124,We=5125,ut=5126;function W(X){for(var De=16;De<=1<<28;De*=16)if(X<=De)return De;return 0}function ne(X){var De,rt;return De=(X>65535)<<4,X>>>=De,rt=(X>255)<<3,X>>>=rt,De|=rt,rt=(X>15)<<2,X>>>=rt,De|=rt,rt=(X>3)<<1,X>>>=rt,De|=rt,De|X>>1}function je(){var X=xt(8,function(){return[]});function De(rr){var Xt=W(rr),Nr=X[ne(Xt)>>2];return Nr.length>0?Nr.pop():new ArrayBuffer(Xt)}function rt(rr){X[ne(rr.byteLength)>>2].push(rr)}function Jt(rr,Xt){var Nr=null;switch(rr){case U:Nr=new Int8Array(De(Xt),0,Xt);break;case N:Nr=new Uint8Array(De(Xt),0,Xt);break;case q:Nr=new Int16Array(De(2*Xt),0,Xt);break;case se:Nr=new Uint16Array(De(2*Xt),0,Xt);break;case Me:Nr=new Int32Array(De(4*Xt),0,Xt);break;case We:Nr=new Uint32Array(De(4*Xt),0,Xt);break;case ut:Nr=new Float32Array(De(4*Xt),0,Xt);break;default:return null}return Nr.length!==Xt?Nr.subarray(0,Xt):Nr}function _r(rr){rt(rr.buffer)}return{alloc:De,free:rt,allocType:Jt,freeType:_r}}var lt=je();lt.zero=je();var Ie=3408,Kt=3410,Er=3411,sn=3412,un=3413,nr=3414,Qr=3415,Hr=33901,$r=33902,oi=3379,pn=3386,mi=34921,Gi=36347,di=36348,zi=35661,Ri=35660,ss=34930,oa=36349,La=34076,Mi=34024,yi=7936,Ii=7937,Ba=7938,vu=35724,_a=34047,Ia=36063,Hl=34852,Ho=3553,Pa=34067,bi=34069,Fa=33984,ca=6408,Wo=5126,ma=5121,us=36160,Qo=36053,Bu=36064,gs=16384,xc=function(X,De){var rt=1;De.ext_texture_filter_anisotropic&&(rt=X.getParameter(_a));var Jt=1,_r=1;De.webgl_draw_buffers&&(Jt=X.getParameter(Hl),_r=X.getParameter(Ia));var rr=!!De.oes_texture_float;if(rr){var Xt=X.createTexture();X.bindTexture(Ho,Xt),X.texImage2D(Ho,0,ca,1,1,0,ca,Wo,null);var Nr=X.createFramebuffer();if(X.bindFramebuffer(us,Nr),X.framebufferTexture2D(us,Bu,Ho,Xt,0),X.bindTexture(Ho,null),X.checkFramebufferStatus(us)!==Qo)rr=!1;else{X.viewport(0,0,1,1),X.clearColor(1,0,0,1),X.clear(gs);var Or=lt.allocType(Wo,4);X.readPixels(0,0,1,1,ca,Wo,Or),X.getError()?rr=!1:(X.deleteFramebuffer(Nr),X.deleteTexture(Xt),rr=Or[0]===1),lt.freeType(Or)}}var en=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),zr=!0;if(!en){var qr=X.createTexture(),an=lt.allocType(ma,36);X.activeTexture(Fa),X.bindTexture(Pa,qr),X.texImage2D(bi,0,ca,3,3,0,ca,ma,an),lt.freeType(an),X.bindTexture(Pa,null),X.deleteTexture(qr),zr=!X.getError()}return{colorBits:[X.getParameter(Kt),X.getParameter(Er),X.getParameter(sn),X.getParameter(un)],depthBits:X.getParameter(nr),stencilBits:X.getParameter(Qr),subpixelBits:X.getParameter(Ie),extensions:Object.keys(De).filter(function(Dr){return!!De[Dr]}),maxAnisotropic:rt,maxDrawbuffers:Jt,maxColorAttachments:_r,pointSizeDims:X.getParameter(Hr),lineWidthDims:X.getParameter($r),maxViewportDims:X.getParameter(pn),maxCombinedTextureUnits:X.getParameter(zi),maxCubeMapSize:X.getParameter(La),maxRenderbufferSize:X.getParameter(Mi),maxTextureUnits:X.getParameter(ss),maxTextureSize:X.getParameter(oi),maxAttributes:X.getParameter(mi),maxVertexUniforms:X.getParameter(Gi),maxVertexTextureUnits:X.getParameter(Ri),maxVaryingVectors:X.getParameter(di),maxFragmentUniforms:X.getParameter(oa),glsl:X.getParameter(vu),renderer:X.getParameter(Ii),vendor:X.getParameter(yi),version:X.getParameter(Ba),readFloat:rr,npotTextureCube:zr}};function Ra(X){return!!X&&typeof X=="object"&&Array.isArray(X.shape)&&Array.isArray(X.stride)&&typeof X.offset=="number"&&X.shape.length===X.stride.length&&(Array.isArray(X.data)||ae(X.data))}var sa=function(X){return Object.keys(X).map(function(De){return X[De]})},er={shape:tn,flatten:fr};function Rn(X,De,rt){for(var Jt=0;Jt<De;++Jt)rt[Jt]=X[Jt]}function Ee(X,De,rt,Jt){for(var _r=0,rr=0;rr<De;++rr)for(var Xt=X[rr],Nr=0;Nr<rt;++Nr)Jt[_r++]=Xt[Nr]}function Ne(X,De,rt,Jt,_r,rr){for(var Xt=rr,Nr=0;Nr<De;++Nr)for(var Or=X[Nr],en=0;en<rt;++en)for(var zr=Or[en],qr=0;qr<Jt;++qr)_r[Xt++]=zr[qr]}function Tt(X,De,rt,Jt,_r){for(var rr=1,Xt=rt+1;Xt<De.length;++Xt)rr*=De[Xt];var Nr=De[rt];if(De.length-rt===4){var Or=De[rt+1],en=De[rt+2],zr=De[rt+3];for(Xt=0;Xt<Nr;++Xt)Ne(X[Xt],Or,en,zr,Jt,_r),_r+=rr}else for(Xt=0;Xt<Nr;++Xt)Tt(X[Xt],De,rt+1,Jt,_r),_r+=rr}function fr(X,De,rt,Jt){var _r=1;if(De.length)for(var rr=0;rr<De.length;++rr)_r*=De[rr];else _r=0;var Xt=Jt||lt.allocType(rt,_r);switch(De.length){case 0:break;case 1:Rn(X,De[0],Xt);break;case 2:Ee(X,De[0],De[1],Xt);break;case 3:Ne(X,De[0],De[1],De[2],Xt,0);break;default:Tt(X,De,0,Xt,0)}return Xt}function tn(X){for(var De=[],rt=X;rt.length;rt=rt[0])De.push(rt.length);return De}var Bn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Xi=5120,yo=5122,wo=5124,vo=5121,Bs=5123,Rs=5125,ep=5126,Sf=5126,Jo={int8:Xi,int16:yo,int32:wo,uint8:vo,uint16:Bs,uint32:Rs,float:ep,float32:Sf},Tl=35048,wl=35040,Fu={dynamic:Tl,stream:wl,static:35044},Nu=er.flatten,el=er.shape,qc=35044,Fs=35040,ro=5121,Cl=5126,tl=[];tl[5120]=1,tl[5122]=2,tl[5124]=4,tl[5121]=1,tl[5123]=2,tl[5125]=4,tl[5126]=4;function Af(X){return Bn[Object.prototype.toString.call(X)]|0}function tp(X,De){for(var rt=0;rt<De.length;++rt)X[rt]=De[rt]}function Tf(X,De,rt,Jt,_r,rr,Xt){for(var Nr=0,Or=0;Or<rt;++Or)for(var en=0;en<Jt;++en)X[Nr++]=De[_r*Or+rr*en+Xt]}function dh(X,De,rt,Jt){var _r=0,rr={};function Xt(Ft){this.id=_r++,this.buffer=X.createBuffer(),this.type=Ft,this.usage=qc,this.byteLength=0,this.dimension=1,this.dtype=ro,this.persistentData=null,rt.profile&&(this.stats={size:0})}Xt.prototype.bind=function(){X.bindBuffer(this.type,this.buffer)},Xt.prototype.destroy=function(){an(this)};var Nr=[];function Or(Ft,lr){var Zr=Nr.pop();return Zr||(Zr=new Xt(Ft)),Zr.bind(),qr(Zr,lr,Fs,0,1,!1),Zr}function en(Ft){Nr.push(Ft)}function zr(Ft,lr,Zr){Ft.byteLength=lr.byteLength,X.bufferData(Ft.type,lr,Zr)}function qr(Ft,lr,Zr,dn,Rr,bn){var Pr;if(Ft.usage=Zr,Array.isArray(lr)){if(Ft.dtype=dn||Cl,lr.length>0){var vn;if(Array.isArray(lr[0])){Pr=el(lr);for(var Cr=1,fn=1;fn<Pr.length;++fn)Cr*=Pr[fn];Ft.dimension=Cr,vn=Nu(lr,Pr,Ft.dtype),zr(Ft,vn,Zr),bn?Ft.persistentData=vn:lt.freeType(vn)}else if(typeof lr[0]=="number"){Ft.dimension=Rr;var $n=lt.allocType(Ft.dtype,lr.length);tp($n,lr),zr(Ft,$n,Zr),bn?Ft.persistentData=$n:lt.freeType($n)}else ae(lr[0])?(Ft.dimension=lr[0].length,Ft.dtype=dn||Af(lr[0])||Cl,vn=Nu(lr,[lr.length,lr[0].length],Ft.dtype),zr(Ft,vn,Zr),bn?Ft.persistentData=vn:lt.freeType(vn)):Se.raise("invalid buffer data")}}else if(ae(lr))Ft.dtype=dn||Af(lr),Ft.dimension=Rr,zr(Ft,lr,Zr),bn&&(Ft.persistentData=new Uint8Array(new Uint8Array(lr.buffer)));else if(Ra(lr)){Pr=lr.shape;var li=lr.stride,ln=lr.offset,Fr=0,Sr=0,Fn=0,Pi=0;Pr.length===1?(Fr=Pr[0],Sr=1,Fn=li[0],Pi=0):Pr.length===2?(Fr=Pr[0],Sr=Pr[1],Fn=li[0],Pi=li[1]):Se.raise("invalid shape"),Ft.dtype=dn||Af(lr.data)||Cl,Ft.dimension=Sr;var Zt=lt.allocType(Ft.dtype,Fr*Sr);Tf(Zt,lr.data,Fr,Sr,Fn,Pi,ln),zr(Ft,Zt,Zr),bn?Ft.persistentData=Zt:lt.freeType(Zt)}else lr instanceof ArrayBuffer?(Ft.dtype=ro,Ft.dimension=Rr,zr(Ft,lr,Zr),bn&&(Ft.persistentData=new Uint8Array(new Uint8Array(lr)))):Se.raise("invalid buffer data")}function an(Ft){De.bufferCount--,Jt(Ft);var lr=Ft.buffer;Se(lr,"buffer must not be deleted already"),X.deleteBuffer(lr),Ft.buffer=null,delete rr[Ft.id]}function Dr(Ft,lr,Zr,dn){De.bufferCount++;var Rr=new Xt(lr);rr[Rr.id]=Rr;function bn(Cr){var fn=qc,$n=null,li=0,ln=0,Fr=1;return Array.isArray(Cr)||ae(Cr)||Ra(Cr)||Cr instanceof ArrayBuffer?$n=Cr:typeof Cr=="number"?li=Cr|0:Cr&&(Se.type(Cr,"object","buffer arguments must be an object, a number or an array"),"data"in Cr&&(Se($n===null||Array.isArray($n)||ae($n)||Ra($n),"invalid data for buffer"),$n=Cr.data),"usage"in Cr&&(Se.parameter(Cr.usage,Fu,"invalid buffer usage"),fn=Fu[Cr.usage]),"type"in Cr&&(Se.parameter(Cr.type,Jo,"invalid buffer type"),ln=Jo[Cr.type]),"dimension"in Cr&&(Se.type(Cr.dimension,"number","invalid dimension"),Fr=Cr.dimension|0),"length"in Cr&&(Se.nni(li,"buffer length must be a nonnegative integer"),li=Cr.length|0)),Rr.bind(),$n?qr(Rr,$n,fn,ln,Fr,dn):(li&&X.bufferData(Rr.type,li,fn),Rr.dtype=ln||ro,Rr.usage=fn,Rr.dimension=Fr,Rr.byteLength=li),rt.profile&&(Rr.stats.size=Rr.byteLength*tl[Rr.dtype]),bn}function Pr(Cr,fn){Se(fn+Cr.byteLength<=Rr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Cr.byteLength+" starting from offset "+fn+" to a buffer of size "+Rr.byteLength),X.bufferSubData(Rr.type,fn,Cr)}function vn(Cr,fn){var $n=(fn||0)|0,li;if(Rr.bind(),ae(Cr)||Cr instanceof ArrayBuffer)Pr(Cr,$n);else if(Array.isArray(Cr)){if(Cr.length>0)if(typeof Cr[0]=="number"){var ln=lt.allocType(Rr.dtype,Cr.length);tp(ln,Cr),Pr(ln,$n),lt.freeType(ln)}else if(Array.isArray(Cr[0])||ae(Cr[0])){li=el(Cr);var Fr=Nu(Cr,li,Rr.dtype);Pr(Fr,$n),lt.freeType(Fr)}else Se.raise("invalid buffer data")}else if(Ra(Cr)){li=Cr.shape;var Sr=Cr.stride,Fn=0,Pi=0,Zt=0,Ai=0;li.length===1?(Fn=li[0],Pi=1,Zt=Sr[0],Ai=0):li.length===2?(Fn=li[0],Pi=li[1],Zt=Sr[0],Ai=Sr[1]):Se.raise("invalid shape");var Ct=Array.isArray(Cr.data)?Rr.dtype:Af(Cr.data),ri=lt.allocType(Ct,Fn*Pi);Tf(ri,Cr.data,Fn,Pi,Zt,Ai,Cr.offset),Pr(ri,$n),lt.freeType(ri)}else Se.raise("invalid data for buffer subdata");return bn}return Zr||bn(Ft),bn._reglType="buffer",bn._buffer=Rr,bn.subdata=vn,rt.profile&&(bn.stats=Rr.stats),bn.destroy=function(){an(Rr)},bn}function Jr(){sa(rr).forEach(function(Ft){Ft.buffer=X.createBuffer(),X.bindBuffer(Ft.type,Ft.buffer),X.bufferData(Ft.type,Ft.persistentData||Ft.byteLength,Ft.usage)})}return rt.profile&&(De.getTotalBufferSize=function(){var Ft=0;return Object.keys(rr).forEach(function(lr){Ft+=rr[lr].stats.size}),Ft}),{create:Dr,createStream:Or,destroyStream:en,clear:function(){sa(rr).forEach(an),Nr.forEach(an)},getBuffer:function(Ft){return Ft&&Ft._buffer instanceof Xt?Ft._buffer:null},restore:Jr,_initBuffer:qr}}var vh=0,mh=0,rp=1,np=1,Gp=4,Kc=4,Uu={points:vh,point:mh,lines:rp,line:np,triangles:Gp,triangle:Kc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ip=0,es=1,Wl=4,Rl=5120,Ks=5121,Ml=5122,pi=5123,rl=5124,Ns=5125,zu=34963,nl=35040,ap=35044;function ra(X,De,rt,Jt){var _r={},rr=0,Xt={uint8:Ks,uint16:pi};De.oes_element_index_uint&&(Xt.uint32=Ns);function Nr(Jr){this.id=rr++,_r[this.id]=this,this.buffer=Jr,this.primType=Wl,this.vertCount=0,this.type=0}Nr.prototype.bind=function(){this.buffer.bind()};var Or=[];function en(Jr){var Ft=Or.pop();return Ft||(Ft=new Nr(rt.create(null,zu,!0,!1)._buffer)),qr(Ft,Jr,nl,-1,-1,0,0),Ft}function zr(Jr){Or.push(Jr)}function qr(Jr,Ft,lr,Zr,dn,Rr,bn){Jr.buffer.bind();var Pr;if(Ft){var vn=bn;!bn&&(!ae(Ft)||Ra(Ft)&&!ae(Ft.data))&&(vn=De.oes_element_index_uint?Ns:pi),rt._initBuffer(Jr.buffer,Ft,lr,vn,3)}else X.bufferData(zu,Rr,lr),Jr.buffer.dtype=Pr||Ks,Jr.buffer.usage=lr,Jr.buffer.dimension=3,Jr.buffer.byteLength=Rr;if(Pr=bn,!bn){switch(Jr.buffer.dtype){case Ks:case Rl:Pr=Ks;break;case pi:case Ml:Pr=pi;break;case Ns:case rl:Pr=Ns;break;default:Se.raise("unsupported type for element array")}Jr.buffer.dtype=Pr}Jr.type=Pr,Se(Pr!==Ns||!!De.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Cr=dn;Cr<0&&(Cr=Jr.buffer.byteLength,Pr===pi?Cr>>=1:Pr===Ns&&(Cr>>=2)),Jr.vertCount=Cr;var fn=Zr;if(Zr<0){fn=Wl;var $n=Jr.buffer.dimension;$n===1&&(fn=ip),$n===2&&(fn=es),$n===3&&(fn=Wl)}Jr.primType=fn}function an(Jr){Jt.elementsCount--,Se(Jr.buffer!==null,"must not double destroy elements"),delete _r[Jr.id],Jr.buffer.destroy(),Jr.buffer=null}function Dr(Jr,Ft){var lr=rt.create(null,zu,!0),Zr=new Nr(lr._buffer);Jt.elementsCount++;function dn(Rr){if(!Rr)lr(),Zr.primType=Wl,Zr.vertCount=0,Zr.type=Ks;else if(typeof Rr=="number")lr(Rr),Zr.primType=Wl,Zr.vertCount=Rr|0,Zr.type=Ks;else{var bn=null,Pr=ap,vn=-1,Cr=-1,fn=0,$n=0;Array.isArray(Rr)||ae(Rr)||Ra(Rr)?bn=Rr:(Se.type(Rr,"object","invalid arguments for elements"),"data"in Rr&&(bn=Rr.data,Se(Array.isArray(bn)||ae(bn)||Ra(bn),"invalid data for element buffer")),"usage"in Rr&&(Se.parameter(Rr.usage,Fu,"invalid element buffer usage"),Pr=Fu[Rr.usage]),"primitive"in Rr&&(Se.parameter(Rr.primitive,Uu,"invalid element buffer primitive"),vn=Uu[Rr.primitive]),"count"in Rr&&(Se(typeof Rr.count=="number"&&Rr.count>=0,"invalid vertex count for elements"),Cr=Rr.count|0),"type"in Rr&&(Se.parameter(Rr.type,Xt,"invalid buffer type"),$n=Xt[Rr.type]),"length"in Rr?fn=Rr.length|0:(fn=Cr,$n===pi||$n===Ml?fn*=2:($n===Ns||$n===rl)&&(fn*=4))),qr(Zr,bn,Pr,vn,Cr,fn,$n)}return dn}return dn(Jr),dn._reglType="elements",dn._elements=Zr,dn.subdata=function(Rr,bn){return lr.subdata(Rr,bn),dn},dn.destroy=function(){an(Zr)},dn}return{create:Dr,createStream:en,destroyStream:zr,getElements:function(Jr){return typeof Jr=="function"&&Jr._elements instanceof Nr?Jr._elements:null},clear:function(){sa(_r).forEach(an)}}}var ki=new Float32Array(1),au=new Uint32Array(ki.buffer),mu=5123;function wf(X){for(var De=lt.allocType(mu,X.length),rt=0;rt<X.length;++rt)if(isNaN(X[rt]))De[rt]=65535;else if(X[rt]===1/0)De[rt]=31744;else if(X[rt]===-1/0)De[rt]=64512;else{ki[0]=X[rt];var Jt=au[0],_r=Jt>>>31<<15,rr=(Jt<<1>>>24)-127,Xt=Jt>>13&1024-1;if(rr<-24)De[rt]=_r;else if(rr<-14){var Nr=-14-rr;De[rt]=_r+(Xt+1024>>Nr)}else rr>15?De[rt]=_r+31744:De[rt]=_r+(rr+15<<10)+Xt}return De}function $a(X){return Array.isArray(X)||ae(X)}var gh=function(X){return!(X&X-1)&&!!X},Cf=34467,Us=3553,il=34067,gu=34069,Gl=6408,yh=6406,Ec=6407,va=6409,Sc=6410,al=32854,Il=32855,_h=36194,Qc=32819,ba=32820,Pl=33635,op=34042,ol=6402,Jc=34041,ef=35904,Rf=35906,sl=36193,Xl=33776,Zu=33777,tf=33778,Ac=33779,$l=35986,bh=35987,Tc=34798,zs=35840,xh=35841,rf=35842,wc=35843,Ol=36196,Vu=5121,Yl=5123,Mf=5125,ul=5126,Eh=10242,Sh=10243,Ah=10497,If=33071,sp=33648,Ya=10240,up=10241,Pf=9728,lp=9729,ql=9984,cp=9985,ju=9986,Sa=9987,Kl=33170,Hu=4352,ll=4353,Zi=4354,Aa=34046,ou=3317,nf=37440,af=37441,Qs=37443,fp=37444,Of=33984,kf=[ql,ju,cp,Sa],Ql=[0,va,Sc,Ec,Gl],Co={};Co[va]=Co[yh]=Co[ol]=1,Co[Jc]=Co[Sc]=2,Co[Ec]=Co[ef]=3,Co[Gl]=Co[Rf]=4;function qa(X){return"[object "+X+"]"}var of=qa("HTMLCanvasElement"),Cc=qa("OffscreenCanvas"),uo=qa("CanvasRenderingContext2D"),Mn=qa("ImageBitmap"),ys=qa("HTMLImageElement"),Df=qa("HTMLVideoElement"),Rc=Object.keys(Bn).concat([of,Cc,uo,Mn,ys,Df]),ls=[];ls[Vu]=1,ls[ul]=4,ls[sl]=2,ls[Yl]=2,ls[Mf]=4;var xa=[];xa[al]=2,xa[Il]=2,xa[_h]=2,xa[Jc]=4,xa[Xl]=.5,xa[Zu]=.5,xa[tf]=1,xa[Ac]=1,xa[$l]=.5,xa[bh]=1,xa[Tc]=1,xa[zs]=.5,xa[xh]=.25,xa[rf]=.5,xa[wc]=.25,xa[Ol]=.5;function Lf(X){return Array.isArray(X)&&(X.length===0||typeof X[0]=="number")}function cn(X){if(!Array.isArray(X))return!1;var De=X.length;return!(De===0||!$a(X[0]))}function cl(X){return Object.prototype.toString.call(X)}function sf(X){return cl(X)===of}function uf(X){return cl(X)===Cc}function yu(X){return cl(X)===uo}function Zs(X){return cl(X)===Mn}function Bf(X){return cl(X)===ys}function Ff(X){return cl(X)===Df}function _s(X){if(!X)return!1;var De=cl(X);return Rc.indexOf(De)>=0?!0:Lf(X)||cn(X)||Ra(X)}function _u(X){return Bn[Object.prototype.toString.call(X)]|0}function hp(X,De){var rt=De.length;switch(X.type){case Vu:case Yl:case Mf:case ul:var Jt=lt.allocType(X.type,rt);Jt.set(De),X.data=Jt;break;case sl:X.data=wf(De);break;default:Se.raise("unsupported texture type, must specify a typed array")}}function Mc(X,De){return lt.allocType(X.type===sl?ul:X.type,De)}function Ic(X,De){X.type===sl?(X.data=wf(De),lt.freeType(De)):X.data=De}function Nf(X,De,rt,Jt,_r,rr){for(var Xt=X.width,Nr=X.height,Or=X.channels,en=Xt*Nr*Or,zr=Mc(X,en),qr=0,an=0;an<Nr;++an)for(var Dr=0;Dr<Xt;++Dr)for(var Jr=0;Jr<Or;++Jr)zr[qr++]=De[rt*Dr+Jt*an+_r*Jr+rr];Ic(X,zr)}function Js(X,De,rt,Jt,_r,rr){var Xt;if(typeof xa[X]!="undefined"?Xt=xa[X]:Xt=Co[X]*ls[De],rr&&(Xt*=6),_r){for(var Nr=0,Or=rt;Or>=1;)Nr+=Xt*Or*Or,Or/=2;return Nr}else return Xt*rt*Jt}function Nt(X,De,rt,Jt,_r,rr,Xt){var Nr={"don't care":Hu,"dont care":Hu,nice:Zi,fast:ll},Or={repeat:Ah,clamp:If,mirror:sp},en={nearest:Pf,linear:lp},zr=O({mipmap:Sa,"nearest mipmap nearest":ql,"linear mipmap nearest":cp,"nearest mipmap linear":ju,"linear mipmap linear":Sa},en),qr={none:0,browser:fp},an={uint8:Vu,rgba4:Qc,rgb565:Pl,"rgb5 a1":ba},Dr={alpha:yh,luminance:va,"luminance alpha":Sc,rgb:Ec,rgba:Gl,rgba4:al,"rgb5 a1":Il,rgb565:_h},Jr={};De.ext_srgb&&(Dr.srgb=ef,Dr.srgba=Rf),De.oes_texture_float&&(an.float32=an.float=ul),De.oes_texture_half_float&&(an.float16=an["half float"]=sl),De.webgl_depth_texture&&(O(Dr,{depth:ol,"depth stencil":Jc}),O(an,{uint16:Yl,uint32:Mf,"depth stencil":op})),De.webgl_compressed_texture_s3tc&&O(Jr,{"rgb s3tc dxt1":Xl,"rgba s3tc dxt1":Zu,"rgba s3tc dxt3":tf,"rgba s3tc dxt5":Ac}),De.webgl_compressed_texture_atc&&O(Jr,{"rgb atc":$l,"rgba atc explicit alpha":bh,"rgba atc interpolated alpha":Tc}),De.webgl_compressed_texture_pvrtc&&O(Jr,{"rgb pvrtc 4bppv1":zs,"rgb pvrtc 2bppv1":xh,"rgba pvrtc 4bppv1":rf,"rgba pvrtc 2bppv1":wc}),De.webgl_compressed_texture_etc1&&(Jr["rgb etc1"]=Ol);var Ft=Array.prototype.slice.call(X.getParameter(Cf));Object.keys(Jr).forEach(function(Ke){var or=Jr[Ke];Ft.indexOf(or)>=0&&(Dr[Ke]=or)});var lr=Object.keys(Dr);rt.textureFormats=lr;var Zr=[];Object.keys(Dr).forEach(function(Ke){var or=Dr[Ke];Zr[or]=Ke});var dn=[];Object.keys(an).forEach(function(Ke){var or=an[Ke];dn[or]=Ke});var Rr=[];Object.keys(en).forEach(function(Ke){var or=en[Ke];Rr[or]=Ke});var bn=[];Object.keys(zr).forEach(function(Ke){var or=zr[Ke];bn[or]=Ke});var Pr=[];Object.keys(Or).forEach(function(Ke){var or=Or[Ke];Pr[or]=Ke});var vn=lr.reduce(function(Ke,or){var Yt=Dr[or];return Yt===va||Yt===yh||Yt===va||Yt===Sc||Yt===ol||Yt===Jc||De.ext_srgb&&(Yt===ef||Yt===Rf)?Ke[Yt]=Yt:Yt===Il||or.indexOf("rgba")>=0?Ke[Yt]=Gl:Ke[Yt]=Ec,Ke},{});function Cr(){this.internalformat=Gl,this.format=Gl,this.type=Vu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=fp,this.width=0,this.height=0,this.channels=0}function fn(Ke,or){Ke.internalformat=or.internalformat,Ke.format=or.format,Ke.type=or.type,Ke.compressed=or.compressed,Ke.premultiplyAlpha=or.premultiplyAlpha,Ke.flipY=or.flipY,Ke.unpackAlignment=or.unpackAlignment,Ke.colorSpace=or.colorSpace,Ke.width=or.width,Ke.height=or.height,Ke.channels=or.channels}function $n(Ke,or){if(!(typeof or!="object"||!or)){if("premultiplyAlpha"in or&&(Se.type(or.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ke.premultiplyAlpha=or.premultiplyAlpha),"flipY"in or&&(Se.type(or.flipY,"boolean","invalid texture flip"),Ke.flipY=or.flipY),"alignment"in or&&(Se.oneOf(or.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ke.unpackAlignment=or.alignment),"colorSpace"in or&&(Se.parameter(or.colorSpace,qr,"invalid colorSpace"),Ke.colorSpace=qr[or.colorSpace]),"type"in or){var Yt=or.type;Se(De.oes_texture_float||!(Yt==="float"||Yt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),Se(De.oes_texture_half_float||!(Yt==="half float"||Yt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),Se(De.webgl_depth_texture||!(Yt==="uint16"||Yt==="uint32"||Yt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Se.parameter(Yt,an,"invalid texture type"),Ke.type=an[Yt]}var xn=Ke.width,Ti=Ke.height,ga=Ke.channels,me=!1;"shape"in or?(Se(Array.isArray(or.shape)&&or.shape.length>=2,"shape must be an array"),xn=or.shape[0],Ti=or.shape[1],or.shape.length===3&&(ga=or.shape[2],Se(ga>0&&ga<=4,"invalid number of channels"),me=!0),Se(xn>=0&&xn<=rt.maxTextureSize,"invalid width"),Se(Ti>=0&&Ti<=rt.maxTextureSize,"invalid height")):("radius"in or&&(xn=Ti=or.radius,Se(xn>=0&&xn<=rt.maxTextureSize,"invalid radius")),"width"in or&&(xn=or.width,Se(xn>=0&&xn<=rt.maxTextureSize,"invalid width")),"height"in or&&(Ti=or.height,Se(Ti>=0&&Ti<=rt.maxTextureSize,"invalid height")),"channels"in or&&(ga=or.channels,Se(ga>0&&ga<=4,"invalid number of channels"),me=!0)),Ke.width=xn|0,Ke.height=Ti|0,Ke.channels=ga|0;var Fe=!1;if("format"in or){var nt=or.format;Se(De.webgl_depth_texture||!(nt==="depth"||nt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Se.parameter(nt,Dr,"invalid texture format");var qt=Ke.internalformat=Dr[nt];Ke.format=vn[qt],nt in an&&("type"in or||(Ke.type=an[nt])),nt in Jr&&(Ke.compressed=!0),Fe=!0}!me&&Fe?Ke.channels=Co[Ke.format]:me&&!Fe?Ke.channels!==Ql[Ke.format]&&(Ke.format=Ke.internalformat=Ql[Ke.channels]):Fe&&me&&Se(Ke.channels===Co[Ke.format],"number of channels inconsistent with specified format")}}function li(Ke){X.pixelStorei(nf,Ke.flipY),X.pixelStorei(af,Ke.premultiplyAlpha),X.pixelStorei(Qs,Ke.colorSpace),X.pixelStorei(ou,Ke.unpackAlignment)}function ln(){Cr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Fr(Ke,or){var Yt=null;if(_s(or)?Yt=or:or&&(Se.type(or,"object","invalid pixel data type"),$n(Ke,or),"x"in or&&(Ke.xOffset=or.x|0),"y"in or&&(Ke.yOffset=or.y|0),_s(or.data)&&(Yt=or.data)),Se(!Ke.compressed||Yt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),or.copy){Se(!Yt,"can not specify copy and data field for the same texture");var xn=_r.viewportWidth,Ti=_r.viewportHeight;Ke.width=Ke.width||xn-Ke.xOffset,Ke.height=Ke.height||Ti-Ke.yOffset,Ke.needsCopy=!0,Se(Ke.xOffset>=0&&Ke.xOffset<xn&&Ke.yOffset>=0&&Ke.yOffset<Ti&&Ke.width>0&&Ke.width<=xn&&Ke.height>0&&Ke.height<=Ti,"copy texture read out of bounds")}else if(!Yt)Ke.width=Ke.width||1,Ke.height=Ke.height||1,Ke.channels=Ke.channels||4;else if(ae(Yt))Ke.channels=Ke.channels||4,Ke.data=Yt,!("type"in or)&&Ke.type===Vu&&(Ke.type=_u(Yt));else if(Lf(Yt))Ke.channels=Ke.channels||4,hp(Ke,Yt),Ke.alignment=1,Ke.needsFree=!0;else if(Ra(Yt)){var ga=Yt.data;!Array.isArray(ga)&&Ke.type===Vu&&(Ke.type=_u(ga));var me=Yt.shape,Fe=Yt.stride,nt,qt,Wt,gt,At,It;me.length===3?(Wt=me[2],It=Fe[2]):(Se(me.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Wt=1,It=1),nt=me[0],qt=me[1],gt=Fe[0],At=Fe[1],Ke.alignment=1,Ke.width=nt,Ke.height=qt,Ke.channels=Wt,Ke.format=Ke.internalformat=Ql[Wt],Ke.needsFree=!0,Nf(Ke,ga,gt,At,It,Yt.offset)}else if(sf(Yt)||uf(Yt)||yu(Yt))sf(Yt)||uf(Yt)?Ke.element=Yt:Ke.element=Yt.canvas,Ke.width=Ke.element.width,Ke.height=Ke.element.height,Ke.channels=4;else if(Zs(Yt))Ke.element=Yt,Ke.width=Yt.width,Ke.height=Yt.height,Ke.channels=4;else if(Bf(Yt))Ke.element=Yt,Ke.width=Yt.naturalWidth,Ke.height=Yt.naturalHeight,Ke.channels=4;else if(Ff(Yt))Ke.element=Yt,Ke.width=Yt.videoWidth,Ke.height=Yt.videoHeight,Ke.channels=4;else if(cn(Yt)){var Je=Ke.width||Yt[0].length,_t=Ke.height||Yt.length,Be=Ke.channels;$a(Yt[0][0])?Be=Be||Yt[0][0].length:Be=Be||1;for(var Et=er.shape(Yt),tr=1,pr=0;pr<Et.length;++pr)tr*=Et[pr];var sr=Mc(Ke,tr);er.flatten(Yt,Et,"",sr),Ic(Ke,sr),Ke.alignment=1,Ke.width=Je,Ke.height=_t,Ke.channels=Be,Ke.format=Ke.internalformat=Ql[Be],Ke.needsFree=!0}Ke.type===ul?Se(rt.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ke.type===sl&&Se(rt.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Sr(Ke,or,Yt){var xn=Ke.element,Ti=Ke.data,ga=Ke.internalformat,me=Ke.format,Fe=Ke.type,nt=Ke.width,qt=Ke.height;li(Ke),xn?X.texImage2D(or,Yt,me,me,Fe,xn):Ke.compressed?X.compressedTexImage2D(or,Yt,ga,nt,qt,0,Ti):Ke.needsCopy?(Jt(),X.copyTexImage2D(or,Yt,me,Ke.xOffset,Ke.yOffset,nt,qt,0)):X.texImage2D(or,Yt,me,nt,qt,0,me,Fe,Ti||null)}function Fn(Ke,or,Yt,xn,Ti){var ga=Ke.element,me=Ke.data,Fe=Ke.internalformat,nt=Ke.format,qt=Ke.type,Wt=Ke.width,gt=Ke.height;li(Ke),ga?X.texSubImage2D(or,Ti,Yt,xn,nt,qt,ga):Ke.compressed?X.compressedTexSubImage2D(or,Ti,Yt,xn,Fe,Wt,gt,me):Ke.needsCopy?(Jt(),X.copyTexSubImage2D(or,Ti,Yt,xn,Ke.xOffset,Ke.yOffset,Wt,gt)):X.texSubImage2D(or,Ti,Yt,xn,Wt,gt,nt,qt,me)}var Pi=[];function Zt(){return Pi.pop()||new ln}function Ai(Ke){Ke.needsFree&&lt.freeType(Ke.data),ln.call(Ke),Pi.push(Ke)}function Ct(){Cr.call(this),this.genMipmaps=!1,this.mipmapHint=Hu,this.mipmask=0,this.images=Array(16)}function ri(Ke,or,Yt){var xn=Ke.images[0]=Zt();Ke.mipmask=1,xn.width=Ke.width=or,xn.height=Ke.height=Yt,xn.channels=Ke.channels=4}function na(Ke,or){var Yt=null;if(_s(or))Yt=Ke.images[0]=Zt(),fn(Yt,Ke),Fr(Yt,or),Ke.mipmask=1;else if($n(Ke,or),Array.isArray(or.mipmap))for(var xn=or.mipmap,Ti=0;Ti<xn.length;++Ti)Yt=Ke.images[Ti]=Zt(),fn(Yt,Ke),Yt.width>>=Ti,Yt.height>>=Ti,Fr(Yt,xn[Ti]),Ke.mipmask|=1<<Ti;else Yt=Ke.images[0]=Zt(),fn(Yt,Ke),Fr(Yt,or),Ke.mipmask=1;fn(Ke,Ke.images[0]),Ke.compressed&&(Ke.internalformat===Xl||Ke.internalformat===Zu||Ke.internalformat===tf||Ke.internalformat===Ac)&&Se(Ke.width%4===0&&Ke.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function mo(Ke,or){for(var Yt=Ke.images,xn=0;xn<Yt.length;++xn){if(!Yt[xn])return;Sr(Yt[xn],or,xn)}}var rs=[];function Di(){var Ke=rs.pop()||new Ct;Cr.call(Ke),Ke.mipmask=0;for(var or=0;or<16;++or)Ke.images[or]=null;return Ke}function Qa(Ke){for(var or=Ke.images,Yt=0;Yt<or.length;++Yt)or[Yt]&&Ai(or[Yt]),or[Yt]=null;rs.push(Ke)}function Oa(){this.minFilter=Pf,this.magFilter=Pf,this.wrapS=If,this.wrapT=If,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Hu}function Bo(Ke,or){if("min"in or){var Yt=or.min;Se.parameter(Yt,zr),Ke.minFilter=zr[Yt],kf.indexOf(Ke.minFilter)>=0&&!("faces"in or)&&(Ke.genMipmaps=!0)}if("mag"in or){var xn=or.mag;Se.parameter(xn,en),Ke.magFilter=en[xn]}var Ti=Ke.wrapS,ga=Ke.wrapT;if("wrap"in or){var me=or.wrap;typeof me=="string"?(Se.parameter(me,Or),Ti=ga=Or[me]):Array.isArray(me)&&(Se.parameter(me[0],Or),Se.parameter(me[1],Or),Ti=Or[me[0]],ga=Or[me[1]])}else{if("wrapS"in or){var Fe=or.wrapS;Se.parameter(Fe,Or),Ti=Or[Fe]}if("wrapT"in or){var nt=or.wrapT;Se.parameter(nt,Or),ga=Or[nt]}}if(Ke.wrapS=Ti,Ke.wrapT=ga,"anisotropic"in or){var qt=or.anisotropic;Se(typeof qt=="number"&&qt>=1&&qt<=rt.maxAnisotropic,"aniso samples must be between 1 and "),Ke.anisotropic=or.anisotropic}if("mipmap"in or){var Wt=!1;switch(typeof or.mipmap){case"string":Se.parameter(or.mipmap,Nr,"invalid mipmap hint"),Ke.mipmapHint=Nr[or.mipmap],Ke.genMipmaps=!0,Wt=!0;break;case"boolean":Wt=Ke.genMipmaps=or.mipmap;break;case"object":Se(Array.isArray(or.mipmap),"invalid mipmap type"),Ke.genMipmaps=!1,Wt=!0;break;default:Se.raise("invalid mipmap type")}Wt&&!("min"in or)&&(Ke.minFilter=ql)}}function xo(Ke,or){X.texParameteri(or,up,Ke.minFilter),X.texParameteri(or,Ya,Ke.magFilter),X.texParameteri(or,Eh,Ke.wrapS),X.texParameteri(or,Sh,Ke.wrapT),De.ext_texture_filter_anisotropic&&X.texParameteri(or,Aa,Ke.anisotropic),Ke.genMipmaps&&(X.hint(Kl,Ke.mipmapHint),X.generateMipmap(or))}var Ja=0,Fo={},ds=rt.maxTextureUnits,Eo=Array(ds).map(function(){return null});function Si(Ke){Cr.call(this),this.mipmask=0,this.internalformat=Gl,this.id=Ja++,this.refCount=1,this.target=Ke,this.texture=X.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Oa,Xt.profile&&(this.stats={size:0})}function ns(Ke){X.activeTexture(Of),X.bindTexture(Ke.target,Ke.texture)}function fa(){var Ke=Eo[0];Ke?X.bindTexture(Ke.target,Ke.texture):X.bindTexture(Us,null)}function ei(Ke){var or=Ke.texture;Se(or,"must not double destroy texture");var Yt=Ke.unit,xn=Ke.target;Yt>=0&&(X.activeTexture(Of+Yt),X.bindTexture(xn,null),Eo[Yt]=null),X.deleteTexture(or),Ke.texture=null,Ke.params=null,Ke.pixels=null,Ke.refCount=0,delete Fo[Ke.id],rr.textureCount--}O(Si.prototype,{bind:function(){var Ke=this;Ke.bindCount+=1;var or=Ke.unit;if(or<0){for(var Yt=0;Yt<ds;++Yt){var xn=Eo[Yt];if(xn){if(xn.bindCount>0)continue;xn.unit=-1}Eo[Yt]=Ke,or=Yt;break}or>=ds&&Se.raise("insufficient number of texture units"),Xt.profile&&rr.maxTextureUnits<or+1&&(rr.maxTextureUnits=or+1),Ke.unit=or,X.activeTexture(Of+or),X.bindTexture(Ke.target,Ke.texture)}return or},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ei(this)}});function Li(Ke,or){var Yt=new Si(Us);Fo[Yt.id]=Yt,rr.textureCount++;function xn(me,Fe){var nt=Yt.texInfo;Oa.call(nt);var qt=Di();return typeof me=="number"?typeof Fe=="number"?ri(qt,me|0,Fe|0):ri(qt,me|0,me|0):me?(Se.type(me,"object","invalid arguments to regl.texture"),Bo(nt,me),na(qt,me)):ri(qt,1,1),nt.genMipmaps&&(qt.mipmask=(qt.width<<1)-1),Yt.mipmask=qt.mipmask,fn(Yt,qt),Se.texture2D(nt,qt,rt),Yt.internalformat=qt.internalformat,xn.width=qt.width,xn.height=qt.height,ns(Yt),mo(qt,Us),xo(nt,Us),fa(),Qa(qt),Xt.profile&&(Yt.stats.size=Js(Yt.internalformat,Yt.type,qt.width,qt.height,nt.genMipmaps,!1)),xn.format=Zr[Yt.internalformat],xn.type=dn[Yt.type],xn.mag=Rr[nt.magFilter],xn.min=bn[nt.minFilter],xn.wrapS=Pr[nt.wrapS],xn.wrapT=Pr[nt.wrapT],xn}function Ti(me,Fe,nt,qt){Se(!!me,"must specify image data");var Wt=Fe|0,gt=nt|0,At=qt|0,It=Zt();return fn(It,Yt),It.width=0,It.height=0,Fr(It,me),It.width=It.width||(Yt.width>>At)-Wt,It.height=It.height||(Yt.height>>At)-gt,Se(Yt.type===It.type&&Yt.format===It.format&&Yt.internalformat===It.internalformat,"incompatible format for texture.subimage"),Se(Wt>=0&&gt>=0&&Wt+It.width<=Yt.width&&gt+It.height<=Yt.height,"texture.subimage write out of bounds"),Se(Yt.mipmask&1<<At,"missing mipmap data"),Se(It.data||It.element||It.needsCopy,"missing image data"),ns(Yt),Fn(It,Us,Wt,gt,At),fa(),Ai(It),xn}function ga(me,Fe){var nt=me|0,qt=Fe|0||nt;if(nt===Yt.width&&qt===Yt.height)return xn;xn.width=Yt.width=nt,xn.height=Yt.height=qt,ns(Yt);for(var Wt=0;Yt.mipmask>>Wt;++Wt){var gt=nt>>Wt,At=qt>>Wt;if(!gt||!At)break;X.texImage2D(Us,Wt,Yt.format,gt,At,0,Yt.format,Yt.type,null)}return fa(),Xt.profile&&(Yt.stats.size=Js(Yt.internalformat,Yt.type,nt,qt,!1,!1)),xn}return xn(Ke,or),xn.subimage=Ti,xn.resize=ga,xn._reglType="texture2d",xn._texture=Yt,Xt.profile&&(xn.stats=Yt.stats),xn.destroy=function(){Yt.decRef()},xn}function Ki(Ke,or,Yt,xn,Ti,ga){var me=new Si(il);Fo[me.id]=me,rr.cubeCount++;var Fe=new Array(6);function nt(gt,At,It,Je,_t,Be){var Et,tr=me.texInfo;for(Oa.call(tr),Et=0;Et<6;++Et)Fe[Et]=Di();if(typeof gt=="number"||!gt){var pr=gt|0||1;for(Et=0;Et<6;++Et)ri(Fe[Et],pr,pr)}else if(typeof gt=="object")if(At)na(Fe[0],gt),na(Fe[1],At),na(Fe[2],It),na(Fe[3],Je),na(Fe[4],_t),na(Fe[5],Be);else if(Bo(tr,gt),$n(me,gt),"faces"in gt){var sr=gt.faces;for(Se(Array.isArray(sr)&&sr.length===6,"cube faces must be a length 6 array"),Et=0;Et<6;++Et)Se(typeof sr[Et]=="object"&&!!sr[Et],"invalid input for cube map face"),fn(Fe[Et],me),na(Fe[Et],sr[Et])}else for(Et=0;Et<6;++Et)na(Fe[Et],gt);else Se.raise("invalid arguments to cube map");for(fn(me,Fe[0]),rt.npotTextureCube||Se(gh(me.width)&&gh(me.height),"your browser does not support non power or two texture dimensions"),tr.genMipmaps?me.mipmask=(Fe[0].width<<1)-1:me.mipmask=Fe[0].mipmask,Se.textureCube(me,tr,Fe,rt),me.internalformat=Fe[0].internalformat,nt.width=Fe[0].width,nt.height=Fe[0].height,ns(me),Et=0;Et<6;++Et)mo(Fe[Et],gu+Et);for(xo(tr,il),fa(),Xt.profile&&(me.stats.size=Js(me.internalformat,me.type,nt.width,nt.height,tr.genMipmaps,!0)),nt.format=Zr[me.internalformat],nt.type=dn[me.type],nt.mag=Rr[tr.magFilter],nt.min=bn[tr.minFilter],nt.wrapS=Pr[tr.wrapS],nt.wrapT=Pr[tr.wrapT],Et=0;Et<6;++Et)Qa(Fe[Et]);return nt}function qt(gt,At,It,Je,_t){Se(!!At,"must specify image data"),Se(typeof gt=="number"&&gt===(gt|0)&&gt>=0&&gt<6,"invalid face");var Be=It|0,Et=Je|0,tr=_t|0,pr=Zt();return fn(pr,me),pr.width=0,pr.height=0,Fr(pr,At),pr.width=pr.width||(me.width>>tr)-Be,pr.height=pr.height||(me.height>>tr)-Et,Se(me.type===pr.type&&me.format===pr.format&&me.internalformat===pr.internalformat,"incompatible format for texture.subimage"),Se(Be>=0&&Et>=0&&Be+pr.width<=me.width&&Et+pr.height<=me.height,"texture.subimage write out of bounds"),Se(me.mipmask&1<<tr,"missing mipmap data"),Se(pr.data||pr.element||pr.needsCopy,"missing image data"),ns(me),Fn(pr,gu+gt,Be,Et,tr),fa(),Ai(pr),nt}function Wt(gt){var At=gt|0;if(At!==me.width){nt.width=me.width=At,nt.height=me.height=At,ns(me);for(var It=0;It<6;++It)for(var Je=0;me.mipmask>>Je;++Je)X.texImage2D(gu+It,Je,me.format,At>>Je,At>>Je,0,me.format,me.type,null);return fa(),Xt.profile&&(me.stats.size=Js(me.internalformat,me.type,nt.width,nt.height,!1,!0)),nt}}return nt(Ke,or,Yt,xn,Ti,ga),nt.subimage=qt,nt.resize=Wt,nt._reglType="textureCube",nt._texture=me,Xt.profile&&(nt.stats=me.stats),nt.destroy=function(){me.decRef()},nt}function So(){for(var Ke=0;Ke<ds;++Ke)X.activeTexture(Of+Ke),X.bindTexture(Us,null),Eo[Ke]=null;sa(Fo).forEach(ei),rr.cubeCount=0,rr.textureCount=0}Xt.profile&&(rr.getTotalTextureSize=function(){var Ke=0;return Object.keys(Fo).forEach(function(or){Ke+=Fo[or].stats.size}),Ke});function yl(){for(var Ke=0;Ke<ds;++Ke){var or=Eo[Ke];or&&(or.bindCount=0,or.unit=-1,Eo[Ke]=null)}sa(Fo).forEach(function(Yt){Yt.texture=X.createTexture(),X.bindTexture(Yt.target,Yt.texture);for(var xn=0;xn<32;++xn)if(Yt.mipmask&1<<xn)if(Yt.target===Us)X.texImage2D(Us,xn,Yt.internalformat,Yt.width>>xn,Yt.height>>xn,0,Yt.internalformat,Yt.type,null);else for(var Ti=0;Ti<6;++Ti)X.texImage2D(gu+Ti,xn,Yt.internalformat,Yt.width>>xn,Yt.height>>xn,0,Yt.internalformat,Yt.type,null);xo(Yt.texInfo,Yt.target)})}return{create2D:Li,createCube:Ki,clear:So,getTexture:function(Ke){return null},restore:yl}}var Le=36161,F=32854,eu=32855,ve=36194,kl=33189,Wu=36168,su=34041,Ro=35907,bs=34836,Zn=34842,Pn=34843,cs=[];cs[F]=2,cs[eu]=2,cs[ve]=2,cs[kl]=2,cs[Wu]=1,cs[su]=4,cs[Ro]=4,cs[bs]=16,cs[Zn]=8,cs[Pn]=6;function fs(X,De,rt){return cs[X]*De*rt}var bu=function(X,De,rt,Jt,_r){var rr={rgba4:F,rgb565:ve,"rgb5 a1":eu,depth:kl,stencil:Wu,"depth stencil":su};De.ext_srgb&&(rr.srgba=Ro),De.ext_color_buffer_half_float&&(rr.rgba16f=Zn,rr.rgb16f=Pn),De.webgl_color_buffer_float&&(rr.rgba32f=bs);var Xt=[];Object.keys(rr).forEach(function(Dr){var Jr=rr[Dr];Xt[Jr]=Dr});var Nr=0,Or={};function en(Dr){this.id=Nr++,this.refCount=1,this.renderbuffer=Dr,this.format=F,this.width=0,this.height=0,_r.profile&&(this.stats={size:0})}en.prototype.decRef=function(){--this.refCount<=0&&zr(this)};function zr(Dr){var Jr=Dr.renderbuffer;Se(Jr,"must not double destroy renderbuffer"),X.bindRenderbuffer(Le,null),X.deleteRenderbuffer(Jr),Dr.renderbuffer=null,Dr.refCount=0,delete Or[Dr.id],Jt.renderbufferCount--}function qr(Dr,Jr){var Ft=new en(X.createRenderbuffer());Or[Ft.id]=Ft,Jt.renderbufferCount++;function lr(dn,Rr){var bn=0,Pr=0,vn=F;if(typeof dn=="object"&&dn){var Cr=dn;if("shape"in Cr){var fn=Cr.shape;Se(Array.isArray(fn)&&fn.length>=2,"invalid renderbuffer shape"),bn=fn[0]|0,Pr=fn[1]|0}else"radius"in Cr&&(bn=Pr=Cr.radius|0),"width"in Cr&&(bn=Cr.width|0),"height"in Cr&&(Pr=Cr.height|0);"format"in Cr&&(Se.parameter(Cr.format,rr,"invalid renderbuffer format"),vn=rr[Cr.format])}else typeof dn=="number"?(bn=dn|0,typeof Rr=="number"?Pr=Rr|0:Pr=bn):dn?Se.raise("invalid arguments to renderbuffer constructor"):bn=Pr=1;if(Se(bn>0&&Pr>0&&bn<=rt.maxRenderbufferSize&&Pr<=rt.maxRenderbufferSize,"invalid renderbuffer size"),!(bn===Ft.width&&Pr===Ft.height&&vn===Ft.format))return lr.width=Ft.width=bn,lr.height=Ft.height=Pr,Ft.format=vn,X.bindRenderbuffer(Le,Ft.renderbuffer),X.renderbufferStorage(Le,vn,bn,Pr),Se(X.getError()===0,"invalid render buffer format"),_r.profile&&(Ft.stats.size=fs(Ft.format,Ft.width,Ft.height)),lr.format=Xt[Ft.format],lr}function Zr(dn,Rr){var bn=dn|0,Pr=Rr|0||bn;return bn===Ft.width&&Pr===Ft.height||(Se(bn>0&&Pr>0&&bn<=rt.maxRenderbufferSize&&Pr<=rt.maxRenderbufferSize,"invalid renderbuffer size"),lr.width=Ft.width=bn,lr.height=Ft.height=Pr,X.bindRenderbuffer(Le,Ft.renderbuffer),X.renderbufferStorage(Le,Ft.format,bn,Pr),Se(X.getError()===0,"invalid render buffer format"),_r.profile&&(Ft.stats.size=fs(Ft.format,Ft.width,Ft.height))),lr}return lr(Dr,Jr),lr.resize=Zr,lr._reglType="renderbuffer",lr._renderbuffer=Ft,_r.profile&&(lr.stats=Ft.stats),lr.destroy=function(){Ft.decRef()},lr}_r.profile&&(Jt.getTotalRenderbufferSize=function(){var Dr=0;return Object.keys(Or).forEach(function(Jr){Dr+=Or[Jr].stats.size}),Dr});function an(){sa(Or).forEach(function(Dr){Dr.renderbuffer=X.createRenderbuffer(),X.bindRenderbuffer(Le,Dr.renderbuffer),X.renderbufferStorage(Le,Dr.format,Dr.width,Dr.height)}),X.bindRenderbuffer(Le,null)}return{create:qr,clear:function(){sa(Or).forEach(zr)},restore:an}},Ua=36160,tu=36161,xu=3553,Eu=34069,pa=36064,_o=36096,Th=36128,Dl=33306,Uf=36053,fl=36054,xs=36055,Jl=36057,Su=36061,zf=36193,Pc=5121,lf=5126,Zf=6407,ec=6408,tc=6402,wh=[Zf,ec],hs=[];hs[ec]=4,hs[Zf]=3;var Au=[];Au[Pc]=1,Au[lf]=4,Au[zf]=2;var cf=32854,Ll=32855,uu=36194,Ch=33189,Gu=36168,Vf=34041,Rh=35907,h=34836,v=34842,p=34843,g=[cf,Ll,uu,Rh,v,p,h],S={};S[Uf]="complete",S[fl]="incomplete attachment",S[Jl]="incomplete dimensions",S[xs]="incomplete, missing attachment",S[Su]="unsupported";function w(X,De,rt,Jt,_r,rr){var Xt={cur:null,next:null,dirty:!1,setFBO:null},Nr=["rgba"],Or=["rgba4","rgb565","rgb5 a1"];De.ext_srgb&&Or.push("srgba"),De.ext_color_buffer_half_float&&Or.push("rgba16f","rgb16f"),De.webgl_color_buffer_float&&Or.push("rgba32f");var en=["uint8"];De.oes_texture_half_float&&en.push("half float","float16"),De.oes_texture_float&&en.push("float","float32");function zr(ln,Fr,Sr){this.target=ln,this.texture=Fr,this.renderbuffer=Sr;var Fn=0,Pi=0;Fr?(Fn=Fr.width,Pi=Fr.height):Sr&&(Fn=Sr.width,Pi=Sr.height),this.width=Fn,this.height=Pi}function qr(ln){ln&&(ln.texture&&ln.texture._texture.decRef(),ln.renderbuffer&&ln.renderbuffer._renderbuffer.decRef())}function an(ln,Fr,Sr){if(ln)if(ln.texture){var Fn=ln.texture._texture,Pi=Math.max(1,Fn.width),Zt=Math.max(1,Fn.height);Se(Pi===Fr&&Zt===Sr,"inconsistent width/height for supplied texture"),Fn.refCount+=1}else{var Ai=ln.renderbuffer._renderbuffer;Se(Ai.width===Fr&&Ai.height===Sr,"inconsistent width/height for renderbuffer"),Ai.refCount+=1}}function Dr(ln,Fr){Fr&&(Fr.texture?X.framebufferTexture2D(Ua,ln,Fr.target,Fr.texture._texture.texture,0):X.framebufferRenderbuffer(Ua,ln,tu,Fr.renderbuffer._renderbuffer.renderbuffer))}function Jr(ln){var Fr=xu,Sr=null,Fn=null,Pi=ln;typeof ln=="object"&&(Pi=ln.data,"target"in ln&&(Fr=ln.target|0)),Se.type(Pi,"function","invalid attachment data");var Zt=Pi._reglType;return Zt==="texture2d"?(Sr=Pi,Se(Fr===xu)):Zt==="textureCube"?(Sr=Pi,Se(Fr>=Eu&&Fr<Eu+6,"invalid cube map target")):Zt==="renderbuffer"?(Fn=Pi,Fr=tu):Se.raise("invalid regl object for attachment"),new zr(Fr,Sr,Fn)}function Ft(ln,Fr,Sr,Fn,Pi){if(Sr){var Zt=Jt.create2D({width:ln,height:Fr,format:Fn,type:Pi});return Zt._texture.refCount=0,new zr(xu,Zt,null)}else{var Ai=_r.create({width:ln,height:Fr,format:Fn});return Ai._renderbuffer.refCount=0,new zr(tu,null,Ai)}}function lr(ln){return ln&&(ln.texture||ln.renderbuffer)}function Zr(ln,Fr,Sr){ln&&(ln.texture?ln.texture.resize(Fr,Sr):ln.renderbuffer&&ln.renderbuffer.resize(Fr,Sr),ln.width=Fr,ln.height=Sr)}var dn=0,Rr={};function bn(){this.id=dn++,Rr[this.id]=this,this.framebuffer=X.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Pr(ln){ln.colorAttachments.forEach(qr),qr(ln.depthAttachment),qr(ln.stencilAttachment),qr(ln.depthStencilAttachment)}function vn(ln){var Fr=ln.framebuffer;Se(Fr,"must not double destroy framebuffer"),X.deleteFramebuffer(Fr),ln.framebuffer=null,rr.framebufferCount--,delete Rr[ln.id]}function Cr(ln){var Fr;X.bindFramebuffer(Ua,ln.framebuffer);var Sr=ln.colorAttachments;for(Fr=0;Fr<Sr.length;++Fr)Dr(pa+Fr,Sr[Fr]);for(Fr=Sr.length;Fr<rt.maxColorAttachments;++Fr)X.framebufferTexture2D(Ua,pa+Fr,xu,null,0);X.framebufferTexture2D(Ua,Dl,xu,null,0),X.framebufferTexture2D(Ua,_o,xu,null,0),X.framebufferTexture2D(Ua,Th,xu,null,0),Dr(_o,ln.depthAttachment),Dr(Th,ln.stencilAttachment),Dr(Dl,ln.depthStencilAttachment);var Fn=X.checkFramebufferStatus(Ua);!X.isContextLost()&&Fn!==Uf&&Se.raise("framebuffer configuration not supported, status = "+S[Fn]),X.bindFramebuffer(Ua,Xt.next?Xt.next.framebuffer:null),Xt.cur=Xt.next,X.getError()}function fn(ln,Fr){var Sr=new bn;rr.framebufferCount++;function Fn(Zt,Ai){var Ct;Se(Xt.next!==Sr,"can not update framebuffer which is currently in use");var ri=0,na=0,mo=!0,rs=!0,Di=null,Qa=!0,Oa="rgba",Bo="uint8",xo=1,Ja=null,Fo=null,ds=null,Eo=!1;if(typeof Zt=="number")ri=Zt|0,na=Ai|0||ri;else if(!Zt)ri=na=1;else{Se.type(Zt,"object","invalid arguments for framebuffer");var Si=Zt;if("shape"in Si){var ns=Si.shape;Se(Array.isArray(ns)&&ns.length>=2,"invalid shape for framebuffer"),ri=ns[0],na=ns[1]}else"radius"in Si&&(ri=na=Si.radius),"width"in Si&&(ri=Si.width),"height"in Si&&(na=Si.height);("color"in Si||"colors"in Si)&&(Di=Si.color||Si.colors,Array.isArray(Di)&&Se(Di.length===1||De.webgl_draw_buffers,"multiple render targets not supported")),Di||("colorCount"in Si&&(xo=Si.colorCount|0,Se(xo>0,"invalid color buffer count")),"colorTexture"in Si&&(Qa=!!Si.colorTexture,Oa="rgba4"),"colorType"in Si&&(Bo=Si.colorType,Qa?(Se(De.oes_texture_float||!(Bo==="float"||Bo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),Se(De.oes_texture_half_float||!(Bo==="half float"||Bo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Bo==="half float"||Bo==="float16"?(Se(De.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Oa="rgba16f"):(Bo==="float"||Bo==="float32")&&(Se(De.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Oa="rgba32f"),Se.oneOf(Bo,en,"invalid color type")),"colorFormat"in Si&&(Oa=Si.colorFormat,Nr.indexOf(Oa)>=0?Qa=!0:Or.indexOf(Oa)>=0?Qa=!1:Qa?Se.oneOf(Si.colorFormat,Nr,"invalid color format for texture"):Se.oneOf(Si.colorFormat,Or,"invalid color format for renderbuffer"))),("depthTexture"in Si||"depthStencilTexture"in Si)&&(Eo=!!(Si.depthTexture||Si.depthStencilTexture),Se(!Eo||De.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Si&&(typeof Si.depth=="boolean"?mo=Si.depth:(Ja=Si.depth,rs=!1)),"stencil"in Si&&(typeof Si.stencil=="boolean"?rs=Si.stencil:(Fo=Si.stencil,mo=!1)),"depthStencil"in Si&&(typeof Si.depthStencil=="boolean"?mo=rs=Si.depthStencil:(ds=Si.depthStencil,mo=!1,rs=!1))}var fa=null,ei=null,Li=null,Ki=null;if(Array.isArray(Di))fa=Di.map(Jr);else if(Di)fa=[Jr(Di)];else for(fa=new Array(xo),Ct=0;Ct<xo;++Ct)fa[Ct]=Ft(ri,na,Qa,Oa,Bo);Se(De.webgl_draw_buffers||fa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),Se(fa.length<=rt.maxColorAttachments,"too many color attachments, not supported"),ri=ri||fa[0].width,na=na||fa[0].height,Ja?ei=Jr(Ja):mo&&!rs&&(ei=Ft(ri,na,Eo,"depth","uint32")),Fo?Li=Jr(Fo):rs&&!mo&&(Li=Ft(ri,na,!1,"stencil","uint8")),ds?Ki=Jr(ds):!Ja&&!Fo&&rs&&mo&&(Ki=Ft(ri,na,Eo,"depth stencil","depth stencil")),Se(!!Ja+!!Fo+!!ds<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var So=null;for(Ct=0;Ct<fa.length;++Ct)if(an(fa[Ct],ri,na),Se(!fa[Ct]||fa[Ct].texture&&wh.indexOf(fa[Ct].texture._texture.format)>=0||fa[Ct].renderbuffer&&g.indexOf(fa[Ct].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ct+" is invalid"),fa[Ct]&&fa[Ct].texture){var yl=hs[fa[Ct].texture._texture.format]*Au[fa[Ct].texture._texture.type];So===null?So=yl:Se(So===yl,"all color attachments much have the same number of bits per pixel.")}return an(ei,ri,na),Se(!ei||ei.texture&&ei.texture._texture.format===tc||ei.renderbuffer&&ei.renderbuffer._renderbuffer.format===Ch,"invalid depth attachment for framebuffer object"),an(Li,ri,na),Se(!Li||Li.renderbuffer&&Li.renderbuffer._renderbuffer.format===Gu,"invalid stencil attachment for framebuffer object"),an(Ki,ri,na),Se(!Ki||Ki.texture&&Ki.texture._texture.format===Vf||Ki.renderbuffer&&Ki.renderbuffer._renderbuffer.format===Vf,"invalid depth-stencil attachment for framebuffer object"),Pr(Sr),Sr.width=ri,Sr.height=na,Sr.colorAttachments=fa,Sr.depthAttachment=ei,Sr.stencilAttachment=Li,Sr.depthStencilAttachment=Ki,Fn.color=fa.map(lr),Fn.depth=lr(ei),Fn.stencil=lr(Li),Fn.depthStencil=lr(Ki),Fn.width=Sr.width,Fn.height=Sr.height,Cr(Sr),Fn}function Pi(Zt,Ai){Se(Xt.next!==Sr,"can not resize a framebuffer which is currently in use");var Ct=Math.max(Zt|0,1),ri=Math.max(Ai|0||Ct,1);if(Ct===Sr.width&&ri===Sr.height)return Fn;for(var na=Sr.colorAttachments,mo=0;mo<na.length;++mo)Zr(na[mo],Ct,ri);return Zr(Sr.depthAttachment,Ct,ri),Zr(Sr.stencilAttachment,Ct,ri),Zr(Sr.depthStencilAttachment,Ct,ri),Sr.width=Fn.width=Ct,Sr.height=Fn.height=ri,Cr(Sr),Fn}return Fn(ln,Fr),O(Fn,{resize:Pi,_reglType:"framebuffer",_framebuffer:Sr,destroy:function(){vn(Sr),Pr(Sr)},use:function(Zt){Xt.setFBO({framebuffer:Fn},Zt)}})}function $n(ln){var Fr=Array(6);function Sr(Pi){var Zt;Se(Fr.indexOf(Xt.next)<0,"can not update framebuffer which is currently in use");var Ai={color:null},Ct=0,ri=null,na="rgba",mo="uint8",rs=1;if(typeof Pi=="number")Ct=Pi|0;else if(!Pi)Ct=1;else{Se.type(Pi,"object","invalid arguments for framebuffer");var Di=Pi;if("shape"in Di){var Qa=Di.shape;Se(Array.isArray(Qa)&&Qa.length>=2,"invalid shape for framebuffer"),Se(Qa[0]===Qa[1],"cube framebuffer must be square"),Ct=Qa[0]}else"radius"in Di&&(Ct=Di.radius|0),"width"in Di?(Ct=Di.width|0,"height"in Di&&Se(Di.height===Ct,"must be square")):"height"in Di&&(Ct=Di.height|0);("color"in Di||"colors"in Di)&&(ri=Di.color||Di.colors,Array.isArray(ri)&&Se(ri.length===1||De.webgl_draw_buffers,"multiple render targets not supported")),ri||("colorCount"in Di&&(rs=Di.colorCount|0,Se(rs>0,"invalid color buffer count")),"colorType"in Di&&(Se.oneOf(Di.colorType,en,"invalid color type"),mo=Di.colorType),"colorFormat"in Di&&(na=Di.colorFormat,Se.oneOf(Di.colorFormat,Nr,"invalid color format for texture"))),"depth"in Di&&(Ai.depth=Di.depth),"stencil"in Di&&(Ai.stencil=Di.stencil),"depthStencil"in Di&&(Ai.depthStencil=Di.depthStencil)}var Oa;if(ri)if(Array.isArray(ri))for(Oa=[],Zt=0;Zt<ri.length;++Zt)Oa[Zt]=ri[Zt];else Oa=[ri];else{Oa=Array(rs);var Bo={radius:Ct,format:na,type:mo};for(Zt=0;Zt<rs;++Zt)Oa[Zt]=Jt.createCube(Bo)}for(Ai.color=Array(Oa.length),Zt=0;Zt<Oa.length;++Zt){var xo=Oa[Zt];Se(typeof xo=="function"&&xo._reglType==="textureCube","invalid cube map"),Ct=Ct||xo.width,Se(xo.width===Ct&&xo.height===Ct,"invalid cube map shape"),Ai.color[Zt]={target:Eu,data:Oa[Zt]}}for(Zt=0;Zt<6;++Zt){for(var Ja=0;Ja<Oa.length;++Ja)Ai.color[Ja].target=Eu+Zt;Zt>0&&(Ai.depth=Fr[0].depth,Ai.stencil=Fr[0].stencil,Ai.depthStencil=Fr[0].depthStencil),Fr[Zt]?Fr[Zt](Ai):Fr[Zt]=fn(Ai)}return O(Sr,{width:Ct,height:Ct,color:Oa})}function Fn(Pi){var Zt,Ai=Pi|0;if(Se(Ai>0&&Ai<=rt.maxCubeMapSize,"invalid radius for cube fbo"),Ai===Sr.width)return Sr;var Ct=Sr.color;for(Zt=0;Zt<Ct.length;++Zt)Ct[Zt].resize(Ai);for(Zt=0;Zt<6;++Zt)Fr[Zt].resize(Ai);return Sr.width=Sr.height=Ai,Sr}return Sr(ln),O(Sr,{faces:Fr,resize:Fn,_reglType:"framebufferCube",destroy:function(){Fr.forEach(function(Pi){Pi.destroy()})}})}function li(){Xt.cur=null,Xt.next=null,Xt.dirty=!0,sa(Rr).forEach(function(ln){ln.framebuffer=X.createFramebuffer(),Cr(ln)})}return O(Xt,{getFramebuffer:function(ln){if(typeof ln=="function"&&ln._reglType==="framebuffer"){var Fr=ln._framebuffer;if(Fr instanceof bn)return Fr}return null},create:fn,createCube:$n,clear:function(){sa(Rr).forEach(vn)},restore:li})}var R=5126,k=34962;function $(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=R,this.offset=0,this.stride=0,this.divisor=0}function oe(X,De,rt,Jt,_r){for(var rr=rt.maxAttributes,Xt=new Array(rr),Nr=0;Nr<rr;++Nr)Xt[Nr]=new $;var Or=0,en={},zr={Record:$,scope:{},state:Xt,currentVAO:null,targetVAO:null,restore:an()?Rr:function(){},createVAO:bn,getVAO:Jr,destroyBuffer:qr,setVAO:an()?Ft:lr,clear:an()?Zr:function(){}};function qr(Pr){for(var vn=0;vn<Xt.length;++vn){var Cr=Xt[vn];Cr.buffer===Pr&&(X.disableVertexAttribArray(vn),Cr.buffer=null)}}function an(){return De.oes_vertex_array_object}function Dr(){return De.angle_instanced_arrays}function Jr(Pr){return typeof Pr=="function"&&Pr._vao?Pr._vao:null}function Ft(Pr){if(Pr!==zr.currentVAO){var vn=an();Pr?vn.bindVertexArrayOES(Pr.vao):vn.bindVertexArrayOES(null),zr.currentVAO=Pr}}function lr(Pr){if(Pr!==zr.currentVAO){if(Pr)Pr.bindAttrs();else for(var vn=Dr(),Cr=0;Cr<Xt.length;++Cr){var fn=Xt[Cr];fn.buffer?(X.enableVertexAttribArray(Cr),X.vertexAttribPointer(Cr,fn.size,fn.type,fn.normalized,fn.stride,fn.offfset),vn&&vn.vertexAttribDivisorANGLE(Cr,fn.divisor)):(X.disableVertexAttribArray(Cr),X.vertexAttrib4f(Cr,fn.x,fn.y,fn.z,fn.w))}zr.currentVAO=Pr}}function Zr(){sa(en).forEach(function(Pr){Pr.destroy()})}function dn(){this.id=++Or,this.attributes=[];var Pr=an();Pr?this.vao=Pr.createVertexArrayOES():this.vao=null,en[this.id]=this,this.buffers=[]}dn.prototype.bindAttrs=function(){for(var Pr=Dr(),vn=this.attributes,Cr=0;Cr<vn.length;++Cr){var fn=vn[Cr];fn.buffer?(X.enableVertexAttribArray(Cr),X.bindBuffer(k,fn.buffer.buffer),X.vertexAttribPointer(Cr,fn.size,fn.type,fn.normalized,fn.stride,fn.offset),Pr&&Pr.vertexAttribDivisorANGLE(Cr,fn.divisor)):(X.disableVertexAttribArray(Cr),X.vertexAttrib4f(Cr,fn.x,fn.y,fn.z,fn.w))}for(var $n=vn.length;$n<rr;++$n)X.disableVertexAttribArray($n)},dn.prototype.refresh=function(){var Pr=an();Pr&&(Pr.bindVertexArrayOES(this.vao),this.bindAttrs(),zr.currentVAO=this)},dn.prototype.destroy=function(){if(this.vao){var Pr=an();this===zr.currentVAO&&(zr.currentVAO=null,Pr.bindVertexArrayOES(null)),Pr.deleteVertexArrayOES(this.vao),this.vao=null}en[this.id]&&(delete en[this.id],Jt.vaoCount-=1)};function Rr(){var Pr=an();Pr&&sa(en).forEach(function(vn){vn.refresh()})}function bn(Pr){var vn=new dn;Jt.vaoCount+=1;function Cr(fn){Se(Array.isArray(fn),"arguments to vertex array constructor must be an array"),Se(fn.length<rr,"too many attributes"),Se(fn.length>0,"must specify at least one attribute");for(var $n=0;$n<vn.buffers.length;++$n)vn.buffers[$n].destroy();vn.buffers.length=0;var li=vn.attributes;li.length=fn.length;for(var ln=0;ln<fn.length;++ln){var Fr=fn[ln],Sr=li[ln]=new $;if(Array.isArray(Fr)||ae(Fr)||Ra(Fr)){var Fn=_r.create(Fr,k,!1,!0);Sr.buffer=_r.getBuffer(Fn),Sr.size=Sr.buffer.dimension|0,Sr.normalized=!1,Sr.type=Sr.buffer.dtype,Sr.offset=0,Sr.stride=0,Sr.divisor=0,Sr.state=1,vn.buffers.push(Fn)}else _r.getBuffer(Fr)?(Sr.buffer=_r.getBuffer(Fr),Sr.size=Sr.buffer.dimension|0,Sr.normalized=!1,Sr.type=Sr.buffer.dtype,Sr.offset=0,Sr.stride=0,Sr.divisor=0,Sr.state=1):_r.getBuffer(Fr.buffer)?(Sr.buffer=_r.getBuffer(Fr.buffer),Sr.size=(+Fr.size||Sr.buffer.dimension)|0,Sr.normalized=!!Fr.normalized||!1,"type"in Fr?(Se.parameter(Fr.type,Jo,"invalid buffer type"),Sr.type=Jo[Fr.type]):Sr.type=Sr.buffer.dtype,Sr.offset=(Fr.offset||0)|0,Sr.stride=(Fr.stride||0)|0,Sr.divisor=(Fr.divisor||0)|0,Sr.state=1,Se(Sr.size>=1&&Sr.size<=4,"size must be between 1 and 4"),Se(Sr.offset>=0,"invalid offset"),Se(Sr.stride>=0&&Sr.stride<=255,"stride must be between 0 and 255"),Se(Sr.divisor>=0,"divisor must be positive"),Se(!Sr.divisor||!!De.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Fr?(Se(ln>0,"first attribute must not be a constant"),Sr.x=+Fr.x||0,Sr.y=+Fr.y||0,Sr.z=+Fr.z||0,Sr.w=+Fr.w||0,Sr.state=2):Se(!1,"invalid attribute spec for location "+ln)}return vn.refresh(),Cr}return Cr.destroy=function(){vn.destroy()},Cr._vao=vn,Cr._reglType="vao",Cr(Pr)}return zr}var be=35632,we=35633,Oe=35718,qe=35721;function $e(X,De,rt,Jt){var _r={},rr={};function Xt(Ft,lr,Zr,dn){this.name=Ft,this.id=lr,this.location=Zr,this.info=dn}function Nr(Ft,lr){for(var Zr=0;Zr<Ft.length;++Zr)if(Ft[Zr].id===lr.id){Ft[Zr].location=lr.location;return}Ft.push(lr)}function Or(Ft,lr,Zr){var dn=Ft===be?_r:rr,Rr=dn[lr];if(!Rr){var bn=De.str(lr);Rr=X.createShader(Ft),X.shaderSource(Rr,bn),X.compileShader(Rr),Se.shaderError(X,Rr,bn,Ft,Zr),dn[lr]=Rr}return Rr}var en={},zr=[],qr=0;function an(Ft,lr){this.id=qr++,this.fragId=Ft,this.vertId=lr,this.program=null,this.uniforms=[],this.attributes=[],Jt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Dr(Ft,lr,Zr){var dn,Rr,bn=Or(be,Ft.fragId),Pr=Or(we,Ft.vertId),vn=Ft.program=X.createProgram();if(X.attachShader(vn,bn),X.attachShader(vn,Pr),Zr)for(dn=0;dn<Zr.length;++dn){var Cr=Zr[dn];X.bindAttribLocation(vn,Cr[0],Cr[1])}X.linkProgram(vn),Se.linkError(X,vn,De.str(Ft.fragId),De.str(Ft.vertId),lr);var fn=X.getProgramParameter(vn,Oe);Jt.profile&&(Ft.stats.uniformsCount=fn);var $n=Ft.uniforms;for(dn=0;dn<fn;++dn)if(Rr=X.getActiveUniform(vn,dn),Rr)if(Rr.size>1)for(var li=0;li<Rr.size;++li){var ln=Rr.name.replace("[0]","["+li+"]");Nr($n,new Xt(ln,De.id(ln),X.getUniformLocation(vn,ln),Rr))}else Nr($n,new Xt(Rr.name,De.id(Rr.name),X.getUniformLocation(vn,Rr.name),Rr));var Fr=X.getProgramParameter(vn,qe);Jt.profile&&(Ft.stats.attributesCount=Fr);var Sr=Ft.attributes;for(dn=0;dn<Fr;++dn)Rr=X.getActiveAttrib(vn,dn),Rr&&Nr(Sr,new Xt(Rr.name,De.id(Rr.name),X.getAttribLocation(vn,Rr.name),Rr))}Jt.profile&&(rt.getMaxUniformsCount=function(){var Ft=0;return zr.forEach(function(lr){lr.stats.uniformsCount>Ft&&(Ft=lr.stats.uniformsCount)}),Ft},rt.getMaxAttributesCount=function(){var Ft=0;return zr.forEach(function(lr){lr.stats.attributesCount>Ft&&(Ft=lr.stats.attributesCount)}),Ft});function Jr(){_r={},rr={};for(var Ft=0;Ft<zr.length;++Ft)Dr(zr[Ft],null,zr[Ft].attributes.map(function(lr){return[lr.location,lr.name]}))}return{clear:function(){var Ft=X.deleteShader.bind(X);sa(_r).forEach(Ft),_r={},sa(rr).forEach(Ft),rr={},zr.forEach(function(lr){X.deleteProgram(lr.program)}),zr.length=0,en={},rt.shaderCount=0},program:function(Ft,lr,Zr,dn){Se.command(Ft>=0,"missing vertex shader",Zr),Se.command(lr>=0,"missing fragment shader",Zr);var Rr=en[lr];Rr||(Rr=en[lr]={});var bn=Rr[Ft];if(bn&&!dn)return bn;var Pr=new an(lr,Ft);return rt.shaderCount++,Dr(Pr,Zr,dn),bn||(Rr[Ft]=Pr),zr.push(Pr),Pr},restore:Jr,shader:Or,frag:-1,vert:-1}}var vt=6408,He=5121,dt=3333,wt=5126;function zt(X,De,rt,Jt,_r,rr,Xt){function Nr(zr){var qr;De.next===null?(Se(_r.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),qr=He):(Se(De.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),qr=De.next.colorAttachments[0].texture._texture.type,rr.oes_texture_float?(Se(qr===He||qr===wt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),qr===wt&&Se(Xt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):Se(qr===He,"Reading from a framebuffer is only allowed for the type 'uint8'"));var an=0,Dr=0,Jr=Jt.framebufferWidth,Ft=Jt.framebufferHeight,lr=null;ae(zr)?lr=zr:zr&&(Se.type(zr,"object","invalid arguments to regl.read()"),an=zr.x|0,Dr=zr.y|0,Se(an>=0&&an<Jt.framebufferWidth,"invalid x offset for regl.read"),Se(Dr>=0&&Dr<Jt.framebufferHeight,"invalid y offset for regl.read"),Jr=(zr.width||Jt.framebufferWidth-an)|0,Ft=(zr.height||Jt.framebufferHeight-Dr)|0,lr=zr.data||null),lr&&(qr===He?Se(lr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):qr===wt&&Se(lr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),Se(Jr>0&&Jr+an<=Jt.framebufferWidth,"invalid width for read pixels"),Se(Ft>0&&Ft+Dr<=Jt.framebufferHeight,"invalid height for read pixels"),rt();var Zr=Jr*Ft*4;return lr||(qr===He?lr=new Uint8Array(Zr):qr===wt&&(lr=lr||new Float32Array(Zr))),Se.isTypedArray(lr,"data buffer for regl.read() must be a typedarray"),Se(lr.byteLength>=Zr,"data buffer for regl.read() too small"),X.pixelStorei(dt,4),X.readPixels(an,Dr,Jr,Ft,vt,qr,lr),lr}function Or(zr){var qr;return De.setFBO({framebuffer:zr.framebuffer},function(){qr=Nr(zr)}),qr}function en(zr){return!zr||!("framebuffer"in zr)?Nr(zr):Or(zr)}return en}function ar(X){return Array.prototype.slice.call(X)}function Qt(X){return ar(X).join("")}function hr(){var X=0,De=[],rt=[];function Jt(qr){for(var an=0;an<rt.length;++an)if(rt[an]===qr)return De[an];var Dr="g"+X++;return De.push(Dr),rt.push(qr),Dr}function _r(){var qr=[];function an(){qr.push.apply(qr,ar(arguments))}var Dr=[];function Jr(){var Ft="v"+X++;return Dr.push(Ft),arguments.length>0&&(qr.push(Ft,"="),qr.push.apply(qr,ar(arguments)),qr.push(";")),Ft}return O(an,{def:Jr,toString:function(){return Qt([Dr.length>0?"var "+Dr.join(",")+";":"",Qt(qr)])}})}function rr(){var qr=_r(),an=_r(),Dr=qr.toString,Jr=an.toString;function Ft(lr,Zr){an(lr,Zr,"=",qr.def(lr,Zr),";")}return O(function(){qr.apply(qr,ar(arguments))},{def:qr.def,entry:qr,exit:an,save:Ft,set:function(lr,Zr,dn){Ft(lr,Zr),qr(lr,Zr,"=",dn,";")},toString:function(){return Dr()+Jr()}})}function Xt(){var qr=Qt(arguments),an=rr(),Dr=rr(),Jr=an.toString,Ft=Dr.toString;return O(an,{then:function(){return an.apply(an,ar(arguments)),this},else:function(){return Dr.apply(Dr,ar(arguments)),this},toString:function(){var lr=Ft();return lr&&(lr="else{"+lr+"}"),Qt(["if(",qr,"){",Jr(),"}",lr])}})}var Nr=_r(),Or={};function en(qr,an){var Dr=[];function Jr(){var Rr="a"+Dr.length;return Dr.push(Rr),Rr}an=an||0;for(var Ft=0;Ft<an;++Ft)Jr();var lr=rr(),Zr=lr.toString,dn=Or[qr]=O(lr,{arg:Jr,toString:function(){return Qt(["function(",Dr.join(),"){",Zr(),"}"])}});return dn}function zr(){var qr=['"use strict";',Nr,"return {"];Object.keys(Or).forEach(function(Jr){qr.push('"',Jr,'":',Or[Jr].toString(),",")}),qr.push("}");var an=Qt(qr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Dr=Function.apply(null,De.concat(an));return Dr.apply(null,rt)}return{global:Nr,link:Jt,block:_r,proc:en,scope:rr,cond:Xt,compile:zr}}var Tr="xyzw".split(""),Yr=5121,Ur=1,_n=2,Hn=0,Vn=1,Wn=2,Wi=3,Tn=4,ui="dither",gi="blend.enable",si="blend.color",ni="blend.equation",vi="blend.func",ii="depth.enable",Jn="depth.func",Mo="depth.range",no="depth.mask",Io="colorMask",bo="cull.enable",Ka="cull.face",io="frontFace",Es="lineWidth",Ss="polygonOffset.enable",hl="polygonOffset.offset",As="sample.alpha",lu="sample.enable",Vs="sample.coverage",Oc="stencil.enable",Xu="stencil.mask",Tu="stencil.func",rc="stencil.opFront",pl="stencil.opBack",cu="scissor.enable",dl="scissor.box",Po="viewport",lo="profile",Ms="framebuffer",fu="vert",wu="frag",Vi="elements",ts="primitive",co="count",hu="offset",kc="instances",$u="vao",Mh="Width",Oo="Height",Br=Ms+Mh,js=Ms+Oo,Ih=Po+Mh,ko=Po+Oo,ru="drawingBuffer",Do=ru+Mh,pp=ru+Oo,nc=[vi,ni,Tu,rc,pl,Vs,Po,dl,hl],vl=34962,Xp=34963,ng=35632,Zv=35633,jf=3553,dp=34067,Ph=2884,Ld=3042,Dc=3024,Oh=2960,Vv=2929,Bd=3089,ig=32823,$p=32926,Fd=32928,Nd=5126,Yp=35664,Bl=35665,vp=35666,Lc=5124,qp=35667,ao=35668,Hf=35669,Wf=35670,ml=35671,ff=35672,Bc=35673,Gf=35674,Xf=35675,Fc=35676,Nc=35678,ic=35680,Kp=4,ac=1028,Hs=1029,mp=2304,Qp=2305,Jp=32775,kh=32776,gl=519,Yu=7680,Ud=0,gp=1,zd=32774,Dh=513,Uc=36160,ed=36064,qu={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},yp=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],zc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ws={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Zd={frag:ng,vert:Zv},oc={cw:mp,ccw:Qp};function Lh(X){return Array.isArray(X)||ae(X)||Ra(X)}function $f(X){return X.sort(function(De,rt){return De===Po?-1:rt===Po?1:De<rt?-1:1})}function ps(X,De,rt,Jt){this.thisDep=X,this.contextDep=De,this.propDep=rt,this.append=Jt}function Ts(X){return X&&!(X.thisDep||X.contextDep||X.propDep)}function Lo(X){return new ps(!1,!1,!1,X)}function pu(X,De){var rt=X.type;if(rt===Hn){var Jt=X.data.length;return new ps(!0,Jt>=1,Jt>=2,De)}else if(rt===Tn){var _r=X.data;return new ps(_r.thisDep,_r.contextDep,_r.propDep,De)}else return new ps(rt===Wi,rt===Wn,rt===Vn,De)}var td=new ps(!1,!1,!1,function(){});function hf(X,De,rt,Jt,_r,rr,Xt,Nr,Or,en,zr,qr,an,Dr,Jr){var Ft=en.Record,lr={add:32774,subtract:32778,"reverse subtract":32779};rt.ext_blend_minmax&&(lr.min=Jp,lr.max=kh);var Zr=rt.angle_instanced_arrays,dn=rt.webgl_draw_buffers,Rr={dirty:!0,profile:Jr.profile},bn={},Pr=[],vn={},Cr={};function fn(me){return me.replace(".","_")}function $n(me,Fe,nt){var qt=fn(me);Pr.push(me),bn[qt]=Rr[qt]=!!nt,vn[qt]=Fe}function li(me,Fe,nt){var qt=fn(me);Pr.push(me),Array.isArray(nt)?(Rr[qt]=nt.slice(),bn[qt]=nt.slice()):Rr[qt]=bn[qt]=nt,Cr[qt]=Fe}$n(ui,Dc),$n(gi,Ld),li(si,"blendColor",[0,0,0,0]),li(ni,"blendEquationSeparate",[zd,zd]),li(vi,"blendFuncSeparate",[gp,Ud,gp,Ud]),$n(ii,Vv,!0),li(Jn,"depthFunc",Dh),li(Mo,"depthRange",[0,1]),li(no,"depthMask",!0),li(Io,Io,[!0,!0,!0,!0]),$n(bo,Ph),li(Ka,"cullFace",Hs),li(io,io,Qp),li(Es,Es,1),$n(Ss,ig),li(hl,"polygonOffset",[0,0]),$n(As,$p),$n(lu,Fd),li(Vs,"sampleCoverage",[1,!1]),$n(Oc,Oh),li(Xu,"stencilMask",-1),li(Tu,"stencilFunc",[gl,0,-1]),li(rc,"stencilOpSeparate",[ac,Yu,Yu,Yu]),li(pl,"stencilOpSeparate",[Hs,Yu,Yu,Yu]),$n(cu,Bd),li(dl,"scissor",[0,0,X.drawingBufferWidth,X.drawingBufferHeight]),li(Po,Po,[0,0,X.drawingBufferWidth,X.drawingBufferHeight]);var ln={gl:X,context:an,strings:De,next:bn,current:Rr,draw:qr,elements:rr,buffer:_r,shader:zr,attributes:en.state,vao:en,uniforms:Or,framebuffer:Nr,extensions:rt,timer:Dr,isBufferArgs:Lh},Fr={primTypes:Uu,compareFuncs:zc,blendFuncs:qu,blendEquations:lr,stencilOps:Ws,glTypes:Jo,orientationType:oc};Se.optional(function(){ln.isArrayLike=$a}),dn&&(Fr.backBuffer=[Hs],Fr.drawBuffer=xt(Jt.maxDrawbuffers,function(me){return me===0?[0]:xt(me,function(Fe){return ed+Fe})}));var Sr=0;function Fn(){var me=hr(),Fe=me.link,nt=me.global;me.id=Sr++,me.batchId="0";var qt=Fe(ln),Wt=me.shared={props:"a0"};Object.keys(ln).forEach(function(_t){Wt[_t]=nt.def(qt,".",_t)}),Se.optional(function(){me.CHECK=Fe(Se),me.commandStr=Se.guessCommand(),me.command=Fe(me.commandStr),me.assert=function(_t,Be,Et){_t("if(!(",Be,"))",this.CHECK,".commandRaise(",Fe(Et),",",this.command,");")},Fr.invalidBlendCombinations=yp});var gt=me.next={},At=me.current={};Object.keys(Cr).forEach(function(_t){Array.isArray(Rr[_t])&&(gt[_t]=nt.def(Wt.next,".",_t),At[_t]=nt.def(Wt.current,".",_t))});var It=me.constants={};Object.keys(Fr).forEach(function(_t){It[_t]=nt.def(JSON.stringify(Fr[_t]))}),me.invoke=function(_t,Be){switch(Be.type){case Hn:var Et=["this",Wt.context,Wt.props,me.batchId];return _t.def(Fe(Be.data),".call(",Et.slice(0,Math.max(Be.data.length+1,4)),")");case Vn:return _t.def(Wt.props,Be.data);case Wn:return _t.def(Wt.context,Be.data);case Wi:return _t.def("this",Be.data);case Tn:return Be.data.append(me,_t),Be.data.ref}},me.attribCache={};var Je={};return me.scopeAttrib=function(_t){var Be=De.id(_t);if(Be in Je)return Je[Be];var Et=en.scope[Be];Et||(Et=en.scope[Be]=new Ft);var tr=Je[Be]=Fe(Et);return tr},me}function Pi(me){var Fe=me.static,nt=me.dynamic,qt;if(lo in Fe){var Wt=!!Fe[lo];qt=Lo(function(At,It){return Wt}),qt.enable=Wt}else if(lo in nt){var gt=nt[lo];qt=pu(gt,function(At,It){return At.invoke(It,gt)})}return qt}function Zt(me,Fe){var nt=me.static,qt=me.dynamic;if(Ms in nt){var Wt=nt[Ms];return Wt?(Wt=Nr.getFramebuffer(Wt),Se.command(Wt,"invalid framebuffer object"),Lo(function(At,It){var Je=At.link(Wt),_t=At.shared;It.set(_t.framebuffer,".next",Je);var Be=_t.context;return It.set(Be,"."+Br,Je+".width"),It.set(Be,"."+js,Je+".height"),Je})):Lo(function(At,It){var Je=At.shared;It.set(Je.framebuffer,".next","null");var _t=Je.context;return It.set(_t,"."+Br,_t+"."+Do),It.set(_t,"."+js,_t+"."+pp),"null"})}else if(Ms in qt){var gt=qt[Ms];return pu(gt,function(At,It){var Je=At.invoke(It,gt),_t=At.shared,Be=_t.framebuffer,Et=It.def(Be,".getFramebuffer(",Je,")");Se.optional(function(){At.assert(It,"!"+Je+"||"+Et,"invalid framebuffer object")}),It.set(Be,".next",Et);var tr=_t.context;return It.set(tr,"."+Br,Et+"?"+Et+".width:"+tr+"."+Do),It.set(tr,"."+js,Et+"?"+Et+".height:"+tr+"."+pp),Et})}else return null}function Ai(me,Fe,nt){var qt=me.static,Wt=me.dynamic;function gt(Je){if(Je in qt){var _t=qt[Je];Se.commandType(_t,"object","invalid "+Je,nt.commandStr);var Be=!0,Et=_t.x|0,tr=_t.y|0,pr,sr;return"width"in _t?(pr=_t.width|0,Se.command(pr>=0,"invalid "+Je,nt.commandStr)):Be=!1,"height"in _t?(sr=_t.height|0,Se.command(sr>=0,"invalid "+Je,nt.commandStr)):Be=!1,new ps(!Be&&Fe&&Fe.thisDep,!Be&&Fe&&Fe.contextDep,!Be&&Fe&&Fe.propDep,function(Nn,En){var On=Nn.shared.context,Kn=pr;"width"in _t||(Kn=En.def(On,".",Br,"-",Et));var ci=sr;return"height"in _t||(ci=En.def(On,".",js,"-",tr)),[Et,tr,Kn,ci]})}else if(Je in Wt){var wr=Wt[Je],kr=pu(wr,function(Nn,En){var On=Nn.invoke(En,wr);Se.optional(function(){Nn.assert(En,On+"&&typeof "+On+'==="object"',"invalid "+Je)});var Kn=Nn.shared.context,ci=En.def(On,".x|0"),ha=En.def(On,".y|0"),Ao=En.def('"width" in ',On,"?",On,".width|0:","(",Kn,".",Br,"-",ci,")"),_l=En.def('"height" in ',On,"?",On,".height|0:","(",Kn,".",js,"-",ha,")");return Se.optional(function(){Nn.assert(En,Ao+">=0&&"+_l+">=0","invalid "+Je)}),[ci,ha,Ao,_l]});return Fe&&(kr.thisDep=kr.thisDep||Fe.thisDep,kr.contextDep=kr.contextDep||Fe.contextDep,kr.propDep=kr.propDep||Fe.propDep),kr}else return Fe?new ps(Fe.thisDep,Fe.contextDep,Fe.propDep,function(Nn,En){var On=Nn.shared.context;return[0,0,En.def(On,".",Br),En.def(On,".",js)]}):null}var At=gt(Po);if(At){var It=At;At=new ps(At.thisDep,At.contextDep,At.propDep,function(Je,_t){var Be=It.append(Je,_t),Et=Je.shared.context;return _t.set(Et,"."+Ih,Be[2]),_t.set(Et,"."+ko,Be[3]),Be})}return{viewport:At,scissor_box:gt(dl)}}function Ct(me,Fe){var nt=me.static,qt=typeof nt[wu]=="string"&&typeof nt[fu]=="string";if(qt){if(Object.keys(Fe.dynamic).length>0)return null;var Wt=Fe.static,gt=Object.keys(Wt);if(gt.length>0&&typeof Wt[gt[0]]=="number"){for(var At=[],It=0;It<gt.length;++It)Se(typeof Wt[gt[It]]=="number","must specify all vertex attribute locations when using vaos"),At.push([Wt[gt[It]]|0,gt[It]]);return At}}return null}function ri(me,Fe,nt){var qt=me.static,Wt=me.dynamic;function gt(Be){if(Be in qt){var Et=De.id(qt[Be]);Se.optional(function(){zr.shader(Zd[Be],Et,Se.guessCommand())});var tr=Lo(function(){return Et});return tr.id=Et,tr}else if(Be in Wt){var pr=Wt[Be];return pu(pr,function(sr,wr){var kr=sr.invoke(wr,pr),Nn=wr.def(sr.shared.strings,".id(",kr,")");return Se.optional(function(){wr(sr.shared.shader,".shader(",Zd[Be],",",Nn,",",sr.command,");")}),Nn})}return null}var At=gt(wu),It=gt(fu),Je=null,_t;return Ts(At)&&Ts(It)?(Je=zr.program(It.id,At.id,null,nt),_t=Lo(function(Be,Et){return Be.link(Je)})):_t=new ps(At&&At.thisDep||It&&It.thisDep,At&&At.contextDep||It&&It.contextDep,At&&At.propDep||It&&It.propDep,function(Be,Et){var tr=Be.shared.shader,pr;At?pr=At.append(Be,Et):pr=Et.def(tr,".",wu);var sr;It?sr=It.append(Be,Et):sr=Et.def(tr,".",fu);var wr=tr+".program("+sr+","+pr;return Se.optional(function(){wr+=","+Be.command}),Et.def(wr+")")}),{frag:At,vert:It,progVar:_t,program:Je}}function na(me,Fe){var nt=me.static,qt=me.dynamic;function Wt(){if(Vi in nt){var Be=nt[Vi];Lh(Be)?Be=rr.getElements(rr.create(Be,!0)):Be&&(Be=rr.getElements(Be),Se.command(Be,"invalid elements",Fe.commandStr));var Et=Lo(function(pr,sr){if(Be){var wr=pr.link(Be);return pr.ELEMENTS=wr,wr}return pr.ELEMENTS=null,null});return Et.value=Be,Et}else if(Vi in qt){var tr=qt[Vi];return pu(tr,function(pr,sr){var wr=pr.shared,kr=wr.isBufferArgs,Nn=wr.elements,En=pr.invoke(sr,tr),On=sr.def("null"),Kn=sr.def(kr,"(",En,")"),ci=pr.cond(Kn).then(On,"=",Nn,".createStream(",En,");").else(On,"=",Nn,".getElements(",En,");");return Se.optional(function(){pr.assert(ci.else,"!"+En+"||"+On,"invalid elements")}),sr.entry(ci),sr.exit(pr.cond(Kn).then(Nn,".destroyStream(",On,");")),pr.ELEMENTS=On,On})}return null}var gt=Wt();function At(){if(ts in nt){var Be=nt[ts];return Se.commandParameter(Be,Uu,"invalid primitve",Fe.commandStr),Lo(function(tr,pr){return Uu[Be]})}else if(ts in qt){var Et=qt[ts];return pu(Et,function(tr,pr){var sr=tr.constants.primTypes,wr=tr.invoke(pr,Et);return Se.optional(function(){tr.assert(pr,wr+" in "+sr,"invalid primitive, must be one of "+Object.keys(Uu))}),pr.def(sr,"[",wr,"]")})}else if(gt)return Ts(gt)?gt.value?Lo(function(tr,pr){return pr.def(tr.ELEMENTS,".primType")}):Lo(function(){return Kp}):new ps(gt.thisDep,gt.contextDep,gt.propDep,function(tr,pr){var sr=tr.ELEMENTS;return pr.def(sr,"?",sr,".primType:",Kp)});return null}function It(Be,Et){if(Be in nt){var tr=nt[Be]|0;return Se.command(!Et||tr>=0,"invalid "+Be,Fe.commandStr),Lo(function(sr,wr){return Et&&(sr.OFFSET=tr),tr})}else if(Be in qt){var pr=qt[Be];return pu(pr,function(sr,wr){var kr=sr.invoke(wr,pr);return Et&&(sr.OFFSET=kr,Se.optional(function(){sr.assert(wr,kr+">=0","invalid "+Be)})),kr})}else if(Et&&gt)return Lo(function(sr,wr){return sr.OFFSET="0",0});return null}var Je=It(hu,!0);function _t(){if(co in nt){var Be=nt[co]|0;return Se.command(typeof Be=="number"&&Be>=0,"invalid vertex count",Fe.commandStr),Lo(function(){return Be})}else if(co in qt){var Et=qt[co];return pu(Et,function(sr,wr){var kr=sr.invoke(wr,Et);return Se.optional(function(){sr.assert(wr,"typeof "+kr+'==="number"&&'+kr+">=0&&"+kr+"===("+kr+"|0)","invalid vertex count")}),kr})}else if(gt)if(Ts(gt)){if(gt)return Je?new ps(Je.thisDep,Je.contextDep,Je.propDep,function(sr,wr){var kr=wr.def(sr.ELEMENTS,".vertCount-",sr.OFFSET);return Se.optional(function(){sr.assert(wr,kr+">=0","invalid vertex offset/element buffer too small")}),kr}):Lo(function(sr,wr){return wr.def(sr.ELEMENTS,".vertCount")});var tr=Lo(function(){return-1});return Se.optional(function(){tr.MISSING=!0}),tr}else{var pr=new ps(gt.thisDep||Je.thisDep,gt.contextDep||Je.contextDep,gt.propDep||Je.propDep,function(sr,wr){var kr=sr.ELEMENTS;return sr.OFFSET?wr.def(kr,"?",kr,".vertCount-",sr.OFFSET,":-1"):wr.def(kr,"?",kr,".vertCount:-1")});return Se.optional(function(){pr.DYNAMIC=!0}),pr}return null}return{elements:gt,primitive:At(),count:_t(),instances:It(kc,!1),offset:Je}}function mo(me,Fe){var nt=me.static,qt=me.dynamic,Wt={};return Pr.forEach(function(gt){var At=fn(gt);function It(Je,_t){if(gt in nt){var Be=Je(nt[gt]);Wt[At]=Lo(function(){return Be})}else if(gt in qt){var Et=qt[gt];Wt[At]=pu(Et,function(tr,pr){return _t(tr,pr,tr.invoke(pr,Et))})}}switch(gt){case bo:case gi:case ui:case Oc:case ii:case cu:case Ss:case As:case lu:case no:return It(function(Je){return Se.commandType(Je,"boolean",gt,Fe.commandStr),Je},function(Je,_t,Be){return Se.optional(function(){Je.assert(_t,"typeof "+Be+'==="boolean"',"invalid flag "+gt,Je.commandStr)}),Be});case Jn:return It(function(Je){return Se.commandParameter(Je,zc,"invalid "+gt,Fe.commandStr),zc[Je]},function(Je,_t,Be){var Et=Je.constants.compareFuncs;return Se.optional(function(){Je.assert(_t,Be+" in "+Et,"invalid "+gt+", must be one of "+Object.keys(zc))}),_t.def(Et,"[",Be,"]")});case Mo:return It(function(Je){return Se.command($a(Je)&&Je.length===2&&typeof Je[0]=="number"&&typeof Je[1]=="number"&&Je[0]<=Je[1],"depth range is 2d array",Fe.commandStr),Je},function(Je,_t,Be){Se.optional(function(){Je.assert(_t,Je.shared.isArrayLike+"("+Be+")&&"+Be+".length===2&&typeof "+Be+'[0]==="number"&&typeof '+Be+'[1]==="number"&&'+Be+"[0]<="+Be+"[1]","depth range must be a 2d array")});var Et=_t.def("+",Be,"[0]"),tr=_t.def("+",Be,"[1]");return[Et,tr]});case vi:return It(function(Je){Se.commandType(Je,"object","blend.func",Fe.commandStr);var _t="srcRGB"in Je?Je.srcRGB:Je.src,Be="srcAlpha"in Je?Je.srcAlpha:Je.src,Et="dstRGB"in Je?Je.dstRGB:Je.dst,tr="dstAlpha"in Je?Je.dstAlpha:Je.dst;return Se.commandParameter(_t,qu,At+".srcRGB",Fe.commandStr),Se.commandParameter(Be,qu,At+".srcAlpha",Fe.commandStr),Se.commandParameter(Et,qu,At+".dstRGB",Fe.commandStr),Se.commandParameter(tr,qu,At+".dstAlpha",Fe.commandStr),Se.command(yp.indexOf(_t+", "+Et)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+_t+", "+Et+")",Fe.commandStr),[qu[_t],qu[Et],qu[Be],qu[tr]]},function(Je,_t,Be){var Et=Je.constants.blendFuncs;Se.optional(function(){Je.assert(_t,Be+"&&typeof "+Be+'==="object"',"invalid blend func, must be an object")});function tr(On,Kn){var ci=_t.def('"',On,Kn,'" in ',Be,"?",Be,".",On,Kn,":",Be,".",On);return Se.optional(function(){Je.assert(_t,ci+" in "+Et,"invalid "+gt+"."+On+Kn+", must be one of "+Object.keys(qu))}),ci}var pr=tr("src","RGB"),sr=tr("dst","RGB");Se.optional(function(){var On=Je.constants.invalidBlendCombinations;Je.assert(_t,On+".indexOf("+pr+'+", "+'+sr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var wr=_t.def(Et,"[",pr,"]"),kr=_t.def(Et,"[",tr("src","Alpha"),"]"),Nn=_t.def(Et,"[",sr,"]"),En=_t.def(Et,"[",tr("dst","Alpha"),"]");return[wr,Nn,kr,En]});case ni:return It(function(Je){if(typeof Je=="string")return Se.commandParameter(Je,lr,"invalid "+gt,Fe.commandStr),[lr[Je],lr[Je]];if(typeof Je=="object")return Se.commandParameter(Je.rgb,lr,gt+".rgb",Fe.commandStr),Se.commandParameter(Je.alpha,lr,gt+".alpha",Fe.commandStr),[lr[Je.rgb],lr[Je.alpha]];Se.commandRaise("invalid blend.equation",Fe.commandStr)},function(Je,_t,Be){var Et=Je.constants.blendEquations,tr=_t.def(),pr=_t.def(),sr=Je.cond("typeof ",Be,'==="string"');return Se.optional(function(){function wr(kr,Nn,En){Je.assert(kr,En+" in "+Et,"invalid "+Nn+", must be one of "+Object.keys(lr))}wr(sr.then,gt,Be),Je.assert(sr.else,Be+"&&typeof "+Be+'==="object"',"invalid "+gt),wr(sr.else,gt+".rgb",Be+".rgb"),wr(sr.else,gt+".alpha",Be+".alpha")}),sr.then(tr,"=",pr,"=",Et,"[",Be,"];"),sr.else(tr,"=",Et,"[",Be,".rgb];",pr,"=",Et,"[",Be,".alpha];"),_t(sr),[tr,pr]});case si:return It(function(Je){return Se.command($a(Je)&&Je.length===4,"blend.color must be a 4d array",Fe.commandStr),xt(4,function(_t){return+Je[_t]})},function(Je,_t,Be){return Se.optional(function(){Je.assert(_t,Je.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","blend.color must be a 4d array")}),xt(4,function(Et){return _t.def("+",Be,"[",Et,"]")})});case Xu:return It(function(Je){return Se.commandType(Je,"number",At,Fe.commandStr),Je|0},function(Je,_t,Be){return Se.optional(function(){Je.assert(_t,"typeof "+Be+'==="number"',"invalid stencil.mask")}),_t.def(Be,"|0")});case Tu:return It(function(Je){Se.commandType(Je,"object",At,Fe.commandStr);var _t=Je.cmp||"keep",Be=Je.ref||0,Et="mask"in Je?Je.mask:-1;return Se.commandParameter(_t,zc,gt+".cmp",Fe.commandStr),Se.commandType(Be,"number",gt+".ref",Fe.commandStr),Se.commandType(Et,"number",gt+".mask",Fe.commandStr),[zc[_t],Be,Et]},function(Je,_t,Be){var Et=Je.constants.compareFuncs;Se.optional(function(){function wr(){Je.assert(_t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}wr(Be+"&&typeof ",Be,'==="object"'),wr('!("cmp" in ',Be,")||(",Be,".cmp in ",Et,")")});var tr=_t.def('"cmp" in ',Be,"?",Et,"[",Be,".cmp]",":",Yu),pr=_t.def(Be,".ref|0"),sr=_t.def('"mask" in ',Be,"?",Be,".mask|0:-1");return[tr,pr,sr]});case rc:case pl:return It(function(Je){Se.commandType(Je,"object",At,Fe.commandStr);var _t=Je.fail||"keep",Be=Je.zfail||"keep",Et=Je.zpass||"keep";return Se.commandParameter(_t,Ws,gt+".fail",Fe.commandStr),Se.commandParameter(Be,Ws,gt+".zfail",Fe.commandStr),Se.commandParameter(Et,Ws,gt+".zpass",Fe.commandStr),[gt===pl?Hs:ac,Ws[_t],Ws[Be],Ws[Et]]},function(Je,_t,Be){var Et=Je.constants.stencilOps;Se.optional(function(){Je.assert(_t,Be+"&&typeof "+Be+'==="object"',"invalid "+gt)});function tr(pr){return Se.optional(function(){Je.assert(_t,'!("'+pr+'" in '+Be+")||("+Be+"."+pr+" in "+Et+")","invalid "+gt+"."+pr+", must be one of "+Object.keys(Ws))}),_t.def('"',pr,'" in ',Be,"?",Et,"[",Be,".",pr,"]:",Yu)}return[gt===pl?Hs:ac,tr("fail"),tr("zfail"),tr("zpass")]});case hl:return It(function(Je){Se.commandType(Je,"object",At,Fe.commandStr);var _t=Je.factor|0,Be=Je.units|0;return Se.commandType(_t,"number",At+".factor",Fe.commandStr),Se.commandType(Be,"number",At+".units",Fe.commandStr),[_t,Be]},function(Je,_t,Be){Se.optional(function(){Je.assert(_t,Be+"&&typeof "+Be+'==="object"',"invalid "+gt)});var Et=_t.def(Be,".factor|0"),tr=_t.def(Be,".units|0");return[Et,tr]});case Ka:return It(function(Je){var _t=0;return Je==="front"?_t=ac:Je==="back"&&(_t=Hs),Se.command(!!_t,At,Fe.commandStr),_t},function(Je,_t,Be){return Se.optional(function(){Je.assert(_t,Be+'==="front"||'+Be+'==="back"',"invalid cull.face")}),_t.def(Be,'==="front"?',ac,":",Hs)});case Es:return It(function(Je){return Se.command(typeof Je=="number"&&Je>=Jt.lineWidthDims[0]&&Je<=Jt.lineWidthDims[1],"invalid line width, must be a positive number between "+Jt.lineWidthDims[0]+" and "+Jt.lineWidthDims[1],Fe.commandStr),Je},function(Je,_t,Be){return Se.optional(function(){Je.assert(_t,"typeof "+Be+'==="number"&&'+Be+">="+Jt.lineWidthDims[0]+"&&"+Be+"<="+Jt.lineWidthDims[1],"invalid line width")}),Be});case io:return It(function(Je){return Se.commandParameter(Je,oc,At,Fe.commandStr),oc[Je]},function(Je,_t,Be){return Se.optional(function(){Je.assert(_t,Be+'==="cw"||'+Be+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),_t.def(Be+'==="cw"?'+mp+":"+Qp)});case Io:return It(function(Je){return Se.command($a(Je)&&Je.length===4,"color.mask must be length 4 array",Fe.commandStr),Je.map(function(_t){return!!_t})},function(Je,_t,Be){return Se.optional(function(){Je.assert(_t,Je.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","invalid color.mask")}),xt(4,function(Et){return"!!"+Be+"["+Et+"]"})});case Vs:return It(function(Je){Se.command(typeof Je=="object"&&Je,At,Fe.commandStr);var _t="value"in Je?Je.value:1,Be=!!Je.invert;return Se.command(typeof _t=="number"&&_t>=0&&_t<=1,"sample.coverage.value must be a number between 0 and 1",Fe.commandStr),[_t,Be]},function(Je,_t,Be){Se.optional(function(){Je.assert(_t,Be+"&&typeof "+Be+'==="object"',"invalid sample.coverage")});var Et=_t.def('"value" in ',Be,"?+",Be,".value:1"),tr=_t.def("!!",Be,".invert");return[Et,tr]})}}),Wt}function rs(me,Fe){var nt=me.static,qt=me.dynamic,Wt={};return Object.keys(nt).forEach(function(gt){var At=nt[gt],It;if(typeof At=="number"||typeof At=="boolean")It=Lo(function(){return At});else if(typeof At=="function"){var Je=At._reglType;Je==="texture2d"||Je==="textureCube"?It=Lo(function(_t){return _t.link(At)}):Je==="framebuffer"||Je==="framebufferCube"?(Se.command(At.color.length>0,'missing color attachment for framebuffer sent to uniform "'+gt+'"',Fe.commandStr),It=Lo(function(_t){return _t.link(At.color[0])})):Se.commandRaise('invalid data for uniform "'+gt+'"',Fe.commandStr)}else $a(At)?It=Lo(function(_t){var Be=_t.global.def("[",xt(At.length,function(Et){return Se.command(typeof At[Et]=="number"||typeof At[Et]=="boolean","invalid uniform "+gt,_t.commandStr),At[Et]}),"]");return Be}):Se.commandRaise('invalid or missing data for uniform "'+gt+'"',Fe.commandStr);It.value=At,Wt[gt]=It}),Object.keys(qt).forEach(function(gt){var At=qt[gt];Wt[gt]=pu(At,function(It,Je){return It.invoke(Je,At)})}),Wt}function Di(me,Fe){var nt=me.static,qt=me.dynamic,Wt={};return Object.keys(nt).forEach(function(gt){var At=nt[gt],It=De.id(gt),Je=new Ft;if(Lh(At))Je.state=Ur,Je.buffer=_r.getBuffer(_r.create(At,vl,!1,!0)),Je.type=0;else{var _t=_r.getBuffer(At);if(_t)Je.state=Ur,Je.buffer=_t,Je.type=0;else if(Se.command(typeof At=="object"&&At,"invalid data for attribute "+gt,Fe.commandStr),"constant"in At){var Be=At.constant;Je.buffer="null",Je.state=_n,typeof Be=="number"?Je.x=Be:(Se.command($a(Be)&&Be.length>0&&Be.length<=4,"invalid constant for attribute "+gt,Fe.commandStr),Tr.forEach(function(Nn,En){En<Be.length&&(Je[Nn]=Be[En])}))}else{Lh(At.buffer)?_t=_r.getBuffer(_r.create(At.buffer,vl,!1,!0)):_t=_r.getBuffer(At.buffer),Se.command(!!_t,'missing buffer for attribute "'+gt+'"',Fe.commandStr);var Et=At.offset|0;Se.command(Et>=0,'invalid offset for attribute "'+gt+'"',Fe.commandStr);var tr=At.stride|0;Se.command(tr>=0&&tr<256,'invalid stride for attribute "'+gt+'", must be integer betweeen [0, 255]',Fe.commandStr);var pr=At.size|0;Se.command(!("size"in At)||pr>0&&pr<=4,'invalid size for attribute "'+gt+'", must be 1,2,3,4',Fe.commandStr);var sr=!!At.normalized,wr=0;"type"in At&&(Se.commandParameter(At.type,Jo,"invalid type for attribute "+gt,Fe.commandStr),wr=Jo[At.type]);var kr=At.divisor|0;"divisor"in At&&(Se.command(kr===0||Zr,'cannot specify divisor for attribute "'+gt+'", instancing not supported',Fe.commandStr),Se.command(kr>=0,'invalid divisor for attribute "'+gt+'"',Fe.commandStr)),Se.optional(function(){var Nn=Fe.commandStr,En=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(At).forEach(function(On){Se.command(En.indexOf(On)>=0,'unknown parameter "'+On+'" for attribute pointer "'+gt+'" (valid parameters are '+En+")",Nn)})}),Je.buffer=_t,Je.state=Ur,Je.size=pr,Je.normalized=sr,Je.type=wr||_t.dtype,Je.offset=Et,Je.stride=tr,Je.divisor=kr}}Wt[gt]=Lo(function(Nn,En){var On=Nn.attribCache;if(It in On)return On[It];var Kn={isStream:!1};return Object.keys(Je).forEach(function(ci){Kn[ci]=Je[ci]}),Je.buffer&&(Kn.buffer=Nn.link(Je.buffer),Kn.type=Kn.type||Kn.buffer+".dtype"),On[It]=Kn,Kn})}),Object.keys(qt).forEach(function(gt){var At=qt[gt];function It(Je,_t){var Be=Je.invoke(_t,At),Et=Je.shared,tr=Je.constants,pr=Et.isBufferArgs,sr=Et.buffer;Se.optional(function(){Je.assert(_t,Be+"&&(typeof "+Be+'==="object"||typeof '+Be+'==="function")&&('+pr+"("+Be+")||"+sr+".getBuffer("+Be+")||"+sr+".getBuffer("+Be+".buffer)||"+pr+"("+Be+'.buffer)||("constant" in '+Be+"&&(typeof "+Be+'.constant==="number"||'+Et.isArrayLike+"("+Be+".constant))))",'invalid dynamic attribute "'+gt+'"')});var wr={isStream:_t.def(!1)},kr=new Ft;kr.state=Ur,Object.keys(kr).forEach(function(Kn){wr[Kn]=_t.def(""+kr[Kn])});var Nn=wr.buffer,En=wr.type;_t("if(",pr,"(",Be,")){",wr.isStream,"=true;",Nn,"=",sr,".createStream(",vl,",",Be,");",En,"=",Nn,".dtype;","}else{",Nn,"=",sr,".getBuffer(",Be,");","if(",Nn,"){",En,"=",Nn,".dtype;",'}else if("constant" in ',Be,"){",wr.state,"=",_n,";","if(typeof "+Be+'.constant === "number"){',wr[Tr[0]],"=",Be,".constant;",Tr.slice(1).map(function(Kn){return wr[Kn]}).join("="),"=0;","}else{",Tr.map(function(Kn,ci){return wr[Kn]+"="+Be+".constant.length>"+ci+"?"+Be+".constant["+ci+"]:0;"}).join(""),"}}else{","if(",pr,"(",Be,".buffer)){",Nn,"=",sr,".createStream(",vl,",",Be,".buffer);","}else{",Nn,"=",sr,".getBuffer(",Be,".buffer);","}",En,'="type" in ',Be,"?",tr.glTypes,"[",Be,".type]:",Nn,".dtype;",wr.normalized,"=!!",Be,".normalized;");function On(Kn){_t(wr[Kn],"=",Be,".",Kn,"|0;")}return On("size"),On("offset"),On("stride"),On("divisor"),_t("}}"),_t.exit("if(",wr.isStream,"){",sr,".destroyStream(",Nn,");","}"),wr}Wt[gt]=pu(At,It)}),Wt}function Qa(me,Fe){var nt=me.static,qt=me.dynamic;if($u in nt){var Wt=nt[$u];return Wt!==null&&en.getVAO(Wt)===null&&(Wt=en.createVAO(Wt)),Lo(function(At){return At.link(en.getVAO(Wt))})}else if($u in qt){var gt=qt[$u];return pu(gt,function(At,It){var Je=At.invoke(It,gt);return It.def(At.shared.vao+".getVAO("+Je+")")})}return null}function Oa(me){var Fe=me.static,nt=me.dynamic,qt={};return Object.keys(Fe).forEach(function(Wt){var gt=Fe[Wt];qt[Wt]=Lo(function(At,It){return typeof gt=="number"||typeof gt=="boolean"?""+gt:At.link(gt)})}),Object.keys(nt).forEach(function(Wt){var gt=nt[Wt];qt[Wt]=pu(gt,function(At,It){return At.invoke(It,gt)})}),qt}function Bo(me,Fe,nt,qt,Wt){var gt=me.static,At=me.dynamic;Se.optional(function(){var On=[Ms,fu,wu,Vi,ts,hu,co,kc,lo,$u].concat(Pr);function Kn(ci){Object.keys(ci).forEach(function(ha){Se.command(On.indexOf(ha)>=0,'unknown parameter "'+ha+'"',Wt.commandStr)})}Kn(gt),Kn(At)});var It=Ct(me,Fe),Je=Zt(me,Wt),_t=Ai(me,Je,Wt),Be=na(me,Wt),Et=mo(me,Wt),tr=ri(me,Wt,It);function pr(On){var Kn=_t[On];Kn&&(Et[On]=Kn)}pr(Po),pr(fn(dl));var sr=Object.keys(Et).length>0,wr={framebuffer:Je,draw:Be,shader:tr,state:Et,dirty:sr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(wr.profile=Pi(me,Wt),wr.uniforms=rs(nt,Wt),wr.drawVAO=wr.scopeVAO=Qa(me,Wt),!wr.drawVAO&&tr.program&&!It&&rt.angle_instanced_arrays){var kr=!0,Nn=tr.program.attributes.map(function(On){var Kn=Fe.static[On];return kr=kr&&!!Kn,Kn});if(kr&&Nn.length>0){var En=en.getVAO(en.createVAO(Nn));wr.drawVAO=new ps(null,null,null,function(On,Kn){return On.link(En)}),wr.useVAO=!0}}return It?wr.useVAO=!0:wr.attributes=Di(Fe,Wt),wr.context=Oa(qt,Wt),wr}function xo(me,Fe,nt){var qt=me.shared,Wt=qt.context,gt=me.scope();Object.keys(nt).forEach(function(At){Fe.save(Wt,"."+At);var It=nt[At];gt(Wt,".",At,"=",It.append(me,Fe),";")}),Fe(gt)}function Ja(me,Fe,nt,qt){var Wt=me.shared,gt=Wt.gl,At=Wt.framebuffer,It;dn&&(It=Fe.def(Wt.extensions,".webgl_draw_buffers"));var Je=me.constants,_t=Je.drawBuffer,Be=Je.backBuffer,Et;nt?Et=nt.append(me,Fe):Et=Fe.def(At,".next"),qt||Fe("if(",Et,"!==",At,".cur){"),Fe("if(",Et,"){",gt,".bindFramebuffer(",Uc,",",Et,".framebuffer);"),dn&&Fe(It,".drawBuffersWEBGL(",_t,"[",Et,".colorAttachments.length]);"),Fe("}else{",gt,".bindFramebuffer(",Uc,",null);"),dn&&Fe(It,".drawBuffersWEBGL(",Be,");"),Fe("}",At,".cur=",Et,";"),qt||Fe("}")}function Fo(me,Fe,nt){var qt=me.shared,Wt=qt.gl,gt=me.current,At=me.next,It=qt.current,Je=qt.next,_t=me.cond(It,".dirty");Pr.forEach(function(Be){var Et=fn(Be);if(!(Et in nt.state)){var tr,pr;if(Et in At){tr=At[Et],pr=gt[Et];var sr=xt(Rr[Et].length,function(kr){return _t.def(tr,"[",kr,"]")});_t(me.cond(sr.map(function(kr,Nn){return kr+"!=="+pr+"["+Nn+"]"}).join("||")).then(Wt,".",Cr[Et],"(",sr,");",sr.map(function(kr,Nn){return pr+"["+Nn+"]="+kr}).join(";"),";"))}else{tr=_t.def(Je,".",Et);var wr=me.cond(tr,"!==",It,".",Et);_t(wr),Et in vn?wr(me.cond(tr).then(Wt,".enable(",vn[Et],");").else(Wt,".disable(",vn[Et],");"),It,".",Et,"=",tr,";"):wr(Wt,".",Cr[Et],"(",tr,");",It,".",Et,"=",tr,";")}}}),Object.keys(nt.state).length===0&&_t(It,".dirty=false;"),Fe(_t)}function ds(me,Fe,nt,qt){var Wt=me.shared,gt=me.current,At=Wt.current,It=Wt.gl;$f(Object.keys(nt)).forEach(function(Je){var _t=nt[Je];if(!(qt&&!qt(_t))){var Be=_t.append(me,Fe);if(vn[Je]){var Et=vn[Je];Ts(_t)?Be?Fe(It,".enable(",Et,");"):Fe(It,".disable(",Et,");"):Fe(me.cond(Be).then(It,".enable(",Et,");").else(It,".disable(",Et,");")),Fe(At,".",Je,"=",Be,";")}else if($a(Be)){var tr=gt[Je];Fe(It,".",Cr[Je],"(",Be,");",Be.map(function(pr,sr){return tr+"["+sr+"]="+pr}).join(";"),";")}else Fe(It,".",Cr[Je],"(",Be,");",At,".",Je,"=",Be,";")}})}function Eo(me,Fe){Zr&&(me.instancing=Fe.def(me.shared.extensions,".angle_instanced_arrays"))}function Si(me,Fe,nt,qt,Wt){var gt=me.shared,At=me.stats,It=gt.current,Je=gt.timer,_t=nt.profile;function Be(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var Et,tr;function pr(On){Et=Fe.def(),On(Et,"=",Be(),";"),typeof Wt=="string"?On(At,".count+=",Wt,";"):On(At,".count++;"),Dr&&(qt?(tr=Fe.def(),On(tr,"=",Je,".getNumPendingQueries();")):On(Je,".beginQuery(",At,");"))}function sr(On){On(At,".cpuTime+=",Be(),"-",Et,";"),Dr&&(qt?On(Je,".pushScopeStats(",tr,",",Je,".getNumPendingQueries(),",At,");"):On(Je,".endQuery();"))}function wr(On){var Kn=Fe.def(It,".profile");Fe(It,".profile=",On,";"),Fe.exit(It,".profile=",Kn,";")}var kr;if(_t){if(Ts(_t)){_t.enable?(pr(Fe),sr(Fe.exit),wr("true")):wr("false");return}kr=_t.append(me,Fe),wr(kr)}else kr=Fe.def(It,".profile");var Nn=me.block();pr(Nn),Fe("if(",kr,"){",Nn,"}");var En=me.block();sr(En),Fe.exit("if(",kr,"){",En,"}")}function ns(me,Fe,nt,qt,Wt){var gt=me.shared;function At(Je){switch(Je){case Yp:case qp:case ml:return 2;case Bl:case ao:case ff:return 3;case vp:case Hf:case Bc:return 4;default:return 1}}function It(Je,_t,Be){var Et=gt.gl,tr=Fe.def(Je,".location"),pr=Fe.def(gt.attributes,"[",tr,"]"),sr=Be.state,wr=Be.buffer,kr=[Be.x,Be.y,Be.z,Be.w],Nn=["buffer","normalized","offset","stride"];function En(){Fe("if(!",pr,".buffer){",Et,".enableVertexAttribArray(",tr,");}");var Kn=Be.type,ci;if(Be.size?ci=Fe.def(Be.size,"||",_t):ci=_t,Fe("if(",pr,".type!==",Kn,"||",pr,".size!==",ci,"||",Nn.map(function(Ao){return pr+"."+Ao+"!=="+Be[Ao]}).join("||"),"){",Et,".bindBuffer(",vl,",",wr,".buffer);",Et,".vertexAttribPointer(",[tr,ci,Kn,Be.normalized,Be.stride,Be.offset],");",pr,".type=",Kn,";",pr,".size=",ci,";",Nn.map(function(Ao){return pr+"."+Ao+"="+Be[Ao]+";"}).join(""),"}"),Zr){var ha=Be.divisor;Fe("if(",pr,".divisor!==",ha,"){",me.instancing,".vertexAttribDivisorANGLE(",[tr,ha],");",pr,".divisor=",ha,";}")}}function On(){Fe("if(",pr,".buffer){",Et,".disableVertexAttribArray(",tr,");",pr,".buffer=null;","}if(",Tr.map(function(Kn,ci){return pr+"."+Kn+"!=="+kr[ci]}).join("||"),"){",Et,".vertexAttrib4f(",tr,",",kr,");",Tr.map(function(Kn,ci){return pr+"."+Kn+"="+kr[ci]+";"}).join(""),"}")}sr===Ur?En():sr===_n?On():(Fe("if(",sr,"===",Ur,"){"),En(),Fe("}else{"),On(),Fe("}"))}qt.forEach(function(Je){var _t=Je.name,Be=nt.attributes[_t],Et;if(Be){if(!Wt(Be))return;Et=Be.append(me,Fe)}else{if(!Wt(td))return;var tr=me.scopeAttrib(_t);Se.optional(function(){me.assert(Fe,tr+".state","missing attribute "+_t)}),Et={},Object.keys(new Ft).forEach(function(pr){Et[pr]=Fe.def(tr,".",pr)})}It(me.link(Je),At(Je.info.type),Et)})}function fa(me,Fe,nt,qt,Wt){for(var gt=me.shared,At=gt.gl,It,Je=0;Je<qt.length;++Je){var _t=qt[Je],Be=_t.name,Et=_t.info.type,tr=nt.uniforms[Be],pr=me.link(_t),sr=pr+".location",wr;if(tr){if(!Wt(tr))continue;if(Ts(tr)){var kr=tr.value;if(Se.command(kr!==null&&typeof kr!="undefined",'missing uniform "'+Be+'"',me.commandStr),Et===Nc||Et===ic){Se.command(typeof kr=="function"&&(Et===Nc&&(kr._reglType==="texture2d"||kr._reglType==="framebuffer")||Et===ic&&(kr._reglType==="textureCube"||kr._reglType==="framebufferCube")),"invalid texture for uniform "+Be,me.commandStr);var Nn=me.link(kr._texture||kr.color[0]._texture);Fe(At,".uniform1i(",sr,",",Nn+".bind());"),Fe.exit(Nn,".unbind();")}else if(Et===Gf||Et===Xf||Et===Fc){Se.optional(function(){Se.command($a(kr),"invalid matrix for uniform "+Be,me.commandStr),Se.command(Et===Gf&&kr.length===4||Et===Xf&&kr.length===9||Et===Fc&&kr.length===16,"invalid length for matrix uniform "+Be,me.commandStr)});var En=me.global.def("new Float32Array(["+Array.prototype.slice.call(kr)+"])"),On=2;Et===Xf?On=3:Et===Fc&&(On=4),Fe(At,".uniformMatrix",On,"fv(",sr,",false,",En,");")}else{switch(Et){case Nd:Se.commandType(kr,"number","uniform "+Be,me.commandStr),It="1f";break;case Yp:Se.command($a(kr)&&kr.length===2,"uniform "+Be,me.commandStr),It="2f";break;case Bl:Se.command($a(kr)&&kr.length===3,"uniform "+Be,me.commandStr),It="3f";break;case vp:Se.command($a(kr)&&kr.length===4,"uniform "+Be,me.commandStr),It="4f";break;case Wf:Se.commandType(kr,"boolean","uniform "+Be,me.commandStr),It="1i";break;case Lc:Se.commandType(kr,"number","uniform "+Be,me.commandStr),It="1i";break;case ml:Se.command($a(kr)&&kr.length===2,"uniform "+Be,me.commandStr),It="2i";break;case qp:Se.command($a(kr)&&kr.length===2,"uniform "+Be,me.commandStr),It="2i";break;case ff:Se.command($a(kr)&&kr.length===3,"uniform "+Be,me.commandStr),It="3i";break;case ao:Se.command($a(kr)&&kr.length===3,"uniform "+Be,me.commandStr),It="3i";break;case Bc:Se.command($a(kr)&&kr.length===4,"uniform "+Be,me.commandStr),It="4i";break;case Hf:Se.command($a(kr)&&kr.length===4,"uniform "+Be,me.commandStr),It="4i";break}Fe(At,".uniform",It,"(",sr,",",$a(kr)?Array.prototype.slice.call(kr):kr,");")}continue}else wr=tr.append(me,Fe)}else{if(!Wt(td))continue;wr=Fe.def(gt.uniforms,"[",De.id(Be),"]")}Et===Nc?Fe("if(",wr,"&&",wr,'._reglType==="framebuffer"){',wr,"=",wr,".color[0];","}"):Et===ic&&Fe("if(",wr,"&&",wr,'._reglType==="framebufferCube"){',wr,"=",wr,".color[0];","}"),Se.optional(function(){function _l(sc,xp){me.assert(Fe,sc,'bad data or missing for uniform "'+Be+'".  '+xp)}function od(sc){_l("typeof "+wr+'==="'+sc+'"',"invalid type, expected "+sc)}function Cu(sc,xp){_l(gt.isArrayLike+"("+wr+")&&"+wr+".length==="+sc,"invalid vector, should have length "+sc,me.commandStr)}function sd(sc){_l("typeof "+wr+'==="function"&&'+wr+'._reglType==="texture'+(sc===jf?"2d":"Cube")+'"',"invalid texture type",me.commandStr)}switch(Et){case Lc:od("number");break;case qp:Cu(2,"number");break;case ao:Cu(3,"number");break;case Hf:Cu(4,"number");break;case Nd:od("number");break;case Yp:Cu(2,"number");break;case Bl:Cu(3,"number");break;case vp:Cu(4,"number");break;case Wf:od("boolean");break;case ml:Cu(2,"boolean");break;case ff:Cu(3,"boolean");break;case Bc:Cu(4,"boolean");break;case Gf:Cu(4,"number");break;case Xf:Cu(9,"number");break;case Fc:Cu(16,"number");break;case Nc:sd(jf);break;case ic:sd(dp);break}});var Kn=1;switch(Et){case Nc:case ic:var ci=Fe.def(wr,"._texture");Fe(At,".uniform1i(",sr,",",ci,".bind());"),Fe.exit(ci,".unbind();");continue;case Lc:case Wf:It="1i";break;case qp:case ml:It="2i",Kn=2;break;case ao:case ff:It="3i",Kn=3;break;case Hf:case Bc:It="4i",Kn=4;break;case Nd:It="1f";break;case Yp:It="2f",Kn=2;break;case Bl:It="3f",Kn=3;break;case vp:It="4f",Kn=4;break;case Gf:It="Matrix2fv";break;case Xf:It="Matrix3fv";break;case Fc:It="Matrix4fv";break}if(Fe(At,".uniform",It,"(",sr,","),It.charAt(0)==="M"){var ha=Math.pow(Et-Gf+2,2),Ao=me.global.def("new Float32Array(",ha,")");Fe("false,(Array.isArray(",wr,")||",wr," instanceof Float32Array)?",wr,":(",xt(ha,function(_l){return Ao+"["+_l+"]="+wr+"["+_l+"]"}),",",Ao,")")}else Kn>1?Fe(xt(Kn,function(_l){return wr+"["+_l+"]"})):Fe(wr);Fe(");")}}function ei(me,Fe,nt,qt){var Wt=me.shared,gt=Wt.gl,At=Wt.draw,It=qt.draw;function Je(){var ci=It.elements,ha,Ao=Fe;return ci?((ci.contextDep&&qt.contextDynamic||ci.propDep)&&(Ao=nt),ha=ci.append(me,Ao)):ha=Ao.def(At,".",Vi),ha&&Ao("if("+ha+")"+gt+".bindBuffer("+Xp+","+ha+".buffer.buffer);"),ha}function _t(){var ci=It.count,ha,Ao=Fe;return ci?((ci.contextDep&&qt.contextDynamic||ci.propDep)&&(Ao=nt),ha=ci.append(me,Ao),Se.optional(function(){ci.MISSING&&me.assert(Fe,"false","missing vertex count"),ci.DYNAMIC&&me.assert(Ao,ha+">=0","missing vertex count")})):(ha=Ao.def(At,".",co),Se.optional(function(){me.assert(Ao,ha+">=0","missing vertex count")})),ha}var Be=Je();function Et(ci){var ha=It[ci];return ha?ha.contextDep&&qt.contextDynamic||ha.propDep?ha.append(me,nt):ha.append(me,Fe):Fe.def(At,".",ci)}var tr=Et(ts),pr=Et(hu),sr=_t();if(typeof sr=="number"){if(sr===0)return}else nt("if(",sr,"){"),nt.exit("}");var wr,kr;Zr&&(wr=Et(kc),kr=me.instancing);var Nn=Be+".type",En=It.elements&&Ts(It.elements);function On(){function ci(){nt(kr,".drawElementsInstancedANGLE(",[tr,sr,Nn,pr+"<<(("+Nn+"-"+Yr+")>>1)",wr],");")}function ha(){nt(kr,".drawArraysInstancedANGLE(",[tr,pr,sr,wr],");")}Be?En?ci():(nt("if(",Be,"){"),ci(),nt("}else{"),ha(),nt("}")):ha()}function Kn(){function ci(){nt(gt+".drawElements("+[tr,sr,Nn,pr+"<<(("+Nn+"-"+Yr+")>>1)"]+");")}function ha(){nt(gt+".drawArrays("+[tr,pr,sr]+");")}Be?En?ci():(nt("if(",Be,"){"),ci(),nt("}else{"),ha(),nt("}")):ha()}Zr&&(typeof wr!="number"||wr>=0)?typeof wr=="string"?(nt("if(",wr,">0){"),On(),nt("}else if(",wr,"<0){"),Kn(),nt("}")):On():Kn()}function Li(me,Fe,nt,qt,Wt){var gt=Fn(),At=gt.proc("body",Wt);return Se.optional(function(){gt.commandStr=Fe.commandStr,gt.command=gt.link(Fe.commandStr)}),Zr&&(gt.instancing=At.def(gt.shared.extensions,".angle_instanced_arrays")),me(gt,At,nt,qt),gt.compile().body}function Ki(me,Fe,nt,qt){Eo(me,Fe),nt.useVAO?nt.drawVAO?Fe(me.shared.vao,".setVAO(",nt.drawVAO.append(me,Fe),");"):Fe(me.shared.vao,".setVAO(",me.shared.vao,".targetVAO);"):(Fe(me.shared.vao,".setVAO(null);"),ns(me,Fe,nt,qt.attributes,function(){return!0})),fa(me,Fe,nt,qt.uniforms,function(){return!0}),ei(me,Fe,Fe,nt)}function So(me,Fe){var nt=me.proc("draw",1);Eo(me,nt),xo(me,nt,Fe.context),Ja(me,nt,Fe.framebuffer),Fo(me,nt,Fe),ds(me,nt,Fe.state),Si(me,nt,Fe,!1,!0);var qt=Fe.shader.progVar.append(me,nt);if(nt(me.shared.gl,".useProgram(",qt,".program);"),Fe.shader.program)Ki(me,nt,Fe,Fe.shader.program);else{nt(me.shared.vao,".setVAO(null);");var Wt=me.global.def("{}"),gt=nt.def(qt,".id"),At=nt.def(Wt,"[",gt,"]");nt(me.cond(At).then(At,".call(this,a0);").else(At,"=",Wt,"[",gt,"]=",me.link(function(It){return Li(Ki,me,Fe,It,1)}),"(",qt,");",At,".call(this,a0);"))}Object.keys(Fe.state).length>0&&nt(me.shared.current,".dirty=true;")}function yl(me,Fe,nt,qt){me.batchId="a1",Eo(me,Fe);function Wt(){return!0}ns(me,Fe,nt,qt.attributes,Wt),fa(me,Fe,nt,qt.uniforms,Wt),ei(me,Fe,Fe,nt)}function Ke(me,Fe,nt,qt){Eo(me,Fe);var Wt=nt.contextDep,gt=Fe.def(),At="a0",It="a1",Je=Fe.def();me.shared.props=Je,me.batchId=gt;var _t=me.scope(),Be=me.scope();Fe(_t.entry,"for(",gt,"=0;",gt,"<",It,";++",gt,"){",Je,"=",At,"[",gt,"];",Be,"}",_t.exit);function Et(Nn){return Nn.contextDep&&Wt||Nn.propDep}function tr(Nn){return!Et(Nn)}if(nt.needsContext&&xo(me,Be,nt.context),nt.needsFramebuffer&&Ja(me,Be,nt.framebuffer),ds(me,Be,nt.state,Et),nt.profile&&Et(nt.profile)&&Si(me,Be,nt,!1,!0),qt)nt.useVAO?nt.drawVAO?Et(nt.drawVAO)?Be(me.shared.vao,".setVAO(",nt.drawVAO.append(me,Be),");"):_t(me.shared.vao,".setVAO(",nt.drawVAO.append(me,_t),");"):_t(me.shared.vao,".setVAO(",me.shared.vao,".targetVAO);"):(_t(me.shared.vao,".setVAO(null);"),ns(me,_t,nt,qt.attributes,tr),ns(me,Be,nt,qt.attributes,Et)),fa(me,_t,nt,qt.uniforms,tr),fa(me,Be,nt,qt.uniforms,Et),ei(me,_t,Be,nt);else{var pr=me.global.def("{}"),sr=nt.shader.progVar.append(me,Be),wr=Be.def(sr,".id"),kr=Be.def(pr,"[",wr,"]");Be(me.shared.gl,".useProgram(",sr,".program);","if(!",kr,"){",kr,"=",pr,"[",wr,"]=",me.link(function(Nn){return Li(yl,me,nt,Nn,2)}),"(",sr,");}",kr,".call(this,a0[",gt,"],",gt,");")}}function or(me,Fe){var nt=me.proc("batch",2);me.batchId="0",Eo(me,nt);var qt=!1,Wt=!0;Object.keys(Fe.context).forEach(function(pr){qt=qt||Fe.context[pr].propDep}),qt||(xo(me,nt,Fe.context),Wt=!1);var gt=Fe.framebuffer,At=!1;gt?(gt.propDep?qt=At=!0:gt.contextDep&&qt&&(At=!0),At||Ja(me,nt,gt)):Ja(me,nt,null),Fe.state.viewport&&Fe.state.viewport.propDep&&(qt=!0);function It(pr){return pr.contextDep&&qt||pr.propDep}Fo(me,nt,Fe),ds(me,nt,Fe.state,function(pr){return!It(pr)}),(!Fe.profile||!It(Fe.profile))&&Si(me,nt,Fe,!1,"a1"),Fe.contextDep=qt,Fe.needsContext=Wt,Fe.needsFramebuffer=At;var Je=Fe.shader.progVar;if(Je.contextDep&&qt||Je.propDep)Ke(me,nt,Fe,null);else{var _t=Je.append(me,nt);if(nt(me.shared.gl,".useProgram(",_t,".program);"),Fe.shader.program)Ke(me,nt,Fe,Fe.shader.program);else{nt(me.shared.vao,".setVAO(null);");var Be=me.global.def("{}"),Et=nt.def(_t,".id"),tr=nt.def(Be,"[",Et,"]");nt(me.cond(tr).then(tr,".call(this,a0,a1);").else(tr,"=",Be,"[",Et,"]=",me.link(function(pr){return Li(Ke,me,Fe,pr,2)}),"(",_t,");",tr,".call(this,a0,a1);"))}}Object.keys(Fe.state).length>0&&nt(me.shared.current,".dirty=true;")}function Yt(me,Fe){var nt=me.proc("scope",3);me.batchId="a2";var qt=me.shared,Wt=qt.current;xo(me,nt,Fe.context),Fe.framebuffer&&Fe.framebuffer.append(me,nt),$f(Object.keys(Fe.state)).forEach(function(At){var It=Fe.state[At],Je=It.append(me,nt);$a(Je)?Je.forEach(function(_t,Be){nt.set(me.next[At],"["+Be+"]",_t)}):nt.set(qt.next,"."+At,Je)}),Si(me,nt,Fe,!0,!0),[Vi,hu,co,kc,ts].forEach(function(At){var It=Fe.draw[At];It&&nt.set(qt.draw,"."+At,""+It.append(me,nt))}),Object.keys(Fe.uniforms).forEach(function(At){nt.set(qt.uniforms,"["+De.id(At)+"]",Fe.uniforms[At].append(me,nt))}),Object.keys(Fe.attributes).forEach(function(At){var It=Fe.attributes[At].append(me,nt),Je=me.scopeAttrib(At);Object.keys(new Ft).forEach(function(_t){nt.set(Je,"."+_t,It[_t])})}),Fe.scopeVAO&&nt.set(qt.vao,".targetVAO",Fe.scopeVAO.append(me,nt));function gt(At){var It=Fe.shader[At];It&&nt.set(qt.shader,"."+At,It.append(me,nt))}gt(fu),gt(wu),Object.keys(Fe.state).length>0&&(nt(Wt,".dirty=true;"),nt.exit(Wt,".dirty=true;")),nt("a1(",me.shared.context,",a0,",me.batchId,");")}function xn(me){if(!(typeof me!="object"||$a(me))){for(var Fe=Object.keys(me),nt=0;nt<Fe.length;++nt)if(rn.isDynamic(me[Fe[nt]]))return!0;return!1}}function Ti(me,Fe,nt){var qt=Fe.static[nt];if(!qt||!xn(qt))return;var Wt=me.global,gt=Object.keys(qt),At=!1,It=!1,Je=!1,_t=me.global.def("{}");gt.forEach(function(Et){var tr=qt[Et];if(rn.isDynamic(tr)){typeof tr=="function"&&(tr=qt[Et]=rn.unbox(tr));var pr=pu(tr,null);At=At||pr.thisDep,Je=Je||pr.propDep,It=It||pr.contextDep}else{switch(Wt(_t,".",Et,"="),typeof tr){case"number":Wt(tr);break;case"string":Wt('"',tr,'"');break;case"object":Array.isArray(tr)&&Wt("[",tr.join(),"]");break;default:Wt(me.link(tr));break}Wt(";")}});function Be(Et,tr){gt.forEach(function(pr){var sr=qt[pr];if(rn.isDynamic(sr)){var wr=Et.invoke(tr,sr);tr(_t,".",pr,"=",wr,";")}})}Fe.dynamic[nt]=new rn.DynamicVariable(Tn,{thisDep:At,contextDep:It,propDep:Je,ref:_t,append:Be}),delete Fe.static[nt]}function ga(me,Fe,nt,qt,Wt){var gt=Fn();gt.stats=gt.link(Wt),Object.keys(Fe.static).forEach(function(It){Ti(gt,Fe,It)}),nc.forEach(function(It){Ti(gt,me,It)});var At=Bo(me,Fe,nt,qt,gt);return So(gt,At),Yt(gt,At),or(gt,At),gt.compile()}return{next:bn,current:Rr,procs:function(){var me=Fn(),Fe=me.proc("poll"),nt=me.proc("refresh"),qt=me.block();Fe(qt),nt(qt);var Wt=me.shared,gt=Wt.gl,At=Wt.next,It=Wt.current;qt(It,".dirty=false;"),Ja(me,Fe),Ja(me,nt,null,!0);var Je;Zr&&(Je=me.link(Zr)),rt.oes_vertex_array_object&&nt(me.link(rt.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var _t=0;_t<Jt.maxAttributes;++_t){var Be=nt.def(Wt.attributes,"[",_t,"]"),Et=me.cond(Be,".buffer");Et.then(gt,".enableVertexAttribArray(",_t,");",gt,".bindBuffer(",vl,",",Be,".buffer.buffer);",gt,".vertexAttribPointer(",_t,",",Be,".size,",Be,".type,",Be,".normalized,",Be,".stride,",Be,".offset);").else(gt,".disableVertexAttribArray(",_t,");",gt,".vertexAttrib4f(",_t,",",Be,".x,",Be,".y,",Be,".z,",Be,".w);",Be,".buffer=null;"),nt(Et),Zr&&nt(Je,".vertexAttribDivisorANGLE(",_t,",",Be,".divisor);")}return nt(me.shared.vao,".currentVAO=null;",me.shared.vao,".setVAO(",me.shared.vao,".targetVAO);"),Object.keys(vn).forEach(function(tr){var pr=vn[tr],sr=qt.def(At,".",tr),wr=me.block();wr("if(",sr,"){",gt,".enable(",pr,")}else{",gt,".disable(",pr,")}",It,".",tr,"=",sr,";"),nt(wr),Fe("if(",sr,"!==",It,".",tr,"){",wr,"}")}),Object.keys(Cr).forEach(function(tr){var pr=Cr[tr],sr=Rr[tr],wr,kr,Nn=me.block();if(Nn(gt,".",pr,"("),$a(sr)){var En=sr.length;wr=me.global.def(At,".",tr),kr=me.global.def(It,".",tr),Nn(xt(En,function(On){return wr+"["+On+"]"}),");",xt(En,function(On){return kr+"["+On+"]="+wr+"["+On+"];"}).join("")),Fe("if(",xt(En,function(On){return wr+"["+On+"]!=="+kr+"["+On+"]"}).join("||"),"){",Nn,"}")}else wr=qt.def(At,".",tr),kr=qt.def(It,".",tr),Nn(wr,");",It,".",tr,"=",wr,";"),Fe("if(",wr,"!==",kr,"){",Nn,"}");nt(Nn)}),me.compile()}(),compile:ga}}function rd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Vd=34918,jv=34919,jd=35007,nd=function(X,De){if(!De.ext_disjoint_timer_query)return null;var rt=[];function Jt(){return rt.pop()||De.ext_disjoint_timer_query.createQueryEXT()}function _r(Zr){rt.push(Zr)}var rr=[];function Xt(Zr){var dn=Jt();De.ext_disjoint_timer_query.beginQueryEXT(jd,dn),rr.push(dn),Dr(rr.length-1,rr.length,Zr)}function Nr(){De.ext_disjoint_timer_query.endQueryEXT(jd)}function Or(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var en=[];function zr(){return en.pop()||new Or}function qr(Zr){en.push(Zr)}var an=[];function Dr(Zr,dn,Rr){var bn=zr();bn.startQueryIndex=Zr,bn.endQueryIndex=dn,bn.sum=0,bn.stats=Rr,an.push(bn)}var Jr=[],Ft=[];function lr(){var Zr,dn,Rr=rr.length;if(Rr!==0){Ft.length=Math.max(Ft.length,Rr+1),Jr.length=Math.max(Jr.length,Rr+1),Jr[0]=0,Ft[0]=0;var bn=0;for(Zr=0,dn=0;dn<rr.length;++dn){var Pr=rr[dn];De.ext_disjoint_timer_query.getQueryObjectEXT(Pr,jv)?(bn+=De.ext_disjoint_timer_query.getQueryObjectEXT(Pr,Vd),_r(Pr)):rr[Zr++]=Pr,Jr[dn+1]=bn,Ft[dn+1]=Zr}for(rr.length=Zr,Zr=0,dn=0;dn<an.length;++dn){var vn=an[dn],Cr=vn.startQueryIndex,fn=vn.endQueryIndex;vn.sum+=Jr[fn]-Jr[Cr];var $n=Ft[Cr],li=Ft[fn];li===$n?(vn.stats.gpuTime+=vn.sum/1e6,qr(vn)):(vn.startQueryIndex=$n,vn.endQueryIndex=li,an[Zr++]=vn)}an.length=Zr}}return{beginQuery:Xt,endQuery:Nr,pushScopeStats:Dr,update:lr,getNumPendingQueries:function(){return rr.length},clear:function(){rt.push.apply(rt,rr);for(var Zr=0;Zr<rt.length;Zr++)De.ext_disjoint_timer_query.deleteQueryEXT(rt[Zr]);rr.length=0,rt.length=0},restore:function(){rr.length=0,rt.length=0}}},Hd=16384,Is=256,_p=1024,bp=34962,id="webglcontextlost",Yf="webglcontextrestored",ad=1,Hv=2,Wv=3;function Wd(X,De){for(var rt=0;rt<X.length;++rt)if(X[rt]===De)return rt;return-1}function Gd(X){var De=Lt(X);if(!De)return null;var rt=De.gl,Jt=rt.getContextAttributes(),_r=rt.isContextLost(),rr=Bt(rt,De);if(!rr)return null;var Xt=he(),Nr=rd(),Or=rr.extensions,en=nd(rt,Or),zr=Ci(),qr=rt.drawingBufferWidth,an=rt.drawingBufferHeight,Dr={tick:0,time:0,viewportWidth:qr,viewportHeight:an,framebufferWidth:qr,framebufferHeight:an,drawingBufferWidth:qr,drawingBufferHeight:an,pixelRatio:De.pixelRatio},Jr={},Ft={elements:null,primitive:4,count:-1,offset:0,instances:-1},lr=xc(rt,Or),Zr=dh(rt,Nr,De,Rr),dn=oe(rt,Or,lr,Nr,Zr);function Rr(ei){return dn.destroyBuffer(ei)}var bn=ra(rt,Or,Zr,Nr),Pr=$e(rt,Xt,Nr,De),vn=Nt(rt,Or,lr,function(){$n.procs.poll()},Dr,Nr,De),Cr=bu(rt,Or,lr,Nr,De),fn=w(rt,Or,lr,vn,Cr,Nr),$n=hf(rt,Xt,Or,lr,Zr,bn,vn,fn,Jr,dn,Pr,Ft,Dr,en,De),li=zt(rt,fn,$n.procs.poll,Dr,Jt,Or,lr),ln=$n.next,Fr=rt.canvas,Sr=[],Fn=[],Pi=[],Zt=[De.onDestroy],Ai=null;function Ct(){if(Sr.length===0){en&&en.update(),Ai=null;return}Ai=yn.next(Ct),ds();for(var ei=Sr.length-1;ei>=0;--ei){var Li=Sr[ei];Li&&Li(Dr,null,0)}rt.flush(),en&&en.update()}function ri(){!Ai&&Sr.length>0&&(Ai=yn.next(Ct))}function na(){Ai&&(yn.cancel(Ct),Ai=null)}function mo(ei){ei.preventDefault(),_r=!0,na(),Fn.forEach(function(Li){Li()})}function rs(ei){rt.getError(),_r=!1,rr.restore(),Pr.restore(),Zr.restore(),vn.restore(),Cr.restore(),fn.restore(),dn.restore(),en&&en.restore(),$n.procs.refresh(),ri(),Pi.forEach(function(Li){Li()})}Fr&&(Fr.addEventListener(id,mo,!1),Fr.addEventListener(Yf,rs,!1));function Di(){Sr.length=0,na(),Fr&&(Fr.removeEventListener(id,mo),Fr.removeEventListener(Yf,rs)),Pr.clear(),fn.clear(),Cr.clear(),vn.clear(),bn.clear(),Zr.clear(),dn.clear(),en&&en.clear(),Zt.forEach(function(ei){ei()})}function Qa(ei){Se(!!ei,"invalid args to regl({...})"),Se.type(ei,"object","invalid args to regl({...})");function Li(Wt){var gt=O({},Wt);delete gt.uniforms,delete gt.attributes,delete gt.context,delete gt.vao,"stencil"in gt&&gt.stencil.op&&(gt.stencil.opBack=gt.stencil.opFront=gt.stencil.op,delete gt.stencil.op);function At(It){if(It in gt){var Je=gt[It];delete gt[It],Object.keys(Je).forEach(function(_t){gt[It+"."+_t]=Je[_t]})}}return At("blend"),At("depth"),At("cull"),At("stencil"),At("polygonOffset"),At("scissor"),At("sample"),"vao"in Wt&&(gt.vao=Wt.vao),gt}function Ki(Wt){var gt={},At={};return Object.keys(Wt).forEach(function(It){var Je=Wt[It];rn.isDynamic(Je)?At[It]=rn.unbox(Je,It):gt[It]=Je}),{dynamic:At,static:gt}}var So=Ki(ei.context||{}),yl=Ki(ei.uniforms||{}),Ke=Ki(ei.attributes||{}),or=Ki(Li(ei)),Yt={gpuTime:0,cpuTime:0,count:0},xn=$n.compile(or,Ke,yl,So,Yt),Ti=xn.draw,ga=xn.batch,me=xn.scope,Fe=[];function nt(Wt){for(;Fe.length<Wt;)Fe.push(null);return Fe}function qt(Wt,gt){var At;if(_r&&Se.raise("context lost"),typeof Wt=="function")return me.call(this,null,Wt,0);if(typeof gt=="function")if(typeof Wt=="number")for(At=0;At<Wt;++At)me.call(this,null,gt,At);else if(Array.isArray(Wt))for(At=0;At<Wt.length;++At)me.call(this,Wt[At],gt,At);else return me.call(this,Wt,gt,0);else if(typeof Wt=="number"){if(Wt>0)return ga.call(this,nt(Wt|0),Wt|0)}else if(Array.isArray(Wt)){if(Wt.length)return ga.call(this,Wt,Wt.length)}else return Ti.call(this,Wt)}return O(qt,{stats:Yt})}var Oa=fn.setFBO=Qa({framebuffer:rn.define.call(null,ad,"framebuffer")});function Bo(ei,Li){var Ki=0;$n.procs.poll();var So=Li.color;So&&(rt.clearColor(+So[0]||0,+So[1]||0,+So[2]||0,+So[3]||0),Ki|=Hd),"depth"in Li&&(rt.clearDepth(+Li.depth),Ki|=Is),"stencil"in Li&&(rt.clearStencil(Li.stencil|0),Ki|=_p),Se(!!Ki,"called regl.clear with no buffer specified"),rt.clear(Ki)}function xo(ei){if(Se(typeof ei=="object"&&ei,"regl.clear() takes an object as input"),"framebuffer"in ei)if(ei.framebuffer&&ei.framebuffer_reglType==="framebufferCube")for(var Li=0;Li<6;++Li)Oa(O({framebuffer:ei.framebuffer.faces[Li]},ei),Bo);else Oa(ei,Bo);else Bo(null,ei)}function Ja(ei){Se.type(ei,"function","regl.frame() callback must be a function"),Sr.push(ei);function Li(){var Ki=Wd(Sr,ei);Se(Ki>=0,"cannot cancel a frame twice");function So(){var yl=Wd(Sr,So);Sr[yl]=Sr[Sr.length-1],Sr.length-=1,Sr.length<=0&&na()}Sr[Ki]=So}return ri(),{cancel:Li}}function Fo(){var ei=ln.viewport,Li=ln.scissor_box;ei[0]=ei[1]=Li[0]=Li[1]=0,Dr.viewportWidth=Dr.framebufferWidth=Dr.drawingBufferWidth=ei[2]=Li[2]=rt.drawingBufferWidth,Dr.viewportHeight=Dr.framebufferHeight=Dr.drawingBufferHeight=ei[3]=Li[3]=rt.drawingBufferHeight}function ds(){Dr.tick+=1,Dr.time=Si(),Fo(),$n.procs.poll()}function Eo(){Fo(),$n.procs.refresh(),en&&en.update()}function Si(){return(Ci()-zr)/1e3}Eo();function ns(ei,Li){Se.type(Li,"function","listener callback must be a function");var Ki;switch(ei){case"frame":return Ja(Li);case"lost":Ki=Fn;break;case"restore":Ki=Pi;break;case"destroy":Ki=Zt;break;default:Se.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ki.push(Li),{cancel:function(){for(var So=0;So<Ki.length;++So)if(Ki[So]===Li){Ki[So]=Ki[Ki.length-1],Ki.pop();return}}}}var fa=O(Qa,{clear:xo,prop:rn.define.bind(null,ad),context:rn.define.bind(null,Hv),this:rn.define.bind(null,Wv),draw:Qa({}),buffer:function(ei){return Zr.create(ei,bp,!1,!1)},elements:function(ei){return bn.create(ei,!1)},texture:vn.create2D,cube:vn.createCube,renderbuffer:Cr.create,framebuffer:fn.create,framebufferCube:fn.createCube,vao:dn.createVAO,attributes:Jt,frame:Ja,on:ns,limits:lr,hasExtension:function(ei){return lr.extensions.indexOf(ei.toLowerCase())>=0},read:li,destroy:Di,_gl:rt,_refresh:Eo,poll:function(){ds(),en&&en.update()},now:Si,stats:Nr});return De.onDone(null,fa),fa}return Gd})},69848:function(Ut){(function(ae,O){Ut.exports=O()})(this,function(){"use strict";function ae(ft,Pe,Rt,Ve,Vt,mr){if(!(Vt-Ve<=Rt)){var ie=Ve+Vt>>1;O(ft,Pe,ie,Ve,Vt,mr%2),ae(ft,Pe,Rt,Ve,ie-1,mr+1),ae(ft,Pe,Rt,ie+1,Vt,mr+1)}}function O(ft,Pe,Rt,Ve,Vt,mr){for(;Vt>Ve;){if(Vt-Ve>600){var ie=Vt-Ve+1,j=Rt-Ve+1,re=Math.log(ie),ke=.5*Math.exp(2*re/3),Te=.5*Math.sqrt(re*ke*(ie-ke)/ie)*(j-ie/2<0?-1:1),st=Math.max(Ve,Math.floor(Rt-j*ke/ie+Te)),ze=Math.min(Vt,Math.floor(Rt+(ie-j)*ke/ie+Te));O(ft,Pe,Rt,st,ze,mr)}var Qe=Pe[2*Rt+mr],at=Ve,Mt=Vt;for(te(ft,Pe,Ve,Rt),Pe[2*Vt+mr]>Qe&&te(ft,Pe,Ve,Vt);at<Mt;){for(te(ft,Pe,at,Mt),at++,Mt--;Pe[2*at+mr]<Qe;)at++;for(;Pe[2*Mt+mr]>Qe;)Mt--}Pe[2*Ve+mr]===Qe?te(ft,Pe,Ve,Mt):(Mt++,te(ft,Pe,Mt,Vt)),Mt<=Rt&&(Ve=Mt+1),Rt<=Mt&&(Vt=Mt-1)}}function te(ft,Pe,Rt,Ve){de(ft,Rt,Ve),de(Pe,2*Rt,2*Ve),de(Pe,2*Rt+1,2*Ve+1)}function de(ft,Pe,Rt){var Ve=ft[Pe];ft[Pe]=ft[Rt],ft[Rt]=Ve}function y(ft,Pe,Rt,Ve,Vt,mr,ie){for(var j=[0,ft.length-1,0],re=[],ke,Te;j.length;){var st=j.pop(),ze=j.pop(),Qe=j.pop();if(ze-Qe<=ie){for(var at=Qe;at<=ze;at++)ke=Pe[2*at],Te=Pe[2*at+1],ke>=Rt&&ke<=Vt&&Te>=Ve&&Te<=mr&&re.push(ft[at]);continue}var Mt=Math.floor((Qe+ze)/2);ke=Pe[2*Mt],Te=Pe[2*Mt+1],ke>=Rt&&ke<=Vt&&Te>=Ve&&Te<=mr&&re.push(ft[Mt]);var vr=(st+1)%2;(st===0?Rt<=ke:Ve<=Te)&&(j.push(Qe),j.push(Mt-1),j.push(vr)),(st===0?Vt>=ke:mr>=Te)&&(j.push(Mt+1),j.push(ze),j.push(vr))}return re}function le(ft,Pe,Rt,Ve,Vt,mr){for(var ie=[0,ft.length-1,0],j=[],re=Vt*Vt;ie.length;){var ke=ie.pop(),Te=ie.pop(),st=ie.pop();if(Te-st<=mr){for(var ze=st;ze<=Te;ze++)P(Pe[2*ze],Pe[2*ze+1],Rt,Ve)<=re&&j.push(ft[ze]);continue}var Qe=Math.floor((st+Te)/2),at=Pe[2*Qe],Mt=Pe[2*Qe+1];P(at,Mt,Rt,Ve)<=re&&j.push(ft[Qe]);var vr=(ke+1)%2;(ke===0?Rt-Vt<=at:Ve-Vt<=Mt)&&(ie.push(st),ie.push(Qe-1),ie.push(vr)),(ke===0?Rt+Vt>=at:Ve+Vt>=Mt)&&(ie.push(Qe+1),ie.push(Te),ie.push(vr))}return j}function P(ft,Pe,Rt,Ve){var Vt=ft-Rt,mr=Pe-Ve;return Vt*Vt+mr*mr}var Y=function(ft){return ft[0]},V=function(ft){return ft[1]},ue=function(Pe,Rt,Ve,Vt,mr){Rt===void 0&&(Rt=Y),Ve===void 0&&(Ve=V),Vt===void 0&&(Vt=64),mr===void 0&&(mr=Float64Array),this.nodeSize=Vt,this.points=Pe;for(var ie=Pe.length<65536?Uint16Array:Uint32Array,j=this.ids=new ie(Pe.length),re=this.coords=new mr(Pe.length*2),ke=0;ke<Pe.length;ke++)j[ke]=ke,re[2*ke]=Rt(Pe[ke]),re[2*ke+1]=Ve(Pe[ke]);ae(j,re,Vt,0,j.length-1,0)};ue.prototype.range=function(Pe,Rt,Ve,Vt){return y(this.ids,this.coords,Pe,Rt,Ve,Vt,this.nodeSize)},ue.prototype.within=function(Pe,Rt,Ve){return le(this.ids,this.coords,Pe,Rt,Ve,this.nodeSize)};var H={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ft){return ft}},Ae=Math.fround||function(ft){return function(Pe){return ft[0]=+Pe,ft[0]}}(new Float32Array(1)),Ce=function(Pe){this.options=dr(Object.create(H),Pe),this.trees=new Array(this.options.maxZoom+1)};Ce.prototype.load=function(Pe){var Rt=this.options,Ve=Rt.log,Vt=Rt.minZoom,mr=Rt.maxZoom,ie=Rt.nodeSize;Ve&&console.time("total time");var j="prepare "+Pe.length+" points";Ve&&console.time(j),this.points=Pe;for(var re=[],ke=0;ke<Pe.length;ke++)Pe[ke].geometry&&re.push(ct(Pe[ke],ke));this.trees[mr+1]=new ue(re,yr,cr,ie,Float32Array),Ve&&console.timeEnd(j);for(var Te=mr;Te>=Vt;Te--){var st=+Date.now();re=this._cluster(re,Te),this.trees[Te]=new ue(re,yr,cr,ie,Float32Array),Ve&&console.log("z%d: %d clusters in %dms",Te,re.length,+Date.now()-st)}return Ve&&console.timeEnd("total time"),this},Ce.prototype.getClusters=function(Pe,Rt){var Ve=((Pe[0]+180)%360+360)%360-180,Vt=Math.max(-90,Math.min(90,Pe[1])),mr=Pe[2]===180?180:((Pe[2]+180)%360+360)%360-180,ie=Math.max(-90,Math.min(90,Pe[3]));if(Pe[2]-Pe[0]>=360)Ve=-180,mr=180;else if(Ve>mr){var j=this.getClusters([Ve,Vt,180,ie],Rt),re=this.getClusters([-180,Vt,mr,ie],Rt);return j.concat(re)}for(var ke=this.trees[this._limitZoom(Rt)],Te=ke.range(mt(Ve),Ze(ie),mt(mr),Ze(Vt)),st=[],ze=0,Qe=Te;ze<Qe.length;ze+=1){var at=Qe[ze],Mt=ke.points[at];st.push(Mt.numPoints?ye(Mt):this.points[Mt.index])}return st},Ce.prototype.getChildren=function(Pe){var Rt=this._getOriginId(Pe),Ve=this._getOriginZoom(Pe),Vt="No cluster with the specified id.",mr=this.trees[Ve];if(!mr)throw new Error(Vt);var ie=mr.points[Rt];if(!ie)throw new Error(Vt);for(var j=this.options.radius/(this.options.extent*Math.pow(2,Ve-1)),re=mr.within(ie.x,ie.y,j),ke=[],Te=0,st=re;Te<st.length;Te+=1){var ze=st[Te],Qe=mr.points[ze];Qe.parentId===Pe&&ke.push(Qe.numPoints?ye(Qe):this.points[Qe.index])}if(ke.length===0)throw new Error(Vt);return ke},Ce.prototype.getLeaves=function(Pe,Rt,Ve){Rt=Rt||10,Ve=Ve||0;var Vt=[];return this._appendLeaves(Vt,Pe,Rt,Ve,0),Vt},Ce.prototype.getTile=function(Pe,Rt,Ve){var Vt=this.trees[this._limitZoom(Pe)],mr=Math.pow(2,Pe),ie=this.options,j=ie.extent,re=ie.radius,ke=re/j,Te=(Ve-ke)/mr,st=(Ve+1+ke)/mr,ze={features:[]};return this._addTileFeatures(Vt.range((Rt-ke)/mr,Te,(Rt+1+ke)/mr,st),Vt.points,Rt,Ve,mr,ze),Rt===0&&this._addTileFeatures(Vt.range(1-ke/mr,Te,1,st),Vt.points,mr,Ve,mr,ze),Rt===mr-1&&this._addTileFeatures(Vt.range(0,Te,ke/mr,st),Vt.points,-1,Ve,mr,ze),ze.features.length?ze:null},Ce.prototype.getClusterExpansionZoom=function(Pe){for(var Rt=this._getOriginZoom(Pe)-1;Rt<=this.options.maxZoom;){var Ve=this.getChildren(Pe);if(Rt++,Ve.length!==1)break;Pe=Ve[0].properties.cluster_id}return Rt},Ce.prototype._appendLeaves=function(Pe,Rt,Ve,Vt,mr){for(var ie=this.getChildren(Rt),j=0,re=ie;j<re.length;j+=1){var ke=re[j],Te=ke.properties;if(Te&&Te.cluster?mr+Te.point_count<=Vt?mr+=Te.point_count:mr=this._appendLeaves(Pe,Te.cluster_id,Ve,Vt,mr):mr<Vt?mr++:Pe.push(ke),Pe.length===Ve)break}return mr},Ce.prototype._addTileFeatures=function(Pe,Rt,Ve,Vt,mr,ie){for(var j=0,re=Pe;j<re.length;j+=1){var ke=re[j],Te=Rt[ke],st=Te.numPoints,ze=void 0,Qe=void 0,at=void 0;if(st)ze=St(Te),Qe=Te.x,at=Te.y;else{var Mt=this.points[Te.index];ze=Mt.properties,Qe=mt(Mt.geometry.coordinates[0]),at=Ze(Mt.geometry.coordinates[1])}var vr={type:1,geometry:[[Math.round(this.options.extent*(Qe*mr-Ve)),Math.round(this.options.extent*(at*mr-Vt))]],tags:ze},kt=void 0;st?kt=Te.id:this.options.generateId?kt=Te.index:this.points[Te.index].id&&(kt=this.points[Te.index].id),kt!==void 0&&(vr.id=kt),ie.features.push(vr)}},Ce.prototype._limitZoom=function(Pe){return Math.max(this.options.minZoom,Math.min(Math.floor(+Pe),this.options.maxZoom+1))},Ce.prototype._cluster=function(Pe,Rt){for(var Ve=[],Vt=this.options,mr=Vt.radius,ie=Vt.extent,j=Vt.reduce,re=Vt.minPoints,ke=mr/(ie*Math.pow(2,Rt)),Te=0;Te<Pe.length;Te++){var st=Pe[Te];if(!(st.zoom<=Rt)){st.zoom=Rt;for(var ze=this.trees[Rt+1],Qe=ze.within(st.x,st.y,ke),at=st.numPoints||1,Mt=at,vr=0,kt=Qe;vr<kt.length;vr+=1){var Vr=kt[vr],Kr=ze.points[Vr];Kr.zoom>Rt&&(Mt+=Kr.numPoints||1)}if(Mt>at&&Mt>=re){for(var Ir=st.x*at,In=st.y*at,gn=j&&at>1?this._map(st,!0):null,nn=(Te<<5)+(Rt+1)+this.points.length,hi=0,Lr=Qe;hi<Lr.length;hi+=1){var jn=Lr[hi],jr=ze.points[jn];if(!(jr.zoom<=Rt)){jr.zoom=Rt;var hn=jr.numPoints||1;Ir+=jr.x*hn,In+=jr.y*hn,jr.parentId=nn,j&&(gn||(gn=this._map(st,!0)),j(gn,this._map(jr)))}}st.parentId=nn,Ve.push(ge(Ir/Mt,In/Mt,nn,Mt,gn))}else if(Ve.push(st),Mt>1)for(var qi=0,Ei=Qe;qi<Ei.length;qi+=1){var ia=Ei[qi],ta=ze.points[ia];ta.zoom<=Rt||(ta.zoom=Rt,Ve.push(ta))}}}return Ve},Ce.prototype._getOriginId=function(Pe){return Pe-this.points.length>>5},Ce.prototype._getOriginZoom=function(Pe){return(Pe-this.points.length)%32},Ce.prototype._map=function(Pe,Rt){if(Pe.numPoints)return Rt?dr({},Pe.properties):Pe.properties;var Ve=this.points[Pe.index].properties,Vt=this.options.map(Ve);return Rt&&Vt===Ve?dr({},Vt):Vt};function ge(ft,Pe,Rt,Ve,Vt){return{x:Ae(ft),y:Ae(Pe),zoom:1/0,id:Rt,parentId:-1,numPoints:Ve,properties:Vt}}function ct(ft,Pe){var Rt=ft.geometry.coordinates,Ve=Rt[0],Vt=Rt[1];return{x:Ae(mt(Ve)),y:Ae(Ze(Vt)),zoom:1/0,index:Pe,parentId:-1}}function ye(ft){return{type:"Feature",id:ft.id,properties:St(ft),geometry:{type:"Point",coordinates:[ht(ft.x),it(ft.y)]}}}function St(ft){var Pe=ft.numPoints,Rt=Pe>=1e4?Math.round(Pe/1e3)+"k":Pe>=1e3?Math.round(Pe/100)/10+"k":Pe;return dr(dr({},ft.properties),{cluster:!0,cluster_id:ft.id,point_count:Pe,point_count_abbreviated:Rt})}function mt(ft){return ft/360+.5}function Ze(ft){var Pe=Math.sin(ft*Math.PI/180),Rt=.5-.25*Math.log((1+Pe)/(1-Pe))/Math.PI;return Rt<0?0:Rt>1?1:Rt}function ht(ft){return(ft-.5)*360}function it(ft){var Pe=(180-ft*360)*Math.PI/180;return 360*Math.atan(Math.exp(Pe))/Math.PI-90}function dr(ft,Pe){for(var Rt in Pe)ft[Rt]=Pe[Rt];return ft}function yr(ft){return ft.x}function cr(ft){return ft.y}return Ce})},17061:function(Ut,ae,O){var te=O(18698).default;function de(){"use strict";Ut.exports=de=function(){return le},Ut.exports.__esModule=!0,Ut.exports.default=Ut.exports;var y,le={},P=Object.prototype,Y=P.hasOwnProperty,V=Object.defineProperty||function(ze,Qe,at){ze[Qe]=at.value},ue=typeof Symbol=="function"?Symbol:{},H=ue.iterator||"@@iterator",Ae=ue.asyncIterator||"@@asyncIterator",Ce=ue.toStringTag||"@@toStringTag";function ge(ze,Qe,at){return Object.defineProperty(ze,Qe,{value:at,enumerable:!0,configurable:!0,writable:!0}),ze[Qe]}try{ge({},"")}catch(ze){ge=function(at,Mt,vr){return at[Mt]=vr}}function ct(ze,Qe,at,Mt){var vr=Qe&&Qe.prototype instanceof dr?Qe:dr,kt=Object.create(vr.prototype),Vr=new Te(Mt||[]);return V(kt,"_invoke",{value:ie(ze,at,Vr)}),kt}function ye(ze,Qe,at){try{return{type:"normal",arg:ze.call(Qe,at)}}catch(Mt){return{type:"throw",arg:Mt}}}le.wrap=ct;var St="suspendedStart",mt="suspendedYield",Ze="executing",ht="completed",it={};function dr(){}function yr(){}function cr(){}var ft={};ge(ft,H,function(){return this});var Pe=Object.getPrototypeOf,Rt=Pe&&Pe(Pe(st([])));Rt&&Rt!==P&&Y.call(Rt,H)&&(ft=Rt);var Ve=cr.prototype=dr.prototype=Object.create(ft);function Vt(ze){["next","throw","return"].forEach(function(Qe){ge(ze,Qe,function(at){return this._invoke(Qe,at)})})}function mr(ze,Qe){function at(vr,kt,Vr,Kr){var Ir=ye(ze[vr],ze,kt);if(Ir.type!=="throw"){var In=Ir.arg,gn=In.value;return gn&&te(gn)=="object"&&Y.call(gn,"__await")?Qe.resolve(gn.__await).then(function(nn){at("next",nn,Vr,Kr)},function(nn){at("throw",nn,Vr,Kr)}):Qe.resolve(gn).then(function(nn){In.value=nn,Vr(In)},function(nn){return at("throw",nn,Vr,Kr)})}Kr(Ir.arg)}var Mt;V(this,"_invoke",{value:function(kt,Vr){function Kr(){return new Qe(function(Ir,In){at(kt,Vr,Ir,In)})}return Mt=Mt?Mt.then(Kr,Kr):Kr()}})}function ie(ze,Qe,at){var Mt=St;return function(vr,kt){if(Mt===Ze)throw new Error("Generator is already running");if(Mt===ht){if(vr==="throw")throw kt;return{value:y,done:!0}}for(at.method=vr,at.arg=kt;;){var Vr=at.delegate;if(Vr){var Kr=j(Vr,at);if(Kr){if(Kr===it)continue;return Kr}}if(at.method==="next")at.sent=at._sent=at.arg;else if(at.method==="throw"){if(Mt===St)throw Mt=ht,at.arg;at.dispatchException(at.arg)}else at.method==="return"&&at.abrupt("return",at.arg);Mt=Ze;var Ir=ye(ze,Qe,at);if(Ir.type==="normal"){if(Mt=at.done?ht:mt,Ir.arg===it)continue;return{value:Ir.arg,done:at.done}}Ir.type==="throw"&&(Mt=ht,at.method="throw",at.arg=Ir.arg)}}}function j(ze,Qe){var at=Qe.method,Mt=ze.iterator[at];if(Mt===y)return Qe.delegate=null,at==="throw"&&ze.iterator.return&&(Qe.method="return",Qe.arg=y,j(ze,Qe),Qe.method==="throw")||at!=="return"&&(Qe.method="throw",Qe.arg=new TypeError("The iterator does not provide a '"+at+"' method")),it;var vr=ye(Mt,ze.iterator,Qe.arg);if(vr.type==="throw")return Qe.method="throw",Qe.arg=vr.arg,Qe.delegate=null,it;var kt=vr.arg;return kt?kt.done?(Qe[ze.resultName]=kt.value,Qe.next=ze.nextLoc,Qe.method!=="return"&&(Qe.method="next",Qe.arg=y),Qe.delegate=null,it):kt:(Qe.method="throw",Qe.arg=new TypeError("iterator result is not an object"),Qe.delegate=null,it)}function re(ze){var Qe={tryLoc:ze[0]};1 in ze&&(Qe.catchLoc=ze[1]),2 in ze&&(Qe.finallyLoc=ze[2],Qe.afterLoc=ze[3]),this.tryEntries.push(Qe)}function ke(ze){var Qe=ze.completion||{};Qe.type="normal",delete Qe.arg,ze.completion=Qe}function Te(ze){this.tryEntries=[{tryLoc:"root"}],ze.forEach(re,this),this.reset(!0)}function st(ze){if(ze||ze===""){var Qe=ze[H];if(Qe)return Qe.call(ze);if(typeof ze.next=="function")return ze;if(!isNaN(ze.length)){var at=-1,Mt=function vr(){for(;++at<ze.length;)if(Y.call(ze,at))return vr.value=ze[at],vr.done=!1,vr;return vr.value=y,vr.done=!0,vr};return Mt.next=Mt}}throw new TypeError(te(ze)+" is not iterable")}return yr.prototype=cr,V(Ve,"constructor",{value:cr,configurable:!0}),V(cr,"constructor",{value:yr,configurable:!0}),yr.displayName=ge(cr,Ce,"GeneratorFunction"),le.isGeneratorFunction=function(ze){var Qe=typeof ze=="function"&&ze.constructor;return!!Qe&&(Qe===yr||(Qe.displayName||Qe.name)==="GeneratorFunction")},le.mark=function(ze){return Object.setPrototypeOf?Object.setPrototypeOf(ze,cr):(ze.__proto__=cr,ge(ze,Ce,"GeneratorFunction")),ze.prototype=Object.create(Ve),ze},le.awrap=function(ze){return{__await:ze}},Vt(mr.prototype),ge(mr.prototype,Ae,function(){return this}),le.AsyncIterator=mr,le.async=function(ze,Qe,at,Mt,vr){vr===void 0&&(vr=Promise);var kt=new mr(ct(ze,Qe,at,Mt),vr);return le.isGeneratorFunction(Qe)?kt:kt.next().then(function(Vr){return Vr.done?Vr.value:kt.next()})},Vt(Ve),ge(Ve,Ce,"Generator"),ge(Ve,H,function(){return this}),ge(Ve,"toString",function(){return"[object Generator]"}),le.keys=function(ze){var Qe=Object(ze),at=[];for(var Mt in Qe)at.push(Mt);return at.reverse(),function vr(){for(;at.length;){var kt=at.pop();if(kt in Qe)return vr.value=kt,vr.done=!1,vr}return vr.done=!0,vr}},le.values=st,Te.prototype={constructor:Te,reset:function(Qe){if(this.prev=0,this.next=0,this.sent=this._sent=y,this.done=!1,this.delegate=null,this.method="next",this.arg=y,this.tryEntries.forEach(ke),!Qe)for(var at in this)at.charAt(0)==="t"&&Y.call(this,at)&&!isNaN(+at.slice(1))&&(this[at]=y)},stop:function(){this.done=!0;var Qe=this.tryEntries[0].completion;if(Qe.type==="throw")throw Qe.arg;return this.rval},dispatchException:function(Qe){if(this.done)throw Qe;var at=this;function Mt(In,gn){return Vr.type="throw",Vr.arg=Qe,at.next=In,gn&&(at.method="next",at.arg=y),!!gn}for(var vr=this.tryEntries.length-1;vr>=0;--vr){var kt=this.tryEntries[vr],Vr=kt.completion;if(kt.tryLoc==="root")return Mt("end");if(kt.tryLoc<=this.prev){var Kr=Y.call(kt,"catchLoc"),Ir=Y.call(kt,"finallyLoc");if(Kr&&Ir){if(this.prev<kt.catchLoc)return Mt(kt.catchLoc,!0);if(this.prev<kt.finallyLoc)return Mt(kt.finallyLoc)}else if(Kr){if(this.prev<kt.catchLoc)return Mt(kt.catchLoc,!0)}else{if(!Ir)throw new Error("try statement without catch or finally");if(this.prev<kt.finallyLoc)return Mt(kt.finallyLoc)}}}},abrupt:function(Qe,at){for(var Mt=this.tryEntries.length-1;Mt>=0;--Mt){var vr=this.tryEntries[Mt];if(vr.tryLoc<=this.prev&&Y.call(vr,"finallyLoc")&&this.prev<vr.finallyLoc){var kt=vr;break}}kt&&(Qe==="break"||Qe==="continue")&&kt.tryLoc<=at&&at<=kt.finallyLoc&&(kt=null);var Vr=kt?kt.completion:{};return Vr.type=Qe,Vr.arg=at,kt?(this.method="next",this.next=kt.finallyLoc,it):this.complete(Vr)},complete:function(Qe,at){if(Qe.type==="throw")throw Qe.arg;return Qe.type==="break"||Qe.type==="continue"?this.next=Qe.arg:Qe.type==="return"?(this.rval=this.arg=Qe.arg,this.method="return",this.next="end"):Qe.type==="normal"&&at&&(this.next=at),it},finish:function(Qe){for(var at=this.tryEntries.length-1;at>=0;--at){var Mt=this.tryEntries[at];if(Mt.finallyLoc===Qe)return this.complete(Mt.completion,Mt.afterLoc),ke(Mt),it}},catch:function(Qe){for(var at=this.tryEntries.length-1;at>=0;--at){var Mt=this.tryEntries[at];if(Mt.tryLoc===Qe){var vr=Mt.completion;if(vr.type==="throw"){var kt=vr.arg;ke(Mt)}return kt}}throw new Error("illegal catch attempt")},delegateYield:function(Qe,at,Mt){return this.delegate={iterator:st(Qe),resultName:at,nextLoc:Mt},this.method==="next"&&(this.arg=y),it}},le}Ut.exports=de,Ut.exports.__esModule=!0,Ut.exports.default=Ut.exports},18698:function(Ut){function ae(O){"@babel/helpers - typeof";return Ut.exports=ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},Ut.exports.__esModule=!0,Ut.exports.default=Ut.exports,ae(O)}Ut.exports=ae,Ut.exports.__esModule=!0,Ut.exports.default=Ut.exports},64687:function(Ut,ae,O){var te=O(17061)();Ut.exports=te;try{regeneratorRuntime=te}catch(de){typeof globalThis=="object"?globalThis.regeneratorRuntime=te:Function("r","regeneratorRuntime = r")(te)}},8520:function(Ut,ae,O){var te;(function(de){(function(y){var le=typeof globalThis=="object"?globalThis:typeof O.g=="object"?O.g:typeof self=="object"?self:typeof this=="object"?this:H(),P=Y(de);typeof le.Reflect!="undefined"&&(P=Y(le.Reflect,P)),y(P,le),typeof le.Reflect=="undefined"&&(le.Reflect=de);function Y(Ae,Ce){return function(ge,ct){Object.defineProperty(Ae,ge,{configurable:!0,writable:!0,value:ct}),Ce&&Ce(ge,ct)}}function V(){try{return Function("return this;")()}catch(Ae){}}function ue(){try{return(0,eval)("(function() { return this; })()")}catch(Ae){}}function H(){return V()||ue()}})(function(y,le){var P=Object.prototype.hasOwnProperty,Y=typeof Symbol=="function",V=Y&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ue=Y&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",H=typeof Object.create=="function",Ae={__proto__:[]}instanceof Array,Ce=!H&&!Ae,ge={create:H?function(){return Ci(Object.create(null))}:Ae?function(){return Ci({__proto__:null})}:function(){return Ci({})},has:Ce?function(he,L){return P.call(he,L)}:function(he,L){return L in he},get:Ce?function(he,L){return P.call(he,L)?he[L]:void 0}:function(he,L){return he[L]}},ct=Object.getPrototypeOf(Function),ye=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Gr(),St=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:rn(),mt=typeof WeakMap=="function"?WeakMap:yn(),Ze=Y?Symbol.for("@reflect-metadata:registry"):void 0,ht=po(),it=To(ht);function dr(he,L,z,fe){if(kt(z)){if(!jn(he))throw new TypeError;if(!hn(L))throw new TypeError;return j(he,L)}else{if(!jn(he))throw new TypeError;if(!Ir(L))throw new TypeError;if(!Ir(fe)&&!kt(fe)&&!Vr(fe))throw new TypeError;return Vr(fe)&&(fe=void 0),z=Lr(z),re(he,L,z,fe)}}y("decorate",dr);function yr(he,L){function z(fe,Re){if(!Ir(fe))throw new TypeError;if(!kt(Re)&&!qi(Re))throw new TypeError;Qe(he,L,fe,Re)}return z}y("metadata",yr);function cr(he,L,z,fe){if(!Ir(z))throw new TypeError;return kt(fe)||(fe=Lr(fe)),Qe(he,L,z,fe)}y("defineMetadata",cr);function ft(he,L,z){if(!Ir(L))throw new TypeError;return kt(z)||(z=Lr(z)),ke(he,L,z)}y("hasMetadata",ft);function Pe(he,L,z){if(!Ir(L))throw new TypeError;return kt(z)||(z=Lr(z)),Te(he,L,z)}y("hasOwnMetadata",Pe);function Rt(he,L,z){if(!Ir(L))throw new TypeError;return kt(z)||(z=Lr(z)),st(he,L,z)}y("getMetadata",Rt);function Ve(he,L,z){if(!Ir(L))throw new TypeError;return kt(z)||(z=Lr(z)),ze(he,L,z)}y("getOwnMetadata",Ve);function Vt(he,L){if(!Ir(he))throw new TypeError;return kt(L)||(L=Lr(L)),at(he,L)}y("getMetadataKeys",Vt);function mr(he,L){if(!Ir(he))throw new TypeError;return kt(L)||(L=Lr(L)),Mt(he,L)}y("getOwnMetadataKeys",mr);function ie(he,L,z){if(!Ir(L))throw new TypeError;if(kt(z)||(z=Lr(z)),!Ir(L))throw new TypeError;kt(z)||(z=Lr(z));var fe=br(L,z,!1);return kt(fe)?!1:fe.OrdinaryDeleteMetadata(he,L,z)}y("deleteMetadata",ie);function j(he,L){for(var z=he.length-1;z>=0;--z){var fe=he[z],Re=fe(L);if(!kt(Re)&&!Vr(Re)){if(!hn(Re))throw new TypeError;L=Re}}return L}function re(he,L,z,fe){for(var Re=he.length-1;Re>=0;--Re){var Ue=he[Re],$t=Ue(L,z,fe);if(!kt($t)&&!Vr($t)){if(!Ir($t))throw new TypeError;fe=$t}}return fe}function ke(he,L,z){var fe=Te(he,L,z);if(fe)return!0;var Re=da(L);return Vr(Re)?!1:ke(he,Re,z)}function Te(he,L,z){var fe=br(L,z,!1);return kt(fe)?!1:nn(fe.OrdinaryHasOwnMetadata(he,L,z))}function st(he,L,z){var fe=Te(he,L,z);if(fe)return ze(he,L,z);var Re=da(L);if(!Vr(Re))return st(he,Re,z)}function ze(he,L,z){var fe=br(L,z,!1);if(!kt(fe))return fe.OrdinaryGetOwnMetadata(he,L,z)}function Qe(he,L,z,fe){var Re=br(z,fe,!0);Re.OrdinaryDefineOwnMetadata(he,L,z,fe)}function at(he,L){var z=Mt(he,L),fe=da(he);if(fe===null)return z;var Re=at(fe,L);if(Re.length<=0)return z;if(z.length<=0)return Re;for(var Ue=new St,$t=[],Lt=0,Bt=z;Lt<Bt.length;Lt++){var xt=Bt[Lt],U=Ue.has(xt);U||(Ue.add(xt),$t.push(xt))}for(var N=0,q=Re;N<q.length;N++){var xt=q[N],U=Ue.has(xt);U||(Ue.add(xt),$t.push(xt))}return $t}function Mt(he,L){var z=br(he,L,!1);return z?z.OrdinaryOwnMetadataKeys(he,L):[]}function vr(he){if(he===null)return 1;switch(typeof he){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return he===null?1:6;default:return 6}}function kt(he){return he===void 0}function Vr(he){return he===null}function Kr(he){return typeof he=="symbol"}function Ir(he){return typeof he=="object"?he!==null:typeof he=="function"}function In(he,L){switch(vr(he)){case 0:return he;case 1:return he;case 2:return he;case 3:return he;case 4:return he;case 5:return he}var z=L===3?"string":L===5?"number":"default",fe=ia(he,V);if(fe!==void 0){var Re=fe.call(he,z);if(Ir(Re))throw new TypeError;return Re}return gn(he,z==="default"?"number":z)}function gn(he,L){if(L==="string"){var z=he.toString;if(jr(z)){var fe=z.call(he);if(!Ir(fe))return fe}var Re=he.valueOf;if(jr(Re)){var fe=Re.call(he);if(!Ir(fe))return fe}}else{var Re=he.valueOf;if(jr(Re)){var fe=Re.call(he);if(!Ir(fe))return fe}var Ue=he.toString;if(jr(Ue)){var fe=Ue.call(he);if(!Ir(fe))return fe}}throw new TypeError}function nn(he){return!!he}function hi(he){return""+he}function Lr(he){var L=In(he,3);return Kr(L)?L:hi(L)}function jn(he){return Array.isArray?Array.isArray(he):he instanceof Object?he instanceof Array:Object.prototype.toString.call(he)==="[object Array]"}function jr(he){return typeof he=="function"}function hn(he){return typeof he=="function"}function qi(he){switch(vr(he)){case 3:return!0;case 4:return!0;default:return!1}}function Ei(he,L){return he===L||he!==he&&L!==L}function ia(he,L){var z=he[L];if(z!=null){if(!jr(z))throw new TypeError;return z}}function ta(he){var L=ia(he,ue);if(!jr(L))throw new TypeError;var z=L.call(he);if(!Ir(z))throw new TypeError;return z}function Se(he){return he.value}function Ni(he){var L=he.next();return L.done?!1:L}function aa(he){var L=he.return;L&&L.call(he)}function da(he){var L=Object.getPrototypeOf(he);if(typeof he!="function"||he===ct||L!==ct)return L;var z=he.prototype,fe=z&&Object.getPrototypeOf(z);if(fe==null||fe===Object.prototype)return L;var Re=fe.constructor;return typeof Re!="function"||Re===he?L:Re}function so(){var he;!kt(Ze)&&typeof le.Reflect!="undefined"&&!(Ze in le.Reflect)&&typeof le.Reflect.defineMetadata=="function"&&(he=Gt(le.Reflect));var L,z,fe,Re=new mt,Ue={registerProvider:$t,getProvider:Bt,setProvider:U};return Ue;function $t(N){if(!Object.isExtensible(Ue))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case he===N:break;case kt(L):L=N;break;case L===N:break;case kt(z):z=N;break;case z===N:break;default:fe===void 0&&(fe=new St),fe.add(N);break}}function Lt(N,q){if(!kt(L)){if(L.isProviderFor(N,q))return L;if(!kt(z)){if(z.isProviderFor(N,q))return L;if(!kt(fe))for(var se=ta(fe);;){var Me=Ni(se);if(!Me)return;var We=Se(Me);if(We.isProviderFor(N,q))return aa(se),We}}}if(!kt(he)&&he.isProviderFor(N,q))return he}function Bt(N,q){var se=Re.get(N),Me;return kt(se)||(Me=se.get(q)),kt(Me)&&(Me=Lt(N,q),kt(Me)||(kt(se)&&(se=new ye,Re.set(N,se)),se.set(q,Me))),Me}function xt(N){if(kt(N))throw new TypeError;return L===N||z===N||!kt(fe)&&fe.has(N)}function U(N,q,se){if(!xt(se))throw new Error("Metadata provider not registered.");var Me=Bt(N,q);if(Me!==se){if(!kt(Me))return!1;var We=Re.get(N);kt(We)&&(We=new ye,Re.set(N,We)),We.set(q,se)}return!0}}function po(){var he;return!kt(Ze)&&Ir(le.Reflect)&&Object.isExtensible(le.Reflect)&&(he=le.Reflect[Ze]),kt(he)&&(he=so()),!kt(Ze)&&Ir(le.Reflect)&&Object.isExtensible(le.Reflect)&&Object.defineProperty(le.Reflect,Ze,{enumerable:!1,configurable:!1,writable:!1,value:he}),he}function To(he){var L=new mt,z={isProviderFor:function(xt,U){var N=L.get(xt);return kt(N)?!1:N.has(U)},OrdinaryDefineOwnMetadata:$t,OrdinaryHasOwnMetadata:Re,OrdinaryGetOwnMetadata:Ue,OrdinaryOwnMetadataKeys:Lt,OrdinaryDeleteMetadata:Bt};return ht.registerProvider(z),z;function fe(xt,U,N){var q=L.get(xt),se=!1;if(kt(q)){if(!N)return;q=new ye,L.set(xt,q),se=!0}var Me=q.get(U);if(kt(Me)){if(!N)return;if(Me=new ye,q.set(U,Me),!he.setProvider(xt,U,z))throw q.delete(U),se&&L.delete(xt),new Error("Wrong provider for target.")}return Me}function Re(xt,U,N){var q=fe(U,N,!1);return kt(q)?!1:nn(q.has(xt))}function Ue(xt,U,N){var q=fe(U,N,!1);if(!kt(q))return q.get(xt)}function $t(xt,U,N,q){var se=fe(N,q,!0);se.set(xt,U)}function Lt(xt,U){var N=[],q=fe(xt,U,!1);if(kt(q))return N;for(var se=q.keys(),Me=ta(se),We=0;;){var ut=Ni(Me);if(!ut)return N.length=We,N;var W=Se(ut);try{N[We]=W}catch(ne){try{aa(Me)}finally{throw ne}}We++}}function Bt(xt,U,N){var q=fe(U,N,!1);if(kt(q)||!q.delete(xt))return!1;if(q.size===0){var se=L.get(U);kt(se)||(se.delete(N),se.size===0&&L.delete(se))}return!0}}function Gt(he){var L=he.defineMetadata,z=he.hasOwnMetadata,fe=he.getOwnMetadata,Re=he.getOwnMetadataKeys,Ue=he.deleteMetadata,$t=new mt,Lt={isProviderFor:function(Bt,xt){var U=$t.get(Bt);return kt(U)?Re(Bt,xt).length?(kt(U)&&(U=new St,$t.set(Bt,U)),U.add(xt),!0):!1:U.has(xt)},OrdinaryDefineOwnMetadata:L,OrdinaryHasOwnMetadata:z,OrdinaryGetOwnMetadata:fe,OrdinaryOwnMetadataKeys:Re,OrdinaryDeleteMetadata:Ue};return Lt}function br(he,L,z){var fe=ht.getProvider(he,L);if(!kt(fe))return fe;if(z){if(ht.setProvider(he,L,it))return it;throw new Error("Illegal state.")}}function Gr(){var he={},L=[],z=function(){function Lt(Bt,xt,U){this._index=0,this._keys=Bt,this._values=xt,this._selector=U}return Lt.prototype["@@iterator"]=function(){return this},Lt.prototype[ue]=function(){return this},Lt.prototype.next=function(){var Bt=this._index;if(Bt>=0&&Bt<this._keys.length){var xt=this._selector(this._keys[Bt],this._values[Bt]);return Bt+1>=this._keys.length?(this._index=-1,this._keys=L,this._values=L):this._index++,{value:xt,done:!1}}return{value:void 0,done:!0}},Lt.prototype.throw=function(Bt){throw this._index>=0&&(this._index=-1,this._keys=L,this._values=L),Bt},Lt.prototype.return=function(Bt){return this._index>=0&&(this._index=-1,this._keys=L,this._values=L),{value:Bt,done:!0}},Lt}(),fe=function(){function Lt(){this._keys=[],this._values=[],this._cacheKey=he,this._cacheIndex=-2}return Object.defineProperty(Lt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Lt.prototype.has=function(Bt){return this._find(Bt,!1)>=0},Lt.prototype.get=function(Bt){var xt=this._find(Bt,!1);return xt>=0?this._values[xt]:void 0},Lt.prototype.set=function(Bt,xt){var U=this._find(Bt,!0);return this._values[U]=xt,this},Lt.prototype.delete=function(Bt){var xt=this._find(Bt,!1);if(xt>=0){for(var U=this._keys.length,N=xt+1;N<U;N++)this._keys[N-1]=this._keys[N],this._values[N-1]=this._values[N];return this._keys.length--,this._values.length--,Ei(Bt,this._cacheKey)&&(this._cacheKey=he,this._cacheIndex=-2),!0}return!1},Lt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=he,this._cacheIndex=-2},Lt.prototype.keys=function(){return new z(this._keys,this._values,Re)},Lt.prototype.values=function(){return new z(this._keys,this._values,Ue)},Lt.prototype.entries=function(){return new z(this._keys,this._values,$t)},Lt.prototype["@@iterator"]=function(){return this.entries()},Lt.prototype[ue]=function(){return this.entries()},Lt.prototype._find=function(Bt,xt){if(!Ei(this._cacheKey,Bt)){this._cacheIndex=-1;for(var U=0;U<this._keys.length;U++)if(Ei(this._keys[U],Bt)){this._cacheIndex=U;break}}return this._cacheIndex<0&&xt&&(this._cacheIndex=this._keys.length,this._keys.push(Bt),this._values.push(void 0)),this._cacheIndex},Lt}();return fe;function Re(Lt,Bt){return Lt}function Ue(Lt,Bt){return Bt}function $t(Lt,Bt){return[Lt,Bt]}}function rn(){var he=function(){function L(){this._map=new ye}return Object.defineProperty(L.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),L.prototype.has=function(z){return this._map.has(z)},L.prototype.add=function(z){return this._map.set(z,z),this},L.prototype.delete=function(z){return this._map.delete(z)},L.prototype.clear=function(){this._map.clear()},L.prototype.keys=function(){return this._map.keys()},L.prototype.values=function(){return this._map.keys()},L.prototype.entries=function(){return this._map.entries()},L.prototype["@@iterator"]=function(){return this.keys()},L.prototype[ue]=function(){return this.keys()},L}();return he}function yn(){var he=16,L=ge.create(),z=fe();return function(){function Bt(){this._key=fe()}return Bt.prototype.has=function(xt){var U=Re(xt,!1);return U!==void 0?ge.has(U,this._key):!1},Bt.prototype.get=function(xt){var U=Re(xt,!1);return U!==void 0?ge.get(U,this._key):void 0},Bt.prototype.set=function(xt,U){var N=Re(xt,!0);return N[this._key]=U,this},Bt.prototype.delete=function(xt){var U=Re(xt,!1);return U!==void 0?delete U[this._key]:!1},Bt.prototype.clear=function(){this._key=fe()},Bt}();function fe(){var Bt;do Bt="@@WeakMap@@"+Lt();while(ge.has(L,Bt));return L[Bt]=!0,Bt}function Re(Bt,xt){if(!P.call(Bt,z)){if(!xt)return;Object.defineProperty(Bt,z,{value:ge.create()})}return Bt[z]}function Ue(Bt,xt){for(var U=0;U<xt;++U)Bt[U]=Math.random()*255|0;return Bt}function $t(Bt){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Bt)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Bt)):Ue(new Uint8Array(Bt),Bt):Ue(new Array(Bt),Bt)}function Lt(){var Bt=$t(he);Bt[6]=Bt[6]&79|64,Bt[8]=Bt[8]&191|128;for(var xt="",U=0;U<he;++U){var N=Bt[U];(U===4||U===6||U===8)&&(xt+="-"),N<16&&(xt+="0"),xt+=N.toString(16).toLowerCase()}return xt}}function Ci(he){return he.__=void 0,delete he.__,he}})})(te||(te={}))}}]);
}());